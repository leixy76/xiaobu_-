<html><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><link href="style.css" rel="stylesheet" type="text/css" /><title>Programming TypeScript</title></head><body><div data-type="book" class="calibre1" id="calibre_link-0"><section data-pdf-bookmark="Programming TypeScript" data-type="titlepage" type="titlepage" class="pcalibre1 pcalibre"><div class="preface" id="calibre_link-1772">
<h1 class="calibre2">Programming TypeScript</h1>

<p class="subtitle">Making Your JavaScript Applications Scale</p>
<p class="author">Boris Cherny</p>
</div></section></div>

<div data-type="book" class="calibre1" id="calibre_link-1"><section data-pdf-bookmark="Programming TypeScript" data-type="copyright-page" type="copyright-page" class="preface"><div class="preface" id="calibre_link-1773">
<h1 class="calibre3">Programming TypeScript</h1>

<p class="author1">by <span class="calibre">Boris </span> <span class="calibre">Cherny</span></p>

<p class="author1">Copyright © 2019 Boris Cherny. All rights reserved.</p>

<p class="author1">Printed in the United States of America.</p>

<p class="author1">Published by <span class="calibre">O’Reilly Media, Inc.</span>, 1005 Gravenstein Highway North, Sebastopol, CA 95472.</p>

<p class="author1">O’Reilly books may be purchased for educational, business, or sales promotional use. Online editions are also available for most titles (<a href="http://oreilly.com" class="calibre4">http://oreilly.com</a>). For more information, contact our corporate/institutional sales department: 800-998-9938 or <span data-type="email" class="calibre"><em class="calibre5">corporate@oreilly.com</em></span>.</p>

<table class="stafflist_table">
	<tbody class="calibre6">
		<tr class="calibre7">
			<td class="calibre8"><p class="author1"><span class="calibre">Development Editor:</span> Angela Rufino</p></td>
			<td class="calibre8"><p class="author1"><span class="calibre">Indexer:</span> Margaret Troutman</p></td>
		</tr>
		<tr class="calibre9">
			<td class="calibre8"><p class="author1"><span class="calibre">Acquisitions Editor:</span> Jennifer Pollock</p></td>
			<td class="calibre8"><p class="author1"><span class="calibre">Interior Designer:</span> David Futato</p></td>
		</tr>
		<tr class="calibre7">
			<td class="calibre8"><p class="author1"><span class="calibre">Production Editor:</span> Katherine Tozer</p></td>
			<td class="calibre8"><p class="author1"><span class="calibre">Cover Designer:</span> Karen Montgomery</p></td>
		</tr>
		<tr class="calibre9">
			<td class="calibre8"><p class="author1"><span class="calibre">Copyeditor:</span> Rachel Head</p></td>
			<td class="calibre8"><p class="author1"><span class="calibre">Illustrator:</span> Rebecca Demarest</p></td>
		</tr>
		<tr class="calibre7">
			<td class="calibre8"><p class="author1"><span class="calibre">Proofreader:</span> Charles Roumeliotis</p></td>
		</tr>
	</tbody>
</table>

<ul class="printings">
	<li class="calibre10"><span class="calibre">May 2019:</span> First Edition</li>
</ul>


<div class="preface">
<h1 class="calibre3">Revision History for the First Edition</h1>

<ul class="printings">
	<li class="calibre11"><span class="calibre">2019-04-18:</span> First Release</li>
</ul>
</div>

<p class="author1">See <a href="http://oreilly.com/catalog/errata.csp?isbn=9781492037651" class="calibre4">http://oreilly.com/catalog/errata.csp?isbn=9781492037651</a> for release details.</p>

<div class="preface">
<p class="author1">The O’Reilly logo is a registered trademark of O’Reilly Media, Inc. <em class="calibre5">Programming TypeScript</em>, the cover image, and related trade dress are trademarks of O’Reilly Media, Inc.</p>

<p class="author1">The views expressed in this work are those of the author, and do not represent the publisher’s views. While the publisher and the author have used good faith efforts to ensure that the information and instructions contained in this work are accurate, the publisher and the author disclaim all responsibility for errors or omissions, including without limitation responsibility for damages resulting from the use of or reliance on this work. Use of the information and instructions contained in this work is at your own risk. If any code samples or other technology this work contains or describes is subject to open source licenses or the intellectual property rights of others, it is your responsibility to ensure that your use thereof complies with such licenses and/or rights.  </p>
</div>

<div class="preface">
<p class="author1">978-1-492-03765-1</p>

<p class="author1">[LSI]</p>
</div>
</div></section></div>

<div data-type="book" class="calibre1" id="calibre_link-2"><section data-pdf-bookmark="Dedication" data-type="dedication" type="dedication" class="preface"><div class="preface" id="calibre_link-1774">
<h1 class="calibre3">Dedication</h1>


<p class="author1">To Sasha and Michael, who might also fall in love with types, someday.</p>
</div></section></div>

<div data-type="book" class="calibre1" id="calibre_link-3"><section data-pdf-bookmark="Preface" data-type="preface" type="preface" class="preface"><div class="preface" id="calibre_link-1775">
<h1 class="calibre12">Preface</h1>


<p class="author1">This is a book for programmers of all walks: professional JavaScript engineers, C# people, Java sympathizers, Python lovers, Ruby aficionados, Haskell nerds. Whatever language(s) you write in, so long as you have some experience programming and know the basics of functions, variables, classes, and errors, this book is for you. Some experience with JavaScript, including a basic knowledge of the Document Object Model (DOM) and the network, will help you along the way&mdash;while we don’t dive deep into these concepts, they are a wellspring of excellent examples, and if you’re not familiar with them the examples might not make as much sense.<a data-primary="JavaScript" data-type="indexterm" id="calibre_link-1142" class="calibre4"></a><a data-primary="DOM (Document Object Model)" data-type="indexterm" id="calibre_link-849" class="calibre4"></a></p>

<p class="author1">Regardless of what programming languages you’ve used in the past, what unites all of us is our shared experience of tracking down exceptions, tracing through code line by line to figure out what went wrong and how we can fix it. This is the experience that TypeScript helps prevent by examining your code automatically and pointing out the mistakes you may have missed.</p>

<p class="author1">It’s OK if you haven’t worked with a statically typed language before. I’ll teach you about types and how to use them effectively to make your programs crash less, document your code better, and scale your applications across more users, engineers, and servers. I’ll try to avoid big words when I can, and explain ideas in a way that’s intuitive, memorable, and practical, using lots of examples along the way to help keep things concrete.</p>

<p class="author1">That’s the thing about TypeScript: unlike a lot of other typed languages, TypeScript is intensely practical. It invents completely new concepts so you can speak more concisely and precisely, letting you write applications in a way that’s fun, modern, and safe.</p>






<section data-pdf-bookmark="How This Book Is Organized" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1776">
<div class="preface" id="calibre_link-1777"></div>
</div></section>













</div></section></div>

<div data-type="book" class="calibre1" id="calibre_link-4">
<section data-pdf-bookmark="Preface" data-type="preface" type="preface" class="preface">
<div class="preface" id="calibre_link-1778">
<section data-pdf-bookmark="How This Book Is Organized" data-type="sect1" class="preface">
<div class="preface" id="calibre_link-1779">
<h1 class="calibre13">How This Book Is Organized</h1>

<p class="author1">This book has two aims: to give you a deep understanding of how the TypeScript language works (theory) and provide bucketfuls of pragmatic advice about how to write production TypeScript code (practice).</p>

<p class="author1">Because TypeScript is such a practical language,  theory quickly turns to practice, and most of this book ends up being a mix of the two, with the first couple of chapters almost entirely theory, and the last few almost completely practice.</p>

<p class="author1">I’ll start with the basics of what compilers, typecheckers, and types are. I’ll then give a broad overview of the different types and type operators in TypeScript, what they’re for, and how you use them. Using what we’ve learned, I’ll cover some advanced topics like TypeScript’s most sophisticated type system features, error handling, and asynchronous programming. Finally, I’ll wrap up with how to use TypeScript with your favorite frameworks (frontend and backend), migrating your existing JavaScript project to TypeScript, and running your TypeScript application in production.</p>

<p class="author1">Most chapters come with a set of exercises at the end. Try to do these yourself&mdash;they’ll give you a deeper intuition for what we cover than just reading would. Answers for chapter exercises are available online, at <a href="https://github.com/bcherny/programming-typescript-answers" class="calibre4"><em class="calibre5">https://github.com/bcherny/programming-typescript-answers</em></a>.</p>
</div></section>













<section data-pdf-bookmark="Style" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1780">
<h1 class="calibre13">Style</h1>

<p class="author1">Throughout this book, I tried to stick to a single code style.<a data-primary="code style" data-secondary="in this book" data-type="indexterm" id="calibre_link-764" class="calibre4"></a> Some aspects of this style are deeply personal&mdash;for example:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">I only use semicolons when necessary.</p>
</li>
<li class="calibre11">
<p class="author1">I indent with two spaces.</p>
</li>
<li class="calibre11">
<p class="author1">I use short variable names like <code class="calibre14">a</code>, <code class="calibre14">f</code>, or _ where the program is a quick snippet, or where the structure of the program is more important than the details.</p>
</li>
</ul>

<p class="author1">Some aspects of the code style, however, are things that I think you should do too. A few of these are:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">You should use the latest JavaScript syntax and features (the latest JavaScript version is usually just called “esnext”).<a data-primary="JavaScript" data-secondary="latest syntax and features" data-type="indexterm" id="calibre_link-1162" class="calibre4"></a> This will keep your code in line with the latest standards, improving interoperability and Googleability, and it can help reduce ramp-up time for new hires. It also lets you take advantage of powerful, modern JavaScript features like arrow functions, promises, and generators.</p>
</li>
<li class="calibre11">
<p class="author1">You should keep your data structures immutable with spreads (<code class="calibre14">...</code>) most of the time.<sup class="calibre15"><a data-type="noteref" href="#calibre_link-5" id="calibre_link-9" class="calibre16">1</a></sup></p>
</li>
<li class="calibre11">
<p class="author1">You should make sure everything has a type, inferred when possible. Be careful not to abuse explicit types; this will help keep your code clear and terse, and improve safety by surfacing incorrect types rather than bandaiding over them.</p>
</li>
<li class="calibre11">
<p class="author1">You should keep your code reusable and generic. Polymorphism (see <a data-type="xref" href="#calibre_link-6" class="calibre4">“Polymorphism”</a>) is your best friend.</p>
</li>
</ul>

<p class="author1">Of course, these ideas are hardly new. But TypeScript works especially well when you stick to them. TypeScript’s built-in downlevel compiler, support for read-only types, powerful type inference, deep support for polymorphism, and completely structural type system encourage good coding style, while the language remains incredibly expressive and true to the underlying JavaScript.</p>

<p class="author1">A couple more notes before we begin.</p>

<p class="author1">JavaScript doesn’t expose pointers and references; instead it has value and reference types.<a data-primary="values" data-type="indexterm" id="calibre_link-1727" class="calibre4"></a><a data-primary="reference types" data-type="indexterm" id="calibre_link-1411" class="calibre4"></a> Values are immutable, and include things like strings, numbers, and booleans, while references point to often-mutable data structures like arrays, objects, and functions. When I use the word “value” in this book, I usually mean it loosely to refer to either a JavaScript value or a reference.</p>

<p class="author1">Lastly, you might find yourself writing less-than-ideal TypeScript code in the wild when interoperating with JavaScript, or incorrectly typed third-party libraries, or legacy code, or if you’re in a rush. This book largely presents how you <em class="calibre5">should</em> write TypeScript, and makes an argument for why you should try really hard not to make compromises. But in practice, how correct your code is is up to you and your team.</p>








<section data-pdf-bookmark="Conventions Used in This Book" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1781">
<h2 class="calibre17">Conventions Used in This Book</h2>

<p class="author1">The following typographical conventions are used in this book:</p>
<dl class="preface">
<dt class="calibre18"><em class="calibre5">Italic</em></dt>
<dd class="calibre19">
<p class="author1">Indicates new terms, URLs, email addresses, filenames, and file extensions.</p>
</dd>
<dt class="calibre18"><code class="calibre14">Constant width</code></dt>
<dd class="calibre19">
<p class="author1">Used for program listings, as well as within paragraphs to refer to program elements such as variable or function names, data types, environment variables, statements, and keywords.</p>
</dd>
<dt class="calibre18"><em class="calibre5"><code class="calibre20">Constant width italic</code></em></dt>
<dd class="calibre19">
<p class="author1">Shows text that should be replaced with user-supplied values or by values determined by context.</p>
</dd>
</dl>
<div data-type="tip" class="calibre21"><h6 class="calibre22">Tip</h6>
<p class="author1">This element signifies a tip or suggestion.</p>
</div>
<div data-type="note" type="note" class="calibre21"><h6 class="calibre22">Note</h6>
<p class="author1">This element signifies a general note.</p>
</div>
<div data-type="warning" type="warning" class="calibre23"><h6 class="calibre24">Warning</h6>
<p class="author1">This element indicates a warning or caution.</p>
</div>
</div></section>





</div></section>













<section data-pdf-bookmark="Using Code Examples" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1782">
<h1 class="calibre13">Using Code Examples</h1>


<p class="author1">Supplemental material (code examples, exercises, etc.) is available for download at <a href="https://github.com/bcherny/programming-typescript-answers" class="calibre4"><em class="calibre5">https://github.com/bcherny/programming-typescript-answers</em></a>.</p>

<p class="author1">This book is here to help you get your job done.<a data-primary="code examples from this book" data-type="indexterm" id="calibre_link-761" class="calibre4"></a> In general, if example code is offered with this book, you may use it in your programs and documentation. You do not need to contact us for permission unless you’re reproducing a significant portion of the code. For example, writing a program that uses several chunks of code from this book does not require permission. Selling or distributing a CD-ROM of examples from O’Reilly books does require permission. Answering a question by citing this book and quoting example code does not require permission. Incorporating a significant amount of example code from this book into your product’s documentation does require permission.</p>

<p class="author1">We appreciate, but do not require, attribution. An attribution usually includes the title, author, publisher, and ISBN. For example: “<em class="calibre5">Programming TypeScript</em> by Boris Cherny (O’Reilly). Copyright 2019 Boris Cherny, 978-1-492-03765-1.”</p>

<p class="author1">If you feel your use of code examples falls outside fair use or the permission given above, feel free to contact us at <a class="calibre4" href="mailto:permissions@oreilly.com"><em class="calibre5">permissions@oreilly.com</em></a>.</p>
</div></section>













<section data-pdf-bookmark="O’Reilly Online Learning" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1783">
<h1 class="calibre13">O’Reilly Online Learning</h1>
<div class="calibre21" data-type="note" type="note"><h6 class="calibre22">Note</h6>
<p class="author1">For almost 40 years, <a class="calibre4" href="http://oreilly.com"><em class="calibre5">O’Reilly Media</em></a> has provided technology and business training, knowledge, and insight to help companies succeed.</p>
</div>

<p class="author1">Our unique network of experts and innovators share their knowledge and expertise through books, articles, conferences, and our online learning platform. O’Reilly’s online learning platform gives you on-demand access to live training courses, in-depth learning paths, interactive coding environments, and a vast collection of text and video from O’Reilly and 200+ other publishers. For more information, please visit <a class="calibre4" href="http://oreilly.com"><em class="calibre5">http://oreilly.com</em></a>.</p>
</div></section>













<section data-pdf-bookmark="How to Contact Us" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1784">
<h1 class="calibre13">How to Contact Us</h1>

<p class="author1">Please address comments and questions concerning this book to the publisher:</p>
<ul class="printings">
  <li class="calibre25">O’Reilly Media, Inc.</li>
  <li class="calibre25">1005 Gravenstein Highway North</li>
  <li class="calibre25">Sebastopol, CA 95472</li>
  <li class="calibre25">800-998-9938 (in the United States or Canada)</li>
  <li class="calibre25">707-829-0515 (international or local)</li>
  <li class="calibre25">707-829-0104 (fax)</li>
</ul>

<p class="author1">We have a web page for <a data-primary="web page for this book" data-type="indexterm" id="calibre_link-1755" class="calibre4"></a>this book, where we list errata, examples, and any additional information. You can access this page at <a href="https://oreil.ly/programming-typescript" class="calibre4"><em class="calibre5">https://oreil.ly/programming-typescript</em></a>.</p>


<p class="author1">To comment or ask technical questions about this book, send email to <a class="calibre4" href="mailto:bookquestions@oreilly.com"><em class="calibre5">bookquestions@oreilly.com</em></a>.</p>

<p class="author1">For more information about our books, courses, conferences, and news, see our website at <a href="http://www.oreilly.com" class="calibre4"><em class="calibre5">http://www.oreilly.com</em></a>.</p>

<p class="author1">Find us on Facebook: <a href="http://facebook.com/oreilly" class="calibre4"><em class="calibre5">http://facebook.com/oreilly</em></a></p>

<p class="author1">Follow us on Twitter: <a href="http://twitter.com/oreillymedia" class="calibre4"><em class="calibre5">http://twitter.com/oreillymedia</em></a></p>

<p class="author1">Watch us on YouTube: <a href="http://www.youtube.com/oreillymedia" class="calibre4"><em class="calibre5">http://www.youtube.com/oreillymedia</em></a></p>
</div></section>













<section class="preface" data-pdf-bookmark="Acknowledgments" data-type="sect1"><div class="preface" id="calibre_link-1785">
<h1 class="calibre13">Acknowledgments</h1>

<p class="author1">This book is the product of years’ worth of snippets and doodles, followed by a year’s worth of early mornings and nights and weekends and holidays spent writing.</p>

<p class="author1">Thank you to O’Rielly for the opportunity to work on this book, and to my editor Angela Rufino for the support throughout the process. Thank you to Nick Nance for his contribution in <a data-type="xref" href="#calibre_link-7" class="calibre4">“Typesafe APIs”</a>, and to Shyam Seshadri for his contribution in <a data-type="xref" href="#calibre_link-8" class="calibre4">“Angular 6/7”</a>. Thanks to my technical editors: Daniel Rosenwasser of the TypeScript team, who spent an unreasonable amount of time reading through this manuscript and guiding me through the nuances of TypeScript’s type system, and Jonathan Creamer, Yakov Fain, and Paul Buying, and Rachel Head for technical edits and feedback. Thanks to my family&mdash;Liza and Ilya, Vadim, Roza and Alik, Faina and Yosif&mdash;for encouraging me to pursue this project.</p>

<p class="author1">Most of all, thanks to my partner Sara Gilford, who supported me throughout the writing process, even when it meant calling off weekend plans, late nights writing and coding, and far too many unprompted conversations about the ins and outs of type systems. I couldn’t have done it without you, and I’m forever grateful for your <span class="calibre">support</span>.</p>
</div></section>







<div data-type="footnotes" class="calibre26"><p data-type="footnote" id="calibre_link-5" class="calibre27"><sup class="calibre28"><a href="#calibre_link-9" class="calibre16">1</a></sup> If you’re not coming from JavaScript, here’s an example: if you have an object <code class="calibre14">o</code>, and you want to add a property <code class="calibre14">k</code> to it with the value <code class="calibre14">3</code>, you can either mutate <code class="calibre14">o</code> directly&mdash;<code class="calibre14">o.k = 3</code>&mdash;or you can apply your change to <code class="calibre14">o</code>, creating a <em class="calibre5">new</em> object as a result&mdash;<code class="calibre14">let p = {...o, k: 3}</code>.</p></div></div></section></div>

<div data-type="book" class="calibre1" id="calibre_link-10"><section class="preface" data-pdf-bookmark="Chapter 1. Introduction" data-type="chapter" type="chapter"><div class="preface" id="calibre_link-20">
<h1 class="calibre12"><span class="calibre">Chapter 1. </span>Introduction</h1>


<p class="author1">So, you decided to buy a book about TypeScript. Why?</p>

<p class="author1">Maybe it’s because you’re sick of those weird <code class="calibre14">cannot read property blah of</code> <span class="calibre"><code class="calibre14">undefined</code></span> JavaScript errors. Or maybe you heard TypeScript can help your code scale better, and wanted to see what all the fuss is about. Or you’re a C# person, and have been thinking of trying out this whole JavaScript thing. Or you’re a functional programmer, and decided it was time to take your chops to the next level. Or your boss was so fed up with your code causing production issues that they gave you this book as a Christmas present (stop me if I’m getting warm).</p>

<p class="author1">Whatever your reasons are, what you’ve heard is true. TypeScript is the language that will power the next generation of web apps, mobile apps, NodeJS projects, and Internet of Things (IoT) devices. <a data-primary="TypeScript" data-secondary="benefits of" data-type="indexterm" id="calibre_link-1675" class="calibre4"></a>It will make your programs safer by checking for common mistakes, serve as documentation for yourself and future engineers, make refactoring painless, and make, like, half of your unit tests unnecessary (“What unit tests?”). TypeScript will double your productivity as a programmer, and it will land you a date with that cute barista across the street.</p>

<p class="author1">But before you go rushing across the street, let’s unpack all of that a little bit, starting with this: what exactly do I mean when I say “safer”? <a data-primary="type safety" data-type="indexterm" id="calibre_link-1580" class="calibre4"></a>What I am talking about, of course, is <em class="calibre5">type safety</em>.</p>
<aside class="keyterm" data-type="sidebar" type="sidebar"><div class="sidebar" id="calibre_link-1786">
<h5 class="calibre29">Type safety</h5>
<p class="author1">Using types to prevent programs from doing invalid things.<sup class="calibre15"><a data-type="noteref" href="#calibre_link-11" id="calibre_link-13" class="calibre16">1</a></sup></p>
</div></aside>

<p class="author1">Here are a few examples of<a data-primary="invalid actions" data-type="indexterm" id="calibre_link-1132" class="calibre4"></a> things that are invalid:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">Multiplying a number and a list</p>
</li>
<li class="calibre11">
<p class="author1">Calling a function with a list of strings when it actually needs a list of objects</p>
</li>
<li class="calibre11">
<p class="author1">Calling a method on an object when that method doesn’t actually exist on that object</p>
</li>
<li class="calibre11">
<p class="author1">Importing a module that was recently moved</p>
</li>
</ul>

<p class="author1">There are some programming languages that try to make the most of mistakes like these. <a data-primary="errors" data-secondary="in JavaScript" data-type="indexterm" id="calibre_link-888" class="calibre4"></a>They try to figure out what you really meant when you did something invalid, because hey, you do what you can, right? Take JavaScript, for example:</p>

<pre data-code-language="js" data-type="programlisting" class="calibre30"><code class="mi">3</code> <code class="o">+</code> <code class="p">[]</code>            <code class="c">// Evaluates to the string "3"</code>

<code class="kd">let</code> <code class="nx">obj</code> <code class="o">=</code> <code class="p">{}</code>
<code class="nx">obj</code><code class="p">.</code><code class="nx">foo</code>           <code class="c">// Evaluates to undefined</code>

<code class="kd">function</code> <code class="nx">a</code><code class="p">(</code><code class="nx">b</code><code class="p">)</code> <code class="p">{</code>
  <code class="kd">return</code> <code class="nx">b</code><code class="o">/</code><code class="mi">2</code>
<code class="p">}</code>
<code class="nx">a</code><code class="p">(</code><code class="s">"z"</code><code class="p">)</code>            <code class="c">// Evaluates to NaN</code></pre>

<p class="author1">Notice that instead of throwing exceptions when you try to do things that are obviously invalid, JavaScript tries to make the best of it and avoids exceptions whenever it can.<a data-primary="exceptions" data-secondary="JavaScript and" data-type="indexterm" id="calibre_link-982" class="calibre4"></a> Is JavaScript being helpful? Certainly. Does it make it easier for you to catch bugs quickly? Probably not.</p>

<p class="author1">Now imagine if JavaScript threw more exceptions instead of quietly making the best of what we gave it. We might get feedback like this instead:</p>

<pre data-code-language="js" data-type="programlisting" class="calibre30"><code class="mi">3</code> <code class="o">+</code> <code class="p">[]</code>            <code class="c">// Error: Did you really mean to add a number and an array?</code>

<code class="kd">let</code> <code class="nx">obj</code> <code class="o">=</code> <code class="p">{}</code>
<code class="nx">obj</code><code class="p">.</code><code class="nx">foo</code>           <code class="c">// Error: You forgot to define the property "foo" on obj.</code>

<code class="kd">function</code> <code class="nx">a</code><code class="p">(</code><code class="nx">b</code><code class="p">)</code> <code class="p">{</code>
  <code class="kd">return</code> <code class="nx">b</code><code class="o">/</code><code class="mi">2</code>
<code class="p">}</code>
<code class="nx">a</code><code class="p">(</code><code class="s">"z"</code><code class="p">)</code>            <code class="c">// Error: The function "a" expects a number,</code>
                  <code class="c">// but you gave it a string.</code></pre>

<p class="author1">Don’t get me wrong: trying to fix our mistakes for us is a neat feature for a programming language to have (if only it worked for more than just programs!). But for JavaScript, this feature creates a disconnect between when you make a mistake in your code, and when you <em class="calibre5">find out</em> that you made a mistake in your code. Often, that means that the first time you hear about your mistake will be from someone else.</p>

<p class="author1">So here’s a question: when exactly does JavaScript tell you that you made a mistake?</p>

<p class="author1">Right: when you actually <em class="calibre5">run</em> your program. Your program might get run when you test it in a browser, or when a user visits your website, or when you run a unit test.<a data-primary="tests, relying on to find errors" data-type="indexterm" id="calibre_link-1471" class="calibre4"></a> If you’re disciplined and write plenty of unit tests and end-to-end tests, smoke test your code before pushing it, and test it internally for a while before shipping it to users, you will hopefully find out about your error before your users do. But what if you don’t?</p>

<p class="author1">That’s where TypeScript comes in.<a data-primary="TypeScript" data-secondary="errors, handling of" data-type="indexterm" id="calibre_link-1688" class="calibre4"></a> Even cooler than the fact that TypeScript gives you helpful error messages is <em class="calibre5">when</em> it gives them to you: TypeScript gives you error messages <em class="calibre5">in your text editor, as you type</em>. <a data-primary="errors" data-secondary="error messages in TypeScript" data-type="indexterm" id="calibre_link-876" class="calibre4"></a>That means you don’t have to rely on unit tests or smoke tests or coworkers to catch these sorts of issues: TypeScript will catch them for you and warn you about them as you write your program. Let’s see what TypeScript says about our previous example:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="mi">3</code> <code class="o">+</code> <code class="p">[]</code>            <code class="c">// Error TS2365: Operator '+' cannot be applied to types '3'</code>
                  <code class="c">// and 'never[]'.</code>

<code class="kd">let</code> <code class="nx">obj</code> <code class="o">=</code> <code class="p">{}</code>
<code class="nx">obj</code><code class="p">.</code><code class="nx">foo</code>           <code class="c">// Error TS2339: Property 'foo' does not exist on type '{}'.</code>

<code class="kd">function</code> <code class="nx">a</code><code class="p">(</code><code class="nx">b</code>: <code class="kt">number</code><code class="p">)</code> <code class="p">{</code>
  <code class="kd">return</code> <code class="nx">b</code> <code class="o">/</code> <code class="mi">2</code>
<code class="p">}</code>
<code class="nx">a</code><code class="p">(</code><code class="s">"z"</code><code class="p">)</code>            <code class="c">// Error TS2345: Argument of type '"z"' is not assignable to</code>
                  <code class="c">// parameter of type 'number'.</code></pre>

<p class="author1">In addition to <a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2339" data-type="indexterm" id="calibre_link-908" class="calibre4"></a><a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2345" data-type="indexterm" id="calibre_link-916" class="calibre4"></a><a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2365" data-type="indexterm" id="calibre_link-932" class="calibre4"></a>eliminating entire classes of type-related bugs, this will actually change the way you write code. You will find yourself sketching out a program at the type level before you fill it in at the value level;<sup class="calibre15"><a data-type="noteref" href="#calibre_link-12" id="calibre_link-14" class="calibre16">2</a></sup> you will think about edge cases as you design your program, not as an afterthought; and you will design programs that are simpler, faster, easier to understand, and easier to maintain.</p>

<p class="author1">Are you ready to begin the journey? Let’s go!</p>
<div data-type="footnotes" class="calibre26"><p data-type="footnote" id="calibre_link-11" class="calibre27"><sup class="calibre28"><a href="#calibre_link-13" class="calibre16">1</a></sup> Depending on which statically typed language you use, “invalid” can mean a range of things, from programs that will crash when you run them to things that won’t crash but are clearly nonsensical.</p><p data-type="footnote" id="calibre_link-12" class="calibre27"><sup class="calibre28"><a href="#calibre_link-14" class="calibre16">2</a></sup> If you’re not sure what “type level” means here, don’t worry. We’ll go over it in depth in later chapters.</p></div></div></section></div>

<div data-type="book" class="calibre1" id="calibre_link-15"><section data-pdf-bookmark="Chapter 2. TypeScript: A 10_000 Foot View" data-type="chapter" type="chapter" class="preface"><div class="preface" id="calibre_link-1787">
<h1 class="calibre12"><span class="calibre">Chapter 2. </span>TypeScript: A 10_000 Foot View</h1>


<p class="author1">Over the next few chapters, I’ll introduce the TypeScript language, give you an overview of how the TypeScript Compiler (TSC) works, and take you on a tour of TypeScript’s features and the patterns you can develop with them. We’ll start with the compiler.<a data-primary="TypeScript" data-secondary="compiler" data-type="indexterm" id="calibre_link-1686" class="calibre4"></a></p>






<section data-pdf-bookmark="The Compiler" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1788">
<h1 class="calibre13">The Compiler</h1>

<p class="author1">Depending on what programming languages you worked with in the past (that is, before you decided to buy this book and commit to a life of type safety), you’ll have a different understanding of how programs work. The way TypeScript works is unusual compared to other mainstream languages like JavaScript or Java, so it’s important that we’re on the same page before we go any further.</p>

<p class="author1">Let’s start broad: programs are files that contain a bunch of text written by you, the  programmer.<a data-primary="compilers" data-secondary="TypeScript compiler" data-type="indexterm" id="calibre_link-776" class="calibre4"></a> That text is parsed by a special program called a <em class="calibre5">compiler</em>, which transforms it into an <em class="calibre5">abstract syntax tree (AST)</em>, a data structure that ignores things like whitespace, comments, and where you stand on the tabs versus spaces debate.<a data-primary="AST (abstract syntax tree)" data-type="indexterm" id="calibre_link-664" class="calibre4"></a><a data-primary="abstract syntax tree (AST)" data-type="indexterm" id="calibre_link-605" class="calibre4"></a> The compiler then converts that AST to a lower-level representation called <em class="calibre5">bytecode</em>.<a data-primary="bytecode" data-type="indexterm" id="calibre_link-710" class="calibre4"></a> You can feed that bytecode into another program called a <em class="calibre5">runtime</em> to evaluate it and get a result.<a data-primary="runtime" data-type="indexterm" id="calibre_link-1425" class="calibre4"></a> So when you run a program, what you’re really doing is telling the runtime to evaluate the bytecode generated by the compiler from the AST parsed from your source code. The details vary, but for most languages this is an accurate high-level view.</p>

<p class="author1">Once again, the steps are:</p>
<ol class="calibre31">
<li class="calibre32">
<p class="author1">Program is parsed into an AST.</p>
</li>
<li class="calibre32">
<p class="author1">AST is compiled to bytecode.</p>
</li>
<li class="calibre32">
<p class="author1">Bytecode is evaluated by the runtime.</p>
</li>

</ol>

<p class="author1">Where TypeScript is special is that instead of compiling straight to bytecode, TypeScript compiles to… JavaScript code! You then run that JavaScript code like you normally would&mdash;in your browser, or with NodeJS, or by hand with a paper and pen (for anyone reading this after the machine uprising has begun).</p>

<p class="author1">At this point you may be thinking: “Wait! In the last chapter you said TypeScript makes my code safer! When does that happen?”</p>

<p class="author1">Great question. I actually skipped over a crucial step: after the TypeScript Compiler generates an AST for your program&mdash;but before it emits code&mdash;it <em class="calibre5">typechecks</em> your code.<a data-primary="typechecking" data-type="indexterm" id="calibre_link-1595" class="calibre4"></a><a data-primary="typechecker" data-type="indexterm" id="calibre_link-1593" class="calibre4"></a></p>
<aside class="keyterm" data-type="sidebar" type="sidebar"><div class="sidebar" id="calibre_link-1789">
<h5 class="calibre29">Typechecker</h5>
<p class="author1">A special program that verifies that your code is typesafe.</p>
</div></aside>

<p class="author1">This typechecking is the magic behind TypeScript. It’s how TypeScript makes sure that your program works as you expect, that there aren’t obvious mistakes, and that the cute barista across the street really will call you back when they said they would. (Don’t worry, they’re probably just busy.)</p>

<p class="author1">So if we include typechecking and JavaScript emission, the process of compiling TypeScript now looks roughly like <a data-type="xref" href="#calibre_link-16" class="calibre4">Figure&nbsp;2-1</a>:</p>

<figure class="calibre33"><div class="figure" id="calibre_link-16">
<h6 class="calibre34"><span class="calibre">Figure 2-1. </span>Compiling and running TypeScript</h6>
</div></figure>

<p class="author1">Steps 1&ndash;3 are done by TSC, and steps 4&ndash;6 are done by the JavaScript runtime that lives in your browser, NodeJS, or whatever JavaScript engine you’re using.<a data-primary="TSC compiler" data-type="indexterm" id="calibre_link-1496" class="calibre4"></a></p>
<div data-type="note" type="note" class="calibre21"><h6 class="calibre22">Note</h6>
<p class="author1">JavaScript compilers and runtimes tend to be smushed into a single program called an <em class="calibre5">engine</em>; as a programmer,<a data-primary="JavaScript" data-secondary="engine" data-type="indexterm" id="calibre_link-1148" class="calibre4"></a> this is what you’ll normally interact with. <a data-primary="engines (JavaScript)" data-type="indexterm" id="calibre_link-863" class="calibre4"></a>It’s how V8 (the engine powering NodeJS, Chrome, and Opera), SpiderMonkey (Firefox), JSCore (Safari), and Chakra (Edge) work, and it’s what gives JavaScript the appearance of being an <em class="calibre5">interpreted</em> language.<a data-primary="interpreted languages" data-type="indexterm" id="calibre_link-1127" class="calibre4"></a></p>
</div>

<p class="author1">In this process, steps 1&ndash;2 use your program’s types; step 3 does not. That’s worth reiterating: <em class="calibre5">when TSC compiles your code from TypeScript to JavaScript, it won’t look at your types</em>. That means your program’s types will never affect your program’s generated output, and are only used for typechecking. This feature makes it foolproof to play around with, update, and improve your program’s types, without risking breaking your application.<a data-primary="compilers" data-secondary="TypeScript compiler" data-startref="ix_cmplTS" data-type="indexterm" id="calibre_link-777" class="calibre4"></a><a data-primary="TypeScript" data-secondary="compiler" data-startref="ix_TScmpl" data-type="indexterm" id="calibre_link-1687" class="calibre4"></a></p>
</div></section>













<section data-pdf-bookmark="The Type System" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1790">
<h1 class="calibre13">The Type System</h1>

<p class="author1">Modern languages have all<a data-primary="type systems" data-type="indexterm" id="calibre_link-1581" class="calibre4"></a><a data-primary="TypeScript" data-secondary="type system" data-type="indexterm" id="calibre_link-1706" class="calibre4"></a> sorts of different <em class="calibre5">type systems</em>.</p>
<aside class="keyterm" data-type="sidebar" type="sidebar"><div class="sidebar" id="calibre_link-1791">
<h5 class="calibre29">Type system</h5>
<p class="author1">A set of rules that a typechecker uses to assign types to your program.</p>
</div></aside>

<p class="author1">There are generally two kinds of type systems: type systems in which you have to tell the compiler what type everything is with explicit syntax, and type systems that infer the types of things for you automatically. Both approaches have trade-offs.<sup class="calibre15"><a data-type="noteref" href="#calibre_link-17" id="calibre_link-29" class="calibre16">1</a></sup></p>

<p class="author1">TypeScript is inspired by both kinds of type systems: you can explicitly annotate your types, or you can let TypeScript infer most of them for you.</p>

<p class="author1">To explicitly signal to TypeScript what your types are, use annotations. Annotations take the form <em class="calibre5">value: type</em> and tell the typechecker, “Hey! You see this <em class="calibre5">value</em> here?<a data-primary="value: type annotations" data-type="indexterm" id="calibre_link-1726" class="calibre4"></a><a data-primary="variables" data-secondary="with explicitly annotated types" data-type="indexterm" id="calibre_link-1742" class="calibre4"></a> Its type is <em class="calibre5">type</em>.” Let’s look at a few examples (the comments following each line are the actual types inferred by TypeScript):</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">a</code>: <code class="kt">number</code> <code class="o">=</code> <code class="mi">1</code>                <code class="c">// a is a number</code>
<code class="kd">let</code> <code class="nx">b</code>: <code class="kt">string</code> <code class="o">=</code> <code class="s">'hello'</code>          <code class="c">// b is a string</code>
<code class="kd">let</code> <code class="nx">c</code>: <code class="kt">boolean</code><code class="p">[]</code> <code class="o">=</code> <code class="p">[</code><code class="kd">true</code><code class="p">,</code> <code class="kd">false</code><code class="p">]</code> <code class="c">// c is an array of booleans</code></pre>

<p class="author1">And if you want TypeScript to infer your types for you, just leave them off and let <a data-primary="variables" data-secondary="with implicitly inferred types" data-type="indexterm" id="calibre_link-1743" class="calibre4"></a>TypeScript get to work:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">a</code> <code class="o">=</code> <code class="mi">1</code>                        <code class="c">// a is a number</code>
<code class="kd">let</code> <code class="nx">b</code> <code class="o">=</code> <code class="s">'hello'</code>                  <code class="c">// b is a string</code>
<code class="kd">let</code> <code class="nx">c</code> <code class="o">=</code> <code class="p">[</code><code class="kd">true</code><code class="p">,</code> <code class="kd">false</code><code class="p">]</code>            <code class="c">// c is an array of booleans</code></pre>

<p class="author1">Right away, you’ll notice how good TypeScript is at inferring types for you.<a data-primary="inferring types" data-type="indexterm" id="calibre_link-1108" class="calibre4"></a> If you leave off the annotations, the types are the same! Throughout this book, we will use annotations only when necessary, and let TypeScript work its inference magic for us whenever possible.</p>
<div data-type="note" type="note" class="calibre21"><h6 class="calibre22">Note</h6>
<p class="author1">In general, it is good style to let TypeScript infer as many types as it can for you, keeping explicitly typed code to a minimum.</p>
</div>








<section data-pdf-bookmark="TypeScript Versus JavaScript" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1792">
<h2 class="calibre17">TypeScript Versus JavaScript</h2>

<p class="author1">Let’s take a deeper look at TypeScript’s type system, and  how it compares to JavaScript’s type system. <a data-type="xref" href="#calibre_link-18" class="calibre4">Table&nbsp;2-1</a> presents an overview. <a data-primary="type systems" data-secondary="comparison for JavaScript and TypeScript" data-type="indexterm" id="calibre_link-1583" class="calibre4"></a><a data-primary="TypeScript" data-secondary="type system" data-tertiary="comparison to JavaScript" data-type="indexterm" id="calibre_link-1708" class="calibre4"></a><a data-primary="JavaScript" data-secondary="type system, comparison to TypeScript" data-type="indexterm" id="calibre_link-1166" class="calibre4"></a>A good understanding of the differences is key to building a mental model of how TypeScript works.</p>
<table id="calibre_link-18" class="stafflist_table">
<caption class="calibre35"><span class="calibre">Table 2-1. </span>Comparing JavaScript’s and TypeScript’s type systems</caption>
<thead class="calibre36">
<tr class="calibre7">
<th class="calibre37">Type system feature</th>
<th class="calibre37">JavaScript</th>
<th class="calibre37">TypeScript</th>
</tr>
</thead>
<tbody class="calibre6">
<tr class="calibre7">
<td class="calibre8"><p class="author1"><strong class="calibre38">How are types bound?</strong></p></td>
<td class="calibre8"><p class="author1">Dynamically</p></td>
<td class="calibre8"><p class="author1">Statically</p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1"><strong class="calibre38">Are types automatically converted?</strong></p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
<td class="calibre8"><p class="author1">No (mostly)</p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1"><strong class="calibre38">When are types checked?</strong></p></td>
<td class="calibre8"><p class="author1">At runtime</p></td>
<td class="calibre8"><p class="author1">At compile time</p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1"><strong class="calibre38">When are errors surfaced?</strong></p></td>
<td class="calibre8"><p class="author1">At runtime (mostly)</p></td>
<td class="calibre8"><p class="author1">At compile time (mostly)</p></td>
</tr>
</tbody>
</table>










<section data-pdf-bookmark="How are types bound?" data-type="sect3" class="preface"><div class="preface" id="calibre_link-1793">
<h3 class="calibre39">How are types bound?</h3>

<p class="author1">Dynamic type binding means that JavaScript needs to actually run your program to know the types of things in it. JavaScript doesn’t know your types before running your program.<a data-primary="types" data-secondary="binding, JavaScript versus TypeScript" data-type="indexterm" id="calibre_link-1610" class="calibre4"></a></p>

<p class="author1">TypeScript is a <em class="calibre5">gradually typed</em> language.<a data-primary="gradually typed languages" data-type="indexterm" id="calibre_link-1086" class="calibre4"></a> That means that TypeScript works best when it knows the types of everything in your program at compile time, but it doesn’t have to know every type in order to compile your program. Even in an untyped program TypeScript can infer some types for you and catch some mistakes, but without knowing the types for everything, it will let a lot of mistakes slip through to your users.</p>

<p class="author1">This gradual typing is really useful for migrating legacy codebases from untyped JavaScript to typed TypeScript (more on that in <a data-type="xref" href="#calibre_link-19" class="calibre4">“Gradually Migrating from JavaScript to TypeScript”</a>), but unless you’re in the middle of migrating your codebase, you should aim for 100% type coverage. That is the approach this book takes, except where explicitly noted.</p>
</div></section>













<section data-pdf-bookmark="Are types automatically converted?" data-type="sect3" class="preface"><div class="preface" id="calibre_link-1794">
<h3 class="calibre39">Are types automatically converted?</h3>

<p class="author1">JavaScript is weakly typed, meaning if you do something invalid like add a number and an array (like we did in <a data-type="xref" href="#calibre_link-20" class="calibre4">Chapter&nbsp;1</a>), it will apply a bunch of rules to figure out what you really meant so it can do the best it can with what you gave it.<a data-primary="types" data-secondary="conversions, JavaScript versus Typescript" data-type="indexterm" id="calibre_link-1617" class="calibre4"></a><a data-primary="weakly typed languages" data-type="indexterm" id="calibre_link-1754" class="calibre4"></a><a data-primary="conversions (type)" data-type="indexterm" id="calibre_link-809" class="calibre4"></a><a data-primary="strings" data-secondary="automatic type conversions in JavaScript" data-type="indexterm" id="calibre_link-1453" class="calibre4"></a> Let’s walk through the specific example of how JavaScript evaluates <code class="calibre14">3 + [1]</code>:</p>
<ol class="calibre31">
<li class="calibre32">
<p class="author1">JavaScript notices that <code class="calibre14">3</code> is a number and <code class="calibre14">[1]</code> is an array.</p>
</li>
<li class="calibre32">
<p class="author1">Because we’re using <code class="calibre14">+</code>, it assumes we want to concatenate the two.</p>
</li>
<li class="calibre32">
<p class="author1">It implicitly converts <code class="calibre14">3</code> to a string, yielding <code class="calibre14">"3"</code>.</p>
</li>
<li class="calibre32">
<p class="author1">It implicitly converts <code class="calibre14">[1]</code> to a string, yielding <code class="calibre14">"1"</code>.</p>
</li>
<li class="calibre32">
<p class="author1">It concatenates the results, yielding <code class="calibre14">"31"</code>.</p>
</li>

</ol>

<p class="author1">We could do this more explicitly too (so JavaScript avoids doing steps 1, 3, and 4):</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="mi">3</code> <code class="o">+</code> <code class="p">[</code><code class="mi">1</code><code class="p">];</code>                         <code class="c">// evaluates to "31"</code>

<code class="p">(</code><code class="mi">3</code><code class="p">).</code><code class="nx">toString</code><code class="p">()</code> <code class="o">+</code> <code class="p">[</code><code class="mi">1</code><code class="p">].</code><code class="nx">toString</code><code class="p">()</code>  <code class="c">// evaluates to "31"</code></pre>

<p class="author1">While JavaScript tries to be helpful by doing clever type conversions for you, TypeScript complains as soon as you do something invalid. When you run that same JavaScript code through <a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2365" data-type="indexterm" id="calibre_link-933" class="calibre4"></a>TSC, you’ll get an error:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="mi">3</code> <code class="o">+</code> <code class="p">[</code><code class="mi">1</code><code class="p">];</code>                         <code class="c">// Error TS2365: Operator '+' cannot be applied to</code>
                                 <code class="c">// types '3' and 'number[]'.</code>

<code class="p">(</code><code class="mi">3</code><code class="p">).</code><code class="nx">toString</code><code class="p">()</code> <code class="o">+</code> <code class="p">[</code><code class="mi">1</code><code class="p">].</code><code class="nx">toString</code><code class="p">()</code>  <code class="c">// evaluates to "31"</code></pre>

<p class="author1">If you do something that doesn’t seem right, TypeScript complains, and if you’re explicit about your intentions, TypeScript gets out of your way. This behavior makes sense: who in their right mind would try to add a number and an array, expecting the result to be a string (of course, besides Bavmorda the JavaScript witch who spends her time coding by candlelight in your startup’s basement)?</p>

<p class="author1">The kind of implicit conversion that JavaScript does can be a really hard-to-track-down source of errors, and is the bane of many JavaScript programmers. It makes it hard for individual engineers to get their jobs done, and it makes it even harder to scale code across a large team, since every engineer needs to understand the implicit assumptions your code makes.</p>

<p class="author1">In short, if you must convert types, do it explicitly.</p>
</div></section>













<section data-pdf-bookmark="When are types checked?" data-type="sect3" class="preface"><div class="preface" id="calibre_link-1795">
<h3 class="calibre39">When are types checked?</h3>

<p class="author1">In most places JavaScript doesn’t care what types you give it, and it instead tries to do its best to convert what you gave it to what it expects.<a data-primary="typechecking" data-secondary="JavaScript versus TypeScript" data-type="indexterm" id="calibre_link-1598" class="calibre4"></a></p>

<p class="author1">TypeScript, on the other hand, typechecks your code at compile time (remember step 2 in the list at the beginning of this chapter?), so you don’t need to actually run your code to see the <code class="calibre14">Error</code> from the previous example. TypeScript <em class="calibre5">statically analyzes</em> your code for errors like these, and shows them to you before you run it. If your code doesn’t compile, that’s a really good sign that you made a mistake and you should fix it before you try to run the code.</p>

<p class="author1"><a data-type="xref" href="#calibre_link-21" class="calibre4">Figure&nbsp;2-2</a> shows what happens when <a data-primary="code editors" data-type="indexterm" id="calibre_link-758" class="calibre4"></a><a data-primary="editors" data-type="indexterm" id="calibre_link-860" class="calibre4"></a>I type the last code example into VSCode (my code editor of choice).</p>

<figure class="calibre33"><div class="figure" id="calibre_link-21">
<img alt="prts 0202" src="images/000009.png" class="calibre40" />
<h6 class="calibre34"><span class="calibre">Figure 2-2. </span>TypeError reported by VSCode</h6>
</div></figure>

<p class="author1">With a good TypeScript extension for your preferred code editor, the error will show up as a red squiggly line under your code <em class="calibre5">as you type it</em>. This dramatically speeds up the feedback loop between writing code, realizing that you made a mistake, and updating the code to fix that mistake.</p>
</div></section>













<section data-pdf-bookmark="When are errors surfaced?" data-type="sect3" class="preface"><div class="preface" id="calibre_link-1796">
<h3 class="calibre39">When are errors surfaced?</h3>

<p class="author1">When JavaScript throws exceptions or performs implicit type conversions, it does so at runtime.<sup class="calibre15"><a data-type="noteref" href="#calibre_link-22" id="calibre_link-30" class="calibre16">2</a></sup> This means you have to actually run your program to get a useful signal back that you did something invalid.<a data-primary="errors" data-secondary="surfacing, in JavaScript versus TypeScript" data-type="indexterm" id="calibre_link-891" class="calibre4"></a> In the best case, that means as part of a unit test; in the worst case, it means an angry email from a user.</p>

<p class="author1">TypeScript throws both syntax-related errors and type-related errors at compile time. In practice, that means those kinds of errors will show up in your code editor, right as you type&mdash;it’s an amazing experience if you’ve never worked with an incrementally compiled statically typed language before.<sup class="calibre15"><a data-type="noteref" href="#calibre_link-23" id="calibre_link-31" class="calibre16">3</a></sup></p>

<p class="author1">That said, there are lots of errors that TypeScript can’t catch for you at compile time&mdash;things like stack overflows, broken network connections, and malformed user inputs&mdash;that will still result in runtime exceptions. What TypeScript does is make compile-time errors out of most errors that would have otherwise been runtime errors in a pure JavaScript world.<a data-primary="TypeScript" data-secondary="type system" data-startref="ix_TStypsysJS" data-tertiary="comparison to JavaScript" data-type="indexterm" id="calibre_link-1709" class="calibre4"></a><a data-primary="JavaScript" data-secondary="type system, comparison to TypeScript" data-startref="ix_JStypsys" data-type="indexterm" id="calibre_link-1167" class="calibre4"></a><a data-primary="type systems" data-secondary="comparison for JavaScript and TypeScript" data-startref="ix_typsyscomp" data-type="indexterm" id="calibre_link-1584" class="calibre4"></a><a data-primary="type systems" data-startref="ix_typsys" data-type="indexterm" id="calibre_link-1582" class="calibre4"></a><a data-primary="TypeScript" data-secondary="type system" data-startref="ix_TStypsys" data-type="indexterm" id="calibre_link-1707" class="calibre4"></a></p>
</div></section>



</div></section>





</div></section>













<section data-pdf-bookmark="Code Editor Setup" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1797">
<h1 class="calibre13">Code Editor Setup</h1>

<p class="author1">Now that you have some intuition for how the TypeScript Compiler and type system work, let’s get your code editor set up so we can start diving into some real code.<a data-primary="TypeScript" data-secondary="setting up code editors" data-type="indexterm" id="calibre_link-1701" class="calibre4"></a><a data-primary="code editors" data-secondary="setting up for TypeScript" data-type="indexterm" id="calibre_link-759" class="calibre4"></a></p>

<p class="author1">Start by downloading a code editor to write your code in. I like VSCode because it provides <a data-primary="VSCode" data-type="indexterm" id="calibre_link-1753" class="calibre4"></a>a particularly nice TypeScript editing experience, but you can also use Sublime Text, Atom, Vim, WebStorm, or whatever editor you like. Engineers tend to be really picky about IDEs, so I’ll leave it to you to decide. If you do want to use VSCode, follow the instructions on the <a href="https://code.visualstudio.com/" class="calibre4">website</a> to get it set up.<a data-primary="TSC compiler" data-type="indexterm" id="calibre_link-1497" class="calibre4"></a></p>

<p class="author1">TSC is itself a command-line application written in TypeScript,<sup class="calibre15"><a data-type="noteref" href="#calibre_link-24" id="calibre_link-32" class="calibre16">4</a></sup> which means you need NodeJS to run it. Follow the instructions on the official NodeJS <a href="https://nodejs.org" class="calibre4">website</a> to get NodeJS up and running on your machine.<a data-primary="NodeJS" data-secondary="installing and running" data-type="indexterm" id="calibre_link-1268" class="calibre4"></a><a data-primary="self-hosting compilers" data-type="indexterm" id="calibre_link-1432" class="calibre4"></a></p>

<p class="author1">NodeJS comes with NPM, a package manager that you will use to manage your project’s dependencies and orchestrate your build. <a data-primary="NPM package manager" data-type="indexterm" id="calibre_link-1284" class="calibre4"></a>We’ll start by using it to install TSC and TSLint (a linter for TypeScript). <a data-primary="TSLint" data-secondary="installing" data-type="indexterm" id="calibre_link-1538" class="calibre4"></a><a data-primary="TSC compiler" data-secondary="installing with npm" data-type="indexterm" id="calibre_link-1513" class="calibre4"></a>Start by opening your terminal and creating a new folder, then initializing a new NPM project in it:</p>

<pre data-code-language="sh" data-type="programlisting" class="calibre30"><code class="c1"># Create a new folder</code>
mkdir chapter-2
<code class="nb">cd </code>chapter-2

<code class="c1"># Initialize a new NPM project (follow the prompts)</code>
npm init

<code class="c1"># Install TSC, TSLint, and type declarations for NodeJS</code>
npm install --save-dev typescript tslint @types/node</pre>








<section data-pdf-bookmark="tsconfig.json" data-type="sect2" class="preface"><div class="preface" id="calibre_link-37">
<h2 class="calibre17">tsconfig.json</h2>

<p class="author1">Every TypeScript project should include a file called <em class="calibre5">tsconfig.json</em> in its root directory.<a data-primary="tsconfig.json" data-type="indexterm" id="calibre_link-1532" class="calibre4"></a><a data-primary="TSC compiler" data-secondary="configuring with tsconfig.json" data-type="indexterm" id="calibre_link-1501" class="calibre4"></a> This <em class="calibre5">tsconfig.json</em> is where TypeScript projects define things like which files should be compiled, which directory to compile them to, and which version of JavaScript to emit.</p>

<p class="author1">Create a new file called <em class="calibre5">tsconfig.json</em> in your root folder (<code class="calibre14">touch tsconfig.json</code>),<sup class="calibre15"><a data-type="noteref" href="#calibre_link-25" id="calibre_link-33" class="calibre16">5</a></sup> then pop it open in your code editor and give it the following contents:</p>

<pre data-code-language="json" data-type="programlisting" class="calibre30"><code class="p">{</code>
  <code class="nt">"compilerOptions"</code><code class="p">:</code> <code class="p">{</code>
    <code class="nt">"lib"</code><code class="p">:</code> <code class="p">[</code><code class="s">"es2015"</code><code class="p">],</code>
    <code class="nt">"module"</code><code class="p">:</code> <code class="s">"commonjs"</code><code class="p">,</code>
    <code class="nt">"outDir"</code><code class="p">:</code> <code class="s">"dist"</code><code class="p">,</code>
    <code class="nt">"sourceMap"</code><code class="p">:</code> <code class="kd">true</code><code class="p">,</code>
    <code class="nt">"strict"</code><code class="p">:</code> <code class="kd">true</code><code class="p">,</code>
    <code class="nt">"target"</code><code class="p">:</code> <code class="s">"es2015"</code>
  <code class="p">},</code>
  <code class="nt">"include"</code><code class="p">:</code> <code class="p">[</code>
    <code class="s">"src"</code>
  <code class="p">]</code>
<code class="p">}</code></pre>

<p class="author1">Let’s briefly go over some of those options and<a data-primary="tsconfig.json" data-secondary="options" data-type="indexterm" id="calibre_link-1536" class="calibre4"></a> what they mean (<a data-type="xref" href="#calibre_link-26" class="calibre4">Table&nbsp;2-2</a>):</p>
<table id="calibre_link-26" class="stafflist_table">
<caption class="calibre35"><span class="calibre">Table 2-2. </span><em class="calibre5">tsconfig.json</em> options</caption>
<thead class="calibre36">
<tr class="calibre7">
<th class="calibre37">Option</th>
<th class="calibre37">Description</th>
</tr>
</thead>
<tbody class="calibre6">
<tr class="calibre7">
<td class="calibre8"><p class="author1"><code class="calibre14">include</code></p></td>
<td class="calibre8"><p class="author1">Which folders should TSC look in to find your TypeScript files?</p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1"><code class="calibre14">lib</code></p></td>
<td class="calibre8"><p class="author1">Which APIs should TSC assume exist in the environment you’ll be running your code in? This includes things like ES5’s <code class="calibre14">Function.prototype.bind</code>, ES2015’s <code class="calibre14">Object.assign</code>, and the DOM’s <code class="calibre14"><span class="calibre">document.querySelector</span></code>.</p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1"><code class="calibre14">module</code></p></td>
<td class="calibre8"><p class="author1">Which module system should TSC compile your code to (CommonJS, SystemJS, ES2015, etc.)?</p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1"><code class="calibre14">outDir</code></p></td>
<td class="calibre8"><p class="author1">Which folder should TSC put your generated JavaScript code in?</p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1"><code class="calibre14">strict</code></p></td>
<td class="calibre8"><p class="author1">Be as strict as possible when checking for invalid code. This option enforces that all of your code is properly typed. We’ll be using it for all of the examples in the book, and you should use it for your TypeScript project too.</p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1"><code class="calibre14">target</code></p></td>
<td class="calibre8"><p class="author1">Which JavaScript version should TSC compile your code to (ES3, ES5, ES2015, ES2016, etc.)?</p></td>
</tr>
</tbody>
</table>

<p class="author1">These are just a few of the available options&mdash;<em class="calibre5">tsconfig.json</em> supports dozens of options, and new ones are added all the time. You won’t find yourself changing these much in practice, besides dialing in the <code class="calibre14">module</code> and <code class="calibre14">target</code> settings when switching to a new module bundler, adding <code class="calibre14">"dom"</code> to <code class="calibre14">lib</code> when writing TypeScript for the browser (you’ll learn more about this in <a data-type="xref" href="#calibre_link-27" class="calibre4">Chapter&nbsp;12</a>), or adjusting your level of <code class="calibre14">strict</code>ness when migrating your existing JavaScript code to TypeScript (see <a data-type="xref" href="#calibre_link-19" class="calibre4">“Gradually Migrating from JavaScript to TypeScript”</a>). For a complete and up-to-date list of supported options, head over to the official documentation on the <a href="http://bit.ly/2JWfsgY" class="calibre4">TypeScript website</a>.</p>

<p class="author1">Note that while using a <em class="calibre5">tsconfig.json</em> file to configure TSC is handy because it lets us check that configuration into source control, you can set most of TSC’s options from the command line too. Run <code class="calibre14">./node_modules/.bin/tsc --help</code> for a list of available command-line options.</p>
</div></section>













<section data-pdf-bookmark="tslint.json" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1798">
<h2 class="calibre17">tslint.json</h2>

<p class="author1">Your project should also have a <em class="calibre5">tslint.json</em> file containing your TSLint configuration, codifying whatever stylistic conventions you want for your code (tabs versus spaces, etc.).<a data-primary="TSLint" data-secondary="configuring with tslint.json" data-type="indexterm" id="calibre_link-1537" class="calibre4"></a><a data-primary="code style" data-secondary="configuring for TSLint" data-type="indexterm" id="calibre_link-763" class="calibre4"></a><a data-primary="tslint.json" data-type="indexterm" id="calibre_link-1541" class="calibre4"></a></p>
<div data-type="note" type="note" class="calibre21"><h6 class="calibre22">Note</h6>
<p class="author1">Using TSLint is optional, but it’s strongly recommend for all TypeScript projects to enforce a consistent coding style. Most importantly, it will save you from arguing over code style with coworkers during code reviews.</p>
</div>

<p class="author1">The following command will generate a <em class="calibre5">tslint.json</em> file with a default TSLint <span class="calibre">configuration</span>:</p>

<pre data-code-language="sh" data-type="programlisting" class="calibre30">./node_modules/.bin/tslint --init</pre>

<p class="author1">You can then add overrides to this to conform with your own coding style. For example, my <em class="calibre5">tslint.json</em> looks like this:</p>

<pre data-code-language="json" data-type="programlisting" class="calibre30"><code class="p">{</code>
  <code class="nt">"defaultSeverity"</code><code class="p">:</code> <code class="s">"error"</code><code class="p">,</code>
  <code class="nt">"extends"</code><code class="p">:</code> <code class="p">[</code>
    <code class="s">"tslint:recommended"</code>
  <code class="p">],</code>
  <code class="nt">"rules"</code><code class="p">:</code> <code class="p">{</code>
    <code class="nt">"semicolon"</code><code class="p">:</code> <code class="kd">false</code><code class="p">,</code>
    <code class="nt">"trailing-comma"</code><code class="p">:</code> <code class="kd">false</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p class="author1">For the full list of available rules, head over to the <a href="https://palantir.github.io/tslint/rules/" class="calibre4">TSLint documentation</a>. You can also add custom rules, or install extra presets (like for <a href="https://www.npmjs.com/package/tslint-react" class="calibre4">ReactJS</a>).<a data-primary="TypeScript" data-secondary="setting up code editors" data-startref="ix_TScodeed" data-type="indexterm" id="calibre_link-1702" class="calibre4"></a><a data-primary="code editors" data-secondary="setting up for TypeScript" data-startref="ix_cdedset" data-type="indexterm" id="calibre_link-760" class="calibre4"></a></p>
</div></section>





</div></section>













<section data-pdf-bookmark="index.ts" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1799">
<h1 class="calibre13">index.ts</h1>

<p class="author1">Now that you’ve set up your <em class="calibre5">tsconfig.json</em> and <em class="calibre5">tslint.json</em>, create a <em class="calibre5">src</em> folder containing your <a data-primary="projects, setting up for TypeScript" data-type="indexterm" id="calibre_link-1375" class="calibre4"></a><a data-primary="TypeScript" data-secondary="setting up projects, index.ts file" data-type="indexterm" id="calibre_link-1703" class="calibre4"></a><a data-primary="index.ts" data-type="indexterm" id="calibre_link-1106" class="calibre4"></a><a data-primary="src/index.ts" data-type="indexterm" id="calibre_link-1443" class="calibre4"></a>first TypeScript file:</p>

<pre data-code-language="sh" data-type="programlisting" class="calibre30">mkdir src
touch src/index.ts</pre>

<p class="author1">Your<a data-primary="folder structure for TypeScript projects" data-type="indexterm" id="calibre_link-1007" class="calibre4"></a> project’s folder structure should now look this:</p>

<pre data-type="programlisting" class="calibre30">chapter-2/
├──node_modules/
├──src/
│ └──index.ts
├──package.json
├──tsconfig.json
└──tslint.json</pre>

<p class="author1">Pop open <em class="calibre5">src/index.ts</em> in your code editor, and enter the following TypeScript code:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s">'Hello TypeScript!'</code><code class="p">)</code></pre>

<p class="author1">Then, compile and run your TypeScript code:</p>

<pre data-code-language="sh" data-type="programlisting" class="calibre30"><code class="c1"># Compile your TypeScript with TSC</code>
./node_modules/.bin/tsc

<code class="c1"># Run your code with NodeJS</code>
node ./dist/index.js</pre>

<p class="author1">If you’ve followed all the steps here, your code should run and you should see a single log in your console:</p>

<pre data-code-language="sh" data-type="programlisting" class="calibre30">Hello TypeScript!</pre>

<p class="author1">That’s it&mdash;you just set up and ran your first TypeScript project from scratch. Nice work!</p>
<div data-type="tip" class="calibre21"><h6 class="calibre22">Tip</h6>
<p class="author1">Since this might have been your first time setting up a TypeScript project from scratch, I wanted to walk through each step so you have a sense for all the moving pieces. There are a couple of shortcuts you can take to do this faster next time:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">Install <a href="https://npmjs.org/package/ts-node" class="calibre4"><code class="calibre14">ts-node</code></a>, and use it to compile and run your TypeScript with a single command.</p>
</li>
<li class="calibre11">
<p class="author1">Use a scaffolding tool like <a href="https://github.com/Microsoft/TypeScript-Node-Starter" class="calibre4"><code class="calibre14">typescript-node-starter</code></a> to quickly generate your folder structure for you.</p>
</li>
</ul>
</div>
</div></section>













<section class="preface" data-pdf-bookmark="Exercises" data-type="sect1"><div class="preface" id="calibre_link-1800">
<h1 class="calibre13">Exercises</h1>

<p class="author1">Now that your environment is set up, open up <em class="calibre5">src/index.ts</em> in your code editor. Enter the following code:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">a</code> <code class="o">=</code> <code class="mi">1</code> <code class="o">+</code> <code class="mi">2</code>
<code class="kd">let</code> <code class="nx">b</code> <code class="o">=</code> <code class="nx">a</code> <code class="o">+</code> <code class="mi">3</code>
<code class="kd">let</code> <code class="nx">c</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">apple</code>: <code class="kt">a</code><code class="p">,</code>
  <code class="nx">banana</code>: <code class="kt">b</code>
<code class="p">}</code>
<code class="kd">let</code> <code class="nx">d</code> <code class="o">=</code> <code class="nx">c</code><code class="p">.</code><code class="nx">apple</code> <code class="o">*</code> <code class="mi">4</code></pre>

<p class="author1">Now hover over <code class="calibre14">a</code>, <code class="calibre14">b</code>, <code class="calibre14">c</code>, and <code class="calibre14">d</code>, and notice how TypeScript infers the types of all your variables for you: <code class="calibre14">a</code> is a <code class="calibre14">number</code>, <code class="calibre14">b</code> is a <code class="calibre14">number</code>, <code class="calibre14">c</code> is an object with a specific shape, and <code class="calibre14">d</code> is also a <code class="calibre14">number</code> (<a data-type="xref" href="#calibre_link-28" class="calibre4">Figure&nbsp;2-3</a>).</p>

<figure class="calibre33"><div class="figure" id="calibre_link-28">
<img alt="prts 0203" src="images/000010.png" class="calibre40" />
<h6 class="calibre34"><span class="calibre">Figure 2-3. </span>TypeScript inferring types for you</h6>
</div></figure>

<p class="author1">Play around with your code a bit. See if you can:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">Get TypeScript to show a red squiggly when you do something invalid (we call this “throwing a <code class="calibre14">TypeError</code>“).</p>
</li>
<li class="calibre11">
<p class="author1">Read the <code class="calibre14">TypeError</code>, and try to understand what it means.</p>
</li>
<li class="calibre11">
<p class="author1">Fix the <code class="calibre14">TypeError</code> and see the red squiggly disappear.</p>
</li>
</ul>

<p class="author1">If you’re ambitious, try to write a piece of code that TypeScript is unable to infer the type for.</p>
</div></section>







<div data-type="footnotes" class="calibre26"><p data-type="footnote" id="calibre_link-17" class="calibre27"><sup class="calibre28"><a href="#calibre_link-29" class="calibre16">1</a></sup> There are languages all over this spectrum: JavaScript, Python, and Ruby infer types at runtime; Haskell and OCaml infer and check missing types at compile time; Scala and TypeScript require some explicit types and infer and check the rest at compile time; and Java and C need explicit annotations for almost everything, which they check at compile time.</p><p data-type="footnote" id="calibre_link-22" class="calibre27"><sup class="calibre28"><a href="#calibre_link-30" class="calibre16">2</a></sup> To be sure, JavaScript surfaces syntax errors and a few select bugs (like multiple <code class="calibre14">const</code> declarations with the same name in the same scope) after it parses your program, but before it runs it. If you parse your JavaScript as part of your build process (e.g., with Babel), you can surface these errors at build time.</p><p data-type="footnote" id="calibre_link-23" class="calibre27"><sup class="calibre28"><a href="#calibre_link-31" class="calibre16">3</a></sup> Incrementally compiled languages can be quickly recompiled when you make a small change, rather than having to recompile your whole program (including the parts you didn’t touch).</p><p data-type="footnote" id="calibre_link-24" class="calibre27"><sup class="calibre28"><a href="#calibre_link-32" class="calibre16">4</a></sup> This puts TSC in the mystical class of compilers known as <em class="calibre5">self-hosting compilers</em>, or compilers that compile themselves.</p><p data-type="footnote" id="calibre_link-25" class="calibre27"><sup class="calibre28"><a href="#calibre_link-33" class="calibre16">5</a></sup> For this exercise, we’re creating a <em class="calibre5">tsconfig.json</em> manually. When you set up TypeScript projects in the future, you can use TSC’s built-in initialize command to generate one for you: <code class="calibre14">./node_modules/.bin/tsc --init</code>.</p></div></div></section></div>

<div data-type="book" class="calibre1" id="calibre_link-34"><section data-pdf-bookmark="Chapter 3. All About Types" data-type="chapter" type="chapter" class="preface"><div class="preface" id="calibre_link-169">
<h1 class="calibre12"><span class="calibre">Chapter 3. </span>All About Types</h1>


<p class="author1">In the last chapter I introduced the idea of type systems, but I never defined what the <em class="calibre5">type</em> in type system really means.<a data-primary="types" data-secondary="defined" data-type="indexterm" id="calibre_link-1620" class="calibre4"></a></p>
<aside class="keyterm" data-type="sidebar" type="sidebar"><div class="sidebar" id="calibre_link-1801">
<h5 class="calibre29">Type</h5>
<p class="author1">A set of values and the things you can do with them.</p>
</div></aside>

<p class="author1">If that sounds confusing, let me give a few familiar examples:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">The <code class="calibre14">boolean</code> type is the set of all booleans (there are just two: <code class="calibre14">true</code> and <code class="calibre14">false</code>) and the operations you can perform on them (like <code class="calibre14">||</code>, <code class="calibre14">&amp;&amp;</code>, and <code class="calibre14">!</code>).<a data-primary="boolean type" data-type="indexterm" id="calibre_link-689" class="calibre4"></a></p>
</li>
<li class="calibre11">
<p class="author1">The <code class="calibre14">number</code> type is the set of all numbers and the operations you can perform on them (like <code class="calibre14">+</code>, <code class="calibre14">-</code>, *, <code class="calibre14">/</code>, <code class="calibre14">%</code>, <code class="calibre14">||</code>, <code class="calibre14">&amp;&amp;</code>, and <code class="calibre14">?</code>), including the methods you can call on them like <code class="calibre14">.toFixed</code>, <code class="calibre14">.toPrecision</code>, <code class="calibre14">.toString</code>, and so on.<a data-primary="number type" data-type="indexterm" id="calibre_link-1297" class="calibre4"></a></p>
</li>
<li class="calibre11">
<p class="author1">The <code class="calibre14">string</code> type is the set of all strings and the operations you can perform on them (like <code class="calibre14">+</code>, <code class="calibre14">||</code>, and <code class="calibre14">&amp;&amp;</code>), including the methods you can call on them like <code class="calibre14"><span class="calibre">.concat</span></code> and <code class="calibre14">.toUpperCase</code>.<a data-primary="string type" data-type="indexterm" id="calibre_link-1451" class="calibre4"></a></p>
</li>
</ul>

<p class="author1">When you see that something is of type <code class="calibre14">T</code>, not only do you know that it’s a <code class="calibre14">T</code>, but you also know <em class="calibre5">exactly what you can do</em> with that <code class="calibre14">T</code> (and what you can’t). Remember, the whole point is to use the typechecker to stop you from doing invalid things.<a data-primary="typechecker" data-type="indexterm" id="calibre_link-1594" class="calibre4"></a> And the way the typechecker knows what’s valid and what’s not is by looking at the types you’re using and how you’re using them.</p>

<p class="author1">In this chapter we’ll take a tour of the types available in TypeScript and cover the basics of what you can do with each of them. <a data-type="xref" href="#calibre_link-35" class="calibre4">Figure&nbsp;3-1</a> gives an overview.</p>

<figure class="calibre33"><div class="figure" id="calibre_link-35">
<img alt="prts 0301" src="images/000011.png" class="calibre40" />
<h6 class="calibre34"><span class="calibre">Figure 3-1. </span>TypeScript’s type hierarchy</h6>
</div></figure>






<section data-pdf-bookmark="Talking About Types" data-type="sect1" class="preface"><div class="preface" id="calibre_link-230">
<h1 class="calibre13">Talking About Types</h1>

<p class="author1">When programmers talk about types, they share a precise, common vocabulary to describe what they mean.<a data-primary="types" data-secondary="terminology and vocabulary of" data-type="indexterm" id="calibre_link-1667" class="calibre4"></a> We’re going to use this vocabulary throughout this book.</p>

<p class="author1">Say you have a function that takes some value and returns<a data-primary="functions" data-secondary="parameter types" data-type="indexterm" id="calibre_link-1049" class="calibre4"></a> that value multiplied by itself:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">squareOf</code><code class="p">(</code><code class="nx">n</code><code class="p">)</code> <code class="p">{</code>
  <code class="kd">return</code> <code class="nx">n</code> <code class="o">*</code> <code class="nx">n</code>
<code class="p">}</code>
<code class="nx">squareOf</code><code class="p">(</code><code class="mi">2</code><code class="p">)</code>     <code class="c">// evaluates to 4</code>
<code class="nx">squareOf</code><code class="p">(</code><code class="s">'z'</code><code class="p">)</code>   <code class="c">// evaluates to NaN</code></pre>

<p class="author1">Clearly, this function will only work for numbers&mdash;if you pass anything besides a number to <code class="calibre14">squareOf</code>, the result will be invalid.<a data-primary="parameters" data-secondary="type" data-type="indexterm" id="calibre_link-1346" class="calibre4"></a> So what we do is explicitly <em class="calibre5">annotate</em> the parameter’s<a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2345" data-type="indexterm" id="calibre_link-917" class="calibre4"></a> type:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<code class="kd">function</code><code class="calibre14"> </code><code class="nx">squareOf</code><code class="p">(</code><code class="nx">n</code><code class="calibre14">: </code><code class="kt">number</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="kd">return</code><code class="calibre14"> </code><code class="nx">n</code><code class="calibre14"> </code><code class="o">*</code><code class="calibre14"> </code><code class="nx">n</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code><code class="nx">squareOf</code><code class="p">(</code><code class="mi">2</code><code class="p">)</code><code class="calibre14">     </code><em class="calibre41"><code class="c2">// evaluates to 4</code></em><code class="c">
</code><code class="nx">squareOf</code><code class="p">(</code><code class="s">'z'</code><code class="p">)</code><code class="calibre14">   </code><em class="calibre41"><code class="c2">// Error TS2345: Argument of type '"z"' is not assignable to</code></em><code class="c">
</code><code class="calibre14">                </code><em class="calibre41"><code class="c2">// parameter of type 'number'.</code></em><code class="c">
</code></pre>

<p class="author1">Now if we call <code class="calibre14">squareOf</code> with anything but a number, TypeScript will know to complain right away. This is a trivial example (we’ll talk a lot more about functions in the next chapter), but it’s enough to introduce a couple of concepts that are key to talking about types in TypeScript. We can say the following things about the last code example:</p>
<ol class="calibre31">
<li class="calibre32">
<p class="author1"><code class="calibre14">squareOf</code>’s parameter <code class="calibre14">n</code> is <em class="calibre5">constrained to</em> <code class="calibre14">number</code>.</p>
</li>
<li class="calibre32">
<p class="author1">The type of the value <code class="calibre14">2</code> is <em class="calibre5">assignable to</em> (equivalently: <em class="calibre5">compatible with</em>) <code class="calibre14">number</code>.</p>
</li>

</ol>

<p class="author1">Without a type annotation, <code class="calibre14">squareOf</code> is unconstrained in its parameter, and you can pass any type of argument to it.<a data-primary="constraints" data-type="indexterm" id="calibre_link-798" class="calibre4"></a><a data-primary="assignability" data-type="indexterm" id="calibre_link-659" class="calibre4"></a> Once we constrain it, TypeScript goes to work for us verifying that every place we call our function, we call it with a compatible argument. In this example the type of <code class="calibre14">2</code> is <code class="calibre14">number</code>, which is assignable to <code class="calibre14">squareOf</code>’s annotation <code class="calibre14">number</code>, so TypeScript accepts our code; but <code class="calibre14">'z'</code> is a <code class="calibre14">string</code>, which is not assignable to <code class="calibre14">number</code>, so TypeScript complains.</p>

<p class="author1">You can also <a data-primary="bounds" data-type="indexterm" id="calibre_link-696" class="calibre4"></a>think of it in terms of <em class="calibre5">bounds</em>: we told TypeScript that <code class="calibre14">n</code>’s <em class="calibre5">upper bound</em> is <code class="calibre14">number</code>, so any value we pass to <code class="calibre14">squareOf</code> has to be at most a <code class="calibre14">number</code>. If it’s anything more than a <code class="calibre14">number</code> (like, if it’s a value that might be a <code class="calibre14">number</code> or might be a <code class="calibre14">string</code>), then it’s not assignable to <code class="calibre14">n</code>.</p>

<p class="author1">I’ll define assignability, bounds, and constraints more formally in <a data-type="xref" href="#calibre_link-36" class="calibre4">Chapter&nbsp;6</a>. For now, all you need to know is this is the language that we use to talk about whether or not a type can be used in a place where we require a certain type.</p>
</div></section>













<section data-pdf-bookmark="The ABCs of Types" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1802">
<h1 class="calibre13">The ABCs of Types</h1>

<p class="author1">Let’s take a tour of the types TypeScript supports, what values they contain, and what you can do with them.<a data-primary="types" data-secondary="supported by TypeScript" data-type="indexterm" id="calibre_link-1648" class="calibre4"></a> We’ll also cover a few basic language features for working with types: type aliases, union types, and intersection types.</p>








<section data-pdf-bookmark="any" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1803">
<h2 class="calibre17">any</h2>

<p class="author1"><code class="calibre14">any</code> is the Godfather of types.<a data-primary="any type" data-type="indexterm" id="calibre_link-625" class="calibre4"></a><a data-primary="types" data-secondary="supported by TypeScript" data-tertiary="any" data-type="indexterm" id="calibre_link-1650" class="calibre4"></a> It does anything for a price, but you don’t want to ask <code class="calibre14">any</code> for a favor unless you’re completely out of options. In TypeScript everything needs to have a type at compile time, and <code class="calibre14">any</code> is the default type when you (the programmer) and TypeScript (the typechecker) can’t figure out what type something is. It’s a last resort type, and you should avoid it when possible.</p>

<p class="author1">Why should you avoid it? Remember what a type is? (It’s a set of values and the things you can do with them.) <code class="calibre14">any</code> is the set of <em class="calibre5">all</em> values, and you can do <em class="calibre5">anything</em> with <code class="calibre14">any</code>. That means that if you have a value of type <code class="calibre14">any</code> you can add to it, multiply by it, call <code class="calibre14">.pizza()</code> on it&mdash;anything.</p>

<p class="author1"><code class="calibre14">any</code> makes your value behave like it would in regular JavaScript, and totally prevents the typechecker from working its magic. When you allow <code class="calibre14">any</code> into your code you’re flying blind. Avoid <code class="calibre14">any</code> like fire, and use it only as a very, very last resort.</p>

<p class="author1">On the rare occasion that you do need to use it, you do it like this:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">a</code>: <code class="kt">any</code> <code class="o">=</code> <code class="mi">666</code>            <code class="c">// any</code>
<code class="kd">let</code> <code class="nx">b</code>: <code class="kt">any</code> <code class="o">=</code> <code class="p">[</code><code class="s">'danger'</code><code class="p">]</code>     <code class="c">// any</code>
<code class="kd">let</code> <code class="nx">c</code> <code class="o">=</code> <code class="nx">a</code> <code class="o">+</code> <code class="nx">b</code>               <code class="c">// any</code></pre>

<p class="author1">Notice how the third type should report an error (why are you trying to add a number and an array?), but doesn’t because you told TypeScript that you’re adding two <code class="calibre14">any</code>s. If you want to use <code class="calibre14">any</code>, you have to be explicit about it. When TypeScript infers that some value is of type <code class="calibre14">any</code> (for example, if you forgot to annotate a function’s parameter, or if you imported an untyped JavaScript module), it will throw a compile-time exception and toss a red squiggly at you in your editor. By explicitly annotating <code class="calibre14">a</code> and <code class="calibre14">b</code> with the <code class="calibre14">any</code> type (<code class="calibre14">: any</code>), you avoid the exception&mdash;it’s your way of telling TypeScript that you know what you’re doing.</p>
<div data-type="tip" class="calibre21"><h1 class="calibre42">TSC Flag: noImplicitAny</h1>
<p class="author1">By default, TypeScript is permissive, and won’t complain about values that it infers as <code class="calibre14">any</code>. To get TypeScript to<a data-primary="noImplicitAny flag in tsconfig.json" data-type="indexterm" id="calibre_link-1276" class="calibre4"></a><a data-primary="tsconfig.json" data-secondary="enabling noImplicitAny flag" data-type="indexterm" id="calibre_link-1533" class="calibre4"></a> complain about implicit <code class="calibre14">any</code>s, be sure to enable the <code class="calibre14">noImplicitAny</code> flag in your <em class="calibre5">tsconfig.json</em>.</p>

<p class="author1"><code class="calibre14">noImplicitAny</code> is part of the <code class="calibre14">strict</code> family of TSC flags, so if you already enabled <code class="calibre14">strict</code> in your <em class="calibre5">tsconfig.json</em> (as we did in <a data-type="xref" href="#calibre_link-37" class="calibre4">“tsconfig.json”</a>), you’re good to go.<a data-primary="strict flags in TSC" data-type="indexterm" id="calibre_link-1444" class="calibre4"></a></p>
</div>
</div></section>













<section data-pdf-bookmark="unknown" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1804">
<h2 class="calibre17">unknown</h2>

<p class="author1">If <code class="calibre14">any</code> is the Godfather, then <code class="calibre14">unknown</code> is Keanu Reeves as undercover FBI agent Johnny Utah in <em class="calibre5">Point Break</em>: laid back, fits right in with the bad guys,<a data-primary="unknown type" data-type="indexterm" id="calibre_link-1722" class="calibre4"></a><a data-primary="types" data-secondary="supported by TypeScript" data-tertiary="unknown" data-type="indexterm" id="calibre_link-1666" class="calibre4"></a> but deep down has a respect for the law and is on the side of the good guys. For the few cases where you have a value whose type you really don’t know ahead of time, don’t use <code class="calibre14">any</code>, and instead reach for <code class="calibre14">unknown</code>. Like <code class="calibre14">any</code>, it represents any value, but TypeScript won’t let you use an <code class="calibre14">unknown</code> type until you refine it by checking what it is (see <a data-type="xref" href="#calibre_link-38" class="calibre4">“Refinement”</a>).</p>

<p class="author1">What operations does <code class="calibre14">unknown</code> support? You can compare <code class="calibre14">unknown</code> values (with <code class="calibre14">==</code>, <code class="calibre14">===</code>, <code class="calibre14">||</code>, <code class="calibre14">&amp;&amp;</code>, and <code class="calibre14">?</code>), negate them (with <code class="calibre14">!</code>), and refine them (like you can any other type) with JavaScript’s <code class="calibre14">typeof</code> and <code class="calibre14">instanceof</code> operators.<a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2571" data-type="indexterm" id="calibre_link-951" class="calibre4"></a> Use <code class="calibre14">unknown</code> like this:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">a</code>: <code class="kt">unknown</code> <code class="o">=</code> <code class="mi">30</code>         <code class="c">// unknown</code>
<code class="kd">let</code> <code class="nx">b</code> <code class="o">=</code> <code class="nx">a</code> <code class="o">===</code> <code class="mi">123</code>           <code class="c">// boolean</code>
<code class="kd">let</code> <code class="nx">c</code> <code class="o">=</code> <code class="nx">a</code> <code class="o">+</code> <code class="mi">10</code>              <code class="c">// Error TS2571: Object is of type 'unknown'.</code>
<code class="kd">if</code> <code class="p">(</code><code class="kd">typeof</code> <code class="nx">a</code> <code class="o">===</code> <code class="s">'number'</code><code class="p">)</code> <code class="p">{</code>
  <code class="kd">let</code> <code class="nx">d</code> <code class="o">=</code> <code class="nx">a</code> <code class="o">+</code> <code class="mi">10</code>            <code class="c">// number</code>
<code class="p">}</code></pre>

<p class="author1">This example should give you a rough idea of how to use <code class="calibre14">unknown</code>:</p>
<ol class="calibre31">
<li class="calibre32">
<p class="author1">TypeScript will never infer something as <code class="calibre14">unknown</code>&mdash;you have to explicitly annotate it (<code class="calibre14">a</code>).<sup class="calibre15"><a data-type="noteref" href="#calibre_link-39" id="calibre_link-57" class="calibre16">1</a></sup></p>
</li>
<li class="calibre32">
<p class="author1">You can compare values to values that are of type <code class="calibre14">unknown</code> (<code class="calibre14">b</code>).</p>
</li>
<li class="calibre32">
<p class="author1">But, you can’t do things that assume an <code class="calibre14">unknown</code> value is of a specific type (<code class="calibre14">c</code>); you have to prove to TypeScript that the value really is of that type first (<code class="calibre14">d</code>).</p>
</li>

</ol>
</div></section>













<section data-pdf-bookmark="boolean" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1805">
<h2 class="calibre17">boolean</h2>

<p class="author1">The <code class="calibre14">boolean</code> type has two values: <code class="calibre14">true</code> and <code class="calibre14">false</code>.<a data-primary="true and false values (boolean type)" data-type="indexterm" id="calibre_link-1492" class="calibre4"></a><a data-primary="boolean type" data-type="indexterm" id="calibre_link-690" class="calibre4"></a><a data-primary="types" data-secondary="supported by TypeScript" data-tertiary="boolean" data-type="indexterm" id="calibre_link-1654" class="calibre4"></a> You can compare them (with <code class="calibre14">==</code>, <code class="calibre14">===</code>, <code class="calibre14">||</code>, <code class="calibre14">&amp;&amp;</code>, and <code class="calibre14">?</code>), negate them (with <code class="calibre14">!</code>), and not much else. Use <code class="calibre14">boolean</code> like this:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">a</code> <code class="o">=</code> <code class="kd">true</code>                <code class="c">// boolean</code>
<code class="kd">var</code> <code class="nx">b</code> <code class="o">=</code> <code class="kd">false</code>               <code class="c">// boolean</code>
<code class="kd">const</code> <code class="nx">c</code> <code class="o">=</code> <code class="kd">true</code>              <code class="c">// true</code>
<code class="kd">let</code> <code class="nx">d</code>: <code class="kt">boolean</code> <code class="o">=</code> <code class="kd">true</code>       <code class="c">// boolean</code>
<code class="kd">let</code> <code class="nx">e</code>: <code class="kt">true</code> <code class="o">=</code> <code class="kd">true</code>          <code class="c">// true</code>
<code class="kd">let</code> <code class="nx">f</code>: <code class="kt">true</code> <code class="o">=</code> <code class="kd">false</code>         <code class="c">// Error TS2322: Type 'false' is not assignable</code>
                            <code class="c">// to type 'true'.</code></pre>

<p class="author1">This example shows a few <a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2322" data-type="indexterm" id="calibre_link-900" class="calibre4"></a>ways to tell TypeScript that something is a <code class="calibre14">boolean</code>:</p>
<ol class="calibre31">
<li class="calibre32">
<p class="author1">You can let TypeScript infer that your value is a <code class="calibre14">boolean</code> (<code class="calibre14">a</code> and <code class="calibre14">b</code>).</p>
</li>
<li class="calibre32">
<p class="author1">You can let TypeScript infer that your value is a specific <code class="calibre14">boolean</code> (<code class="calibre14">c</code>).</p>
</li>
<li class="calibre32">
<p class="author1">You can tell TypeScript explicitly that your value is a <code class="calibre14">boolean</code> (<code class="calibre14">d</code>).</p>
</li>
<li class="calibre32">
<p class="author1">You can tell TypeScript explicitly that your value is a specific <code class="calibre14">boolean</code> (<code class="calibre14">e</code> and <code class="calibre14">f</code>).</p>
</li>

</ol>

<p class="author1">In general, you will use the first or second way in your programs. Very rarely, you’ll use the fourth way&mdash;only when it buys you extra type safety (I’ll show you examples of that throughout this book). You will almost never use the third way.</p>

<p class="author1">The second and fourth cases are particularly interesting because while they do something intuitive, they’re supported by surprisingly few programming languages and so might be new to you. What I did in that example was say, “Hey TypeScript! See this variable <code class="calibre14">e</code> here? <code class="calibre14">e</code> isn’t just any old <code class="calibre14">boolean</code>&mdash;it’s the specific <code class="calibre14">boolean</code> <code class="calibre14">true</code>.” By using a value as a type, I essentially limited the possible values for <code class="calibre14">e</code> and <code class="calibre14">f</code> from all <code class="calibre14">booleans</code> to one specific <code class="calibre14">boolean</code> each. <a data-primary="type literals" data-type="indexterm" id="calibre_link-1573" class="calibre4"></a>This feature is called <em class="calibre5">type literals</em>.</p>
<aside class="keyterm" data-type="sidebar" type="sidebar"><div class="sidebar" id="calibre_link-1806">
<h5 class="calibre29">Type literal</h5>
<p class="author1">A type that represents a single value and nothing else.</p>
</div></aside>

<p class="author1">In the fourth case I explicitly annotated my variables with type literals, and in the second case TypeScript inferred a literal type for me because I used <code class="calibre14">const</code> instead of <code class="calibre14">let</code> or <code class="calibre14">var</code>.<a data-primary="const values" data-type="indexterm" id="calibre_link-797" class="calibre4"></a><a data-primary="let" data-secondary="using const instead of" data-type="indexterm" id="calibre_link-1188" class="calibre4"></a><a data-primary="var" data-secondary="using const instead of" data-type="indexterm" id="calibre_link-1735" class="calibre4"></a> Because TypeScript knows that once a primitive is assigned with <code class="calibre14">const</code> its value will never change, it infers the most narrow type it can for that variable. That’s why in the second case TypeScript inferred <code class="calibre14">c</code>’s type as <code class="calibre14">true</code> instead of as <code class="calibre14">boolean</code>. To learn more about why TypeScript infers different types for <code class="calibre14">let</code> and <code class="calibre14">const</code>, jump ahead to <a data-type="xref" href="#calibre_link-40" class="calibre4">“Type Widening”</a>.</p>

<p class="author1">We will revisit type literals throughout this book. They are a powerful language feature that lets you squeeze out extra safety all over the place. Type literals make TypeScript unique in the language world and are something you should lord over your Java friends.</p>
</div></section>













<section data-pdf-bookmark="number" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1807">
<h2 class="calibre17">number</h2>

<p class="author1"><code class="calibre14">number</code> is the set of all numbers: integers, floats, positives, negatives, <code class="calibre14">Infinity</code>, <code class="calibre14">NaN</code>, and so on. <a data-primary="number type" data-type="indexterm" id="calibre_link-1298" class="calibre4"></a><a data-primary="types" data-secondary="supported by TypeScript" data-tertiary="number" data-type="indexterm" id="calibre_link-1657" class="calibre4"></a>Numbers can do, well, numbery things, like addition (<code class="calibre14">+</code>), subtraction (<code class="calibre14">-</code>), modulo (<code class="calibre14">%</code>), and comparison (<code class="calibre14">&lt;</code>). Let’s look at a few examples:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">a</code> <code class="o">=</code> <code class="mi">1234</code>                <code class="c">// number</code>
<code class="kd">var</code> <code class="nx">b</code> <code class="o">=</code> <code class="kd">Infinity</code> <code class="o">*</code> <code class="mi">0.10</code>     <code class="c">// number</code>
<code class="kd">const</code> <code class="nx">c</code> <code class="o">=</code> <code class="mi">5678</code>              <code class="c">// 5678</code>
<code class="kd">let</code> <code class="nx">d</code> <code class="o">=</code> <code class="nx">a</code> <code class="o">&lt;</code> <code class="nx">b</code>               <code class="c">// boolean</code>
<code class="kd">let</code> <code class="nx">e</code>: <code class="kt">number</code> <code class="o">=</code> <code class="mi">100</code>         <code class="c">// number</code>
<code class="kd">let</code> <code class="nx">f</code>: <code class="kt">26.218</code> <code class="o">=</code> <code class="mi">26.218</code>      <code class="c">// 26.218</code>
<code class="kd">let</code> <code class="nx">g</code>: <code class="kt">26.218</code> <code class="o">=</code> <code class="mi">10</code>          <code class="c">// Error TS2322: Type '10' is not assignable</code>
                            <code class="c">// to type '26.218'.</code></pre>

<p class="author1">Like in the <code class="calibre14">boolean</code> example, there are four ways to type something as a <code class="calibre14">number</code>:</p>
<ol class="calibre31">
<li class="calibre32">
<p class="author1">You can let TypeScript infer that your value is a <code class="calibre14">number</code> (<code class="calibre14">a</code> and <code class="calibre14">b</code>).</p>
</li>
<li class="calibre32">
<p class="author1">You can use <code class="calibre14">const</code> so TypeScript infers that your value is a specific <code class="calibre14">number</code> (<code class="calibre14">c</code>).</p>
</li>
<li class="calibre32">
<p class="author1">You can tell TypeScript explicitly that your value is a <code class="calibre14">number</code> (<code class="calibre14">e</code>).</p>
</li>
<li class="calibre32">
<p class="author1">You can tell TypeScript explicitly that your value is a specific <code class="calibre14">number</code> (<code class="calibre14">f</code> and <code class="calibre14">g</code>).</p>
</li>

</ol>

<p class="author1">And just like with <code class="calibre14">booleans</code>, you’re usually going to let TypeScript infer the type for you (the first way). Once in a while you’ll do some clever programming that requires your number’s type to be restricted to a specific value (the second or fourth way). There is no good reason to explicitly type something as a <code class="calibre14">number</code> (the third way).</p>
<div data-type="tip" class="calibre21"><h6 class="calibre22">Tip</h6>
<p class="author1">When working with long numbers, use numeric separators to make those numbers easier to read.<a data-primary="numbers, numeric separators in" data-type="indexterm" id="calibre_link-1299" class="calibre4"></a> You can use numeric separators in both type and value positions:</p>
<pre data-type="programlisting" class="calibre43"><code class="kd">let</code> <code class="nx">oneMillion</code> <code class="o">=</code> <code class="nx">1_000_000</code> <code class="c">// Equivalent to 1000000</code>
<code class="kd">let</code> <code class="nx">twoMillion</code>: <code class="kt">2_000_000</code> <code class="o">=</code> <code class="nx">2_000_000</code></pre>
</div>
</div></section>













<section data-pdf-bookmark="bigint" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1808">
<h2 class="calibre17">bigint</h2>

<p class="author1"><code class="calibre14">bigint</code> is a newcomer to JavaScript and TypeScript: it lets you work with large integers without running into rounding errors.<a data-primary="bigint type" data-type="indexterm" id="calibre_link-683" class="calibre4"></a><a data-primary="types" data-secondary="supported by TypeScript" data-tertiary="bigint" data-type="indexterm" id="calibre_link-1653" class="calibre4"></a> While the <code class="calibre14">number</code> type can only represent whole numbers up to 2<sup class="calibre15">53</sup>, <code class="calibre14">bigint</code> can represent integers bigger than that too. <a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS1353" data-type="indexterm" id="calibre_link-893" class="calibre4"></a><a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2322" data-type="indexterm" id="calibre_link-901" class="calibre4"></a>The <code class="calibre14">bigint</code> type is the set of all BigInts, and supports things like addition (<code class="calibre14">+</code>), subtraction (<code class="calibre14">-</code>), multiplication (*), division (<code class="calibre14">/</code>), and comparison (<code class="calibre14">&lt;</code>). Use it like this:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">a</code> <code class="o">=</code> <code class="mi">1234</code><code class="nx">n</code>               <code class="c">// bigint</code>
<code class="kd">const</code> <code class="nx">b</code> <code class="o">=</code> <code class="mi">5678</code><code class="nx">n</code>             <code class="c">// 5678n</code>
<code class="kd">var</code> <code class="nx">c</code> <code class="o">=</code> <code class="nx">a</code> <code class="o">+</code> <code class="nx">b</code>               <code class="c">// bigint</code>
<code class="kd">let</code> <code class="nx">d</code> <code class="o">=</code> <code class="nx">a</code> <code class="o">&lt;</code> <code class="mi">1235</code>            <code class="c">// boolean</code>
<code class="kd">let</code> <code class="nx">e</code> <code class="o">=</code> <code class="mi">88.5</code><code class="nx">n</code>               <code class="c">// Error TS1353: A bigint literal must be an integer.</code>
<code class="kd">let</code> <code class="nx">f</code>: <code class="kt">bigint</code> <code class="o">=</code> <code class="mi">100</code><code class="nx">n</code>        <code class="c">// bigint</code>
<code class="kd">let</code> <code class="nx">g</code>: <code class="kt">100n</code> <code class="o">=</code> <code class="mi">100</code><code class="nx">n</code>          <code class="c">// 100n</code>
<code class="kd">let</code> <code class="nx">h</code>: <code class="kt">bigint</code> <code class="o">=</code> <code class="mi">100</code>         <code class="c">// Error TS2322: Type '100' is not assignable</code>
                            <code class="c">// to type 'bigint'.</code></pre>

<p class="author1">Like with <code class="calibre14">boolean</code> and <code class="calibre14">number</code>, there are four ways to declare bigints. Try to let TypeScript infer your bigint’s type when you can.</p>
<div data-type="warning" type="warning" class="calibre23"><h6 class="calibre24">Warning</h6>
<p class="author1">At the time of writing, <code class="calibre14">bigint</code> is not yet natively supported by every JavaScript engine. If your application relies on <code class="calibre14">bigint</code>, be careful to check whether or not it’s supported by your target platform.</p>
</div>
</div></section>













<section data-pdf-bookmark="string" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1809">
<h2 class="calibre17">string</h2>

<p class="author1"><code class="calibre14">string</code> is the set of all strings and the things you can do with them like concatenate (<code class="calibre14">+</code>), slice (<code class="calibre14">.slice</code>), and so on.<a data-primary="string type" data-type="indexterm" id="calibre_link-1452" class="calibre4"></a><a data-primary="types" data-secondary="supported by TypeScript" data-tertiary="string" data-type="indexterm" id="calibre_link-1660" class="calibre4"></a> Let’s see some examples:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">a</code> <code class="o">=</code> <code class="s">'hello'</code>             <code class="c">// string</code>
<code class="kd">var</code> <code class="nx">b</code> <code class="o">=</code> <code class="s">'billy'</code>             <code class="c">// string</code>
<code class="kd">const</code> <code class="nx">c</code> <code class="o">=</code> <code class="s">'!'</code>               <code class="c">// '!'</code>
<code class="kd">let</code> <code class="nx">d</code> <code class="o">=</code> <code class="nx">a</code> <code class="o">+</code> <code class="s">' '</code> <code class="o">+</code> <code class="nx">b</code> <code class="o">+</code> <code class="nx">c</code>     <code class="c">// string</code>
<code class="kd">let</code> <code class="nx">e</code>: <code class="kt">string</code> <code class="o">=</code> <code class="s">'zoom'</code>      <code class="c">// string</code>
<code class="kd">let</code> <code class="nx">f</code><code class="o">:</code> <code class="s">'john'</code> <code class="o">=</code> <code class="s">'john'</code>      <code class="c">// 'john'</code>
<code class="kd">let</code> <code class="nx">g</code><code class="o">:</code> <code class="s">'john'</code> <code class="o">=</code> <code class="s">'zoe'</code>       <code class="c">// Error TS2322: Type "zoe" is not assignable</code>
                            <code class="c">// to type "john".</code></pre>

<p class="author1">Like <code class="calibre14">boolean</code> and <code class="calibre14">number</code>, there are four ways to declare <code class="calibre14">string</code> types, and you should let TypeScript<a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2322" data-type="indexterm" id="calibre_link-902" class="calibre4"></a> infer the type for you whenever you can.</p>
</div></section>













<section data-pdf-bookmark="symbol" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1810">
<h2 class="calibre17">symbol</h2>

<p class="author1"><code class="calibre14">symbol</code> is a relatively new language feature that arrived with one of the latest major JavaScript revisions (ES2015). <a data-primary="symbol type" data-type="indexterm" id="calibre_link-1465" class="calibre4"></a><a data-primary="types" data-secondary="supported by TypeScript" data-tertiary="symbol" data-type="indexterm" id="calibre_link-1661" class="calibre4"></a>Symbols don’t come up often in practice; they are used as an alternative to string keys in objects and maps, in places where you want to be extra sure that people are using the right well-known key and didn’t accidentally set the key&mdash;think setting a default iterator for your object (<code class="calibre14">Symbol.iterator</code>), or overriding at runtime whether or not your object is an instance of something (<code class="calibre14">Symbol.hasInstance</code>). Symbols have the type <code class="calibre14">symbol</code>, and there isn’t all that much you can do with them:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">a</code> <code class="o">=</code> <code class="nx">Symbol</code><code class="p">(</code><code class="s">'a'</code><code class="p">)</code>         <code class="c">// symbol</code>
<code class="kd">let</code> <code class="nx">b</code>: <code class="kt">symbol</code> <code class="o">=</code> <code class="nx">Symbol</code><code class="p">(</code><code class="s">'b'</code><code class="p">)</code> <code class="c">// symbol</code>
<code class="kd">var</code> <code class="nx">c</code> <code class="o">=</code> <code class="nx">a</code> <code class="o">===</code> <code class="nx">b</code>             <code class="c">// boolean</code>
<code class="kd">let</code> <code class="nx">d</code> <code class="o">=</code> <code class="nx">a</code> <code class="o">+</code> <code class="s">'x'</code>             <code class="c">// Error TS2469: The '+' operator cannot be applied</code>
                            <code class="c">// to type 'symbol'.</code></pre>

<p class="author1">The way <code class="calibre14">Symbol('a')</code> works in JavaScript<a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2469" data-type="indexterm" id="calibre_link-940" class="calibre4"></a> is by creating a new <code class="calibre14">symbol</code> with the given name; that <code class="calibre14">symbol</code> is unique, and will not be equal (when compared with <code class="calibre14">==</code> or <code class="calibre14">===</code>) to any other <code class="calibre14">symbol</code> (even if you create a second <code class="calibre14">symbol</code> with the same exact name!). Similarly to how the value <code class="calibre14">27</code> is inferred to be a <code class="calibre14">number</code> when declared with <code class="calibre14">let</code> but the specific number <code class="calibre14">27</code> when you declare it with <code class="calibre14">const</code>, symbols are inferred to be of type <code class="calibre14">symbol</code> but can be <a data-primary="const" data-secondary="declaring symbols with" data-type="indexterm" id="calibre_link-791" class="calibre4"></a><a data-primary="unique symbols" data-type="indexterm" id="calibre_link-1720" class="calibre4"></a><a data-primary="symbol type" data-secondary="example usages for unique symbol" data-type="indexterm" id="calibre_link-1466" class="calibre4"></a><a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS1332" data-type="indexterm" id="calibre_link-892" class="calibre4"></a>explicitly typed as <code class="calibre14">unique symbol</code>:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">const</code> <code class="nx">e</code> <code class="o">=</code> <code class="nx">Symbol</code><code class="p">(</code><code class="s">'e'</code><code class="p">)</code>                <code class="c">// typeof e</code>
<code class="kd">const</code> <code class="nx">f</code>: <code class="kt">unique</code> <code class="nx">symbol</code> <code class="o">=</code> <code class="nx">Symbol</code><code class="p">(</code><code class="s">'f'</code><code class="p">)</code> <code class="c">// typeof f</code>
<code class="kd">let</code> <code class="nx">g</code>: <code class="kt">unique</code> <code class="nx">symbol</code> <code class="o">=</code> <code class="nx">Symbol</code><code class="p">(</code><code class="s">'f'</code><code class="p">)</code>   <code class="c">// Error TS1332: A variable whose type is a</code>
                                     <code class="c">// 'unique symbol' type must be 'const'.</code>
<code class="kd">let</code> <code class="nx">h</code> <code class="o">=</code> <code class="nx">e</code> <code class="o">===</code> <code class="nx">e</code>             <code class="c">// boolean</code>
<code class="kd">let</code> <code class="nx">i</code> <code class="o">=</code> <code class="nx">e</code> <code class="o">===</code> <code class="nx">f</code>             <code class="c">// Error TS2367: This condition will always return</code>
                            <code class="c">// 'false' since the types 'unique symbol' and</code>
                            <code class="c">// 'unique symbol' have no overlap.</code></pre>

<p class="author1">This example shows<a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2367" data-type="indexterm" id="calibre_link-935" class="calibre4"></a> off a few ways to create unique symbols:</p>
<ol class="calibre31">
<li class="calibre32">
<p class="author1">When you declare a new <code class="calibre14">symbol</code> and assign it to a <code class="calibre14">const</code> variable (not a <code class="calibre14">let</code> or <code class="calibre14">var</code> variable), TypeScript will infer its type as <code class="calibre14">unique symbol</code>. It will show up as <code class="calibre14">typeof</code> <em class="calibre5">yourVariableName</em>, not <code class="calibre14">unique symbol</code>, in your code editor.</p>
</li>
<li class="calibre32">
<p class="author1">You can explicitly annotate a <code class="calibre14">const</code> variable’s type as <code class="calibre14">unique symbol</code>.</p>
</li>
<li class="calibre32">
<p class="author1">A <code class="calibre14">unique symbol</code> is always equal to itself.</p>
</li>
<li class="calibre32">
<p class="author1">TypeScript knows at compile time that a <code class="calibre14">unique symbol</code> will never be equal to any other <code class="calibre14">unique symbol</code>.</p>
</li>

</ol>

<p class="author1">Think of <code class="calibre14">unique symbols</code> like other literal types, like <code class="calibre14">1</code>, <code class="calibre14">true</code>, or <code class="calibre14">"literal"</code>. They’re a way to create a type that represents a particular inhabitant of <code class="calibre14">symbol</code>.</p>
</div></section>













<section data-pdf-bookmark="Objects" data-type="sect2" class="preface"><div class="preface" id="calibre_link-525">
<h2 class="calibre17">Objects</h2>

<p class="author1">TypeScript’s object types specify the shapes of objects.<a data-primary="objects" data-type="indexterm" id="calibre_link-1303" class="calibre4"></a><a data-primary="types" data-secondary="supported by TypeScript" data-tertiary="objects" data-type="indexterm" id="calibre_link-1658" class="calibre4"></a> Notably, they can’t tell the difference between simple objects (like the kind you make with <code class="calibre14">{}</code>) and more complicated ones (the kind you create with <code class="calibre14">new Blah</code>). <a data-primary="structural typing" data-type="indexterm" id="calibre_link-1455" class="calibre4"></a><a data-primary="nominal typing" data-type="indexterm" id="calibre_link-1282" class="calibre4"></a>This is by design: JavaScript is generally <em class="calibre5">structurally typed</em>, so TypeScript favors that style of programming over a <em class="calibre5">nominally typed</em> style.</p>
<aside class="keyterm" data-type="sidebar" type="sidebar"><div class="sidebar" id="calibre_link-1811">
<h5 class="calibre29">Structural typing</h5>
<p class="author1">A style of programming where you just care that an object has certain properties, and not what its name is (nominal typing).<a data-primary="duck typing" data-seealso="structural typing" data-type="indexterm" id="calibre_link-858" class="calibre4"></a> Also called <em class="calibre5">duck typing</em> in some languages (or, not judging a book by its cover).</p>
</div></aside>

<p class="author1">There are a few ways to use types to describe objects in TypeScript. The first is to declare a value as an <code class="calibre14">object</code>:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">a</code>: <code class="kt">object</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">b</code><code class="o">:</code> <code class="s">'x'</code>
<code class="p">}</code></pre>

<p class="author1">What happens when you access <code class="calibre14">b</code>?</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">a</code><code class="p">.</code><code class="nx">b</code>   <code class="c">// Error TS2339: Property 'b' does not exist on type 'object'.</code></pre>

<p class="author1">Wait, that’s not very useful! What’s the point of typing something as an <code class="calibre14">object</code> if you can’t do anything with it?<a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2339" data-type="indexterm" id="calibre_link-909" class="calibre4"></a></p>

<p class="author1">Why, that’s a great point, aspiring TypeScripter! In fact, <code class="calibre14">object</code> is a little narrower than <code class="calibre14">any</code>, but not by much. <code class="calibre14">object</code> doesn’t tell you a lot about the value it describes, just that the value is a JavaScript object (and that it’s not <code class="calibre14">null</code>).<a data-primary="any type" data-secondary="object versus" data-type="indexterm" id="calibre_link-629" class="calibre4"></a></p>

<p class="author1">What if we leave off the explicit annotation, and let TypeScript do its thing?</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">a</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">b</code><code class="o">:</code> <code class="s">'x'</code>
<code class="p">}</code>            <code class="c">// {b: string}</code>
<code class="nx">a</code><code class="p">.</code><code class="nx">b</code>          <code class="c">// string</code>

<code class="kd">let</code> <code class="nx">b</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">c</code><code class="o">:</code> <code class="p">{</code>
    <code class="nx">d</code><code class="o">:</code> <code class="s">'f'</code>
  <code class="p">}</code>
<code class="p">}</code>            <code class="c">// {c: {d: string}}</code></pre>

<p class="author1">Voilà! You’ve just discovered the second way to type an object: object literal syntax (not to be confused with type literals).<a data-primary="object literals" data-type="indexterm" id="calibre_link-1300" class="calibre4"></a><a data-primary="{} (curly braces), defining object literal types with" data-type="indexterm" id="calibre_link-596" class="calibre4"></a><a data-primary="const" data-secondary="declaring objects with" data-type="indexterm" id="calibre_link-790" class="calibre4"></a> You can either let TypeScript infer your object’s shape for you, or explicitly describe it inside curly braces(<code class="calibre14">{}</code>):</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">a</code><code class="o">:</code> <code class="p">{</code><code class="nx">b</code>: <code class="kt">number</code><code class="p">}</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">b</code>: <code class="kt">12</code>
<code class="p">}</code>            <code class="c">// {b: number}</code></pre>
<aside data-type="sidebar" type="sidebar" class="keyterm"><div class="sidebar" id="calibre_link-1812">
<h5 class="calibre29">Type Inference When Declaring Objects with const</h5>
<p class="author1">What would have happened if we’d used <code class="calibre14">const</code> to declare the object instead?</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">const</code> <code class="nx">a</code><code class="o">:</code> <code class="p">{</code><code class="nx">b</code>: <code class="kt">number</code><code class="p">}</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">b</code>: <code class="kt">12</code>
<code class="p">}</code>            <code class="c">// Still {b: number}</code></pre>

<p class="author1">You might be surprised that TypeScript inferred <code class="calibre14">b</code> as a <code class="calibre14">number</code>, and not as the literal <code class="calibre14">12</code>. After all, we learned that when declaring <code class="calibre14">number</code>s or <code class="calibre14">string</code>s, our choice of <code class="calibre14">const</code> or <code class="calibre14">let</code> affects how TypeScript infers our types.</p>

<p class="author1">Unlike the primitive types we’ve looked at so far&mdash;<code class="calibre14">boolean</code>, <code class="calibre14">number</code>, <code class="calibre14">bigint</code>, <code class="calibre14">string</code>, and <code class="calibre14">symbol</code>&mdash;declaring an object with <code class="calibre14">const</code> won’t hint to TypeScript to infer its type more narrowly. That’s because JavaScript objects are mutable, and for all TypeScript knows you might update their fields after you create them.</p>

<p class="author1">We explore this idea more deeply&mdash;including how to opt into narrower inference&mdash;in <a data-type="xref" href="#calibre_link-40" class="calibre4">“Type Widening”</a>.</p>
</div></aside>

<p class="author1">Object literal syntax says, “Here is a thing that has this shape.” The thing might be an object literal, or it might be a class:</p>
<pre class="calibre30" data-code-language="ts" data-type="programlisting">
<code class="kd">let</code> <code class="nx">c</code><code class="o">:</code> <code class="p">{</code>
  <code class="nx">firstName</code>: <code class="kt">string</code>
  <code class="nx">lastName</code>: <code class="kt">string</code>
<code class="p">}</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">firstName</code><code class="o">:</code> <code class="s">'john'</code><code class="p">,</code>
  <code class="nx">lastName</code><code class="o">:</code> <code class="s">'barrowman'</code>
<code class="p">}</code>

<code class="kd">class</code> <code class="nx">Person</code> <code class="p">{</code>
  <code class="kd">constructor</code><code class="p">(</code>
    <code class="kd">public</code> <code class="nx">firstName</code>: <code class="kt">string</code><code class="p">,</code>   <code class="c">// public is shorthand for</code>
                                <code class="c">// this.firstName = firstName</code>
    <code class="kd">public</code> <code class="nx">lastName</code>: <code class="kt">string</code>
  <code class="p">)</code> <code class="p">{}</code>
<code class="p">}</code>
<code class="nx">c</code> <code class="o">=</code> <code class="kd">new</code> <code class="nx">Person</code><code class="p">(</code><code class="s">'matt'</code><code class="p">,</code> <code class="s">'smith'</code><code class="p">)</code> <code class="c">// OK</code>
</pre>

<p class="author1"><code class="calibre14">{firstName: string, lastName: string}</code> describes <a data-primary="objects" data-secondary="shape of" data-type="indexterm" id="calibre_link-1318" class="calibre4"></a>the <em class="calibre5">shape</em> of an object, and both the object literal and the class instance from the last example satisfy that shape, so TypeScript lets us assign a <code class="calibre14">Person</code> to <code class="calibre14">c</code>.</p>

<p class="author1">Let’s explore what happens when <a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2322" data-type="indexterm" id="calibre_link-903" class="calibre4"></a><a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2741" data-type="indexterm" id="calibre_link-956" class="calibre4"></a>we add extra properties, or leave out required ones:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">a</code><code class="o">:</code> <code class="p">{</code><code class="nx">b</code>: <code class="kt">number</code><code class="p">}</code>

<code class="nx">a</code> <code class="o">=</code> <code class="p">{}</code>  <code class="c">// Error TS2741: Property 'b' is missing in type '{}'</code>
        <code class="c">// but required in type '{b: number}'.</code>

<code class="nx">a</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">b</code>: <code class="kt">1</code><code class="p">,</code>
  <code class="nx">c</code>: <code class="kt">2</code>  <code class="c">// Error TS2322: Type '{b: number; c: number}' is not assignable</code>
<code class="p">}</code>       <code class="c">// to type '{b: number}'. Object literal may only specify known</code>
        <code class="c">// properties, and 'c' does not exist in type '{b: number}'.</code></pre>
<aside data-type="sidebar" type="sidebar" class="keyterm"><div class="sidebar" id="calibre_link-1813">
<h5 class="calibre29">Definite Assignment</h5>
<p class="author1">This is the first example we’ve looked at where we first declare a variable (<code class="calibre14">a</code>), then initialize it with values (<code class="calibre14">{}</code> and <code class="calibre14">{b: 1, c: 2}</code>).<a data-primary="variables" data-secondary="declaring, then initializing with values" data-type="indexterm" id="calibre_link-1739" class="calibre4"></a> This is a common JavaScript pattern, and it’s supported by TypeScript too.</p>

<p class="author1">When you declare a variable in one place and initialize it later, TypeScript will make sure that your variable is <em class="calibre5">definitely assigned</em> a value by the time you use it:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">i</code>: <code class="kt">number</code>
<code class="kd">let</code> <code class="nx">j</code> <code class="o">=</code> <code class="nx">i</code> <code class="o">*</code> <code class="mi">3</code>  <code class="c">// Error TS2454: Variable 'i' is used</code>
               <code class="c">// before being assigned.</code></pre>

<p class="author1">And don’t worry, TypeScript enforces this for you even if you leave off the explicit type <a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2532" data-type="indexterm" id="calibre_link-944" class="calibre4"></a>annotation:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">i</code>
<code class="kd">let</code> <code class="nx">j</code> <code class="o">=</code> <code class="nx">i</code> <code class="o">*</code> <code class="mi">3</code>  <code class="c">// Error TS2532: Object is possibly</code>
               <code class="c">// 'undefined'.</code></pre>
</div></aside>

<p class="author1">By default, TypeScript is pretty strict about object properties&mdash;if you say the object should have a property <a data-primary="objects" data-secondary="properties of" data-type="indexterm" id="calibre_link-1316" class="calibre4"></a>called <code class="calibre14">b</code> that’s a <code class="calibre14">number</code>, TypeScript expects <code class="calibre14">b</code> and only <code class="calibre14">b</code>. If <code class="calibre14">b</code> is missing, or if there are extra properties, TypeScript will complain.</p>

<p class="author1">Can you tell TypeScript that something is optional, or that there might be more properties <a data-primary="? (question mark)" data-secondary="for optional properties in objects" data-type="indexterm" id="calibre_link-588" class="calibre4"></a>than you planned for? You bet:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code><code class="calibre14"> </code><code class="nx">a</code><code class="o">:</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="nx">b</code><code class="calibre14">: </code><code class="kt">number</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-41" id="calibre_link-44"><img alt="1" src="images/000000.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="nx">c?</code><code class="calibre14">: </code><code class="kt">string</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-42" id="calibre_link-45"><img alt="2" src="images/000001.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="p">[</code><code class="nx">key</code><code class="calibre14">: </code><code class="kt">number</code><code class="p">]</code><code class="o">:</code><code class="calibre14"> </code><code class="kd">boolean</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-43" id="calibre_link-46"><img alt="3" src="images/000002.png" class="calibre40" /></a><code class="calibre14">
</code><code class="p">}</code></pre>
<dl class="preface">
<dt class="calibre18"><a class="calibre4" href="#calibre_link-44" id="calibre_link-41"><img alt="1" src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45"><code class="calibre14">a</code> has a property <code class="calibre14">b</code> that’s a <code class="calibre14">number</code>.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-45" id="calibre_link-42"><img alt="2" src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45"><code class="calibre14">a</code> might have a property <code class="calibre14">c</code> that’s a <code class="calibre14">string</code>. And if <code class="calibre14">c</code> is set, it might be <code class="calibre14">undefined</code>.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-46" id="calibre_link-43"><img alt="3" src="images/000002.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45"><code class="calibre14">a</code> might have any number of numeric properties that are <code class="calibre14">booleans</code>.</p></dd>
</dl>

<p class="author1">Let’s see what types of<a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2741" data-type="indexterm" id="calibre_link-957" class="calibre4"></a> objects we can assign to <code class="calibre14">a</code>:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">a</code> <code class="o">=</code> <code class="p">{</code><code class="nx">b</code>: <code class="kt">1</code><code class="p">}</code>
<code class="nx">a</code> <code class="o">=</code> <code class="p">{</code><code class="nx">b</code>: <code class="kt">1</code><code class="p">,</code> <code class="nx">c</code>: <code class="kt">undefined</code><code class="p">}</code>
<code class="nx">a</code> <code class="o">=</code> <code class="p">{</code><code class="nx">b</code>: <code class="kt">1</code><code class="p">,</code> <code class="nx">c</code><code class="o">:</code> <code class="s">'d'</code><code class="p">}</code>
<code class="nx">a</code> <code class="o">=</code> <code class="p">{</code><code class="nx">b</code>: <code class="kt">1</code><code class="p">,</code> <code class="nx">10</code>: <code class="kt">true</code><code class="p">}</code>
<code class="nx">a</code> <code class="o">=</code> <code class="p">{</code><code class="nx">b</code>: <code class="kt">1</code><code class="p">,</code> <code class="nx">10</code>: <code class="kt">true</code><code class="p">,</code> <code class="nx">20</code>: <code class="kt">false</code><code class="p">}</code>
<code class="nx">a</code> <code class="o">=</code> <code class="p">{</code><code class="nx">10</code>: <code class="kt">true</code><code class="p">}</code>          <code class="c">// Error TS2741: Property 'b' is missing in type</code>
                        <code class="c">// '{10: true}'.</code>
<code class="nx">a</code> <code class="o">=</code> <code class="p">{</code><code class="nx">b</code>: <code class="kt">1</code><code class="p">,</code> <code class="mi">33</code><code class="o">:</code> <code class="s">'red'</code><code class="p">}</code>   <code class="c">// Error TS2741: Type 'string' is not assignable</code>
                        <code class="c">// to type 'boolean'.</code></pre>
<aside data-type="sidebar" type="sidebar" class="keyterm"><div class="sidebar" id="calibre_link-1814">
<h5 class="calibre29">Index Signatures</h5>
<p class="author1">The <code class="calibre14">[key: T]: U</code> syntax is called an <em class="calibre5">index signature</em>, and this is the way you tell TypeScript that the given object might contain more keys.<a data-primary="[] (square brackets)" data-secondary="index signature syntax" data-type="indexterm" id="calibre_link-592" class="calibre4"></a><a data-primary="index signatures" data-type="indexterm" id="calibre_link-1104" class="calibre4"></a><a data-primary="objects" data-secondary="index signature" data-type="indexterm" id="calibre_link-1312" class="calibre4"></a> The way to read it is, “For this object, all keys of type <code class="calibre14">T</code> must have values of type <code class="calibre14">U</code>.” Index signatures let you safely add more keys to an object, in addition to any keys that you explicitly declared.</p>

<p class="author1">There is one rule to keep in mind for index signatures: the index signature key’s type (<code class="calibre14">T</code>) must be assignable to either <code class="calibre14">number</code> or <code class="calibre14">string</code>.<sup class="calibre15"><a data-type="noteref" href="#calibre_link-47" id="calibre_link-59" class="calibre16">2</a></sup></p>

<p class="author1">Also note that you can use any word for the index signature key’s name&mdash;it doesn’t have to be <code class="calibre14">key</code>:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">airplaneSeatingAssignments</code><code class="o">:</code> <code class="p">{</code>
  <code class="p">[</code><code class="nx">seatNumber</code>: <code class="kt">string</code><code class="p">]</code><code class="o">:</code> <code class="kt">string</code>
<code class="p">}</code> <code class="o">=</code> <code class="p">{</code>
  <code class="s">'34D'</code><code class="o">:</code> <code class="s">'Boris Cherny'</code><code class="p">,</code>
  <code class="s">'34E'</code><code class="o">:</code> <code class="s">'Bill Gates'</code>
<code class="p">}</code></pre>
</div></aside>

<p class="author1">Optional (<code class="calibre14">?</code>) isn’t the only modifier you can use when declaring object types. You can also mark fields as read-only (that is, you can declare that a field can’t be modified after it’s assigned an initial value&mdash;kind of like <code class="calibre14">const</code> for object properties) with <a data-primary="readonly modifier" data-type="indexterm" id="calibre_link-1406" class="calibre4"></a>the <code class="calibre14">readonly</code> modifier:</p>

<pre class="calibre30" data-code-language="ts" data-type="programlisting"><code class="kd">let</code> <code class="nx">user</code><code class="o">:</code> <code class="p">{</code>
  <code class="nx">readonly</code> <code class="nx">firstName</code>: <code class="kt">string</code>
<code class="p">}</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">firstName</code><code class="o">:</code> <code class="s">'abby'</code>
<code class="p">}</code>

<code class="nx">user</code><code class="p">.</code><code class="nx">firstName</code> <code class="c">// string</code>
<code class="nx">user</code><code class="p">.</code><code class="nx">firstName</code> <code class="o">=</code>
  <code class="s">'abbey with an e'</code> <code class="c">// Error TS2540: Cannot assign to 'firstName' because it</code>
                    <code class="c">// is a read-only property.</code></pre>

<p class="author1">Object literal<a data-primary="objects" data-secondary="empty" data-type="indexterm" id="calibre_link-1310" class="calibre4"></a><a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2540" data-type="indexterm" id="calibre_link-945" class="calibre4"></a> notation has one special case: empty object types (<code class="calibre14">{}</code>). Every type&mdash;except <code class="calibre14">null</code> and <code class="calibre14">undefined</code>&mdash;is assignable to an empty object type, which can make it tricky to use. Try to avoid empty object types when possible:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">danger</code><code class="o">:</code> <code class="p">{}</code>
<code class="nx">danger</code> <code class="o">=</code> <code class="p">{}</code>
<code class="nx">danger</code> <code class="o">=</code> <code class="p">{</code><code class="nx">x</code>: <code class="kt">1</code><code class="p">}</code>
<code class="nx">danger</code> <code class="o">=</code> <code class="p">[]</code>
<code class="nx">danger</code> <code class="o">=</code> <code class="mi">2</code></pre>

<p class="author1">As a final note on objects, it’s worth mentioning one last way of typing something as an object: <code class="calibre14">Object</code>. This is pretty much the same as using <code class="calibre14">{}</code>, and is best avoided. <sup class="calibre15"><a data-type="noteref" href="#calibre_link-48" id="calibre_link-60" class="calibre16">3</a></sup></p>

<p class="author1">To summarize, there are four ways to declare <a data-primary="objects" data-secondary="declaring in TypeScript" data-type="indexterm" id="calibre_link-1309" class="calibre4"></a><a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2322" data-type="indexterm" id="calibre_link-904" class="calibre4"></a>objects in TypeScript:</p>
<ol class="calibre31">
<li class="calibre32">
<p class="author1">Object literal notation (like <code class="calibre14">{a: string}</code>), also called a <em class="calibre5">shape</em>. Use this when you know which fields your object could have, or when all of your object’s values will have the same type.</p>
</li>
<li class="calibre32">
<p class="author1">Empty object literal notation (<code class="calibre14">{}</code>). Try to avoid this.</p>
</li>
<li class="calibre32">
<p class="author1">The <code class="calibre14">object</code> type. Use this when you just want an object, and don’t care about which fields it has.</p>
</li>
<li class="calibre32">
<p class="author1">The <code class="calibre14">Object</code> type. Try to avoid this.</p>
</li>

</ol>

<p class="author1">In your TypeScript programs, you should almost always stick to the first way and the third way. Be careful to avoid the second and fourth ways&mdash;use a linter to warn about them, complain about them in code reviews, print posters&mdash;use your team’s preferred tool to keep them far away from your codebase.</p>

<p class="author1"><a data-type="xref" href="#calibre_link-49" class="calibre4">Table&nbsp;3-1</a> is a handy reference for options 2&ndash;4 in the previous list.</p>
<table id="calibre_link-49" class="stafflist_table">
<caption class="calibre35"><span class="calibre">Table 3-1. </span>Is the value a valid object?</caption>
<thead class="calibre36">
<tr class="calibre7">
<th class="calibre37">Value</th>
<th class="calibre37"><code class="calibre14">{}</code></th>
<th class="calibre37"><code class="calibre14">object</code></th>
<th class="calibre37"><code class="calibre14">Object</code></th>
</tr>
</thead>
<tbody class="calibre6">
<tr class="calibre7">
<td class="calibre8"><p class="author1"><code class="calibre14">{}</code></p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1"><code class="calibre14">['a']</code></p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1"><code class="calibre14">function () {}</code></p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1"><code class="calibre14">new String('a')</code></p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1"><code class="calibre14">'a'</code></p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
<td class="calibre8"><p class="author1"><strong class="calibre38">No</strong></p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1"><code class="calibre14">1</code></p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
<td class="calibre8"><p class="author1"><strong class="calibre38">No</strong></p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1"><code class="calibre14">Symbol('a')</code></p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
<td class="calibre8"><p class="author1"><strong class="calibre38">No</strong></p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1"><code class="calibre14">null</code></p></td>
<td class="calibre8"><p class="author1"><strong class="calibre38">No</strong></p></td>
<td class="calibre8"><p class="author1"><strong class="calibre38">No</strong></p></td>
<td class="calibre8"><p class="author1"><strong class="calibre38">No</strong></p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1"><code class="calibre14">undefined</code></p></td>
<td class="calibre8"><p class="author1"><strong class="calibre38">No</strong></p></td>
<td class="calibre8"><p class="author1"><strong class="calibre38">No</strong></p></td>
<td class="calibre8"><p class="author1"><strong class="calibre38">No</strong></p></td>
</tr>
</tbody>
</table>
</div></section>













<section data-pdf-bookmark="Intermission: Type Aliases, Unions, and Intersections" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1815">
<h2 class="calibre17">Intermission: Type Aliases, Unions, and Intersections</h2>

<p class="author1">You are quickly becoming a grizzled TypeScript programmer.<a data-primary="objects" data-startref="ix_objs" data-type="indexterm" id="calibre_link-1304" class="calibre4"></a><a data-primary="types" data-secondary="supported by TypeScript" data-startref="ix_typTSobj" data-tertiary="objects" data-type="indexterm" id="calibre_link-1659" class="calibre4"></a> You have seen several types and how they work, and are now familiar with the concepts of type systems, types, and safety. It’s time we go deeper.</p>

<p class="author1">As you know, if you have a value, you can perform certain operations on it, depending on what its type permits. For example, you can use <code class="calibre14">+</code> to add two numbers, or <code class="calibre14">.toUpperCase</code> to uppercase a string.</p>

<p class="author1">If you have a <em class="calibre5">type</em>, you can perform some operations on it too. I’m going to introduce a few type-level operations here&mdash;there are more to come later in the book, but these are so common that I want to introduce them as early as possible.</p>










<section data-pdf-bookmark="Type aliases" data-type="sect3" class="preface"><div class="preface" id="calibre_link-1816">
<h3 class="calibre39">Type aliases</h3>

<p class="author1">Just like you can use variable declarations (<code class="calibre14">let</code>, <code class="calibre14">const</code>, and <code class="calibre14">var</code>) to declare a variable that aliases a value, you can declare a type alias that points to a type.<a data-primary="types" data-secondary="supported by TypeScript" data-tertiary="type aliases" data-type="indexterm" id="calibre_link-1663" class="calibre4"></a><a data-primary="aliases (type)" data-see="type aliases" data-type="indexterm" id="calibre_link-1817" class="calibre4"></a><a data-primary="type aliases" data-type="indexterm" id="calibre_link-1551" class="calibre4"></a> It looks like this:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">Age</code> <code class="o">=</code> <code class="kt">number</code>

<code class="nx">type</code> <code class="nx">Person</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">name</code>: <code class="kt">string</code>
  <code class="nx">age</code>: <code class="kt">Age</code>
<code class="p">}</code></pre>

<p class="author1"><code class="calibre14">Age</code> is but a <code class="calibre14">number</code>. It can also help make the definition of the <code class="calibre14">Person</code> shape easier to understand. Aliases are never inferred by TypeScript, so you have to type them explicitly:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">age</code>: <code class="kt">Age</code> <code class="o">=</code> <code class="mi">55</code>

<code class="kd">let</code> <code class="nx">driver</code>: <code class="kt">Person</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">name</code><code class="o">:</code> <code class="s">'James May'</code>
  <code class="nx">age</code>: <code class="kt">age</code>
<code class="p">}</code></pre>

<p class="author1">Because <code class="calibre14">Age</code> is just an alias for <code class="calibre14">number</code>, that means it’s also assignable to <code class="calibre14">number</code>, so we can rewrite this as:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">age</code> <code class="o">=</code> <code class="mi">55</code>

<code class="kd">let</code> <code class="nx">driver</code>: <code class="kt">Person</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">name</code><code class="o">:</code> <code class="s">'James May'</code>
  <code class="nx">age</code>: <code class="kt">age</code>
<code class="p">}</code></pre>

<p class="author1">Wherever you see a type alias used, you can substitute in the type it aliases without changing the meaning of your program.</p>

<p class="author1">Like JavaScript <a data-primary="let" data-secondary="variable declarations with" data-type="indexterm" id="calibre_link-1189" class="calibre4"></a><a data-primary="const" data-secondary="variable declarations with" data-type="indexterm" id="calibre_link-796" class="calibre4"></a><a data-primary="var" data-secondary="variable declarations with" data-type="indexterm" id="calibre_link-1736" class="calibre4"></a>variable declarations (<code class="calibre14">let</code>, <code class="calibre14">const</code>, and <code class="calibre14">var</code>), you can’t declare a type twice:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">Color</code> <code class="o">=</code> <code class="s">'red'</code>
<code class="nx">type</code> <code class="nx">Color</code> <code class="o">=</code> <code class="s">'blue'</code>  <code class="c">// Error TS2300: Duplicate identifier 'Color'.</code></pre>

<p class="author1">And like <code class="calibre14">let</code> and <code class="calibre14">const</code>, type aliases are block-scoped.<a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2300" data-type="indexterm" id="calibre_link-894" class="calibre4"></a> Every block and every function has its own scope, and inner type alias declarations shadow outer ones:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">Color</code> <code class="o">=</code> <code class="s">'red'</code>

<code class="kd">let</code> <code class="nx">x</code> <code class="o">=</code> <code class="nb">Math</code><code class="p">.</code><code class="nx">random</code><code class="p">()</code> <code class="o">&lt;</code> <code class="p">.</code><code class="mi">5</code>

<code class="kd">if</code> <code class="p">(</code><code class="nx">x</code><code class="p">)</code> <code class="p">{</code>
  <code class="nx">type</code> <code class="nx">Color</code> <code class="o">=</code> <code class="s">'blue'</code>  <code class="c">// This shadows the Color declared above.</code>
  <code class="kd">let</code> <code class="nx">b</code>: <code class="kt">Color</code> <code class="o">=</code> <code class="s">'blue'</code>
<code class="p">}</code> <code class="kd">else</code> <code class="p">{</code>
  <code class="kd">let</code> <code class="nx">c</code>: <code class="kt">Color</code> <code class="o">=</code> <code class="s">'red'</code>
<code class="p">}</code></pre>

<p class="author1">Type aliases are useful for DRYing up repeated complex types,<sup class="calibre15"><a data-type="noteref" href="#calibre_link-50" id="calibre_link-61" class="calibre16">4</a></sup> and for making it clear what a variable is used for (some people prefer descriptive type names to descriptive variable names!).<a data-primary="Don&apos;t Repeat Yourself (DRY)" data-type="indexterm" id="calibre_link-855" class="calibre4"></a><a data-primary="DRY (Don&apos;t Repeat Yourself)" data-type="indexterm" id="calibre_link-857" class="calibre4"></a> When deciding whether or not to alias a type, use the same judgment as when deciding whether or not to pull a value out into its own <span class="calibre">variable</span>.</p>
</div></section>













<section data-pdf-bookmark="Union and intersection types" data-type="sect3" class="preface"><div class="preface" id="calibre_link-58">
<h3 class="calibre39">Union and intersection types</h3>

<p class="author1">If you have two things <code class="calibre14">A</code> and <code class="calibre14">B</code>, the <em class="calibre5">union</em> of those things is their sum (everything in <code class="calibre14">A</code> or <code class="calibre14">B</code> or both), and the <em class="calibre5">intersection</em> is what they have in common (everything in both <code class="calibre14">A</code> and <code class="calibre14">B</code>). <a data-primary="union types" data-type="indexterm" id="calibre_link-1716" class="calibre4"></a><a data-primary="intersection types" data-type="indexterm" id="calibre_link-1128" class="calibre4"></a>The easiest way to think about this is with sets.<a data-primary="types" data-secondary="supported by TypeScript" data-tertiary="union and intersection types" data-type="indexterm" id="calibre_link-1665" class="calibre4"></a> In <a data-type="xref" href="#calibre_link-51" class="calibre4">Figure&nbsp;3-2</a> I represent sets as circles. On the left is the union, or <em class="calibre5">sum</em>, of the two sets; on the right is their intersection, or <em class="calibre5">product</em>.</p>

<figure class="calibre33"><div class="figure" id="calibre_link-51">
<img alt="prts 0302" src="images/000012.png" class="calibre40" />
<h6 class="calibre34"><span class="calibre">Figure 3-2. </span>Union (|) and intersection (&amp;)</h6>
</div></figure>

<p class="author1">TypeScript gives us special type operators to describe unions and intersections of types: <code class="calibre14">|</code> for union and <code class="calibre14">&amp;</code> for intersection.<a data-primary="| (pipe symbol), for union types" data-type="indexterm" id="calibre_link-597" class="calibre4"></a><a data-primary="&amp; (ampersand), for intersection types" data-type="indexterm" id="calibre_link-578" class="calibre4"></a> Since types are a lot like sets, we can think of them in the same way:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">Cat</code> <code class="o">=</code> <code class="p">{</code><code class="nx">name</code>: <code class="kt">string</code><code class="p">,</code> <code class="nx">purrs</code>: <code class="kt">boolean</code><code class="p">}</code>
<code class="nx">type</code> <code class="nx">Dog</code> <code class="o">=</code> <code class="p">{</code><code class="nx">name</code>: <code class="kt">string</code><code class="p">,</code> <code class="nx">barks</code>: <code class="kt">boolean</code><code class="p">,</code> <code class="nx">wags</code>: <code class="kt">boolean</code><code class="p">}</code>
<code class="nx">type</code> <code class="nx">CatOrDogOrBoth</code> <code class="o">=</code> <code class="nx">Cat</code> <code class="o">|</code> <code class="nx">Dog</code>
<code class="nx">type</code> <code class="nx">CatAndDog</code> <code class="o">=</code> <code class="nx">Cat</code> <code class="o">&amp;</code> <code class="nx">Dog</code></pre>

<p class="author1">If something is a <code class="calibre14">CatOrDogOrBoth</code>, what do you know about it? You know that it has a <code class="calibre14">name</code> property that’s a string, and not much else. On the flip side, what can you assign to a <code class="calibre14">CatOrDogOrBoth</code>? Well, a <code class="calibre14">Cat</code>, a <code class="calibre14">Dog</code>, or both:</p>
<pre class="calibre30" data-code-language="ts" data-type="programlisting">
<code class="c">// Cat</code>
<code class="kd">let</code> <code class="nx">a</code>: <code class="kt">CatOrDogOrBoth</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">name</code><code class="o">:</code> <code class="s">'Bonkers'</code><code class="p">,</code>
  <code class="nx">purrs</code>: <code class="kt">true</code>
<code class="p">}</code>

<code class="c">// Dog</code>
<code class="nx">a</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">name</code><code class="o">:</code> <code class="s">'Domino'</code><code class="p">,</code>
  <code class="nx">barks</code>: <code class="kt">true</code><code class="p">,</code>
  <code class="nx">wags</code>: <code class="kt">true</code>
<code class="p">}</code>

<code class="c">// Both</code>
<code class="nx">a</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">name</code><code class="o">:</code> <code class="s">'Donkers'</code><code class="p">,</code>
  <code class="nx">barks</code>: <code class="kt">true</code><code class="p">,</code>
  <code class="nx">purrs</code>: <code class="kt">true</code><code class="p">,</code>
  <code class="nx">wags</code>: <code class="kt">true</code>
<code class="p">}</code>
</pre>

<p class="author1">This is worth reiterating: a value with a union type (<code class="calibre14">|</code>) isn’t necessarily one specific member of your union; in fact, it can be both members at once!<sup class="calibre15"><a data-type="noteref" href="#calibre_link-52" id="calibre_link-62" class="calibre16">5</a></sup></p>

<p class="author1">On the other hand, what do you know about <code class="calibre14">CatAndDog</code>? Not only does your canine-feline hybrid super-pet have a <code class="calibre14">name</code>, but it can purr, bark, and wag:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">b</code>: <code class="kt">CatAndDog</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">name</code><code class="o">:</code> <code class="s">'Domino'</code><code class="p">,</code>
  <code class="nx">barks</code>: <code class="kt">true</code><code class="p">,</code>
  <code class="nx">purrs</code>: <code class="kt">true</code><code class="p">,</code>
  <code class="nx">wags</code>: <code class="kt">true</code>
<code class="p">}</code></pre>

<p class="author1">Unions come up naturally a lot more often than intersections do. Take this function, for example:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">trueOrNull</code><code class="p">(</code><code class="nx">isTrue</code>: <code class="kt">boolean</code><code class="p">)</code> <code class="p">{</code>
  <code class="kd">if</code> <code class="p">(</code><code class="nx">isTrue</code><code class="p">)</code> <code class="p">{</code>
    <code class="kd">return</code> <code class="s">'true'</code>
  <code class="p">}</code>
  <code class="kd">return</code> <code class="kd">null</code>
<code class="p">}</code></pre>

<p class="author1">What is the type of the value this function returns? Well, it might be a <code class="calibre14">string</code>, or it might be <code class="calibre14">null</code>. We can express its return type as:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">Returns</code> <code class="o">=</code> <code class="kt">string</code> <code class="o">|</code> <code class="kd">null</code></pre>

<p class="author1">How about this one?</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code><code class="p">(</code><code class="nx">a</code>: <code class="kt">string</code><code class="p">,</code> <code class="nx">b</code>: <code class="kt">number</code><code class="p">)</code> <code class="p">{</code>
  <code class="kd">return</code> <code class="nx">a</code> <code class="o">||</code> <code class="nx">b</code>
<code class="p">}</code></pre>

<p class="author1">If <code class="calibre14">a</code> is truthy then the return type is <code class="calibre14">string</code>, and otherwise it’s <code class="calibre14">number</code>: in other words, <code class="calibre14">string | number</code>.</p>

<p class="author1">The last place where unions come up naturally is in arrays (specifically the heterogeneous kind), which we’ll talk about next.</p>
</div></section>



</div></section>













<section data-pdf-bookmark="Arrays" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1818">
<h2 class="calibre17">Arrays</h2>

<p class="author1">Like in JavaScript, TypeScript arrays are special kinds of objects that support things like concatenation, pushing, searching, and slicing.<a data-primary="types" data-secondary="supported by TypeScript" data-tertiary="arrays" data-type="indexterm" id="calibre_link-1651" class="calibre4"></a><a data-primary="arrays" data-type="indexterm" id="calibre_link-642" class="calibre4"></a><a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2345" data-type="indexterm" id="calibre_link-918" class="calibre4"></a> It’s example time:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">a</code> <code class="o">=</code> <code class="p">[</code><code class="mi">1</code><code class="p">,</code> <code class="mi">2</code><code class="p">,</code> <code class="mi">3</code><code class="p">]</code>           <code class="c">// number[]</code>
<code class="kd">var</code> <code class="nx">b</code> <code class="o">=</code> <code class="p">[</code><code class="s">'a'</code><code class="p">,</code> <code class="s">'b'</code><code class="p">]</code>          <code class="c">// string[]</code>
<code class="kd">let</code> <code class="nx">c</code>: <code class="kt">string</code><code class="p">[]</code> <code class="o">=</code> <code class="p">[</code><code class="s">'a'</code><code class="p">]</code>     <code class="c">// string[]</code>
<code class="kd">let</code> <code class="nx">d</code> <code class="o">=</code> <code class="p">[</code><code class="mi">1</code><code class="p">,</code> <code class="s">'a'</code><code class="p">]</code>            <code class="c">// (string | number)[]</code>
<code class="kd">const</code> <code class="nx">e</code> <code class="o">=</code> <code class="p">[</code><code class="mi">2</code><code class="p">,</code> <code class="s">'b'</code><code class="p">]</code>          <code class="c">// (string | number)[]</code>

<code class="kd">let</code> <code class="nx">f</code> <code class="o">=</code> <code class="p">[</code><code class="s">'red'</code><code class="p">]</code>
<code class="nx">f</code><code class="p">.</code><code class="nx">push</code><code class="p">(</code><code class="s">'blue'</code><code class="p">)</code>
<code class="nx">f</code><code class="p">.</code><code class="nx">push</code><code class="p">(</code><code class="kd">true</code><code class="p">)</code>                <code class="c">// Error TS2345: Argument of type 'true' is not</code>
                            <code class="c">// assignable to parameter of type 'string'.</code>

<code class="kd">let</code> <code class="nx">g</code> <code class="o">=</code> <code class="p">[]</code>                  <code class="c">// any[]</code>
<code class="nx">g</code><code class="p">.</code><code class="nx">push</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code>                   <code class="c">// number[]</code>
<code class="nx">g</code><code class="p">.</code><code class="nx">push</code><code class="p">(</code><code class="s">'red'</code><code class="p">)</code>               <code class="c">// (string | number)[]</code>

<code class="kd">let</code> <code class="nx">h</code>: <code class="kt">number</code><code class="p">[]</code> <code class="o">=</code> <code class="p">[]</code>        <code class="c">// number[]</code>
<code class="nx">h</code><code class="p">.</code><code class="nx">push</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code>                   <code class="c">// number[]</code>
<code class="nx">h</code><code class="p">.</code><code class="nx">push</code><code class="p">(</code><code class="s">'red'</code><code class="p">)</code>               <code class="c">// Error TS2345: Argument of type '"red"' is not</code>
                            <code class="c">// assignable to parameter of type 'number'.</code></pre>
<div data-type="note" type="note" class="calibre21"><h6 class="calibre22">Note</h6>
<p class="author1">TypeScript supports two syntaxes for arrays: <code class="calibre14">T[]</code> and <code class="calibre14">Array&lt;T&gt;</code>. They are identical both in meaning and in performance.<a data-primary="arrays" data-secondary="syntaxes for, T[] and Array&lt;T&gt;" data-type="indexterm" id="calibre_link-652" class="calibre4"></a> This book uses <code class="calibre14">T[]</code> syntax for its terseness, but you should pick whichever style you like for your own code.</p>
</div>

<p class="author1">As you read through these examples, notice that everything but <code class="calibre14">c</code> and <code class="calibre14">h</code> is implicitly typed. You’ll also notice that TypeScript has rules about what you can and can’t put in an array.</p>

<p class="author1">The general rule of thumb is to keep arrays <em class="calibre5">homogeneous</em>. <a data-primary="homogeneous arrays" data-type="indexterm" id="calibre_link-1087" class="calibre4"></a><a data-primary="arrays" data-secondary="homogeneous" data-type="indexterm" id="calibre_link-649" class="calibre4"></a>That is, don’t mix apples and oranges and numbers in a single array&mdash;try to design your programs so that every element of your array has the same type. The reason is that otherwise, you’re going to have to do more work to prove to TypeScript that what you’re doing is safe.</p>

<p class="author1">To see why things are easier when your arrays are homogeneous, take a look at example <code class="calibre14">f</code>. I initialized an array with the string <code class="calibre14">'red'</code> (at the point when I declared the array it contained just strings, so TypeScript inferred that it must be an array of strings). I then pushed <code class="calibre14">'blue'</code> onto it; <code class="calibre14">'blue'</code> is a string, so TypeScript let it pass. Then I tried to push <code class="calibre14">true</code> onto the array, but that failed! Why? Because <code class="calibre14">f</code> is an array of strings, and <code class="calibre14">true</code> is not a string.</p>

<p class="author1">On the other hand, when I initialized <code class="calibre14">d</code> I gave it a <code class="calibre14">number</code> and a <code class="calibre14">string</code>, so TypeScript inferred that <a data-primary="intersection types" data-secondary="array" data-type="indexterm" id="calibre_link-1130" class="calibre4"></a>it must be an array of type <code class="calibre14">number | string</code>. Because each element might be either a number or a string, you have to check which it is before using it. For example, say you want to map over that array, converting every letter to uppercase and tripling every number:</p>
<pre class="calibre30" data-code-language="ts" data-type="programlisting">
<code class="kd">let</code> <code class="nx">d</code> <code class="o">=</code> <code class="p">[</code><code class="mi">1</code><code class="p">,</code> <code class="s">'a'</code><code class="p">]</code>

<code class="nx">d</code><code class="p">.</code><code class="nx">map</code><code class="p">(</code><code class="nx">_</code> <code class="o">=&gt;</code> <code class="p">{</code>
  <code class="kd">if</code> <code class="p">(</code><code class="kd">typeof</code> <code class="nx">_</code> <code class="o">===</code> <code class="s">'number'</code><code class="p">)</code> <code class="p">{</code>
    <code class="kd">return</code> <code class="nx">_</code> <code class="o">*</code> <code class="mi">3</code>
  <code class="p">}</code>
  <code class="kd">return</code> <code class="nx">_</code><code class="p">.</code><code class="nx">toUpperCase</code><code class="p">()</code>
<code class="p">})</code>
</pre>

<p class="author1">You have to query the type of each item with <code class="calibre14">typeof</code>, checking if it’s a <code class="calibre14">number</code> or a <code class="calibre14">string</code> before you can do anything with it.<a data-primary="typeof operator" data-secondary="using with array items" data-type="indexterm" id="calibre_link-1601" class="calibre4"></a></p>

<p class="author1">Like with objects, creating arrays with <code class="calibre14">const</code> won’t hint to TypeScript to infer their types more narrowly.<a data-primary="const" data-secondary="array declarations with" data-type="indexterm" id="calibre_link-789" class="calibre4"></a> That’s why TypeScript inferred both <code class="calibre14">d</code> and <code class="calibre14">e</code> to be arrays of <code class="calibre14">number | string</code>.</p>

<p class="author1"><code class="calibre14">g</code> is the special case: when you initialize an empty array, TypeScript doesn’t know what type the array’s elements should be, so it gives you the benefit of the doubt and makes them <code class="calibre14">any</code>. As you manipulate<a data-primary="any type" data-secondary="inferred for empty array elements" data-type="indexterm" id="calibre_link-627" class="calibre4"></a> the array and add elements to it, TypeScript starts to piece together your array’s type. Once your array leaves the scope it was defined in (for example, if you declared it in a function, then returned it), TypeScript<a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2345" data-type="indexterm" id="calibre_link-919" class="calibre4"></a> will assign it a final type that can’t be expanded anymore:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">buildArray() {</code>
  <code class="kd">let</code> <code class="nx">a</code> <code class="o">=</code> <code class="p">[]</code>                <code class="c">// any[]</code>
  <code class="nx">a</code><code class="p">.</code><code class="nx">push</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code>                 <code class="c">// number[]</code>
  <code class="nx">a</code><code class="p">.</code><code class="nx">push</code><code class="p">(</code><code class="s">'x'</code><code class="p">)</code>               <code class="c">// (string | number)[]</code>
  <code class="kd">return</code> <code class="nx">a</code>
<code class="p">}</code>

<code class="kd">let</code> <code class="nx">myArray</code> <code class="o">=</code> <code class="nx">buildArray</code><code class="p">()</code>  <code class="c">// (string | number)[]</code>
<code class="nx">myArray</code><code class="p">.</code><code class="nx">push</code><code class="p">(</code><code class="kd">true</code><code class="p">)</code>          <code class="c">// Error 2345: Argument of type 'true' is not</code>
                            <code class="c">// assignable to parameter of type 'string | number'.</code></pre>

<p class="author1">So as far as uses of <code class="calibre14">any</code> go, this one shouldn’t make you sweat too much.</p>
</div></section>













<section data-pdf-bookmark="Tuples" data-type="sect2" class="preface"><div class="preface" id="calibre_link-527">
<h2 class="calibre17">Tuples</h2>

<p class="author1">Tuples are subtypes of <code class="calibre14">array</code>. They’re a special <a data-primary="types" data-secondary="supported by TypeScript" data-tertiary="tuples" data-type="indexterm" id="calibre_link-1662" class="calibre4"></a><a data-primary="tuples" data-type="indexterm" id="calibre_link-1546" class="calibre4"></a><a data-primary="arrays" data-secondary="tuples" data-type="indexterm" id="calibre_link-653" class="calibre4"></a>way to type arrays that have fixed lengths, where the values at each index have specific, known types. Unlike most other types, tuples have to be explicitly typed when you declare them.<a data-primary="[] (square brackets)" data-secondary="in tuple declarations" data-secondary-sortas="tuple declarations" data-type="indexterm" id="calibre_link-595" class="calibre4"></a> That’s because the JavaScript syntax is the same for tuples and arrays (both use square brackets), and TypeScript already has rules for inferring array types from square brackets:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">a</code><code class="o">:</code> <code class="p">[</code><code class="kt">number</code><code class="p">]</code> <code class="o">=</code> <code class="p">[</code><code class="mi">1</code><code class="p">]</code>

<code class="c">// A tuple of [first name, last name, birth year]</code>
<code class="kd">let</code> <code class="nx">b</code><code class="o">:</code> <code class="p">[</code><code class="kt">string</code><code class="p">,</code> <code class="kt">string</code><code class="p">,</code> <code class="kt">number</code><code class="p">]</code> <code class="o">=</code> <code class="p">[</code><code class="s">'malcolm'</code><code class="p">,</code> <code class="s">'gladwell'</code><code class="p">,</code> <code class="mi">1963</code><code class="p">]</code>

<code class="nx">b</code> <code class="o">=</code> <code class="p">[</code><code class="s">'queen'</code><code class="p">,</code> <code class="s">'elizabeth'</code><code class="p">,</code> <code class="s">'ii'</code><code class="p">,</code> <code class="mi">1926</code><code class="p">]</code>  <code class="c">// Error TS2322: Type 'string' is not</code>
                                        <code class="c">// assignable to type 'number'.</code></pre>

<p class="author1">Tuples support optional elements too.<a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2322" data-type="indexterm" id="calibre_link-905" class="calibre4"></a><a data-primary="? (question mark)" data-secondary="for optional elements in tuples" data-type="indexterm" id="calibre_link-586" class="calibre4"></a><a data-primary="tuples" data-secondary="optional elements" data-type="indexterm" id="calibre_link-1548" class="calibre4"></a> Just like in object types, <code class="calibre14">?</code> means “optional”:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// An array of train fares, which sometimes vary depending on direction</code>
<code class="kd">let</code> <code class="nx">trainFares</code><code class="o">:</code> <code class="p">[</code><code class="kt">number</code><code class="p">,</code> <code class="kt">number</code><code class="o">?</code><code class="p">][]</code> <code class="o">=</code> <code class="p">[</code>
  <code class="p">[</code><code class="mi">3.75</code><code class="p">],</code>
  <code class="p">[</code><code class="mi">8.25</code><code class="p">,</code> <code class="mi">7.70</code><code class="p">],</code>
  <code class="p">[</code><code class="mi">10.50</code><code class="p">]</code>
<code class="p">]</code>

<code class="c">// Equivalently:</code>
<code class="kd">let</code> <code class="nx">moreTrainFares</code><code class="o">:</code> <code class="p">([</code><code class="kt">number</code><code class="p">]</code> <code class="o">|</code> <code class="p">[</code><code class="kt">number</code><code class="p">,</code> <code class="kt">number</code><code class="p">])[]</code> <code class="o">=</code> <code class="p">[</code>
  <code class="c">// ...</code>
<code class="p">]</code></pre>

<p class="author1">Tuples also support rest elements, which you <a data-primary="tuples" data-secondary="rest elements" data-type="indexterm" id="calibre_link-1550" class="calibre4"></a>can use to type tuples with minimum lengths:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// A list of strings with at least 1 element</code>
<code class="kd">let</code> <code class="nx">friends</code><code class="o">:</code> <code class="p">[</code><code class="kt">string</code><code class="p">,</code> <code class="p">...</code><code class="kt">string</code><code class="p">[]]</code> <code class="o">=</code> <code class="p">[</code><code class="s">'Sara'</code><code class="p">,</code> <code class="s">'Tali'</code><code class="p">,</code> <code class="s">'Chloe'</code><code class="p">,</code> <code class="s">'Claire'</code><code class="p">]</code>

<code class="c">// A heterogeneous list</code>
<code class="kd">let</code> <code class="nx">list</code><code class="o">:</code> <code class="p">[</code><code class="kt">number</code><code class="p">,</code> <code class="kd">boolean</code><code class="p">,</code> <code class="p">...</code><code class="kt">string</code><code class="p">[]]</code> <code class="o">=</code> <code class="p">[</code><code class="mi">1</code><code class="p">,</code> <code class="kd">false</code><code class="p">,</code> <code class="s">'a'</code><code class="p">,</code> <code class="s">'b'</code><code class="p">,</code> <code class="s">'c'</code><code class="p">]</code></pre>

<p class="author1">Not only do tuple types safely encode heterogeneous lists, but they also capture the length of the list they type. These features buy you significantly more safety than plain old arrays&mdash;use them often.</p>










<section data-pdf-bookmark="Read-only arrays and tuples" data-type="sect3" class="preface"><div class="preface" id="calibre_link-117">
<h3 class="calibre39">Read-only arrays and tuples</h3>

<p class="author1">While regular arrays are mutable (meaning you can <code class="calibre14">.push</code> onto them, <code class="calibre14">.splice</code> them, and update them in place), which is probably what you want most of the time, sometimes you want an immutable array&mdash;one that you can update to produce a new array, leaving the original unchanged.<a data-primary="tuples" data-secondary="read-only" data-type="indexterm" id="calibre_link-1549" class="calibre4"></a><a data-primary="arrays" data-secondary="read-only" data-type="indexterm" id="calibre_link-651" class="calibre4"></a></p>

<p class="author1">TypeScript comes with a <code class="calibre14">readonly</code> array type out of the box, which you can use to create immutable arrays.<a data-primary="ReadonlyArray type" data-type="indexterm" id="calibre_link-1408" class="calibre4"></a> Read-only arrays are just like regular arrays, but you can’t update them in place. To create a read-only array, use an explicit type annotation; to update a read-only array, use nonmutating methods like <code class="calibre14">.concat</code> and <code class="calibre14">.slice</code> instead of <a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2339" data-type="indexterm" id="calibre_link-910" class="calibre4"></a><a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2542" data-type="indexterm" id="calibre_link-946" class="calibre4"></a>mutating ones like <code class="calibre14">.push</code> and <code class="calibre14">.splice</code>:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="kd">as</code><code class="o">:</code> <code class="nx">readonly</code> <code class="kt">number</code><code class="p">[]</code> <code class="o">=</code> <code class="p">[</code><code class="mi">1</code><code class="p">,</code> <code class="mi">2</code><code class="p">,</code> <code class="mi">3</code><code class="p">]</code>     <code class="c">// readonly number[]</code>
<code class="kd">let</code> <code class="nx">bs</code>: <code class="kt">readonly</code> <code class="kt">number</code><code class="p">[]</code> <code class="o">=</code> <code class="kd">as</code><code class="p">.</code><code class="nx">concat</code><code class="p">(</code><code class="mi">4</code><code class="p">)</code>  <code class="c">// readonly number[]</code>
<code class="kd">let</code> <code class="nx">three</code> <code class="o">=</code> <code class="nx">bs</code><code class="p">[</code><code class="mi">2</code><code class="p">]</code>                         <code class="c">// number</code>
<code class="kd">as</code><code class="p">[</code><code class="mi">4</code><code class="p">]</code> <code class="o">=</code> <code class="mi">5</code>            <code class="c">// Error TS2542: Index signature in type</code>
                     <code class="c">// 'readonly number[]' only permits reading.</code>
<code class="kd">as</code><code class="p">.</code><code class="nx">push</code><code class="p">(</code><code class="mi">6</code><code class="p">)</code>           <code class="c">// Error TS2339: Property 'push' does not</code>
                     <code class="c">// exist on type 'readonly number[]'.</code></pre>

<p class="author1">Like <code class="calibre14">Array</code>, TypeScript comes with a couple of longer-form ways to declare read-only arrays and tuples:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">A</code> <code class="o">=</code> <code class="nx">readonly</code> <code class="kt">string</code><code class="p">[]</code>           <code class="c">// readonly string[]</code>
<code class="nx">type</code> <code class="nx">B</code> <code class="o">=</code> <code class="nx">ReadonlyArray</code><code class="o">&lt;</code><code class="kt">string</code><code class="o">&gt;</code>       <code class="c">// readonly string[]</code>
<code class="nx">type</code> <code class="nx">C</code> <code class="o">=</code> <code class="nx">Readonly</code><code class="o">&lt;</code><code class="kt">string</code><code class="p">[]</code><code class="o">&gt;</code>          <code class="c">// readonly string[]</code>

<code class="nx">type</code> <code class="nx">D</code> <code class="o">=</code> <code class="nx">readonly</code> <code class="p">[</code><code class="kt">number</code><code class="p">,</code> <code class="kt">string</code><code class="p">]</code>   <code class="c">// readonly [number, string]</code>
<code class="nx">type</code> <code class="nx">E</code> <code class="o">=</code> <code class="nx">Readonly</code><code class="o">&lt;</code><code class="p">[</code><code class="kt">number</code><code class="p">,</code> <code class="kt">string</code><code class="p">]</code><code class="o">&gt;</code>  <code class="c">// readonly [number, string]</code></pre>

<p class="author1">Which syntax you use&mdash;the terser <code class="calibre14">readonly</code> modifier, or the longer-form <code class="calibre14">Readonly</code> or <code class="calibre14">ReadonlyArray</code> utilities&mdash;is a matter of taste.<a data-primary="readonly modifier" data-secondary="using with arrays and tuples" data-type="indexterm" id="calibre_link-1407" class="calibre4"></a></p>

<p class="author1">Note that while read-only arrays can make your code easier to reason about in some cases by avoiding mutability, they are backed by regular JavaScript arrays. That means even small updates to an array result in having to copy the original array first, which can hurt your application’s runtime performance if you’re not careful. For small arrays this overhead is rarely noticeable, but for bigger arrays, the overhead can become significant.<a data-primary="immutable arrays" data-type="indexterm" id="calibre_link-1090" class="calibre4"></a></p>
<div data-type="tip" class="calibre21"><h6 class="calibre22">Tip</h6>
<p class="author1">If you plan to make heavy use of immutable arrays, consider reaching for a more efficient implementation, like Lee Byron’s excellent <a href="https://www.npmjs.com/package/immutable" class="calibre4"><code class="calibre14">immutable</code></a>.<a data-primary="types" data-secondary="supported by TypeScript" data-startref="ix_typeTSarr" data-tertiary="arrays" data-type="indexterm" id="calibre_link-1652" class="calibre4"></a><a data-primary="arrays" data-startref="ix_arr" data-type="indexterm" id="calibre_link-643" class="calibre4"></a></p>
</div>
</div></section>



</div></section>













<section data-pdf-bookmark="null, undefined, void, and never" data-type="sect2" class="preface"><div class="preface" id="calibre_link-557">
<h2 class="calibre17">null, undefined, void, and never</h2>

<p class="author1">JavaScript has two values to represent an absence of something: <code class="calibre14">null</code> and <code class="calibre14">undefined</code>. <a data-primary="types" data-secondary="supported by TypeScript" data-tertiary="null, undefined, void, and never" data-type="indexterm" id="calibre_link-1655" class="calibre4"></a>TypeScript supports both of these as values, and it also has types for them&mdash;any guess what they’re called? You got it, the types are called <code class="calibre14">null</code> and <code class="calibre14">undefined</code> too.<a data-primary="null type" data-type="indexterm" id="calibre_link-1289" class="calibre4"></a><a data-primary="undefined type" data-type="indexterm" id="calibre_link-1711" class="calibre4"></a></p>

<p class="author1">They’re both special types, because in TypeScript the only thing of type <code class="calibre14">undefined</code> is the value <code class="calibre14">undefined</code>, and the only thing of type <code class="calibre14">null</code> is the value <code class="calibre14">null</code>.<a data-primary="values" data-secondary="null and undefined" data-type="indexterm" id="calibre_link-1731" class="calibre4"></a></p>

<p class="author1">JavaScript programmers usually use the two interchangeably, though there is a subtle semantic difference worth mentioning: <code class="calibre14">undefined</code> means that something hasn’t been defined yet, and <code class="calibre14">null</code> means an absence of a value (like if you tried to compute a value, but ran into an error along the way). These are just conventions and TypeScript doesn’t hold you to them, but it can be a useful distinction to make.</p>

<p class="author1">In addition to <code class="calibre14">null</code> and <code class="calibre14">undefined</code>, TypeScript<a data-primary="void type" data-type="indexterm" id="calibre_link-1751" class="calibre4"></a><a data-primary="never type" data-type="indexterm" id="calibre_link-1255" class="calibre4"></a> also has <code class="calibre14">void</code> and <code class="calibre14">never</code>. <a data-primary="functions" data-secondary="null, undefined, void and never return types" data-type="indexterm" id="calibre_link-1047" class="calibre4"></a>These are really specific, special-purpose types that draw even finer lines between the different kinds of things that don’t exist: <code class="calibre14">void</code> is the return type of a function that doesn’t explicitly return anything (for example, <code class="calibre14">console.log</code>), and <code class="calibre14">never</code> is the type <a data-primary="null type" data-secondary="example of usage" data-type="indexterm" id="calibre_link-1290" class="calibre4"></a><a data-primary="undefined type" data-secondary="example of usage" data-type="indexterm" id="calibre_link-1712" class="calibre4"></a>of a function that never returns at all (like a function that throws an exception, or one that runs forever):</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// (a) A function that returns a number or null</code>
<code class="kd">function</code> <code class="nx">a</code><code class="p">(</code><code class="nx">x</code>: <code class="kt">number</code><code class="p">)</code> <code class="p">{</code>
  <code class="kd">if</code> <code class="p">(</code><code class="nx">x</code> <code class="o">&lt;</code> <code class="mi">10</code><code class="p">)</code> <code class="p">{</code>
    <code class="kd">return</code> <code class="nx">x</code>
  <code class="p">}</code>
  <code class="kd">return</code> <code class="kd">null</code>
<code class="p">}</code>

<code class="c">// (b) A function that returns undefined</code>
<code class="kd">function</code> <code class="nx">b() {</code>
  <code class="kd">return</code> <code class="kd">undefined</code>
<code class="p">}</code>

<code class="c">// (c) A function that returns void</code>
<code class="kd">function</code> <code class="nx">c() {</code>
  <code class="kd">let</code> <code class="nx">a</code> <code class="o">=</code> <code class="mi">2</code> <code class="o">+</code> <code class="mi">2</code>
  <code class="kd">let</code> <code class="nx">b</code> <code class="o">=</code> <code class="nx">a</code> <code class="o">*</code> <code class="nx">a</code>
<code class="p">}</code>

<code class="c">// (d) A function that returns never</code>
<code class="kd">function</code> <code class="nx">d() {</code>
  <code class="kd">throw</code> <code class="nx">TypeError</code><code class="p">(</code><code class="s">'I always error'</code><code class="p">)</code>
<code class="p">}</code>

<code class="c">// (e) Another function that returns never</code>
<code class="kd">function</code> <code class="nx">e() {</code>
  <code class="kd">while</code> <code class="p">(</code><code class="kd">true</code><code class="p">)</code> <code class="p">{</code>
    <code class="nx">doSomething</code><code class="p">()</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p class="author1">(a) and (b) explicitly return <code class="calibre14">null</code> and <code class="calibre14">undefined</code>, respectively. (c) returns <code class="calibre14">undefined</code>, but it doesn’t do so  with an explicit <code class="calibre14">return</code> statement, so we say it returns <code class="calibre14">void</code>. (d) throws an exception, and (e) runs forever&mdash;neither will ever return, so we say their return type is <code class="calibre14">never</code>.</p>

<p class="author1">If <code class="calibre14">unknown</code> is the supertype of every other type, then <code class="calibre14">never</code> is the subtype of every other type. <a data-primary="bottom type" data-type="indexterm" id="calibre_link-691" class="calibre4"></a>We call it a <em class="calibre5">bottom type</em>. That means it’s assignable to every other type, and a value of type <code class="calibre14">never</code> can be used anywhere safely. This has mostly theoretical significance,<sup class="calibre15"><a data-type="noteref" href="#calibre_link-53" id="calibre_link-64" class="calibre16">6</a></sup> but is something that will come up when you talk about TypeScript with other language nerds.<a data-primary="null type" data-secondary="summary of usage" data-type="indexterm" id="calibre_link-1295" class="calibre4"></a><a data-primary="undefined type" data-secondary="summary of usage" data-type="indexterm" id="calibre_link-1714" class="calibre4"></a><a data-primary="void type" data-secondary="summary of usage" data-type="indexterm" id="calibre_link-1752" class="calibre4"></a><a data-primary="never type" data-secondary="summary of usage" data-type="indexterm" id="calibre_link-1257" class="calibre4"></a></p>

<p class="author1"><a data-type="xref" href="#calibre_link-54" class="calibre4">Table&nbsp;3-2</a> summarizes how the four absence types are used.</p>
<table class="stafflist_table" id="calibre_link-54">
<caption class="calibre35"><span class="calibre">Table 3-2. </span>Types that mean an absence of something</caption>
<thead class="calibre36">
<tr class="calibre7">
<th class="calibre37">Type</th>
<th class="calibre37">Meaning</th>
</tr>
</thead>
<tbody class="calibre6">
<tr class="calibre7">
<td class="calibre8"><p class="author1"><code class="calibre14">null</code></p></td>
<td class="calibre8"><p class="author1">Absence of a value</p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1"><code class="calibre14">undefined</code></p></td>
<td class="calibre8"><p class="author1">Variable that has not been assigned a value yet</p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1"><code class="calibre14">void</code></p></td>
<td class="calibre8"><p class="author1">Function that doesn’t have a <code class="calibre14">return</code> statement</p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1"><code class="calibre14">never</code></p></td>
<td class="calibre8"><p class="author1">Function that never returns</p></td>
</tr>
</tbody>
</table>
<aside data-type="sidebar" type="sidebar" class="keyterm"><div class="sidebar" id="calibre_link-1819">
<h5 class="calibre29">Strict null Checking</h5>
<p class="author1">In older versions of TypeScript (or with TSC’s <code class="calibre14">strictNullChecks</code> option set to <code class="calibre14">false</code>), <code class="calibre14">null</code> behaves a little differently: it is a subtype of all types, except <code class="calibre14">never</code>. <a data-primary="strictNullChecks option" data-type="indexterm" id="calibre_link-1450" class="calibre4"></a><a data-primary="TSC compiler" data-secondary="strictNullChecks option" data-type="indexterm" id="calibre_link-1529" class="calibre4"></a><a data-primary="null type" data-secondary="strict null checking" data-type="indexterm" id="calibre_link-1294" class="calibre4"></a>That means every type is nullable, and you can never really trust the type of anything without first checking if it’s <code class="calibre14">null</code> or not. For example, if someone passes the variable <code class="calibre14">pizza</code> to your function and you want to call the method <code class="calibre14">.addAnchovies</code> on it, you first have to check if your <code class="calibre14">pizza</code> is <code class="calibre14">null</code> before you can add delicious tiny fish to it. In practice this is really tedious to do with every single variable, so people often forget to actually check first. Then, when something really is <code class="calibre14">null</code>, you get a dreaded null pointer exception at runtime:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">addDeliciousFish</code><code class="p">(</code><code class="nx">pizza</code>: <code class="kt">Pizza</code><code class="p">)</code> <code class="p">{</code>
  <code class="kd">return</code> <code class="nx">pizza</code><code class="p">.</code><code class="nx">addAnchovies</code><code class="p">()</code>  <code class="c">// Uncaught TypeError: Cannot read</code>
<code class="p">}</code>                              <code class="c">// property 'addAnchovies' of null</code>

<code class="c">// TypeScript lets this fly with strictNullChecks = false</code>
<code class="nx">addDeliciousFish</code><code class="p">(</code><code class="kd">null</code><code class="p">)</code></pre>

<p class="author1"><code class="calibre14">null</code> has been called the <a href="http://bit.ly/2WEdZNO" class="calibre4">“billion dollar mistake”</a> by the guy that introduced it in the 1960s.<a data-primary="null type" data-secondary="problems with in programming languages" data-type="indexterm" id="calibre_link-1293" class="calibre4"></a> The problem with <code class="calibre14">null</code> is it’s something that most languages’ type systems can’t express and don’t check for; so when a programmer tries to do something with a variable that they thought was defined but it actually turns out to be <code class="calibre14">null</code> at runtime, the code throws a runtime exception!</p>

<p class="author1">Why? Don’t ask me, I’m just the guy writing this book. But languages are coming around to encoding <code class="calibre14">null</code> in their type systems, and TypeScript is a great example of how to do it right. If the goal is to catch as many bugs as possible at compile time before your users encounter them, then being able to check for <code class="calibre14">null</code> in the type system is indispensable.<a data-primary="types" data-secondary="supported by TypeScript" data-startref="ix_typeTSnull" data-tertiary="null, undefined, void, and never" data-type="indexterm" id="calibre_link-1656" class="calibre4"></a></p>
</div></aside>
</div></section>













<section data-pdf-bookmark="Enums" data-type="sect2" class="preface"><div class="preface" id="calibre_link-167">
<h2 class="calibre17">Enums</h2>

<p class="author1">Enums are a way to <em class="calibre5">enumerate</em> the possible values for a type. <a data-primary="enums" data-type="indexterm" id="calibre_link-864" class="calibre4"></a>They are unordered data structures that map keys to values. Think of them like objects where the keys are fixed at compile time, so TypeScript can check that the given key actually exists when you access it.</p>

<p class="author1">There are two kinds of enums: enums that map from strings to strings, and enums that map from strings to numbers. <a data-primary="enums" data-secondary="with inferred numeric values, example of" data-type="indexterm" id="calibre_link-874" class="calibre4"></a>They look like this:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">enum</code> <code class="nx">Language</code> <code class="p">{</code>
  <code class="nx">English</code><code class="p">,</code>
  <code class="nx">Spanish</code><code class="p">,</code>
  <code class="nx">Russian</code>
<code class="p">}</code></pre>
<div data-type="note" type="note" class="calibre21"><h6 class="calibre22">Note</h6>
<p class="author1">By convention, enum names are uppercase and singular.<a data-primary="enums" data-secondary="naming conventions" data-type="indexterm" id="calibre_link-870" class="calibre4"></a> Their keys are also uppercase.</p>
</div>

<p class="author1">TypeScript will automatically infer a number as the value for each member of your enum, but you can also set values explicitly. <a data-primary="enums" data-secondary="with explicit numeric values, example of" data-type="indexterm" id="calibre_link-873" class="calibre4"></a>Let’s make explicit what TypeScript inferred in the previous example:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">enum</code> <code class="nx">Language</code> <code class="p">{</code>
  <code class="nx">English</code> <code class="o">=</code> <code class="mi">0</code><code class="p">,</code>
  <code class="nx">Spanish</code> <code class="o">=</code> <code class="mi">1</code><code class="p">,</code>
  <code class="nx">Russian</code> <code class="o">=</code> <code class="mi">2</code>
<code class="p">}</code></pre>

<p class="author1">To retrieve a value from an enum, you access it with either dot or bracket notation&mdash;just like you would to get a value <a data-primary="[] (square brackets)" data-secondary="retrieving enum values" data-type="indexterm" id="calibre_link-594" class="calibre4"></a>from a regular object:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">myFirstLanguage</code> <code class="o">=</code> <code class="nx">Language</code><code class="p">.</code><code class="nx">Russian</code>      <code class="c">// Language</code>
<code class="kd">let</code> <code class="nx">mySecondLanguage</code> <code class="o">=</code> <code class="nx">Language</code><code class="p">[</code><code class="s">'English'</code><code class="p">]</code>  <code class="c">// Language</code></pre>

<p class="author1">You can split your enum across multiple declarations, and TypeScript will automatically merge them for you (to learn more, jump ahead to <a data-type="xref" href="#calibre_link-55" class="calibre4">“Declaration Merging”</a>). Beware that when you do split your enum, TypeScript can only infer values for one of those declarations, <a data-primary="enums" data-secondary="splitting across multiple declarations" data-type="indexterm" id="calibre_link-872" class="calibre4"></a>so it’s good practice to explicitly assign a value to each enum member:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">enum</code> <code class="nx">Language</code> <code class="p">{</code>
  <code class="nx">English</code> <code class="o">=</code> <code class="mi">0</code><code class="p">,</code>
  <code class="nx">Spanish</code> <code class="o">=</code> <code class="mi">1</code>
<code class="p">}</code>

<code class="kd">enum</code> <code class="nx">Language</code> <code class="p">{</code>
  <code class="nx">Russian</code> <code class="o">=</code> <code class="mi">2</code>
<code class="p">}</code></pre>

<p class="author1">You can use computed values, <a data-primary="enums" data-secondary="with partially inferred values, example of" data-type="indexterm" id="calibre_link-875" class="calibre4"></a>and you don’t have to define all of them (TypeScript will do its best to infer what’s missing):</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">enum</code> <code class="nx">Language</code> <code class="p">{</code>
  <code class="nx">English</code> <code class="o">=</code> <code class="mi">100</code><code class="p">,</code>
  <code class="nx">Spanish</code> <code class="o">=</code> <code class="mi">200</code> <code class="o">+</code> <code class="mi">300</code><code class="p">,</code>
  <code class="nx">Russian</code>                 <code class="c">// TypeScript infers 501 (the next number after 500)</code>
<code class="p">}</code></pre>

<p class="author1">You can also use string values for enums, or even mix string and number values:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">enum</code> <code class="nx">Color</code> <code class="p">{</code>
  <code class="nx">Red</code> <code class="o">=</code> <code class="s">'#c10000'</code><code class="p">,</code>
  <code class="nx">Blue</code> <code class="o">=</code> <code class="s">'#007ac1'</code><code class="p">,</code>
  <code class="nx">Pink</code> <code class="o">=</code> <code class="mi">0xc10050</code><code class="p">,</code>        <code class="c">// A hexadecimal literal</code>
  <code class="nx">White</code> <code class="o">=</code> <code class="mi">255</code>             <code class="c">// A decimal literal</code>
<code class="p">}</code>

<code class="kd">let</code> <code class="nx">red</code> <code class="o">=</code> <code class="nx">Color</code><code class="p">.</code><code class="nx">Red</code>       <code class="c">// Color</code>
<code class="kd">let</code> <code class="nx">pink</code> <code class="o">=</code> <code class="nx">Color</code><code class="p">.</code><code class="nx">Pink</code>     <code class="c">// Color</code></pre>

<p class="author1">TypeScript lets you access enums both by value and by key for convenience, but this can get <a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2339" data-type="indexterm" id="calibre_link-911" class="calibre4"></a>unsafe quickly:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">a</code> <code class="o">=</code> <code class="nx">Color</code><code class="p">.</code><code class="nx">Red</code>         <code class="c">// Color</code>
<code class="kd">let</code> <code class="nx">b</code> <code class="o">=</code> <code class="nx">Color</code><code class="p">.</code><code class="nx">Green</code>       <code class="c">// Error TS2339: Property 'Green' does not exist</code>
                          <code class="c">// on type 'typeof Color'.</code>
<code class="kd">let</code> <code class="nx">c</code> <code class="o">=</code> <code class="nx">Color</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code>          <code class="c">// string</code>
<code class="kd">let</code> <code class="nx">d</code> <code class="o">=</code> <code class="nx">Color</code><code class="p">[</code><code class="mi">6</code><code class="p">]</code>          <code class="c">// string (!!!)</code></pre>

<p class="author1">You shouldn’t be able to get <code class="calibre14">Color[6]</code>, but TypeScript doesn’t stop you! We can ask TypeScript to prevent this kind of unsafe access by opting into a safer subset of enum behavior with <code class="calibre14">const enum</code> instead.<a data-primary="const" data-secondary="enum declarations with" data-type="indexterm" id="calibre_link-792" class="calibre4"></a><a data-primary="enums" data-secondary="const" data-type="indexterm" id="calibre_link-869" class="calibre4"></a> Let’s rewrite our <code class="calibre14">Language</code> enum from earlier:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">const</code> <code class="kd">enum</code> <code class="nx">Language</code> <code class="p">{</code>
  <code class="nx">English</code><code class="p">,</code>
  <code class="nx">Spanish</code><code class="p">,</code>
  <code class="nx">Russian</code>
<code class="p">}</code>

<code class="c">// Accessing a valid enum key</code>
<code class="kd">let</code> <code class="nx">a</code> <code class="o">=</code> <code class="nx">Language</code><code class="p">.</code><code class="nx">English</code>  <code class="c">// Language</code>

<code class="c">// Accessing an invalid enum key</code>
<code class="kd">let</code> <code class="nx">b</code> <code class="o">=</code> <code class="nx">Language</code><code class="p">.</code><code class="nx">Tagalog</code>  <code class="c">// Error TS2339: Property 'Tagalog' does not exist</code>
                          <code class="c">// on type 'typeof Language'.</code>

<code class="c">// Accessing a valid enum value</code>
<code class="kd">let</code> <code class="nx">c</code> <code class="o">=</code> <code class="nx">Language</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code>       <code class="c">// Error TS2476: A const enum member can only be</code>
                          <code class="c">// accessed using a string literal.</code>

<code class="c">// Accessing an invalid enum value</code>
<code class="kd">let</code> <code class="nx">d</code> <code class="o">=</code> <code class="nx">Language</code><code class="p">[</code><code class="mi">6</code><code class="p">]</code>       <code class="c">// Error TS2476: A const enum member can only be</code>
                          <code class="c">// accessed using a string literal.</code></pre>

<p class="author1">A <code class="calibre14">const enum</code> doesn’t let you do reverse lookups, and so behaves a lot like a regular JavaScript object.<a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2476" data-type="indexterm" id="calibre_link-941" class="calibre4"></a><a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2339" data-type="indexterm" id="calibre_link-912" class="calibre4"></a> It also doesn’t generate any JavaScript code by default, and instead inlines the enum member’s value wherever it’s used (for example, TypeScript will replace every occurrence of <code class="calibre14">Language.Spanish</code> with its value, <code class="calibre14">1</code>).</p>
<div data-type="tip" class="calibre21"><h1 class="calibre42">TSC Flag: preserveConstEnums</h1>
<p class="author1"><code class="calibre14">const enum</code> inlining can lead to safety issues when you import a <code class="calibre14">const enum</code> from someone else’s TypeScript code: if the enum author updates their <code class="calibre14">const enum</code> after you’ve compiled your <a data-primary="const" data-secondary="enum declarations with" data-tertiary="problems with" data-type="indexterm" id="calibre_link-793" class="calibre4"></a>TypeScript code, then your version of the enum and their version might point to different values at runtime, and TypeScript will be none the wiser.<a data-primary="enums" data-secondary="preserveConstEnums TSC flag" data-type="indexterm" id="calibre_link-871" class="calibre4"></a><a data-primary="preserveConstEnums TSC flag" data-type="indexterm" id="calibre_link-1369" class="calibre4"></a><a data-primary="TSC compiler" data-secondary="preserveConstEnums option" data-type="indexterm" id="calibre_link-1521" class="calibre4"></a></p>

<p class="author1">If you use <code class="calibre14">const enum</code>s, be careful to avoid inlining them and to only use them in TypeScript programs that you control: avoid using them in programs that you’re planning to publish to NPM, or to make available for others to use as a library.</p>

<p class="author1">To enable runtime code generation for <code class="calibre14">const enum</code>s, switch the <code class="calibre14">preserveConstEnums</code> TSC setting to <code class="calibre14">true</code> in your <em class="calibre5">tsconfig.json</em>:</p>

<pre data-code-language="json" data-type="programlisting" class="calibre43"><code class="p">{</code>
  <code class="nt">"compilerOptions"</code><code class="p">:</code> <code class="p">{</code>
    <code class="nt">"preserveConstEnums"</code><code class="p">:</code> <code class="kd">true</code>
  <code class="p">}</code>
<code class="p">}</code></pre>
</div>

<p class="author1">&nbsp;
Let’s see how we use <code class="calibre14">const enum</code>s:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">const</code> <code class="kd">enum</code> <code class="nx">Flippable</code> <code class="p">{</code>
  <code class="nx">Burger</code><code class="p">,</code>
  <code class="nx">Chair</code><code class="p">,</code>
  <code class="nx">Cup</code><code class="p">,</code>
  <code class="nx">Skateboard</code><code class="p">,</code>
  <code class="nx">Table</code>
<code class="p">}</code>

<code class="kd">function</code> <code class="nx">flip</code><code class="p">(</code><code class="nx">f</code>: <code class="kt">Flippable</code><code class="p">)</code> <code class="p">{</code>
  <code class="kd">return</code> <code class="s">'flipped it'</code>
<code class="p">}</code>

<code class="nx">flip</code><code class="p">(</code><code class="nx">Flippable</code><code class="p">.</code><code class="nx">Chair</code><code class="p">)</code>     <code class="c">// 'flipped it'</code>
<code class="nx">flip</code><code class="p">(</code><code class="nx">Flippable</code><code class="p">.</code><code class="nx">Cup</code><code class="p">)</code>       <code class="c">// 'flipped it'</code>
<code class="nx">flip</code><code class="p">(</code><code class="mi">12</code><code class="p">)</code>                  <code class="c">// 'flipped it' (!!!)</code></pre>

<p class="author1">Everything looks great&mdash;<code class="calibre14">Chairs</code> and <code class="calibre14">Cups</code> work exactly as you expect… until you realize that all numbers are also assignable to enums!<a data-primary="assignability" data-secondary="for enums" data-type="indexterm" id="calibre_link-661" class="calibre4"></a> That behavior is an unfortunate consequence of TypeScript’s assignability rules, and to fix it you have to be extra careful to only use string-valued enums:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">const</code> <code class="kd">enum</code> <code class="nx">Flippable</code> <code class="p">{</code>
  <code class="nx">Burger</code> <code class="o">=</code> <code class="s">'Burger'</code><code class="p">,</code>
  <code class="nx">Chair</code> <code class="o">=</code> <code class="s">'Chair'</code><code class="p">,</code>
  <code class="nx">Cup</code> <code class="o">=</code> <code class="s">'Cup'</code><code class="p">,</code>
  <code class="nx">Skateboard</code> <code class="o">=</code> <code class="s">'Skateboard'</code><code class="p">,</code>
  <code class="nx">Table</code> <code class="o">=</code> <code class="s">'Table'</code>
<code class="p">}</code>

<code class="kd">function</code> <code class="nx">flip</code><code class="p">(</code><code class="nx">f</code>: <code class="kt">Flippable</code><code class="p">)</code> <code class="p">{</code>
  <code class="kd">return</code> <code class="s">'flipped it'</code>
<code class="p">}</code>

<code class="nx">flip</code><code class="p">(</code><code class="nx">Flippable</code><code class="p">.</code><code class="nx">Chair</code><code class="p">)</code>     <code class="c">// 'flipped it'</code>
<code class="nx">flip</code><code class="p">(</code><code class="nx">Flippable</code><code class="p">.</code><code class="nx">Cup</code><code class="p">)</code>       <code class="c">// 'flipped it'</code>
<code class="nx">flip</code><code class="p">(</code><code class="mi">12</code><code class="p">)</code>                  <code class="c">// Error TS2345: Argument of type '12' is not</code>
                          <code class="c">// assignable to parameter of type 'Flippable'.</code>
<code class="nx">flip</code><code class="p">(</code><code class="s">'Hat'</code><code class="p">)</code>               <code class="c">// Error TS2345: Argument of type '"Hat"' is not</code>
                          <code class="c">// assignable to parameter of type 'Flippable'.</code></pre>

<p class="author1">All it takes is one pesky numeric value in your enum to make the whole enum unsafe.<a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2345" data-type="indexterm" id="calibre_link-920" class="calibre4"></a></p>
<div data-type="warning" type="warning" class="calibre23"><h6 class="calibre24">Warning</h6>
<p class="author1">Because of all the pitfalls that come with using enums safely, I recommend you stay away from them&mdash;there are plenty of better ways to express yourself in TypeScript.<a data-primary="enums" data-secondary="avoiding use of" data-type="indexterm" id="calibre_link-868" class="calibre4"></a></p>

<p class="author1">And if a coworker insists on using enums and there’s nothing you can do to change their mind, be sure to ninja-merge a few TSLint rules while they’re out to warn about numeric values and non-<code class="calibre14">const</code> enums.</p>
</div>
</div></section>





</div></section>













<section data-pdf-bookmark="Summary" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1820">
<h1 class="calibre13">Summary</h1>

<p class="author1">In short, TypeScript comes with a bunch of built-in types. You can let TypeScript infer types for you from your values, or you can explicitly type your values. <code class="calibre14">const</code> will infer more specific types, <code class="calibre14">let</code> and <code class="calibre14">var</code> more general ones.<a data-primary="const" data-secondary="type declarations with" data-type="indexterm" id="calibre_link-794" class="calibre4"></a><a data-primary="let" data-secondary="type declarations with" data-type="indexterm" id="calibre_link-1187" class="calibre4"></a><a data-primary="var" data-secondary="type declarations with" data-type="indexterm" id="calibre_link-1734" class="calibre4"></a><a data-primary="types" data-secondary="supported by TypeScript" data-tertiary="types and their subtypes" data-type="indexterm" id="calibre_link-1664" class="calibre4"></a> Most types have general and more specific counterparts, the latter subtypes of the former (see <a data-type="xref" href="#calibre_link-56" class="calibre4">Table&nbsp;3-3</a>).</p>
<table id="calibre_link-56" class="stafflist_table">
<caption class="calibre35"><span class="calibre">Table 3-3. </span>Types and their more specific subtypes</caption>
<thead class="calibre36">
<tr class="calibre7">
<th class="calibre37">Type</th>
<th class="calibre37">Subtype</th>
</tr>
</thead>
<tbody class="calibre6">
<tr class="calibre7">
<td class="calibre8"><p class="author1"><code class="calibre14">boolean</code></p></td>
<td class="calibre8"><p class="author1">Boolean literal</p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1"><code class="calibre14">bigint</code></p></td>
<td class="calibre8"><p class="author1">BigInt literal</p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1"><code class="calibre14">number</code></p></td>
<td class="calibre8"><p class="author1">Number literal</p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1"><code class="calibre14">string</code></p></td>
<td class="calibre8"><p class="author1">String literal</p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1"><code class="calibre14">symbol</code></p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">unique symbol</code></p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1"><code class="calibre14">object</code></p></td>
<td class="calibre8"><p class="author1">Object literal</p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1">Array</p></td>
<td class="calibre8"><p class="author1">Tuple</p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1"><code class="calibre14">enum</code></p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">const enum</code><a data-primary="enums" data-startref="ix_enum" data-type="indexterm" id="calibre_link-865" class="calibre4"></a><a data-primary="types" data-secondary="supported by TypeScript" data-startref="ix_typeTS" data-type="indexterm" id="calibre_link-1649" class="calibre4"></a></p></td>
</tr>
</tbody>
</table>
</div></section>













<section data-pdf-bookmark="Exercises" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1821">
<h1 class="calibre13">Exercises</h1>
<ol class="calibre31">
<li class="calibre32">
<p class="author1">For each of these values, what type will TypeScript infer?</p>
<ol class="calibre46">
<li class="calibre47"><code class="calibre14">let a = 1042</code></li>
<li class="calibre47"><code class="calibre14">let b = 'apples and oranges'</code></li>
<li class="calibre47"><code class="calibre14">const c = 'pineapples'</code></li>
<li class="calibre47"><code class="calibre14">let d = [true, true, false]</code></li>
<li class="calibre47"><code class="calibre14">let e = {type: 'ficus'}</code></li>
<li class="calibre47"><code class="calibre14">let f = [1, false]</code></li>
<li class="calibre47"><code class="calibre14">const g = [3]</code></li>
<li class="calibre47"><code class="calibre14">let h = null</code> (try this out in your code editor, then jump ahead to <a data-type="xref" href="#calibre_link-40" class="calibre4">“Type Widening”</a> if the result surprises you!)</li>
</ol>
</li>
<li class="calibre32">
<p class="author1">Why does each of these throw the error it does?</p>
<ol class="calibre46">
<li class="calibre47">
<pre class="calibre30" data-code-language="ts" data-type="programlisting">
<code class="kd">let</code> <code class="nx">i</code>: <code class="kt">3</code> <code class="o">=</code> <code class="mi">3</code>
<code class="nx">i</code> <code class="o">=</code> <code class="mi">4</code> <code class="c">// Error TS2322: Type '4' is not assignable to type '3'.</code>
</pre>

</li>
<li class="calibre47">
<pre class="calibre30" data-code-language="ts" data-type="programlisting">
<code class="kd">let</code> <code class="nx">j</code> <code class="o">=</code> <code class="p">[</code><code class="mi">1</code><code class="p">,</code> <code class="mi">2</code><code class="p">,</code> <code class="mi">3</code><code class="p">]</code>
<code class="nx">j</code><code class="p">.</code><code class="nx">push</code><code class="p">(</code><code class="mi">4</code><code class="p">)</code>
<code class="nx">j</code><code class="p">.</code><code class="nx">push</code><code class="p">(</code><code class="s">'5'</code><code class="p">)</code> <code class="c">// Error TS2345: Argument of type '"5"' is not</code>
            <code class="c">// assignable to parameter of type 'number'.</code>
</pre>

</li>
<li class="calibre47">
<pre class="calibre30" data-code-language="ts" data-type="programlisting">
<code class="kd">let</code> <code class="nx">k</code>: <code class="kt">never</code> <code class="o">=</code> <code class="mi">4</code> <code class="c">// Error TSTS2322: Type '4' is not assignable</code>
                 <code class="c">// to type 'never'.</code>
</pre>

</li>
<li class="calibre47">
<pre class="calibre30" data-code-language="ts" data-type="programlisting">
<code class="kd">let</code> <code class="nx">l</code>: <code class="kt">unknown</code> <code class="o">=</code> <code class="mi">4</code>
<code class="kd">let</code> <code class="nx">m</code> <code class="o">=</code> <code class="nx">l</code> <code class="o">*</code> <code class="mi">2</code> <code class="c">// Error TS2571: Object is of type 'unknown'.</code>
</pre>

</li>
</ol>
</li>
</ol>
</div></section>







<div data-type="footnotes" class="calibre26"><p data-type="footnote" id="calibre_link-39" class="calibre27"><sup class="calibre28"><a href="#calibre_link-57" class="calibre16">1</a></sup> Almost. When <code class="calibre14">unknown</code> is part of a union type, the result of the union will be <code class="calibre14">unknown</code>. You’ll read more about union types in <a data-type="xref" href="#calibre_link-58" class="calibre48">“Union and intersection types”</a>.</p><p data-type="footnote" id="calibre_link-47" class="calibre27"><sup class="calibre28"><a href="#calibre_link-59" class="calibre16">2</a></sup> Objects in JavaScript use strings for keys; arrays are special kinds of objects that use numerical keys.</p><p data-type="footnote" id="calibre_link-48" class="calibre27"><sup class="calibre28"><a href="#calibre_link-60" class="calibre16">3</a></sup> There’s one minor technical difference: <code class="calibre14">{}</code> lets you define whatever types you want for built-in methods on the <code class="calibre14">Object</code> prototype, like <code class="calibre14">.toString</code> and <code class="calibre14">.hasOwnProperty</code> (head over to <a href="https://mzl.la/2VSuDJz" class="calibre4">MDN</a> to learn more about prototypes), while <code class="calibre14">Object</code> enforces that the types you declare are assignable to those on <code class="calibre14">Object</code>’s prototype. For example, this code typechecks: <code class="calibre14">let a: {} = {toString() { return 3 }}</code>. But if you change the type annotation to <code class="calibre14">Object</code>, TypeScript complains: <code class="calibre14">let b: Object = {toString() { return 3 }}</code> results in <code class="calibre14">Error TS2322: Type 'number' is not assignable to type 'string'</code>.</p><p data-type="footnote" id="calibre_link-50" class="calibre27"><sup class="calibre28"><a href="#calibre_link-61" class="calibre16">4</a></sup> The acronym DRY stands for “Don’t Repeat Yourself”&mdash;the idea that code shouldn’t be repetitive. It was introduced by Andrew Hunt and David Thomas in their book <em class="calibre5">The Pragmatic Programmer: From Journeyman to Master</em> (Addison-Wesley).</p><p data-type="footnote" id="calibre_link-52" class="calibre27"><sup class="calibre28"><a href="#calibre_link-62" class="calibre16">5</a></sup> Jump ahead to <a data-type="xref" href="#calibre_link-63" class="calibre48">“Discriminated union types”</a> to learn how to hint to TypeScript that your union is disjoint and a value of that union’s type has to be one or the other, and not both.</p><p data-type="footnote" id="calibre_link-53" class="calibre27"><sup class="calibre28"><a href="#calibre_link-64" class="calibre16">6</a></sup> The way to think about a bottom type is as a type that has no values. A bottom type corresponds to a mathematical proposition that’s always false.</p></div></div></section></div>

<div data-type="book" class="calibre1" id="calibre_link-65"><section data-pdf-bookmark="Chapter 4. Functions" data-type="chapter" type="chapter" class="preface"><div class="preface" id="calibre_link-1822">
<h1 class="calibre12"><span class="calibre">Chapter 4. </span>Functions</h1>


<p class="author1">In the last chapter we covered the basics of TypeScript’s type system: primitive types, objects, arrays, tuples, and enums, as well as the basics of TypeScript’s type inference and how type assignability works. You are now ready for TypeScript’s pièce de résistance (or raison d’être, if you’re a functional programmer): functions.<a data-primary="functions" data-type="indexterm" id="calibre_link-1024" class="calibre4"></a> A few of the topics we’ll cover in this chapter are:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">The different ways to declare and invoke functions in TypeScript</p>
</li>
<li class="calibre11">
<p class="author1">Signature overloading</p>
</li>
<li class="calibre11">
<p class="author1">Polymorphic functions</p>
</li>
<li class="calibre11">
<p class="author1">Polymorphic type aliases</p>
</li>
</ul>






<section data-pdf-bookmark="Declaring and Invoking Functions" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1823">
<h1 class="calibre13">Declaring and Invoking Functions</h1>

<p class="author1">In JavaScript, functions are first-class objects. That means you can use them exactly like you would <a data-primary="functions" data-secondary="declaring and invoking" data-type="indexterm" id="calibre_link-1029" class="calibre4"></a>any other object: assign them to variables, pass them to other functions, return them from functions, assign them to objects and prototypes, write properties to them, read those properties back, and so on. There is a lot you can do with functions in JavaScript, and TypeScript models all of those things with its rich type system.</p>

<p class="author1">Here’s what a function looks like in TypeScript (this should look familiar from the last chapter):</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">add</code><code class="p">(</code><code class="nx">a</code>: <code class="kt">number</code><code class="p">,</code> <code class="nx">b</code>: <code class="kt">number</code><code class="p">)</code> <code class="p">{</code>
  <code class="kd">return</code> <code class="nx">a</code> <code class="o">+</code> <code class="nx">b</code>
<code class="p">}</code></pre>

<p class="author1">You will usually explicitly annotate function parameters (<code class="calibre14">a</code> and <code class="calibre14">b</code> in this example)&mdash;TypeScript will always infer types throughout the body of your function, but in most cases it won’t infer types for your parameters, except for a few special cases where it can infer types from context (more on that in <a data-type="xref" href="#calibre_link-66" class="calibre4">“Contextual Typing”</a>). <a data-primary="return types" data-secondary="annotations of" data-type="indexterm" id="calibre_link-1421" class="calibre4"></a>The return type <em class="calibre5">is</em> inferred, but you can explicitly annotate it too if you want:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">add</code><code class="p">(</code><code class="nx">a</code>: <code class="kt">number</code><code class="p">,</code> <code class="nx">b</code>: <code class="kt">number</code><code class="p">)</code><code class="o">:</code> <code class="kt">number</code> <code class="p">{</code>
  <code class="kd">return</code> <code class="nx">a</code> <code class="o">+</code> <code class="nx">b</code>
<code class="p">}</code></pre>
<div data-type="note" type="note" class="calibre21"><h6 class="calibre22">Note</h6>
<p class="author1">Throughout this book I’ll explicitly annotate return types where it helps you, the reader, understand what the function does. Otherwise I’ll leave the annotations off because TypeScript already infers them for us, and why would we want to repeat work?</p>
</div>

<p class="author1">The last example used <em class="calibre5">named function syntax</em> to declare <a data-primary="named function syntax" data-type="indexterm" id="calibre_link-1244" class="calibre4"></a><a data-primary="functions" data-secondary="declaring and invoking" data-tertiary="declaring with named function syntax" data-type="indexterm" id="calibre_link-1034" class="calibre4"></a>the function, but JavaScript and TypeScript support at least five ways to do this:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// Named function</code>
<code class="kd">function</code> <code class="nx">greet</code><code class="p">(</code><code class="nx">name</code>: <code class="kt">string</code><code class="p">)</code> <code class="p">{</code>
  <code class="kd">return</code> <code class="s">'hello '</code> <code class="o">+</code> <code class="nx">name</code>
<code class="p">}</code>

<code class="c">// Function expression</code>
<code class="kd">let</code> <code class="nx">greet2</code> <code class="o">=</code> <code class="kd">function</code><code class="p">(</code><code class="nx">name</code>: <code class="kt">string</code><code class="p">)</code> <code class="p">{</code>
  <code class="kd">return</code> <code class="s">'hello '</code> <code class="o">+</code> <code class="nx">name</code>
<code class="p">}</code>

<code class="c">// Arrow function expression</code>
<code class="kd">let</code> <code class="nx">greet3</code> <code class="o">=</code> <code class="p">(</code><code class="nx">name</code>: <code class="kt">string</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
  <code class="kd">return</code> <code class="s">'hello '</code> <code class="o">+</code> <code class="nx">name</code>
<code class="p">}</code>

<code class="c">// Shorthand arrow function expression</code>
<code class="kd">let</code> <code class="nx">greet4</code> <code class="o">=</code> <code class="p">(</code><code class="nx">name</code>: <code class="kt">string</code><code class="p">)</code> <code class="o">=&gt;</code>
  <code class="s">'hello '</code> <code class="o">+</code> <code class="nx">name</code>

<code class="c">// Function constructor</code>
<code class="kd">let</code> <code class="nx">greet5</code> <code class="o">=</code> <code class="kd">new</code> <code class="nb">Function</code><code class="p">(</code><code class="s">'name'</code><code class="p">,</code> <code class="s">'return "hello " + name'</code><code class="p">)</code></pre>

<p class="author1">Besides<a data-primary="constructors" data-secondary="safety issues with function constructors" data-type="indexterm" id="calibre_link-804" class="calibre4"></a> function constructors (which you shouldn’t use unless you are being chased by bees because they are totally unsafe),<sup class="calibre15"><a data-type="noteref" href="#calibre_link-67" id="calibre_link-144" class="calibre16">1</a></sup> all of these syntaxes are supported by TypeScript in a typesafe way, and they all follow the same rules around usually mandatory type annotations for parameters and optional annotations for return types.</p>
<div data-type="note" type="note" class="calibre21"><h6 class="calibre22">Note</h6>
<p class="author1">A quick refresher on terminology:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">A parameter is a piece of data that a function needs to run, declared as part of a function declaration.<a data-primary="formal parameters" data-see="parameters" data-type="indexterm" id="calibre_link-1824" class="calibre4"></a><a data-primary="parameters" data-secondary="defined" data-type="indexterm" id="calibre_link-1341" class="calibre4"></a> Also called a <em class="calibre5">formal parameter</em>.</p>
</li>
<li class="calibre11">
<p class="author1">An argument is a piece of data that you passed to a function when invoking it. Also called an <em class="calibre5">actual parameter</em>.<a data-primary="actual parameters" data-see="arguments" data-type="indexterm" id="calibre_link-1825" class="calibre4"></a><a data-primary="arguments" data-secondary="defined" data-type="indexterm" id="calibre_link-637" class="calibre4"></a></p>
</li>
</ul>
</div>

<p class="author1">When you invoke a function in TypeScript, you don’t need to provide any additional type information&mdash;just pass in some arguments,<a data-primary="functions" data-secondary="declaring and invoking" data-tertiary="invoking functions" data-type="indexterm" id="calibre_link-1036" class="calibre4"></a><a data-primary="arguments" data-secondary="passing in function calls" data-type="indexterm" id="calibre_link-638" class="calibre4"></a><a data-primary="parameters" data-secondary="compatibility of arguments with" data-type="indexterm" id="calibre_link-1339" class="calibre4"></a> and TypeScript will go to work checking that your arguments are compatible with the types of your function’s parameters:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">add</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="mi">2</code><code class="p">)</code>         <code class="c">// evaluates to 3</code>
<code class="nx">greet</code><code class="p">(</code><code class="s">'Crystal'</code><code class="p">)</code>  <code class="c">// evaluates to 'hello Crystal'</code></pre>

<p class="author1">Of course, if you forgot an argument, or passed an argument of the wrong type, TypeScript will be quick <a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2345" data-type="indexterm" id="calibre_link-921" class="calibre4"></a><a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2554" data-type="indexterm" id="calibre_link-947" class="calibre4"></a>to point it out:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">add</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code>            <code class="c">// Error TS2554: Expected 2 arguments, but got 1.</code>
<code class="nx">add</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="s">'a'</code><code class="p">)</code>       <code class="c">// Error TS2345: Argument of type '"a"' is not assignable</code>
                  <code class="c">// to parameter of type 'number'.</code></pre>








<section data-pdf-bookmark="Optional and Default Parameters" data-type="sect2" class="preface"><div class="preface" id="calibre_link-528">
<h2 class="calibre17">Optional and Default Parameters</h2>

<p class="author1">Like in object and tuple types, you can use <code class="calibre14">?</code> to mark parameters as optional.<a data-primary="? (question mark)" data-secondary="for optional function parameters" data-type="indexterm" id="calibre_link-587" class="calibre4"></a><a data-primary="parameters" data-secondary="optional and default" data-type="indexterm" id="calibre_link-1343" class="calibre4"></a><a data-primary="functions" data-secondary="declaring and invoking" data-tertiary="optional and default parameters" data-type="indexterm" id="calibre_link-1040" class="calibre4"></a> When declaring your function’s parameters, required parameters have to come first, followed by optional parameters:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">log</code><code class="p">(</code><code class="nx">message</code>: <code class="kt">string</code><code class="p">,</code> <code class="nx">userId?</code>: <code class="kt">string</code><code class="p">)</code> <code class="p">{</code>
  <code class="kd">let</code> <code class="nx">time</code> <code class="o">=</code> <code class="kd">new</code> <code class="nb">Date</code><code class="p">().</code><code class="nx">toLocaleTimeString</code><code class="p">()</code>
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">time</code><code class="p">,</code> <code class="nx">message</code><code class="p">,</code> <code class="nx">userId</code> <code class="o">||</code> <code class="s">'Not signed in'</code><code class="p">)</code>
<code class="p">}</code>

<code class="nx">log</code><code class="p">(</code><code class="s">'Page loaded'</code><code class="p">)</code> <code class="c">// Logs "12:38:31 PM Page loaded Not signed in"</code>
<code class="nx">log</code><code class="p">(</code><code class="s">'User signed in'</code><code class="p">,</code> <code class="s">'da763be'</code><code class="p">)</code> <code class="c">// Logs "12:38:31 PM User signed in da763be"</code></pre>

<p class="author1">Like in JavaScript, you can provide default values for optional parameters.<a data-primary="defaults" data-secondary="for function parameters" data-type="indexterm" id="calibre_link-832" class="calibre4"></a> Semantically it’s similar to making a parameter optional, in that callers no longer have to pass it in (a difference is that default parameters don’t have to be at the end of your list of parameters, while optional parameters do).</p>

<p class="author1">For example, we can rewrite <code class="calibre14">log</code> as:</p>
<pre class="calibre30" data-code-language="ts" data-type="programlisting">
<code class="kd">function</code><code class="calibre14"> </code><code class="nx">log</code><code class="p">(</code><code class="nx">message</code><code class="calibre14">: </code><code class="kt">string</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">userId</code><code class="calibre14"> </code><strong class="calibre49"><code class="o1">=</code><code class="calibre50"> </code><code class="s1">'Not signed in'</code></strong><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">time</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="kd">new</code><code class="calibre14"> </code><code class="nb">Date</code><code class="p">(</code><code class="p">)</code><code class="p">.</code><code class="nx">toISOString</code><code class="p">(</code><code class="p">)</code><code class="calibre14">
  </code><code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">time</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">message</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">userId</code><code class="p">)</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">

</code><code class="nx">log</code><code class="p">(</code><code class="s">'User clicked on a button'</code><code class="p">,</code><code class="calibre14"> </code><code class="s">'da763be'</code><code class="p">)</code><code class="calibre14">
</code><code class="nx">log</code><code class="p">(</code><code class="s">'User signed out'</code><code class="p">)</code><code class="calibre14">
</code></pre>

<p class="author1">Notice how when we give <code class="calibre14">userId</code> a default value, we remove its optional annotation, <code class="calibre14">?</code>.  We also don’t have to type it anymore. TypeScript is smart enough to infer the parameter’s type from its default value, keeping our code terse and easy to read.</p>

<p class="author1">Of course, you can also add explicit type annotations to your default parameters, the same way you can for parameters without defaults:</p>
<pre data-type="programlisting" class="calibre30">
<strong class="calibre49"><code class="nx1">type</code><code class="calibre50"> </code><code class="nx1">Context</code><code class="calibre50"> </code><code class="o1">=</code><code class="calibre50"> </code><code class="p1">{</code><code class="calibre50">
  </code><code class="nx1">appId?</code><code class="calibre50">: </code><code class="kt1">string</code><code class="calibre50">
  </code><code class="nx1">userId?</code><code class="calibre50">: </code><code class="kt1">string</code><code class="calibre50">
</code><code class="p1">}</code></strong><code class="calibre14">

</code><code class="kd">function</code><code class="calibre14"> </code><code class="nx">log</code><code class="p">(</code><code class="nx">message</code><code class="calibre14">: </code><code class="kt">string</code><code class="p">,</code><code class="calibre14"> </code><strong class="calibre49"><code class="nx1">context</code><code class="calibre50">: </code><code class="kt1">Context</code><code class="calibre50"> </code><code class="o1">=</code><code class="calibre50"> </code><code class="p1">{</code><code class="p1">}</code></strong><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">time</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="kd">new</code><code class="calibre14"> </code><code class="nb">Date</code><code class="p">(</code><code class="p">)</code><code class="p">.</code><code class="nx">toISOString</code><code class="p">(</code><code class="p">)</code><code class="calibre14">
  </code><code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">time</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">message</code><code class="p">,</code><code class="calibre14"> </code><strong class="calibre49"><code class="nx1">context</code><code class="p1">.</code></strong><code class="nx">userId</code><code class="p">)</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code></pre>

<p class="author1">You’ll find yourself using default parameters over optional parameters often.</p>
</div></section>













<section data-pdf-bookmark="Rest Parameters" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1826">
<h2 class="calibre17">Rest Parameters</h2>

<p class="author1">If a function takes a list of arguments,<a data-primary="rest parameters" data-type="indexterm" id="calibre_link-1418" class="calibre4"></a><a data-primary="parameters" data-secondary="rest" data-type="indexterm" id="calibre_link-1345" class="calibre4"></a><a data-primary="functions" data-secondary="declaring and invoking" data-tertiary="rest parameters" data-type="indexterm" id="calibre_link-1043" class="calibre4"></a> you can of course simply<a data-primary="arrays" data-secondary="lists of function parameters passed in as" data-type="indexterm" id="calibre_link-650" class="calibre4"></a> pass the list in as an array:</p>

<pre data-code-language="ts" data-type="programlisting" id="calibre_link-1827" class="calibre30"><code class="kd">function</code> <code class="nx">sum</code><code class="p">(</code><code class="nx">numbers</code>: <code class="kt">number</code><code class="p">[])</code><code class="o">:</code> <code class="kt">number</code> <code class="p">{</code>
  <code class="kd">return</code> <code class="nx">numbers</code><code class="p">.</code><code class="nx">reduce</code><code class="p">((</code><code class="nx">total</code><code class="p">,</code> <code class="nx">n</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="nx">total</code> <code class="o">+</code> <code class="nx">n</code><code class="p">,</code> <code class="mi">0</code><code class="p">)</code>
<code class="p">}</code>

<code class="nx">sum</code><code class="p">([</code><code class="mi">1</code><code class="p">,</code> <code class="mi">2</code><code class="p">,</code> <code class="mi">3</code><code class="p">])</code> <code class="c">// evaluates to 6</code></pre>

<p class="author1">Sometimes, you might opt for a <em class="calibre5">variadic</em> function API&mdash;one that takes a variable number of<a data-primary="variadic functions" data-type="indexterm" id="calibre_link-1744" class="calibre4"></a><a data-primary="fixed-arity functions" data-type="indexterm" id="calibre_link-1005" class="calibre4"></a> arguments&mdash;instead of a <em class="calibre5">fixed-arity</em> API that takes a fixed number of arguments.<a data-primary="arguments" data-secondary="variable or fixed number of" data-type="indexterm" id="calibre_link-639" class="calibre4"></a><a data-primary="arity" data-secondary="variadic versus fixed-arity functons" data-type="indexterm" id="calibre_link-641" class="calibre4"></a> Traditionally, that required using JavaScript’s magic <code class="calibre14">arguments</code> object.</p>

<p class="author1"><code class="calibre14">arguments</code> is “magic” because your JavaScript runtime automatically defines it for you in functions, and assigns to it the list of arguments you passed to your function. Because <code class="calibre14">arguments</code> is only array-like, and not a true array, you first have to convert it to an array before you can call the built-in <code class="calibre14">.reduce</code> on it:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">sumVariadic</code><code class="p">()</code><code class="o">:</code> <code class="kt">number</code> <code class="p">{</code>
  <code class="kd">return</code> <code class="nb">Array</code>
    <code class="p">.</code><code class="nx">from</code><code class="p">(</code><code class="nx">arguments</code><code class="p">)</code>
    <code class="p">.</code><code class="nx">reduce</code><code class="p">((</code><code class="nx">total</code><code class="p">,</code> <code class="nx">n</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="nx">total</code> <code class="o">+</code> <code class="nx">n</code><code class="p">,</code> <code class="mi">0</code><code class="p">)</code>
<code class="p">}</code>

<code class="nx">sumVariadic</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="mi">2</code><code class="p">,</code> <code class="mi">3</code><code class="p">)</code> <code class="c">// evaluates to 6</code></pre>

<p class="author1">But there’s one big problem with using <code class="calibre14">arguments</code>: it’s totally unsafe! If you hover over <code class="calibre14">total</code> or <code class="calibre14">n</code> in your text editor, you’ll see output similar to that shown in <a data-type="xref" href="#calibre_link-68" class="calibre4">Figure&nbsp;4-1</a>.</p>

<figure class="calibre33"><div class="figure" id="calibre_link-68">
<img alt="prts 0401" src="images/000013.png" class="calibre40" />
<h6 class="calibre34"><span class="calibre">Figure 4-1. </span>arguments is unsafe</h6>
</div></figure>

<p class="author1">This means TypeScript inferred that both <code class="calibre14">n</code> and <code class="calibre14">total</code> are of type <code class="calibre14">any</code>, and silently <a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2554" data-type="indexterm" id="calibre_link-948" class="calibre4"></a>let it pass&mdash;that is, until you try to use <code class="calibre14">sumVariadic</code>:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">sumVariadic</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="mi">2</code><code class="p">,</code> <code class="mi">3</code><code class="p">)</code> <code class="c">// Error TS2554: Expected 0 arguments, but got 3.</code></pre>

<p class="author1">Since we didn’t declare that <code class="calibre14">sumVariadic</code> takes arguments, from TypeScript’s point of view it doesn’t take any arguments, so we get a <code class="calibre14">TypeError</code> when we try to use it.</p>

<p class="author1">So, how can we safely type variadic functions?</p>

<p class="author1">Rest parameters to the rescue! Instead of resorting to the unsafe <code class="calibre14">arguments</code> magic variable, we can instead use rest parameters to safely make our <code class="calibre14">sum</code> function accept any number of arguments:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">sumVariadicSafe</code><code class="p">(...</code><code class="nx">numbers</code>: <code class="kt">number</code><code class="p">[])</code><code class="o">:</code> <code class="kt">number</code> <code class="p">{</code>
  <code class="kd">return</code> <code class="nx">numbers</code><code class="p">.</code><code class="nx">reduce</code><code class="p">((</code><code class="nx">total</code><code class="p">,</code> <code class="nx">n</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="nx">total</code> <code class="o">+</code> <code class="nx">n</code><code class="p">,</code> <code class="mi">0</code><code class="p">)</code>
<code class="p">}</code>

<code class="nx">sumVariadicSafe</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="mi">2</code><code class="p">,</code> <code class="mi">3</code><code class="p">)</code> <code class="c">// evaluates to 6</code></pre>

<p class="author1">That’s it! Notice that the only change between this variadic <code class="calibre14">sum</code> and our original single-parameter <code class="calibre14">sum</code> function is the extra <code class="calibre14">...</code> in the parameter list&mdash;nothing else has to change, and it’s totally typesafe.<a data-primary="… (ellipsis) in variadic function parameters list" data-type="indexterm" id="calibre_link-601" class="calibre4"></a></p>

<p class="author1">A function can have at most one rest parameter, and that parameter has to be the last one in the function’s parameter list. For example, take a look at TypeScript’s built-in declaration for <code class="calibre14">console.log</code> (if you don’t know what an <code class="calibre14">interface</code> is, don’t worry&mdash;we’ll cover it in <a data-type="xref" href="#calibre_link-69" class="calibre4">Chapter&nbsp;5</a>). <code class="calibre14">console.log</code> takes an optional <code class="calibre14">message</code>, and any number of additional arguments to log:</p>

<pre data-code-language="ts" data-type="programlisting" id="calibre_link-1828" class="calibre30"><code class="kd">interface</code> <code class="nx">Console</code> <code class="p">{</code>
  <code class="nx">log</code><code class="p">(</code><code class="nx">message?</code>: <code class="kt">any</code><code class="p">,</code> <code class="p">...</code><code class="nx">optionalParams</code>: <code class="kt">any</code><code class="p">[])</code><code class="o">:</code> <code class="kd">void</code>
<code class="p">}</code></pre>
</div></section>













<section data-pdf-bookmark="call, apply, and bind" data-type="sect2" class="preface"><div class="preface" id="calibre_link-555">
<h2 class="calibre17">call, apply, and bind</h2>

<p class="author1">In addition to invoking a function with parentheses <code class="calibre14">()</code>, JavaScript supports at least two other ways to call a function.<a data-primary="() (parentheses), invoking functions with" data-type="indexterm" id="calibre_link-580" class="calibre4"></a><a data-primary="functions" data-secondary="declaring and invoking" data-tertiary="invoking with call, apply, and bind" data-type="indexterm" id="calibre_link-1037" class="calibre4"></a> Take <code class="calibre14">add</code> from earlier in the chapter:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">add</code><code class="p">(</code><code class="nx">a</code>: <code class="kt">number</code><code class="p">,</code> <code class="nx">b</code>: <code class="kt">number</code><code class="p">)</code><code class="o">:</code> <code class="kt">number</code> <code class="p">{</code>
  <code class="kd">return</code> <code class="nx">a</code> <code class="o">+</code> <code class="nx">b</code>
<code class="p">}</code>

<code class="nx">add</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code> <code class="mi">20</code><code class="p">)</code>                <code class="c">// evaluates to 30</code>
<code class="nx">add</code><code class="p">.</code><code class="nx">apply</code><code class="p">(</code><code class="kd">null</code><code class="p">,</code> <code class="p">[</code><code class="mi">10</code><code class="p">,</code> <code class="mi">20</code><code class="p">])</code>  <code class="c">// evaluates to 30</code>
<code class="nx">add</code><code class="p">.</code><code class="nx">call</code><code class="p">(</code><code class="kd">null</code><code class="p">,</code> <code class="mi">10</code><code class="p">,</code> <code class="mi">20</code><code class="p">)</code>     <code class="c">// evaluates to 30</code>
<code class="nx">add</code><code class="p">.</code><code class="nx">bind</code><code class="p">(</code><code class="kd">null</code><code class="p">,</code> <code class="mi">10</code><code class="p">,</code> <code class="mi">20</code><code class="p">)()</code>   <code class="c">// evaluates to 30</code></pre>

<p class="author1"><code class="calibre14">apply</code> binds a value to <code class="calibre14">this</code> within your function (in this example, we bind <code class="calibre14">this</code> to <code class="calibre14">null</code>), and spreads its second argument over your function’s parameters. <code class="calibre14">call</code> does the same, but applies its arguments in order instead of spreading.<a data-primary="call function" data-type="indexterm" id="calibre_link-711" class="calibre4"></a><a data-primary="this variable" data-type="indexterm" id="calibre_link-1476" class="calibre4"></a><a data-primary="apply function" data-type="indexterm" id="calibre_link-636" class="calibre4"></a></p>

<p class="author1"><code class="calibre14">bind()</code> is similar, in that it <em class="calibre5">binds</em> a <code class="calibre14">this</code>-argument and a list of arguments to your function. <a data-primary="bind function" data-type="indexterm" id="calibre_link-685" class="calibre4"></a>The difference is that <code class="calibre14">bind</code> does not invoke your function; instead, it returns a new function that you can then invoke with <code class="calibre14">()</code>, <code class="calibre14">.call</code>, or <code class="calibre14">.apply</code>, passing more arguments in to be bound to the so far unbound parameters if you want.</p>
<div data-type="tip" class="calibre21"><h1 class="calibre42">TSC Flag: strictBindCallApply</h1>
<p class="author1">To safely use <code class="calibre14">.call</code>, <code class="calibre14">.apply</code>, and <code class="calibre14">.bind</code> in your code, be sure to enable the <code class="calibre14">strictBindCallApply</code> option in your <em class="calibre5">tsconfig.json</em> (it’s automatically enabled if you already enabled <code class="calibre14">strict</code> mode).<a data-primary="strictBindCallApply option" data-type="indexterm" id="calibre_link-1447" class="calibre4"></a><a data-primary="TSC compiler" data-secondary="strictBindCallApply option" data-type="indexterm" id="calibre_link-1526" class="calibre4"></a></p>
</div>
</div></section>













<section data-pdf-bookmark="Typing this" data-type="sect2" class="preface"><div class="preface" id="calibre_link-81">
<h2 class="calibre17">Typing this</h2>

<p class="author1">If you’re not coming from JavaScript, you may be surprised to learn that in JavaScript the <code class="calibre14">this</code> variable is defined for every function, not just for those functions that live as methods on classes. <code class="calibre14">this</code> has a different value depending on how you called your function, which can make it notoriously fragile and hard to reason about.<a data-primary="functions" data-secondary="declaring and invoking" data-tertiary="typing this variable" data-type="indexterm" id="calibre_link-1044" class="calibre4"></a><a data-primary="this variable" data-secondary="typing" data-type="indexterm" id="calibre_link-1478" class="calibre4"></a></p>
<div data-type="tip" class="calibre21"><h6 class="calibre22">Tip</h6>
<p class="author1">For this reason, a lot of teams ban <code class="calibre14">this</code> everywhere except in class methods&mdash;to do this for your codebase too, enable the <code class="calibre14">no-invalid-this</code> TSLint rule.<a data-primary="TSLint" data-secondary="no-invalid-this rule" data-type="indexterm" id="calibre_link-1540" class="calibre4"></a><a data-primary="no-invalid-this TSLint rule" data-type="indexterm" id="calibre_link-1261" class="calibre4"></a></p>
</div>

<p class="author1">The reason that <code class="calibre14">this</code> is fragile has to do with the way it’s assigned. The general rule is that <code class="calibre14">this</code> will take the value of the thing to the left of the dot when invoking a method.<a data-primary="assignment, this variable" data-type="indexterm" id="calibre_link-663" class="calibre4"></a> For example:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">x</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">a() {</code>
    <code class="kd">return</code> <code class="kd">this</code>
  <code class="p">}</code>
<code class="p">}</code>
<code class="nx">x</code><code class="p">.</code><code class="nx">a</code><code class="p">()</code> <code class="c">// this is the object x in the body of a()</code></pre>

<p class="author1">But if at some point you reassign <code class="calibre14">a</code> before calling it, the result will change!</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">a</code> <code class="o">=</code> <code class="nx">x</code><code class="p">.</code><code class="nx">a</code>
<code class="nx">a</code><code class="p">()</code> <code class="c">// now, this is undefined in the body of a()</code></pre>

<p class="author1">Say you have a utility function for formatting dates that looks like this:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">fancyDate() {</code>
  <code class="kd">return</code> <code class="nx">$</code><code class="p">{</code><code class="kd">this</code><code class="p">.</code><code class="nx">getDate</code><code class="p">()}</code><code class="o">/</code><code class="nx">$</code><code class="p">{</code><code class="kd">this</code><code class="p">.</code><code class="nx">getMonth</code><code class="p">()}</code><code class="o">/</code><code class="nx">$</code><code class="p">{</code><code class="kd">this</code><code class="p">.</code><code class="nx">getFullYear</code><code class="p">()}</code>
<code class="p">}</code></pre>

<p class="author1">You designed this API in your early days as a programmer (before you learned about function parameters). To use <code class="calibre14">fancyDate</code>, you have to call it with a <code class="calibre14">Date</code> bound to <code class="calibre14">this</code>:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">fancyDate</code><code class="p">.</code><code class="nx">call</code><code class="p">(</code><code class="kd">new</code> <code class="nb">Date</code><code class="p">)</code> <code class="c">// evaluates to "4/14/2005"</code></pre>

<p class="author1">If you forget to bind a <code class="calibre14">Date</code> to <code class="calibre14">this</code>, you’ll get a runtime exception!</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">fancyDate</code><code class="p">()</code> <code class="c">// Uncaught TypeError: this.getDate is not a function</code></pre>

<p class="author1">Though exploring all of the semantics of <code class="calibre14">this</code> is beyond the scope of this book,<sup class="calibre15"><a data-type="noteref" href="#calibre_link-70" id="calibre_link-145" class="calibre16">2</a></sup> this behavior&mdash;that <code class="calibre14">this</code> depends on the way you called a function, and not on the way that you declared it&mdash;can be surprising to say the least.</p>

<p class="author1">Thankfully, TypeScript has your back. <a data-primary="types" data-secondary="declaring type this variable" data-type="indexterm" id="calibre_link-1619" class="calibre4"></a>If your function uses <code class="calibre14">this</code>, be sure to declare your expected <code class="calibre14">this</code> type as your function’s first parameter (before any additional parameters), and TypeScript will enforce that <code class="calibre14">this</code> really is what you say it is at every call site. <code class="calibre14">this</code> isn’t treated like other parameters&mdash;it’s a reserved word when used as part of a function signature:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<code class="kd">function</code><code class="calibre14"> </code><code class="nx">fancyDate</code><code class="p">(</code><strong class="calibre49"><code class="k">this</code><code class="o1">:</code><code class="calibre50"> </code><code class="nb1">Date</code></strong><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="kd">return</code><code class="calibre14"> </code><code class="nx">$</code><code class="p">{</code><code class="kd">this</code><code class="p">.</code><code class="nx">getDate</code><code class="p">(</code><code class="p">)</code><code class="p">}</code><code class="o">/</code><code class="nx">$</code><code class="p">{</code><code class="kd">this</code><code class="p">.</code><code class="nx">getMonth</code><code class="p">(</code><code class="p">)</code><code class="p">}</code><code class="o">/</code><code class="nx">$</code><code class="p">{</code><code class="kd">this</code><code class="p">.</code><code class="nx">getFullYear</code><code class="p">(</code><code class="p">)</code><code class="p">}</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code></pre>

<p class="author1">Now here’s what happens when we call <code class="calibre14">fancyDate</code>:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">fancyDate</code><code class="p">.</code><code class="nx">call</code><code class="p">(</code><code class="kd">new</code> <code class="nb">Date</code><code class="p">)</code> <code class="c">// evaluates to "6/13/2008"</code>

<code class="nx">fancyDate</code><code class="p">()</code> <code class="c">// Error TS2684: The 'this' context of type 'void' is</code>
            <code class="c">// not assignable to method's 'this' of type 'Date'.</code></pre>

<p class="author1">We took a runtime error,<a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2684" data-type="indexterm" id="calibre_link-952" class="calibre4"></a> and gave TypeScript enough information to warn about the error at compile time instead.</p>
<div data-type="tip" class="calibre21"><h1 class="calibre42">TSC Flag: noImplicitThis</h1>
<p class="author1">To enforce that <code class="calibre14">this</code> types are always explicitly annotated in functions, enable the <code class="calibre14">noImplicitThis</code> setting in your <em class="calibre5">tsconfig.json</em>. <code class="calibre14">strict</code> mode includes <code class="calibre14">noImplicitThis</code>, so if you already have that enabled you’re good to go.<a data-primary="noImplicitThis TSC option" data-type="indexterm" id="calibre_link-1279" class="calibre4"></a><a data-primary="TSC compiler" data-secondary="noImplicitThis option" data-type="indexterm" id="calibre_link-1520" class="calibre4"></a></p>

<p class="author1">Note that <code class="calibre14">noImplicitThis</code> doesn’t enforce <code class="calibre14">this</code>-annotations for classes, or for functions on objects.&nbsp;</p>
</div>
</div></section>













<section data-pdf-bookmark="Generator Functions" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1829">
<h2 class="calibre17">Generator Functions</h2>

<p class="author1">Generator functions (<em class="calibre5">generators</em> for short) are a convenient way to, well, <em class="calibre5">generate</em> a bunch of values. They give <a data-primary="generator functions" data-type="indexterm" id="calibre_link-1059" class="calibre4"></a><a data-primary="functions" data-secondary="declaring and invoking" data-tertiary="generator functions" data-type="indexterm" id="calibre_link-1035" class="calibre4"></a>the generator’s consumer fine control over the pace at which values are produced. Because they’re lazy&mdash;that is, they only compute the next value when a consumer asks for it&mdash;they can do things that can be hard to do otherwise, like generate infinite lists.</p>

<p class="author1">They work like this:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code><code class="o">*</code><code class="calibre14"> </code><code class="nx">createFibonacciGenerator() {</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-71" id="calibre_link-75"><img alt="1" src="images/000000.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">a</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="mi">0</code><code class="calibre14">
  </code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">b</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="mi">1</code><code class="calibre14">
  </code><code class="kd">while</code><code class="calibre14"> </code><code class="p">(</code><code class="kd">true</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-72" id="calibre_link-76"><img alt="2" src="images/000001.png" class="calibre40" /></a><code class="calibre14">
    </code><code class="nx">yield</code><code class="calibre14"> </code><code class="nx">a</code><code class="p">;</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-73" id="calibre_link-77"><img alt="3" src="images/000002.png" class="calibre40" /></a><code class="calibre14">
    </code><code class="p">[</code><code class="nx">a</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">b</code><code class="p">]</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">[</code><code class="nx">b</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">a</code><code class="calibre14"> </code><code class="o">+</code><code class="calibre14"> </code><code class="nx">b</code><code class="p">]</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-74" id="calibre_link-78"><img alt="4" src="images/000003.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">

</code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">fibonacciGenerator</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="nx">createFibonacciGenerator</code><code class="p">(</code><code class="p">)</code><code class="calibre14"> </code><code class="c">// IterableIterator&lt;number&gt;
</code><code class="nx">fibonacciGenerator</code><code class="p">.</code><code class="nx">next</code><code class="p">(</code><code class="p">)</code><code class="calibre14">   </code><code class="c">// evaluates to {value: 0, done: false}
</code><code class="nx">fibonacciGenerator</code><code class="p">.</code><code class="nx">next</code><code class="p">(</code><code class="p">)</code><code class="calibre14">   </code><code class="c">// evaluates to {value: 1, done: false}
</code><code class="nx">fibonacciGenerator</code><code class="p">.</code><code class="nx">next</code><code class="p">(</code><code class="p">)</code><code class="calibre14">   </code><code class="c">// evaluates to {value: 1, done: false}
</code><code class="nx">fibonacciGenerator</code><code class="p">.</code><code class="nx">next</code><code class="p">(</code><code class="p">)</code><code class="calibre14">   </code><code class="c">// evaluates to {value: 2, done: false}
</code><code class="nx">fibonacciGenerator</code><code class="p">.</code><code class="nx">next</code><code class="p">(</code><code class="p">)</code><code class="calibre14">   </code><code class="c">// evaluates to {value: 3, done: false}
</code><code class="nx">fibonacciGenerator</code><code class="p">.</code><code class="nx">next</code><code class="p">(</code><code class="p">)</code><code class="calibre14">   </code><code class="c">// evaluates to {value: 5, done: false}</code></pre>
<dl class="preface">
<dt class="calibre18"><a class="calibre4" href="#calibre_link-75" id="calibre_link-71"><img alt="1" src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">The asterisk (<code class="calibre14">*</code>) before a function’s name makes that function a generator.<a data-primary="* (asterisk), before function names" data-type="indexterm" id="calibre_link-581" class="calibre4"></a> Calling a generator returns an iterable iterator.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-76" id="calibre_link-72"><img alt="2" src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">Our generator can generate values forever.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-77" id="calibre_link-73"><img alt="3" src="images/000002.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">Generators use the <code class="calibre14">yield</code> keyword to, well, <em class="calibre5">yield</em> values.<a data-primary="yield keyword" data-type="indexterm" id="calibre_link-1769" class="calibre4"></a> When a consumer asks for the generator’s next value (for example, by calling <code class="calibre14">next</code>), <code class="calibre14">yield</code> sends a result back to the consumer and pauses execution until the consumer asks for the next value. In this way the <code class="calibre14">while(true)</code> loop doesn’t immediately cause the program to run forever and crash.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-78" id="calibre_link-74"><img alt="4" src="images/000003.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">To compute the next Fibonacci number, we reassign <code class="calibre14">a</code> to <code class="calibre14">b</code> and <code class="calibre14">b</code> to <code class="calibre14">a + b</code> in a single step.</p></dd>
</dl>

<p class="author1">We called <code class="calibre14">createFibonacciGenerator</code>, and that returned an <code class="calibre14">IterableIterator</code>. <a data-primary="IterableIterator type" data-type="indexterm" id="calibre_link-1136" class="calibre4"></a>Every time we call <code class="calibre14">next</code>, the iterator computes the next Fibonacci number and <code class="calibre14">yield</code>s it back to us. Notice how TypeScript is able to infer the type of our iterator from the type of the value we <code class="calibre14">yield</code>ed.</p>

<p class="author1">You can also explicitly annotate a generator, wrapping the type it yields in an <code class="calibre14">IterableIterator</code>:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code><code class="o">*</code> <code class="nx">createNumbers</code><code class="p">()</code><code class="o">:</code> <code class="nx">IterableIterator</code><code class="o">&lt;</code><code class="kt">number</code><code class="o">&gt;</code> <code class="p">{</code>
  <code class="kd">let</code> <code class="nx">n</code> <code class="o">=</code> <code class="mi">0</code>
  <code class="kd">while</code> <code class="p">(</code><code class="mi">1</code><code class="p">)</code> <code class="p">{</code>
    <code class="nx">yield</code> <code class="nx">n</code><code class="o">++</code>
  <code class="p">}</code>
<code class="p">}</code>

<code class="kd">let</code> <code class="nx">numbers</code> <code class="o">=</code> <code class="nx">createNumbers</code><code class="p">()</code>
<code class="nx">numbers</code><code class="p">.</code><code class="nx">next</code><code class="p">()</code>              <code class="c">// evaluates to {value: 0, done: false}</code>
<code class="nx">numbers</code><code class="p">.</code><code class="nx">next</code><code class="p">()</code>              <code class="c">// evaluates to {value: 1, done: false}</code>
<code class="nx">numbers</code><code class="p">.</code><code class="nx">next</code><code class="p">()</code>              <code class="c">// evaluates to {value: 2, done: false}</code></pre>

<p class="author1">We won’t delve deeper into generators in this book&mdash;they’re a big topic, and since this book is about TypeScript, I don’t want to get sidetracked with JavaScript features. The short of it is they’re a super cool JavaScript language feature that TypeScript supports too. To learn more about generators, head to their page on <a href="https://mzl.la/2UitIk4" class="calibre4">MDN</a>.</p>
</div></section>













<section data-pdf-bookmark="Iterators" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1830">
<h2 class="calibre17">Iterators</h2>

<p class="author1">Iterators are the flip side to generators: while generators are a way to produce a stream of values, iterators are a way to consume those values.<a data-primary="functions" data-secondary="declaring and invoking" data-tertiary="iterators" data-type="indexterm" id="calibre_link-1038" class="calibre4"></a><a data-primary="iterators" data-type="indexterm" id="calibre_link-1138" class="calibre4"></a> The terminology can get pretty confusing, so let’s start with a couple of definitions.</p>
<aside class="keyterm" data-type="sidebar" type="sidebar"><div class="sidebar" id="calibre_link-1831">
<h5 class="calibre29">Iterable</h5>
<p class="author1">Any object that contains a property called <code class="calibre14">Symbol.iterator</code>, whose value is a function that returns an iterator.<a data-primary="iterables" data-type="indexterm" id="calibre_link-1137" class="calibre4"></a></p>
</div></aside>
<aside class="keyterm" data-type="sidebar" type="sidebar"><div class="sidebar" id="calibre_link-1832">
<h5 class="calibre29">Iterator</h5>
<p class="author1">Any object that defines a method called <code class="calibre14">next</code>, which returns an object with the properties <code class="calibre14">value</code> and <code class="calibre14">done</code>.<a data-primary="iterators" data-secondary="defined" data-type="indexterm" id="calibre_link-1141" class="calibre4"></a></p>
</div></aside>

<p class="author1">When you create a generator (say, by calling <code class="calibre14">createFibonacciGenerator</code>), you get a value back that’s <em class="calibre5">both</em> an iterable and an iterator&mdash;an <em class="calibre5">iterable iterator</em>&mdash;because it defines both a <code class="calibre14">Symbol.iterator</code> property and a <code class="calibre14">next</code> method.<a data-primary="Symbol.iterator" data-type="indexterm" id="calibre_link-1467" class="calibre4"></a><a data-primary="next method" data-type="indexterm" id="calibre_link-1260" class="calibre4"></a><a data-primary="iterable iterators" data-type="indexterm" id="calibre_link-1135" class="calibre4"></a></p>

<p class="author1">You can manually define an iterator or an iterable by creating an object (or a class) that implements <code class="calibre14">Symbol.iterator</code> or <code class="calibre14">next</code>, respectively. For example, let’s define an iterator that returns the numbers 1 through 10:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">numbers</code> <code class="o">=</code> <code class="p">{</code>
  <code class="o">*</code><code class="p">[</code><code class="nx">Symbol</code><code class="p">.</code><code class="nx">iterator</code><code class="p">]()</code> <code class="p">{</code>
    <code class="kd">for</code> <code class="p">(</code><code class="kd">let</code> <code class="nx">n</code> <code class="o">=</code> <code class="mi">1</code><code class="p">;</code> <code class="nx">n</code> <code class="o">&lt;=</code> <code class="mi">10</code><code class="p">;</code> <code class="nx">n</code><code class="o">++</code><code class="p">)</code> <code class="p">{</code>
      <code class="nx">yield</code> <code class="nx">n</code>
    <code class="p">}</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p class="author1">If you type that iterator into your code editor and hover over it, you’ll see what TypeScript infers as its type (<a data-type="xref" href="#calibre_link-79" class="calibre4">Figure&nbsp;4-2</a>).</p>

<figure class="width"><div class="figure" id="calibre_link-79">
<img alt="prts 0402" src="images/000014.png" class="calibre40" />
<h6 class="calibre34"><span class="calibre">Figure 4-2. </span>Manually defining an iterator</h6>
</div></figure>

<p class="author1">In other words, <code class="calibre14">numbers</code> is an iterator, and calling the generator function <code class="calibre14">numbers[Symbol.iterator]()</code> returns an iterable iterator.</p>

<p class="author1">Not only can you define your own iterators, but you can use JavaScript’s built-in iterators <a data-primary="JavaScript" data-secondary="built-in iterators for collection types" data-type="indexterm" id="calibre_link-1143" class="calibre4"></a><a data-primary="iterators" data-secondary="built-in, for common collection types" data-type="indexterm" id="calibre_link-1140" class="calibre4"></a>for common collection types&mdash;<code class="calibre14">Array</code>, <code class="calibre14">Map</code>, <code class="calibre14">Set</code>, <code class="calibre14">String</code>,<sup class="calibre15"><a data-type="noteref" href="#calibre_link-80" id="calibre_link-146" class="calibre16">3</a></sup> and so on&mdash;to do things like:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// Iterate over an iterator with for-of</code>
<code class="kd">for</code> <code class="p">(</code><code class="kd">let</code> <code class="nx">a</code> <code class="nx">of</code> <code class="nx">numbers</code><code class="p">)</code> <code class="p">{</code>
  <code class="c">// 1, 2, 3, etc.</code>
<code class="p">}</code>

<code class="c">// Spread an iterator</code>
<code class="kd">let</code> <code class="nx">allNumbers</code> <code class="o">=</code> <code class="p">[...</code><code class="nx">numbers</code><code class="p">]</code> <code class="c">// number[]</code>

<code class="c">// Destructure an iterator</code>
<code class="kd">let</code> <code class="p">[</code><code class="nx">one</code><code class="p">,</code> <code class="nx">two</code><code class="p">,</code> <code class="p">...</code><code class="nx">rest</code><code class="p">]</code> <code class="o">=</code> <code class="nx">numbers</code> <code class="c">// [number, number, number[]]</code></pre>

<p class="author1">Again, we won’t go more deeply into iterators in this book. You can read more about iterators and async iterators on <a href="https://mzl.la/2OAoy1o" class="calibre4">MDN</a>.</p>
<div data-type="tip" class="calibre21"><h1 class="calibre42">TSC Flag: downlevelIteration</h1>
<p class="author1">If you’re compiling your TypeScript to a JavaScript version older than <code class="calibre14">ES2015</code>, you can enable custom iterators with the <code class="calibre14"><span class="calibre">downlevel</span>Iteration</code> flag in your <em class="calibre5">tsconfig.json</em>.<a data-primary="downlevelIteration TSC flag" data-type="indexterm" id="calibre_link-856" class="calibre4"></a><a data-primary="TSC compiler" data-secondary="downlevelIteration flag" data-type="indexterm" id="calibre_link-1503" class="calibre4"></a></p>

<p class="author1">You may want to keep <code class="calibre14">downlevelIteration</code> disabled if your application is especially sensitive to bundle size: it takes a lot of code to get custom iterators working in older environments. For example, the previous <code class="calibre14">numbers</code> example generates nearly 1 KB of code <span class="calibre">(gzipped)</span>.<a data-primary="functions" data-secondary="declaring and invoking" data-startref="ix_funcdeciter" data-tertiary="iterators" data-type="indexterm" id="calibre_link-1039" class="calibre4"></a><a data-primary="iterators" data-startref="ix_iter" data-type="indexterm" id="calibre_link-1139" class="calibre4"></a></p>
</div>
</div></section>













<section data-pdf-bookmark="Call Signatures" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1833">
<h2 class="calibre17">Call Signatures</h2>

<p class="author1">So far, we’ve learned to type functions’ parameters and return types. <a data-primary="call signatures" data-type="indexterm" id="calibre_link-712" class="calibre4"></a><a data-primary="functions" data-secondary="declaring and invoking" data-tertiary="call signatures" data-type="indexterm" id="calibre_link-1031" class="calibre4"></a>Now, let’s switch gears and talk about how we can express the full types of functions themselves.</p>

<p class="author1">Let’s revisit <code class="calibre14">sum</code> from the top of this chapter. As a reminder, it looks like this:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">sum</code><code class="p">(</code><code class="nx">a</code>: <code class="kt">number</code><code class="p">,</code> <code class="nx">b</code>: <code class="kt">number</code><code class="p">)</code><code class="o">:</code> <code class="kt">number</code> <code class="p">{</code>
  <code class="kd">return</code> <code class="nx">a</code> <code class="o">+</code> <code class="nx">b</code>
<code class="p">}</code></pre>

<p class="author1">What is the type of <code class="calibre14">sum</code>? Well, <code class="calibre14">sum</code> is a function, so its type is:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nb">Function</code></pre>

<p class="author1">The <code class="calibre14">Function</code> type, as you may have guessed, is not what you want to use most of the time. Like <code class="calibre14">object</code> describes all objects, <code class="calibre14">Function</code> is a catchall type for all functions, and doesn’t tell you anything about the specific function that it types.<a data-primary="Function type" data-type="indexterm" id="calibre_link-1023" class="calibre4"></a></p>

<p class="author1">How else can we type <code class="calibre14">sum</code>? <code class="calibre14">sum</code> is a function that takes two <code class="calibre14">numbers</code> and returns a <code class="calibre14">number</code>. In TypeScript we can express its type as:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="p">(</code><code class="nx">a</code>: <code class="kt">number</code><code class="p">,</code> <code class="nx">b</code>: <code class="kt">number</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="kt">number</code></pre>

<p class="author1">This is TypeScript’s syntax for a function’s type, or <em class="calibre5">call signature</em> (also called a <em class="calibre5">type signature</em>). You’ll notice it looks remarkably similar to an arrow function&mdash;this is intentional! When you pass functions around as arguments, or return them from other functions, this is the syntax you’ll use to type them.<a data-primary="type signatures" data-see="call signatures" data-type="indexterm" id="calibre_link-1834" class="calibre4"></a></p>
<div data-type="note" type="note" class="calibre21"><h6 class="calibre22">Note</h6>
<p class="author1">The parameter names <code class="calibre14">a</code> and <code class="calibre14">b</code> just serve as documentation, and don’t affect the assignability of a function with that type.</p>
</div>

<p class="author1">Function call <a data-primary="type-level code" data-type="indexterm" id="calibre_link-1592" class="calibre4"></a>signatures only contain <em class="calibre5">type-level</em> code&mdash;that is, types only, no values. That means function call signatures can express parameter types, <code class="calibre14">this</code> types (see <a data-type="xref" href="#calibre_link-81" class="calibre4">“Typing this”</a>), return types, rest types, and optional types, and they cannot express default values (since a default value is a value, not a type). And because they have no body for TypeScript to infer from, call signatures require explicit return type annotations.</p>
<aside data-type="sidebar" type="sidebar" class="keyterm"><div class="sidebar" id="calibre_link-1835">
<h5 class="calibre29">Type Level and Value Level Code</h5>
<p class="author1">People use the terms “type-level” and “value-level” a lot when talking about programming with static types, and it helps to have a common vocabulary.</p>

<p class="author1">Throughout this book, when I use the term <em class="calibre5">type-level code</em>, what I’m referring to is code that consists exclusively of types and type operators. Contrast that with <em class="calibre5">value-level code</em>, which is everything else.<a data-primary="value-level code" data-type="indexterm" id="calibre_link-1725" class="calibre4"></a> A rule of thumb is: if it’s valid JavaScript code, then it’s value-level; if it’s valid TypeScript but not valid JavaScript, then it’s type-level.<sup class="calibre15"><a data-type="noteref" href="#calibre_link-82" id="calibre_link-147" class="calibre16">4</a></sup></p>

<p class="author1">To be extra sure that we’re on the same page, let’s look at an example&mdash;the bold terms here are type-level, and everything else is value-level:</p>
<pre data-type="programlisting" class="calibre30">
<code class="kd">function</code><code class="calibre14"> </code><code class="nx">area</code><code class="p">(</code><code class="nx">radius</code><strong class="calibre49"><code class="calibre50">: </code><code class="kt1">number</code></strong><code class="p">)</code><strong class="calibre49"><code class="o1">:</code><code class="calibre50"> </code><code class="kt1">number</code><code class="calibre50"> </code><code class="o1">|</code><code class="calibre50"> </code><code class="k">null</code></strong><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="kd">if</code><code class="calibre14"> </code><code class="p">(</code><code class="nx">radius</code><code class="calibre14"> </code><code class="o">&lt;</code><code class="calibre14"> </code><code class="mi">0</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
    </code><code class="kd">return</code><code class="calibre14"> </code><code class="kd">null</code><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">
  </code><code class="kd">return</code><code class="calibre14"> </code><code class="nb">Math</code><code class="p">.</code><code class="nx">PI</code><code class="calibre14"> </code><code class="o">*</code><code class="calibre14"> </code><code class="p">(</code><code class="nx">radius</code><code class="calibre14"> </code><code class="o">*</code><code class="o">*</code><code class="calibre14"> </code><code class="mi">2</code><code class="p">)</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">

</code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">r</code><strong class="calibre49"><code class="calibre50">: </code><code class="kt1">number</code></strong><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="mi">3</code><code class="calibre14">
</code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">a</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="nx">area</code><code class="p">(</code><code class="nx">r</code><code class="p">)</code><code class="calibre14">
</code><code class="kd">if</code><code class="calibre14"> </code><code class="p">(</code><code class="nx">a</code><code class="calibre14"> </code><code class="o">!==</code><code class="calibre14"> </code><code class="kd">null</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="nx">console</code><code class="p">.</code><code class="nx">info</code><code class="p">(</code><code class="s">'result:'</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">a</code><code class="p">)</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code></pre>

<p class="author1">The bold type-level terms are type annotations and the union type operator, <code class="calibre14">|</code>; everything else is a value-level term.</p>
</div></aside>

<p class="author1">Let’s go through a few of the examples of functions we’ve seen so far in this chapter, and pull out their types into standalone call signatures that we’ll bind to type aliases:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// function greet(name: string)</code>
<code class="nx">type</code> <code class="nx">Greet</code> <code class="o">=</code> <code class="p">(</code><code class="nx">name</code>: <code class="kt">string</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="kt">string</code>

<code class="c">// function log(message: string, userId?: string)</code>
<code class="nx">type</code> <code class="nx">Log</code> <code class="o">=</code> <code class="p">(</code><code class="nx">message</code>: <code class="kt">string</code><code class="p">,</code> <code class="nx">userId?</code>: <code class="kt">string</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="kd">void</code>

<code class="c">// function sumVariadicSafe(...numbers: number[]): number</code>
<code class="nx">type</code> <code class="nx">SumVariadicSafe</code> <code class="o">=</code> <code class="p">(...</code><code class="nx">numbers</code>: <code class="kt">number</code><code class="p">[])</code> <code class="o">=&gt;</code> <code class="kt">number</code></pre>

<p class="author1">Getting the hang of it? The functions’ call signatures look remarkably similar to their implementations. This is intentional, and is a language design choice that makes call signatures easier to reason about.</p>

<p class="author1">Let’s make the relationship between call signatures and their implementations more concrete.<a data-primary="call signatures" data-secondary="implementing, example" data-type="indexterm" id="calibre_link-715" class="calibre4"></a> If you have a call signature, how can you declare a function that implements that signature? You simply combine the call signature with a function expression that implements it. For example, let’s rewrite <code class="calibre14">Log</code> to use its shiny new signature:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code><code class="calibre14"> </code><code class="nx">Log</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">(</code><code class="nx">message</code><code class="calibre14">: </code><code class="kt">string</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">userId?</code><code class="calibre14">: </code><code class="kt">string</code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="kd">void</code><code class="calibre14">

</code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">log</code><code class="calibre14">: </code><code class="kt">Log</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">(</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-83" id="calibre_link-87"><img alt="1" src="images/000000.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="nx">message</code><code class="p">,</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-84" id="calibre_link-88"><img alt="2" src="images/000001.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="nx">userId</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="s">'Not signed in'</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-85" id="calibre_link-89"><img alt="3" src="images/000002.png" class="calibre40" /></a><code class="calibre14">
</code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-86" id="calibre_link-90"><img alt="4" src="images/000003.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">time</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="kd">new</code><code class="calibre14"> </code><code class="nb">Date</code><code class="p">(</code><code class="p">)</code><code class="p">.</code><code class="nx">toISOString</code><code class="p">(</code><code class="p">)</code><code class="calibre14">
  </code><code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">time</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">message</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">userId</code><code class="p">)</code><code class="calibre14">
</code><code class="p">}</code></pre>
<dl class="preface">
<dt class="calibre18"><a class="calibre4" href="#calibre_link-87" id="calibre_link-83"><img alt="1" src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We declare a function expression <code class="calibre14">log</code>, and explicitly type it as type <code class="calibre14">Log</code>.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-88" id="calibre_link-84"><img alt="2" src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We don’t need to annotate our parameters twice. Since <code class="calibre14">message</code> is already annotated as a <code class="calibre14">string</code> as part of the definition for <code class="calibre14">Log</code>, we don’t need to type it again here. Instead, we let TypeScript infer it for us from <code class="calibre14">Log</code>.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-89" id="calibre_link-85"><img alt="3" src="images/000002.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We add a default value for <code class="calibre14">userId</code>, since we captured <code class="calibre14">userId</code>’s type in our signature for <code class="calibre14">Log</code>, but we couldn’t capture the default value as part of <code class="calibre14">Log</code> because <code class="calibre14">Log</code> is a type and can’t contain values.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-90" id="calibre_link-86"><img alt="4" src="images/000003.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We don’t need to annotate our return type again, since we already declared it as <code class="calibre14">void</code> in our <code class="calibre14">Log</code> type.<a data-primary="functions" data-secondary="declaring and invoking" data-startref="ix_funcdeccall" data-tertiary="call signatures" data-type="indexterm" id="calibre_link-1032" class="calibre4"></a><a data-primary="call signatures" data-startref="ix_callsig" data-type="indexterm" id="calibre_link-713" class="calibre4"></a></p></dd>
</dl>
</div></section>













<section data-pdf-bookmark="Contextual Typing" data-type="sect2" class="preface"><div class="preface" id="calibre_link-66">
<h2 class="calibre17">Contextual Typing</h2>

<p class="author1">Notice that the last example was the first example we’ve seen where we didn’t have to explicitly annotate our function parameter types. Because we already declared that <code class="calibre14">log</code> is of type <code class="calibre14">Log</code>, TypeScript is able to infer from context that <code class="calibre14">message</code> has to be of type <code class="calibre14">string</code>. This is a powerful feature of TypeScript’s type inference called <em class="calibre5">contextual typing</em>.<a data-primary="contextual typing" data-type="indexterm" id="calibre_link-806" class="calibre4"></a><a data-primary="functions" data-secondary="declaring and invoking" data-tertiary="contextual typing" data-type="indexterm" id="calibre_link-1033" class="calibre4"></a></p>

<p class="author1">Earlier in this chapter, we touched on one other place where contextual typing comes up: callback functions.<sup class="calibre15"><a data-type="noteref" href="#calibre_link-91" id="calibre_link-149" class="calibre16">5</a></sup></p>

<p class="author1">Let’s declare a function <code class="calibre14">times</code> that calls its callback <code class="calibre14">f</code> some number of times <code class="calibre14">n</code>, passing the current index to <code class="calibre14">f</code> each time:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">times</code><code class="p">(</code>
  <code class="nx">f</code><code class="o">:</code> <code class="p">(</code><code class="nx">index</code>: <code class="kt">number</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="kd">void</code><code class="p">,</code>
  <code class="nx">n</code>: <code class="kt">number</code>
<code class="p">)</code> <code class="p">{</code>
  <code class="kd">for</code> <code class="p">(</code><code class="kd">let</code> <code class="nx">i</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code> <code class="nx">i</code> <code class="o">&lt;</code> <code class="nx">n</code><code class="p">;</code> <code class="nx">i</code><code class="o">++</code><code class="p">)</code> <code class="p">{</code>
    <code class="nx">f</code><code class="p">(</code><code class="nx">i</code><code class="p">)</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p class="author1">When you call <code class="calibre14">times</code>, you don’t have to explicitly annotate the function you pass to <code class="calibre14">times</code> if you declare that function inline:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">times</code><code class="p">(</code><code class="nx">n</code> <code class="o">=&gt;</code> <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">n</code><code class="p">),</code> <code class="mi">4</code><code class="p">)</code></pre>

<p class="author1">TypeScript infers from context that <code class="calibre14">n</code> is a <code class="calibre14">number</code>&mdash;we declared that <code class="calibre14">f</code>’s argument <code class="calibre14">index</code> is a <code class="calibre14">number</code> in <code class="calibre14">times</code>’s signature, and TypeScript is smart enough to infer that <code class="calibre14">n</code> is that argument, so it must be a <code class="calibre14">number</code>.</p>

<p class="author1">Note that if <a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS7006" data-type="indexterm" id="calibre_link-958" class="calibre4"></a>we didn’t declare <code class="calibre14">f</code> inline, TypeScript wouldn’t have been able to infer its type:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">f</code><code class="p">(</code><code class="nx">n</code><code class="p">)</code> <code class="p">{</code> <code class="c">// Error TS7006: Parameter 'n' implicitly has an 'any' type.</code>
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">n</code><code class="p">)</code>
<code class="p">}</code>

<code class="nx">times</code><code class="p">(</code><code class="nx">f</code><code class="p">,</code> <code class="mi">4</code><code class="p">)</code></pre>
</div></section>













<section data-pdf-bookmark="Overloaded Function Types" data-type="sect2" class="preface"><div class="preface" id="calibre_link-142">
<h2 class="calibre17">Overloaded Function Types</h2>

<p class="author1">The function type syntax we used in the last section&mdash;<code class="calibre14">type Fn = (...) =&gt; ...</code>&mdash;is a <em class="calibre5">shorthand call signature</em>. <a data-primary="overloaded function types" data-type="indexterm" id="calibre_link-1334" class="calibre4"></a><a data-primary="functions" data-secondary="declaring and invoking" data-tertiary="overloaded function types" data-type="indexterm" id="calibre_link-1041" class="calibre4"></a><a data-primary="shorthand call signatures" data-type="indexterm" id="calibre_link-1438" class="calibre4"></a><a data-primary="call signatures" data-secondary="shorthand  versus written out fully" data-type="indexterm" id="calibre_link-719" class="calibre4"></a>We can instead write it out more explicitly. Again taking the example of <code class="calibre14">Log</code>:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// Shorthand call signature</code>
<code class="nx">type</code> <code class="nx">Log</code> <code class="o">=</code> <code class="p">(</code><code class="nx">message</code>: <code class="kt">string</code><code class="p">,</code> <code class="nx">userId?</code>: <code class="kt">string</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="kd">void</code>

<code class="c">// Full call signature</code>
<code class="nx">type</code> <code class="nx">Log</code> <code class="o">=</code> <code class="p">{</code>
  <code class="p">(</code><code class="nx">message</code>: <code class="kt">string</code><code class="p">,</code> <code class="nx">userId?</code>: <code class="kt">string</code><code class="p">)</code><code class="o">:</code> <code class="kd">void</code>
<code class="p">}</code></pre>

<p class="author1">The two are completely equivalent in every way, and differ only in syntax.</p>

<p class="author1">Would you ever want to use a full call signature over the shorthand? For simple cases like our <code class="calibre14">Log</code> function, you should prefer the shorthand; but for more complicated functions, there are a few good use cases for full signatures.<a data-primary="call signatures" data-secondary="overloaded" data-type="indexterm" id="calibre_link-717" class="calibre4"></a></p>

<p class="author1">The first of these is <em class="calibre5">overloading</em> a function type. But first, what does it even mean to overload a function?</p>
<aside class="keyterm" data-type="sidebar" type="sidebar"><div class="sidebar" id="calibre_link-1836">
<h5 class="calibre29">Overloaded function</h5>
<p class="author1">A function with multiple call signatures.</p>
</div></aside>

<p class="author1">In most programming languages, once you declare a function that takes some set of parameters and yields some return type, you can call that function with exactly that set of parameters, and you will always get that same return type back. Not so in JavaScript. Because JavaScript is such a dynamic language, it’s a common pattern for there to be multiple ways to call a given function; not only that, but sometimes the output type will actually depend on the input type for an argument!</p>

<p class="author1">TypeScript models this dynamism&mdash;overloaded function declarations, and a function’s output type depending on its input type&mdash;with its static type system. We might take this language feature for granted, but it’s a really advanced feature for a type system to have!</p>

<p class="author1">You can use overloaded function signatures to design really expressive APIs. For example, let’s design an API to book a vacation&mdash;we’ll call it <code class="calibre14">Reserve</code>. Let’s start by sketching out its types (with a full type signature this time):</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">Reserve</code> <code class="o">=</code> <code class="p">{</code>
  <code class="p">(</code><code class="nx">from</code>: <code class="kt">Date</code><code class="p">,</code> <code class="nx">to</code>: <code class="kt">Date</code><code class="p">,</code> <code class="nx">destination</code>: <code class="kt">string</code><code class="p">)</code><code class="o">:</code> <code class="nx">Reservation</code>
<code class="p">}</code></pre>

<p class="author1">Let’s then stub out an implementation for <code class="calibre14">Reserve</code>:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">reserve</code>: <code class="kt">Reserve</code> <code class="o">=</code> <code class="p">(</code><code class="nx">from</code><code class="p">,</code> <code class="nx">to</code><code class="p">,</code> <code class="nx">destination</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
  <code class="c">// ...</code>
<code class="p">}</code></pre>

<p class="author1">So a user who wants to book a trip to Bali has to call our <code class="calibre14">reserve</code> API with a <code class="calibre14">from</code> date, a <code class="calibre14">to</code> date, and <code class="calibre14">"Bali"</code> as a destination.</p>

<p class="author1">We might repurpose our API to support one-way trips too:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">Reserve</code> <code class="o">=</code> <code class="p">{</code>
  <code class="p">(</code><code class="nx">from</code>: <code class="kt">Date</code><code class="p">,</code> <code class="nx">to</code>: <code class="kt">Date</code><code class="p">,</code> <code class="nx">destination</code>: <code class="kt">string</code><code class="p">)</code><code class="o">:</code> <code class="nx">Reservation</code>
  <code class="p">(</code><code class="nx">from</code>: <code class="kt">Date</code><code class="p">,</code> <code class="nx">destination</code>: <code class="kt">string</code><code class="p">)</code><code class="o">:</code> <code class="nx">Reservation</code>
<code class="p">}</code></pre>

<p class="author1">You’ll notice that when you try to run this code, TypeScript will give you an error at the point where you implement <code class="calibre14">Reserve</code> (see <a data-type="xref" href="#calibre_link-92" class="calibre4">Figure&nbsp;4-3</a>).</p>

<figure class="width"><div class="figure" id="calibre_link-92">
<img alt="prts 0403" src="images/000015.png" class="calibre40" />
<h6 class="calibre34"><span class="calibre">Figure 4-3. </span>TypeError when missing a combined overload signature</h6>
</div></figure>

<p class="author1">This is because of the way call signature overloading works in TypeScript. If you declare a set of overload signatures for a function <code class="calibre14">f</code>, from a caller’s point of view <code class="calibre14">f</code>’s type is the union of those overload signatures. But from <code class="calibre14">f</code>’s <em class="calibre5">implementation’s</em> point of view, there needs to be a single, combined type that can actually be implemented. You need to manually declare this combined call signature when implementing <code class="calibre14">f</code>&mdash;it won’t be inferred for you. For our <code class="calibre14">Reserve</code> example, we can update our <code class="calibre14">reserve</code> function like this:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code><code class="calibre14"> </code><code class="nx">Reserve</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="p">(</code><code class="nx">from</code><code class="calibre14">: </code><code class="kt">Date</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">to</code><code class="calibre14">: </code><code class="kt">Date</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">destination</code><code class="calibre14">: </code><code class="kt">string</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">Reservation</code><code class="calibre14">
  </code><code class="p">(</code><code class="nx">from</code><code class="calibre14">: </code><code class="kt">Date</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">destination</code><code class="calibre14">: </code><code class="kt">string</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">Reservation</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-93" id="calibre_link-95"><img alt="1" src="images/000000.png" class="calibre40" /></a><code class="calibre14">

</code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">reserve</code><code class="calibre14">: </code><code class="kt">Reserve</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">(</code><code class="calibre14">
  </code><code class="nx">from</code><code class="calibre14">: </code><code class="kt">Date</code><code class="p">,</code><code class="calibre14">
  </code><code class="nx">toOrDestination</code><code class="calibre14">: </code><code class="kt">Date</code><code class="calibre14"> </code><code class="o">|</code><code class="calibre14"> </code><code class="kt">string</code><code class="p">,</code><code class="calibre14">
  </code><code class="nx">destination?</code><code class="calibre14">: </code><code class="kt">string</code><code class="calibre14">
</code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-94" id="calibre_link-96"><img alt="2" src="images/000001.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="c">// ...
</code><code class="p">}</code></pre>
<dl class="preface">
<dt class="calibre18"><a class="calibre4" href="#calibre_link-95" id="calibre_link-93"><img alt="1" src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We declare two overloaded function signatures.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-96" id="calibre_link-94"><img alt="2" src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">The implementation’s signature is the result of us manually combining the two overload signatures (in other words, we computed <code class="calibre14">Signature1 | Signature2</code> by hand). Note that the combined signature isn’t visible to functions that call <code class="calibre14">reserve</code>; from a consumer’s point of view, <code class="calibre14">Reserve</code>’s signature is:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">Reserve</code> <code class="o">=</code> <code class="p">{</code>
  <code class="p">(</code><code class="nx">from</code>: <code class="kt">Date</code><code class="p">,</code> <code class="nx">to</code>: <code class="kt">Date</code><code class="p">,</code> <code class="nx">destination</code>: <code class="kt">string</code><code class="p">)</code><code class="o">:</code> <code class="nx">Reservation</code>
  <code class="p">(</code><code class="nx">from</code>: <code class="kt">Date</code><code class="p">,</code> <code class="nx">destination</code>: <code class="kt">string</code><code class="p">)</code><code class="o">:</code> <code class="nx">Reservation</code>
<code class="p">}</code></pre>

<p class="author1">Notably, this doesn’t include the combined signature we created:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// Wrong!</code>
<code class="nx">type</code> <code class="nx">Reserve</code> <code class="o">=</code> <code class="p">{</code>
  <code class="p">(</code><code class="nx">from</code>: <code class="kt">Date</code><code class="p">,</code> <code class="nx">to</code>: <code class="kt">Date</code><code class="p">,</code> <code class="nx">destination</code>: <code class="kt">string</code><code class="p">)</code><code class="o">:</code> <code class="nx">Reservation</code>
  <code class="p">(</code><code class="nx">from</code>: <code class="kt">Date</code><code class="p">,</code> <code class="nx">destination</code>: <code class="kt">string</code><code class="p">)</code><code class="o">:</code> <code class="nx">Reservation</code>
  <code class="p">(</code><code class="nx">from</code>: <code class="kt">Date</code><code class="p">,</code> <code class="nx">toOrDestination</code>: <code class="kt">Date</code> <code class="o">|</code> <code class="kt">string</code><code class="p">,</code>
    <code class="nx">destination?</code>: <code class="kt">string</code><code class="p">)</code><code class="o">:</code> <code class="nx">Reservation</code>
<code class="p">}</code></pre></dd>
</dl>

<p class="author1">Since <code class="calibre14">reserve</code> might be called in either of two ways, when you implement <code class="calibre14">reserve</code> you have to prove to TypeScript that you checked how it was called:<sup class="calibre15"><a data-type="noteref" href="#calibre_link-97" id="calibre_link-150" class="calibre16">6</a></sup></p>

<pre data-code-language="js" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">reserve</code><code class="o">:</code> <code class="nx">Reserve</code> <code class="o">=</code> <code class="p">(</code>
  <code class="nx">from</code><code class="o">:</code> <code class="nb">Date</code><code class="p">,</code>
  <code class="nx">toOrDestination</code><code class="o">:</code> <code class="nb">Date</code> <code class="o">|</code> <code class="nx">string</code><code class="p">,</code>
  <code class="nx">destination</code><code class="o">?:</code> <code class="nx">string</code>
<code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
  <code class="kd">if</code> <code class="p">(</code><code class="nx">toOrDestination</code> <code class="kd">instanceof</code> <code class="nb">Date</code> <code class="o">&amp;&amp;</code> <code class="nx">destination</code> <code class="o">!==</code> <code class="kd">undefined</code><code class="p">)</code> <code class="p">{</code>
    <code class="c">// Book a one-way trip</code>
  <code class="p">}</code> <code class="kd">else</code> <code class="kd">if</code> <code class="p">(</code><code class="kd">typeof</code> <code class="nx">toOrDestination</code> <code class="o">===</code> <code class="s">'string'</code><code class="p">)</code> <code class="p">{</code>
    <code class="c">// Book a round trip</code>
  <code class="p">}</code>
<code class="p">}</code></pre>
<aside data-type="sidebar" type="sidebar" class="keyterm"><div class="sidebar" id="calibre_link-1837">
<h5 class="calibre29">Keeping Overload Signatures Specific</h5>
<p class="author1">In general, each overload signature (e.g., <code class="calibre14">Reserve</code>) has to be assignable to the implementation’s signature (e.g., <code class="calibre14">reserve</code>) when declaring an overloaded function type.<a data-primary="overloaded function types" data-secondary="keeping overload signatures specific" data-type="indexterm" id="calibre_link-1337" class="calibre4"></a> That means you can be overly general when declaring the implementation’s signature, so long as all of your overloads are assignable to it. For example, this works:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">reserve</code>: <code class="kt">Reserve</code> <code class="o">=</code> <code class="p">(</code>
  <code class="nx">from</code>: <code class="kt">any</code><code class="p">,</code>
  <code class="nx">toOrDestination</code>: <code class="kt">any</code><code class="p">,</code>
  <code class="nx">destination?</code>: <code class="kt">any</code>
<code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
  <code class="c">// ...</code>
<code class="p">}</code></pre>

<p class="author1">When using overloads, try to keep your implementation’s signature as specific as possible to make it easier to implement the function. That means preferring <code class="calibre14">Date</code> over <code class="calibre14">any</code>, and a union of <code class="calibre14">Date | string</code> over <code class="calibre14">any</code> in our example.</p>

<p class="author1">Why does keeping types narrow make it easier to implement a function with a given signature?<a data-primary="any type" data-secondary="as overloaded function parameter type" data-type="indexterm" id="calibre_link-626" class="calibre4"></a> If you type a parameter as <code class="calibre14">any</code> and want to use it as a <code class="calibre14">Date</code>, you have to prove to TypeScript that it’s actually a date:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">getMonth</code><code class="p">(</code><code class="nx">date</code>: <code class="kt">any</code><code class="p">)</code><code class="o">:</code> <code class="kt">number</code> <code class="o">|</code> <code class="kd">undefined</code> <code class="p">{</code>
  <code class="kd">if</code> <code class="p">(</code><code class="nx">date</code> <code class="kd">instanceof</code> <code class="nb">Date</code><code class="p">)</code> <code class="p">{</code>
    <code class="kd">return</code> <code class="nx">date</code><code class="p">.</code><code class="nx">getMonth</code><code class="p">()</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p class="author1">But if you typed the parameter as a <code class="calibre14">Date</code> upfront, you don’t need to do extra work in the implementation:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">getMonth</code><code class="p">(</code><code class="nx">date</code>: <code class="kt">Date</code><code class="p">)</code><code class="o">:</code> <code class="kt">number</code> <code class="p">{</code>
  <code class="kd">return</code> <code class="nx">date</code><code class="p">.</code><code class="nx">getMonth</code><code class="p">()</code>
<code class="p">}</code></pre>
</div></aside>

<p class="author1">Overloads come up naturally in browser DOM APIs. <a data-primary="DOM (Document Object Model)" data-secondary="overloads in browser DOM APIs" data-type="indexterm" id="calibre_link-853" class="calibre4"></a><a data-primary="browsers" data-secondary="overloads in browser DOM APIs" data-type="indexterm" id="calibre_link-700" class="calibre4"></a><a data-primary="createElement DOM API" data-type="indexterm" id="calibre_link-813" class="calibre4"></a>The <code class="calibre14">createElement</code> DOM API, for example, is used to create a new HTML element. It takes a string corresponding to an HTML tag and returns a new HTML element of that tag’s type. TypeScript comes with built-in types for each HTML element. These include:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1"><code class="calibre14">HTMLAnchorElement</code> for <code class="calibre14">&lt;a&gt;</code> elements</p>
</li>
<li class="calibre11">
<p class="author1"><code class="calibre14">HTMLCanvasElement</code> for <code class="calibre14">&lt;canvas&gt;</code> elements</p>
</li>
<li class="calibre11">
<p class="author1"><code class="calibre14">HTMLTableElement</code> for <code class="calibre14">&lt;table&gt;</code> elements</p>
</li>
</ul>

<p class="author1">Overloaded call signatures are a natural way to model how <code class="calibre14">createElement</code> works. Think about how you might type <code class="calibre14">createElement</code> (try to answer this by yourself before you read on!).</p>

<p class="author1">The answer:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code><code class="calibre14"> </code><code class="nx">CreateElement</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="p">(</code><code class="nx">tag</code><code class="o">:</code><code class="calibre14"> </code><code class="s">'a'</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">HTMLAnchorElement</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-98" id="calibre_link-101"><img alt="1" src="images/000000.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="p">(</code><code class="nx">tag</code><code class="o">:</code><code class="calibre14"> </code><code class="s">'canvas'</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">HTMLCanvasElement</code><code class="calibre14">
  </code><code class="p">(</code><code class="nx">tag</code><code class="o">:</code><code class="calibre14"> </code><code class="s">'table'</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">HTMLTableElement</code><code class="calibre14">
  </code><code class="p">(</code><code class="nx">tag</code><code class="calibre14">: </code><code class="kt">string</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">HTMLElement</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-99" id="calibre_link-102"><img alt="2" src="images/000001.png" class="calibre40" /></a><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">

</code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">createElement</code><code class="calibre14">: </code><code class="kt">CreateElement</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">(</code><code class="nx">tag</code><code class="calibre14">: </code><code class="kt">string</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">HTMLElement</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-100" id="calibre_link-104"><img alt="3" src="images/000002.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="c">// ...
</code><code class="p">}</code></pre>
<dl class="preface">
<dt class="calibre18"><a class="calibre4" href="#calibre_link-101" id="calibre_link-98"><img alt="1" src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We overload on the parameter’s type, matching on it with string literal types.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-102" id="calibre_link-99"><img alt="2" src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We add a catchall case: if the user passed a custom tag name, or a cutting-edge experimental tag name that hasn’t made its way into TypeScript’s built-in type declarations yet, we return a generic <code class="calibre14">HTMLElement</code>. Since TypeScript resolves overloads in the order they were declared,<sup class="calibre15"><a data-type="noteref" href="#calibre_link-103" id="calibre_link-151" class="calibre16">7</a></sup> when you call <code class="calibre14">createElement</code> with a string that doesn’t have a specific overload defined (e.g., <code class="calibre14">createElement('foo')</code>), TypeScript will fall back to <code class="calibre14">HTMLElement</code>.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-104" id="calibre_link-100"><img alt="3" src="images/000002.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">To type the implementation’s parameter, we combine all the types that parameter might have in <code class="calibre14">createElement</code>’s overload signatures, resulting in <code class="calibre14">'a' | 'canvas' | 'table' | string</code>. Since the three string literal types are all subtypes of <code class="calibre14">string</code>, the type reduces to just <code class="calibre14">string</code>.</p></dd>
</dl>
<div data-type="note" type="note" class="calibre21"><h6 class="calibre22">Note</h6>
<p class="author1">In all of the examples in this section we overloaded function expressions. But what if we want to overload a function declaration? As always, TypeScript has your back, with an equivalent syntax for function declarations. Let’s rewrite our <code class="calibre14">createElement</code> overloads:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre43"><code class="kd">function</code> <code class="nx">createElement</code><code class="p">(</code><code class="nx">tag</code><code class="o">:</code> <code class="s">'a'</code><code class="p">)</code><code class="o">:</code> <code class="nx">HTMLAnchorElement</code>
<code class="kd">function</code> <code class="nx">createElement</code><code class="p">(</code><code class="nx">tag</code><code class="o">:</code> <code class="s">'canvas'</code><code class="p">)</code><code class="o">:</code> <code class="nx">HTMLCanvasElement</code>
<code class="kd">function</code> <code class="nx">createElement</code><code class="p">(</code><code class="nx">tag</code><code class="o">:</code> <code class="s">'table'</code><code class="p">)</code><code class="o">:</code> <code class="nx">HTMLTableElement</code>
<code class="kd">function</code> <code class="nx">createElement</code><code class="p">(</code><code class="nx">tag</code>: <code class="kt">string</code><code class="p">)</code><code class="o">:</code> <code class="nx">HTMLElement</code> <code class="p">{</code>
  <code class="c">// ...</code>
<code class="p">}</code></pre>

<p class="author1">Which syntax you use is up to you, and depends on what kind of function you’re overloading (function expression or function <span class="calibre">declarations</span>).</p>
</div>

<p class="author1">Full type signatures aren’t limited to overloading how you call a function. You can also use them to model properties on functions.<a data-primary="properties" data-secondary="function, modeling with full call signatures" data-type="indexterm" id="calibre_link-1387" class="calibre4"></a> Since JavaScript functions are just callable objects, you can assign properties to them to do things like:</p>

<pre data-code-language="js" data-type="programlisting" id="calibre_link-1838" class="calibre30"><code class="kd">function</code> <code class="nx">warnUser</code><code class="p">(</code><code class="nx">warning</code><code class="p">)</code> <code class="p">{</code>
  <code class="kd">if</code> <code class="p">(</code><code class="nx">warnUser</code><code class="p">.</code><code class="nx">wasCalled</code><code class="p">)</code> <code class="p">{</code>
    <code class="kd">return</code>
  <code class="p">}</code>
  <code class="nx">warnUser</code><code class="p">.</code><code class="nx">wasCalled</code> <code class="o">=</code> <code class="kd">true</code>
  <code class="nx">alert</code><code class="p">(</code><code class="nx">warning</code><code class="p">)</code>
<code class="p">}</code>
<code class="nx">warnUser</code><code class="p">.</code><code class="nx">wasCalled</code> <code class="o">=</code> <code class="kd">false</code></pre>

<p class="author1">That is, we show the user a warning, and we don’t show a warning more than once. Let’s use TypeScript to type <code class="calibre14">warnUser</code>’s full signature:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">WarnUser</code> <code class="o">=</code> <code class="p">{</code>
  <code class="p">(</code><code class="nx">warning</code>: <code class="kt">string</code><code class="p">)</code><code class="o">:</code> <code class="kd">void</code>
  <code class="nx">wasCalled</code>: <code class="kt">boolean</code>
<code class="p">}</code></pre>

<p class="author1">We can then rewrite <code class="calibre14">warnUser</code> as a function expression that implements that signature:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">warnUser</code>: <code class="kt">WarnUser</code> <code class="o">=</code> <code class="p">(</code><code class="nx">warning</code>: <code class="kt">string</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
  <code class="kd">if</code> <code class="p">(</code><code class="nx">warnUser</code><code class="p">.</code><code class="nx">wasCalled</code><code class="p">)</code> <code class="p">{</code>
    <code class="kd">return</code>
  <code class="p">}</code>
  <code class="nx">warnUser</code><code class="p">.</code><code class="nx">wasCalled</code> <code class="o">=</code> <code class="kd">true</code>
  <code class="nx">alert</code><code class="p">(</code><code class="nx">warning</code><code class="p">)</code>
<code class="p">}</code>
<code class="nx">warnUser</code><code class="p">.</code><code class="nx">wasCalled</code> <code class="o">=</code> <code class="kd">false</code></pre>

<p class="author1">Note that TypeScript is smart enough to realize that though we didn’t assign <code class="calibre14"><span class="calibre">wasCalled</span></code> to <code class="calibre14">warnUser</code> when we declared the <code class="calibre14">warnUser</code> function, we did assign <code class="calibre14"><span class="calibre">wasCalled</span></code> to it right after.<a data-primary="overloaded function types" data-startref="ix_ovrfunc" data-type="indexterm" id="calibre_link-1335" class="calibre4"></a><a data-primary="call signatures" data-secondary="overloaded" data-startref="ix_callsigovr" data-type="indexterm" id="calibre_link-718" class="calibre4"></a><a data-primary="functions" data-secondary="declaring and invoking" data-startref="ix_funcdecovr" data-tertiary="overloaded function types" data-type="indexterm" id="calibre_link-1042" class="calibre4"></a><a data-primary="functions" data-secondary="declaring and invoking" data-startref="ix_funcdec" data-type="indexterm" id="calibre_link-1030" class="calibre4"></a></p>
</div></section>





</div></section>













<section data-pdf-bookmark="Polymorphism" data-type="sect1" class="preface"><div class="preface" id="calibre_link-6">
<h1 class="calibre13">Polymorphism</h1>

<p class="author1">So far in this book, we’ve been talking about the hows and whys of concrete types, and functions that use concrete types.<a data-primary="polymorphism" data-type="indexterm" id="calibre_link-1354" class="calibre4"></a><a data-primary="functions" data-secondary="polymorphism" data-type="indexterm" id="calibre_link-1050" class="calibre4"></a> What’s a <em class="calibre5">concrete type</em>? <a data-primary="concrete types" data-type="indexterm" id="calibre_link-782" class="calibre4"></a>It so happens that every type we’ve seen so far is concrete:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1"><code class="calibre14">boolean</code></p>
</li>
<li class="calibre11">
<p class="author1"><code class="calibre14">string</code></p>
</li>
<li class="calibre11">
<p class="author1"><code class="calibre14">Date[]</code></p>
</li>
<li class="calibre11">
<p class="author1"><code class="calibre14">{a: number} | {b: string}</code></p>
</li>
<li class="calibre11">
<p class="author1"><code class="calibre14">(numbers: number[]) =&gt; number</code></p>
</li>
</ul>

<p class="author1">Concrete types are useful when you know precisely what type you’re expecting, and want to verify that type was actually passed. But sometimes, you don’t know what type to expect beforehand, and you don’t want to restrict your function’s behavior to a specific type!</p>

<p class="author1">As an example of what I mean, let’s implement <code class="calibre14">filter</code>. You use <code class="calibre14">filter</code> to iterate over an array and refine it; in JavaScript, it might look like this:</p>

<pre data-code-language="js" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">filter</code><code class="p">(</code><code class="nx">array</code><code class="p">,</code> <code class="nx">f</code><code class="p">)</code> <code class="p">{</code>
  <code class="kd">let</code> <code class="nx">result</code> <code class="o">=</code> <code class="p">[]</code>
  <code class="kd">for</code> <code class="p">(</code><code class="kd">let</code> <code class="nx">i</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code> <code class="nx">i</code> <code class="o">&lt;</code> <code class="nx">array</code><code class="p">.</code><code class="nx">length</code><code class="p">;</code> <code class="nx">i</code><code class="o">++</code><code class="p">)</code> <code class="p">{</code>
    <code class="kd">let</code> <code class="nx">item</code> <code class="o">=</code> <code class="nx">array</code><code class="p">[</code><code class="nx">i</code><code class="p">]</code>
    <code class="kd">if</code> <code class="p">(</code><code class="nx">f</code><code class="p">(</code><code class="nx">item</code><code class="p">))</code> <code class="p">{</code>
      <code class="nx">result</code><code class="p">.</code><code class="nx">push</code><code class="p">(</code><code class="nx">item</code><code class="p">)</code>
    <code class="p">}</code>
  <code class="p">}</code>
  <code class="kd">return</code> <code class="nx">result</code>
<code class="p">}</code>

<code class="nx">filter</code><code class="p">([</code><code class="mi">1</code><code class="p">,</code> <code class="mi">2</code><code class="p">,</code> <code class="mi">3</code><code class="p">,</code> <code class="mi">4</code><code class="p">],</code> <code class="nx">_</code> <code class="o">=&gt;</code> <code class="nx">_</code> <code class="o">&lt;</code> <code class="mi">3</code><code class="p">)</code> <code class="c">// evaluates to [1, 2]</code></pre>

<p class="author1">Let’s start by pulling out <code class="calibre14">filter</code>’s full type signature, and adding some placeholder <code class="calibre14">unknown</code>s for the types:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">Filter</code> <code class="o">=</code> <code class="p">{</code>
  <code class="p">(</code><code class="nx">array</code>: <code class="kt">unknown</code><code class="p">,</code> <code class="nx">f</code>: <code class="kt">unknown</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="nx">unknown</code><code class="p">[]</code>
<code class="p">}</code></pre>

<p class="author1">Now, let’s try to fill in the types with, say, <code class="calibre14">number</code>:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<code class="nx">type</code><code class="calibre14"> </code><code class="nx">Filter</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="p">(</code><code class="nx">array</code><code class="calibre14">: </code><strong class="calibre49"><code class="kt1">number</code><code class="p1">[</code><code class="p1">]</code></strong><code class="p">,</code><code class="calibre14"> </code><code class="nx">f</code><code class="o">:</code><code class="calibre14"> </code><strong class="calibre49"><code class="p1">(</code><code class="nx1">item</code><code class="calibre50">: </code><code class="kt1">number</code><code class="p1">)</code><code class="calibre50"> </code><code class="o1">=</code><code class="o1">&gt;</code><code class="calibre50"> </code><code class="k">boolean</code></strong><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><strong class="calibre49"><code class="kt1">number</code><code class="p1">[</code><code class="p1">]</code></strong><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code></pre>

<p class="author1">Typing the array’s<a data-primary="arrays" data-secondary="filtering" data-type="indexterm" id="calibre_link-647" class="calibre4"></a> elements as <code class="calibre14">number</code> works well for this example, but <code class="calibre14">filter</code> is meant to be a generic function&mdash;you can filter arrays of numbers, strings, objects, other arrays, anything. The signature we wrote works for arrays of numbers, but it doesn’t work for arrays of other types of elements.<a data-primary="strings" data-secondary="filtering arrays of" data-type="indexterm" id="calibre_link-1454" class="calibre4"></a><a data-primary="overloaded function types" data-secondary="filter function" data-type="indexterm" id="calibre_link-1336" class="calibre4"></a> Let’s try to use an overload to extend it to work on arrays of strings too:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<code class="nx">type</code><code class="calibre14"> </code><code class="nx">Filter</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="p">(</code><code class="nx">array</code><code class="calibre14">: </code><code class="kt">number</code><code class="p">[</code><code class="p">]</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">f</code><code class="o">:</code><code class="calibre14"> </code><code class="p">(</code><code class="nx">item</code><code class="calibre14">: </code><code class="kt">number</code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="kd">boolean</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="kt">number</code><code class="p">[</code><code class="p">]</code><code class="calibre14">
  </code><strong class="calibre49"><code class="p1">(</code><code class="nx1">array</code><code class="calibre50">: </code><code class="kt1">string</code><code class="p1">[</code><code class="p1">]</code><code class="p1">,</code><code class="calibre50"> </code><code class="nx1">f</code><code class="o1">:</code><code class="calibre50"> </code><code class="p1">(</code><code class="nx1">item</code><code class="calibre50">: </code><code class="kt1">string</code><code class="p1">)</code><code class="calibre50"> </code><code class="o1">=</code><code class="o1">&gt;</code><code class="calibre50"> </code><code class="k">boolean</code><code class="p1">)</code><code class="o1">:</code><code class="calibre50"> </code><code class="kt1">string</code><code class="p1">[</code><code class="p1">]</code></strong><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code></pre>

<p class="author1">So far so good (though it might get messy to write out an overload for every type). <a data-primary="objects" data-secondary="filtering arrays of" data-type="indexterm" id="calibre_link-1311" class="calibre4"></a>What about arrays of objects?</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<code class="nx">type</code><code class="calibre14"> </code><code class="nx">Filter</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="p">(</code><code class="nx">array</code><code class="calibre14">: </code><code class="kt">number</code><code class="p">[</code><code class="p">]</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">f</code><code class="o">:</code><code class="calibre14"> </code><code class="p">(</code><code class="nx">item</code><code class="calibre14">: </code><code class="kt">number</code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="kd">boolean</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="kt">number</code><code class="p">[</code><code class="p">]</code><code class="calibre14">
  </code><code class="p">(</code><code class="nx">array</code><code class="calibre14">: </code><code class="kt">string</code><code class="p">[</code><code class="p">]</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">f</code><code class="o">:</code><code class="calibre14"> </code><code class="p">(</code><code class="nx">item</code><code class="calibre14">: </code><code class="kt">string</code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="kd">boolean</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="kt">string</code><code class="p">[</code><code class="p">]</code><code class="calibre14">
  </code><strong class="calibre49"><code class="p1">(</code><code class="nx1">array</code><code class="calibre50">: </code><code class="kt1">object</code><code class="p1">[</code><code class="p1">]</code><code class="p1">,</code><code class="calibre50"> </code><code class="nx1">f</code><code class="o1">:</code><code class="calibre50"> </code><code class="p1">(</code><code class="nx1">item</code><code class="calibre50">: </code><code class="kt1">object</code><code class="p1">)</code><code class="calibre50"> </code><code class="o1">=</code><code class="o1">&gt;</code><code class="calibre50"> </code><code class="k">boolean</code><code class="p1">)</code><code class="o1">:</code><code class="calibre50"> </code><code class="nx1">object</code><code class="p1">[</code><code class="p1">]</code></strong><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code></pre>

<p class="author1">This might look fine at first glance, but let’s try to use it to see where it breaks down. If you implement a <code class="calibre14">filter</code> function with that signature (that is, <code class="calibre14">filter: Filter</code>), and try to use it, you’ll get:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">names</code> <code class="o">=</code> <code class="p">[</code>
  <code class="p">{</code><code class="nx">firstName</code><code class="o">:</code> <code class="s">'beth'</code><code class="p">},</code>
  <code class="p">{</code><code class="nx">firstName</code><code class="o">:</code> <code class="s">'caitlyn'</code><code class="p">},</code>
  <code class="p">{</code><code class="nx">firstName</code><code class="o">:</code> <code class="s">'xin'</code><code class="p">}</code>
<code class="p">]</code>

<code class="kd">let</code> <code class="nx">result</code> <code class="o">=</code> <code class="nx">filter</code><code class="p">(</code>
  <code class="nx">names</code><code class="p">,</code>
  <code class="nx">_</code> <code class="o">=&gt;</code> <code class="nx">_</code><code class="p">.</code><code class="nx">firstName</code><code class="p">.</code><code class="nx">startsWith</code><code class="p">(</code><code class="s">'b'</code><code class="p">)</code>
<code class="p">)</code> <code class="c">// Error TS2339: Property 'firstName' does not exist on type 'object'.</code>

<code class="nx">result</code><code class="p">[</code><code class="mi">0</code><code class="p">].</code><code class="nx">firstName</code> <code class="c">// Error TS2339: Property 'firstName' does not exist</code>
                    <code class="c">// on type 'object'.</code></pre>

<p class="author1">At this point, it should make sense why TypeScript is throwing this error. We told TypeScript <a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2339" data-type="indexterm" id="calibre_link-913" class="calibre4"></a>that we might pass an array of numbers, strings, or objects to <code class="calibre14">filter</code>. We passed an array of objects, but remember that <code class="calibre14">object</code> doesn’t tell you anything about the shape of the object. So each time we try to access a property on an object in the array, TypeScript throws an error, because we didn’t tell it what specific shape the object has.</p>

<p class="author1">What to do?</p>

<p class="author1">If you come from a language that supports generic types, then by now you are rolling your eyes and shouting, “THAT’S WHAT GENERICS ARE FOR!” The good news is, you’re spot on (the bad news is, you just woke up the neighbors’ kid with your <span class="calibre">shouting</span>).<a data-primary="polymorphism" data-secondary="generic type parameters" data-type="indexterm" id="calibre_link-1368" class="calibre4"></a></p>

<p class="author1">In case you haven’t worked with generic types before, I’ll define them first, then give an example with our <code class="calibre14">filter</code> function.</p>
<aside class="keyterm" data-type="sidebar" type="sidebar"><div class="sidebar" id="calibre_link-1839">
<h5 class="calibre29">Generic type parameter</h5>
<p class="author1">A placeholder type used to enforce a type-level constraint in multiple places. Also known as <em class="calibre5">polymorphic type parameter</em>.<a data-primary="generic type parameters" data-seealso="generic types; generics" data-type="indexterm" id="calibre_link-1060" class="calibre4"></a><a data-primary="parameters" data-secondary="generic type" data-type="indexterm" id="calibre_link-1342" class="calibre4"></a></p>
</div></aside>

<p class="author1">Going back to our <code class="calibre14">filter</code> example, here is what its type looks like when we rewrite it with a generic type parameter <code class="calibre14">T</code>:</p>
<pre data-type="programlisting" class="calibre30">
<code class="nx">type</code><code class="calibre14"> </code><code class="nx">Filter</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><strong class="calibre49"><code class="o1">&lt;</code><code class="nx1">T</code><code class="o1">&gt;</code></strong><code class="p">(</code><code class="nx">array</code><code class="calibre14">: </code><strong class="calibre49"><code class="kt1">T</code></strong><code class="p">[</code><code class="p">]</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">f</code><code class="o">:</code><code class="calibre14"> </code><code class="p">(</code><code class="nx">item</code><code class="calibre14">: </code><strong class="calibre49"><code class="kt1">T</code></strong><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="kt">boolean</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><strong class="calibre49"><code class="nx1">T</code></strong><code class="p">[</code><code class="p">]</code><code class="calibre14">
</code><code class="p">}</code>
</pre>

<p class="author1">What we’ve done here is say: “This function <code class="calibre14">filter</code> uses a generic type parameter <code class="calibre14">T</code>; we don’t know what this type will be ahead of time, so TypeScript if you can infer what it is each time we call <code class="calibre14">filter</code> that would be swell.” TypeScript infers <code class="calibre14">T</code> from the type we pass in for <code class="calibre14">array</code>. Once TypeScript infers what <code class="calibre14">T</code> is for a given call to <code class="calibre14">filter</code>, it substitutes that type in for every <code class="calibre14">T</code> it sees. <code class="calibre14">T</code> is like a placeholder type, to be filled in by the typechecker from context; it <em class="calibre5">parameterizes</em> <code class="calibre14">Filter</code>’s type, which is why we call it a generic type <em class="calibre5">parameter</em>.</p>
<div data-type="note" type="note" class="calibre21"><h6 class="calibre22">Note</h6>
<p class="author1">Because it’s such a mouthful to say “generic type parameter” every time, people often shorten it to just “generic type,” or simply “generic.” I’ll use the terms interchangeably throughout this book.<a data-primary="generics" data-type="indexterm" id="calibre_link-1066" class="calibre4"></a><a data-primary="generic types" data-type="indexterm" id="calibre_link-1064" class="calibre4"></a></p>
</div>

<p class="author1">The funny-looking <a data-primary="&lt; &gt; (angle brackets)" data-secondary="enclosing generic type parameters" data-type="indexterm" id="calibre_link-584" class="calibre4"></a>angle brackets, <code class="calibre14">&lt;&gt;</code>, are how you declare generic type parameters (think of them like the <code class="calibre14">type</code> keyword, but for generic types); where you place the angle brackets scopes the generics (there are just a few places you can put them), and TypeScript makes sure that within their scope, all instances of the generic type parameters are eventually bound to the same concrete types.<a data-primary="concrete types" data-secondary="binding to generic type parameters" data-type="indexterm" id="calibre_link-783" class="calibre4"></a> Because of where the angle brackets are in this example, TypeScript will bind concrete types to our generic <code class="calibre14">T</code> when we call <code class="calibre14">filter</code>. And it will decide which concrete type to bind to <code class="calibre14">T</code> depending on what we called <code class="calibre14">filter</code> with. You can declare as many comma-separated generic type parameters as you want between a pair of angle brackets.<a data-primary="generic type parameters" data-secondary="comma-separated list within angle brackets" data-type="indexterm" id="calibre_link-1062" class="calibre4"></a></p>
<div data-type="note" type="note" class="calibre21"><h6 class="calibre22">Note</h6>
<p class="author1"><code class="calibre14">T</code> is just a type name, and we could have used any other name instead: <code class="calibre14">A</code>, <code class="calibre14">Zebra</code>, or <code class="calibre14">l33t</code>. By convention, people use uppercase single-letter names starting with the letter <code class="calibre14">T</code> and continuing to <code class="calibre14">U</code>, <code class="calibre14">V</code>, <code class="calibre14">W</code>, and so on depending on how many generics they need.<a data-primary="generic type parameters" data-secondary="naming conventions" data-type="indexterm" id="calibre_link-1063" class="calibre4"></a></p>

<p class="author1">If you’re declaring a lot of generics in a row or are using them in a complicated way, consider deviating from this convention and using more descriptive names like <code class="calibre14">Value</code> or <code class="calibre14">WidgetType</code> instead.</p>

<p class="author1">Some people prefer to start at <code class="calibre14">A</code> instead of <code class="calibre14">T</code>. Different programming language communities prefer one or the other, depending on their heritage: functional language users prefer <code class="calibre14">A</code>, <code class="calibre14">B</code>, <code class="calibre14">C</code>, and so on because of their likeness to the Greek letters α, β, and γ that you might find in math proofs; object-oriented language users tend to use <code class="calibre14">T</code> for “Type.” TypeScript, though it supports both programming styles, uses the latter convention.</p>
</div>

<p class="author1">Like a function’s parameter gets re-bound every time you call that function, so each call to <code class="calibre14">filter</code> gets its<a data-primary="binding" data-secondary="for generic type parameters" data-type="indexterm" id="calibre_link-686" class="calibre4"></a> own binding for <code class="calibre14">T</code>:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">Filter</code> <code class="o">=</code> <code class="p">{</code>
  <code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">array</code>: <code class="kt">T</code><code class="p">[],</code> <code class="nx">f</code><code class="o">:</code> <code class="p">(</code><code class="nx">item</code>: <code class="kt">T</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="kd">boolean</code><code class="p">)</code><code class="o">:</code> <code class="nx">T</code><code class="p">[]</code>
<code class="p">}</code>

<code class="kd">let</code> <code class="nx">filter</code>: <code class="kt">Filter</code> <code class="o">=</code> <code class="p">(</code><code class="nx">array</code><code class="p">,</code> <code class="nx">f</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="c">// ...</code>

<code class="c">// (a) T is bound to number</code>
<code class="nx">filter</code><code class="p">([</code><code class="mi">1</code><code class="p">,</code> <code class="mi">2</code><code class="p">,</code> <code class="mi">3</code><code class="p">],</code> <code class="nx">_</code> <code class="o">=&gt;</code> <code class="nx">_</code> <code class="o">&gt;</code> <code class="mi">2</code><code class="p">)</code>

<code class="c">// (b) T is bound to string</code>
<code class="nx">filter</code><code class="p">([</code><code class="s">'a'</code><code class="p">,</code> <code class="s">'b'</code><code class="p">],</code> <code class="nx">_</code> <code class="o">=&gt;</code> <code class="nx">_</code> <code class="o">!==</code> <code class="s">'b'</code><code class="p">)</code>

<code class="c">// (c) T is bound to {firstName: string}</code>
<code class="kd">let</code> <code class="nx">names</code> <code class="o">=</code> <code class="p">[</code>
  <code class="p">{</code><code class="nx">firstName</code><code class="o">:</code> <code class="s">'beth'</code><code class="p">},</code>
  <code class="p">{</code><code class="nx">firstName</code><code class="o">:</code> <code class="s">'caitlyn'</code><code class="p">},</code>
  <code class="p">{</code><code class="nx">firstName</code><code class="o">:</code> <code class="s">'xin'</code><code class="p">}</code>
<code class="p">]</code>
<code class="nx">filter</code><code class="p">(</code><code class="nx">names</code><code class="p">,</code> <code class="nx">_</code> <code class="o">=&gt;</code> <code class="nx">_</code><code class="p">.</code><code class="nx">firstName</code><code class="p">.</code><code class="nx">startsWith</code><code class="p">(</code><code class="s">'b'</code><code class="p">))</code></pre>

<p class="author1">TypeScript infers these generic bindings from the types of the arguments we passed in. Let’s walk through how TypeScript binds <code class="calibre14">T</code> for (a):</p>
<ol class="calibre31">
<li class="calibre32">
<p class="author1">From the type signature for <code class="calibre14">filter</code>, TypeScript knows that <code class="calibre14">array</code> is an array of elements of some type <code class="calibre14">T</code>.</p>
</li>
<li class="calibre32">
<p class="author1">TypeScript notices that we passed in the array <code class="calibre14">[1, 2, 3]</code>, so <code class="calibre14">T</code> must be <code class="calibre14">number</code>.</p>
</li>
<li class="calibre32">
<p class="author1">Wherever TypeScript sees a <code class="calibre14">T</code>, it substitutes in the <code class="calibre14">number</code> type. So the parameter <code class="calibre14">f: (item: T) =&gt; boolean</code> becomes <code class="calibre14">f: (item: number) =&gt; boolean</code>, and the return type <code class="calibre14">T[]</code> becomes <code class="calibre14">number[]</code>.</p>
</li>
<li class="calibre32">
<p class="author1">TypeScript checks that the types all satisfy assignability, and that the function we passed in as <code class="calibre14">f</code> is assignable to its freshly inferred signature.</p>
</li>

</ol>

<p class="author1">Generics are a powerful way to say what your function does in a more general way than what concrete types allow.<a data-primary="constraints" data-secondary="generics as" data-type="indexterm" id="calibre_link-799" class="calibre4"></a><a data-primary="generic type parameters" data-secondary="as constraints" data-type="indexterm" id="calibre_link-1061" class="calibre4"></a> The way to think about generics is as <em class="calibre5">constraints</em>. Just like annotating a function parameter as <code class="calibre14">n: number</code> constrains the <em class="calibre5">value</em> of the parameter <code class="calibre14">n</code> to the type <code class="calibre14">number</code>, so using a generic <code class="calibre14">T</code> constrains the <em class="calibre5">type</em> of whatever type you bind to <code class="calibre14">T</code> to be the same type everywhere that <code class="calibre14">T</code> shows up.</p>
<div data-type="tip" class="calibre21"><h6 class="calibre22">Tip</h6>
<p class="author1">Generic types can also be used in type aliases, classes, and interfaces&mdash;we’ll use them copiously throughout this book. I’ll introduce them in context as we cover more topics.</p>

<p class="author1">Use generics whenever you can. They will help keep your code general, reusable, and terse.</p>
</div>








<section data-pdf-bookmark="When Are Generics Bound?" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1840">
<h2 class="calibre17">When Are Generics Bound?</h2>

<p class="author1">The place where you declare a generic type doesn’t just scope the type, but also dictates when TypeScript will bind a concrete type to your generic.<a data-primary="call signatures" data-secondary="declaring generics as part of" data-type="indexterm" id="calibre_link-714" class="calibre4"></a><a data-primary="generics" data-secondary="binding, when it happens" data-type="indexterm" id="calibre_link-1067" class="calibre4"></a><a data-primary="binding" data-secondary="of generics, when it happens" data-type="indexterm" id="calibre_link-687" class="calibre4"></a><a data-primary="polymorphism" data-secondary="binding of generics" data-type="indexterm" id="calibre_link-1356" class="calibre4"></a> From the last <span class="calibre">example</span>:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">Filter</code> <code class="o">=</code> <code class="p">{</code>
  <code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">array</code>: <code class="kt">T</code><code class="p">[],</code> <code class="nx">f</code><code class="o">:</code> <code class="p">(</code><code class="nx">item</code>: <code class="kt">T</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="kd">boolean</code><code class="p">)</code><code class="o">:</code> <code class="nx">T</code><code class="p">[]</code>
<code class="p">}</code>

<code class="kd">let</code> <code class="nx">filter</code>: <code class="kt">Filter</code> <code class="o">=</code> <code class="p">(</code><code class="nx">array</code><code class="p">,</code> <code class="nx">f</code><code class="p">)</code> <code class="o">=&gt;</code>
  <code class="c">// ...</code></pre>

<p class="author1">Because we declared <code class="calibre14">&lt;T&gt;</code> as part of a call signature (right before the signature’s opening parenthesis, <code class="calibre14">()</code>, TypeScript will bind a concrete type to <code class="calibre14">T</code> when we actually call a function of type <code class="calibre14">Filter</code>.</p>

<p class="author1">If we’d instead scoped <code class="calibre14">T</code> to the type alias <code class="calibre14">Filter</code>, TypeScript would have required us to bind a type explicitly<a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2314" data-type="indexterm" id="calibre_link-898" class="calibre4"></a> when we used <code class="calibre14">Filter</code>:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<code class="nx">type</code><code class="calibre14"> </code><code class="nx">Filter</code><strong class="calibre49"><code class="o1">&lt;</code><code class="nx1">T</code><code class="o1">&gt;</code></strong><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="p">(</code><code class="nx">array</code><code class="calibre14">: </code><code class="kt">T</code><code class="p">[</code><code class="p">]</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">f</code><code class="o">:</code><code class="calibre14"> </code><code class="p">(</code><code class="nx">item</code><code class="calibre14">: </code><code class="kt">T</code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="kd">boolean</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">T</code><code class="p">[</code><code class="p">]</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">

</code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">filter</code><code class="calibre14">: </code><code class="kt">Filter</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">(</code><code class="nx">array</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">f</code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><em class="calibre41"><code class="c2">// Error TS2314: Generic type 'Filter'</code></em><code class="c">
</code><code class="calibre14">  </code><code class="c">// ...                           </code><em class="calibre41"><code class="c2">// requires 1 type argument(s).</code></em><code class="c">
</code><code class="calibre14">
</code><code class="nx">type</code><code class="calibre14"> </code><code class="nx">OtherFilter</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="nx">Filter</code><code class="calibre14">          </code><em class="calibre41"><code class="c2">// Error TS2314: Generic type 'Filter'</code></em><code class="c">
</code><code class="calibre14">                                   </code><em class="calibre41"><code class="c2">// requires 1 type argument(s).</code></em><code class="c">
</code><code class="calibre14">
</code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">filter</code><code class="calibre14">: </code><code class="kt">Filter</code><code class="o">&lt;</code><code class="kt">number</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">(</code><code class="nx">array</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">f</code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14">
  </code><code class="c">// ...
</code><code class="calibre14">
</code><code class="nx">type</code><code class="calibre14"> </code><code class="nx">StringFilter</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="nx">Filter</code><code class="o">&lt;</code><code class="kt">string</code><code class="o">&gt;</code><code class="calibre14">
</code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">stringFilter</code><code class="calibre14">: </code><code class="kt">StringFilter</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">(</code><code class="nx">array</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">f</code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14">
  </code><code class="c">// ...
</code></pre>

<p class="author1">Generally, TypeScript will bind concrete types to your generic when you use the generic: for functions, it’s when you call them; for classes, it’s when you instantiate them (more on that in <a data-type="xref" href="#calibre_link-105" class="calibre4">“Polymorphism”</a>); and for type aliases and interfaces (see <a data-type="xref" href="#calibre_link-106" class="calibre4">“Interfaces”</a>), it’s when you use or implement them.<a data-primary="classes" data-secondary="binding of generics" data-type="indexterm" id="calibre_link-734" class="calibre4"></a><a data-primary="interfaces" data-secondary="binding of generics" data-type="indexterm" id="calibre_link-1117" class="calibre4"></a><a data-primary="type aliases" data-secondary="binding of generics" data-type="indexterm" id="calibre_link-1552" class="calibre4"></a><a data-primary="functions" data-secondary="binding generics" data-type="indexterm" id="calibre_link-1028" class="calibre4"></a></p>
</div></section>













<section data-pdf-bookmark="Where Can You Declare Generics?" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1841">
<h2 class="calibre17">Where Can You Declare Generics?</h2>

<p class="author1">For each of TypeScript’s ways to declare a call signature, there’s a way to add a generic type to it:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code><code class="calibre14"> </code><code class="nx">Filter</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-107" id="calibre_link-112"><img alt="1" src="images/000000.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">array</code><code class="calibre14">: </code><code class="kt">T</code><code class="p">[</code><code class="p">]</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">f</code><code class="o">:</code><code class="calibre14"> </code><code class="p">(</code><code class="nx">item</code><code class="calibre14">: </code><code class="kt">T</code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="kd">boolean</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">T</code><code class="p">[</code><code class="p">]</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">filter</code><code class="calibre14">: </code><code class="kt">Filter</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="c">// ...
</code><code class="calibre14">
</code><code class="nx">type</code><code class="calibre14"> </code><code class="nx">Filter</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-108" id="calibre_link-113"><img alt="2" src="images/000001.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="p">(</code><code class="nx">array</code><code class="calibre14">: </code><code class="kt">T</code><code class="p">[</code><code class="p">]</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">f</code><code class="o">:</code><code class="calibre14"> </code><code class="p">(</code><code class="nx">item</code><code class="calibre14">: </code><code class="kt">T</code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="kd">boolean</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">T</code><code class="p">[</code><code class="p">]</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">filter</code><code class="calibre14">: </code><code class="kt">Filter</code><code class="o">&lt;</code><code class="kt">number</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="c">// ...
</code><code class="calibre14">
</code><code class="nx">type</code><code class="calibre14"> </code><code class="nx">Filter</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">array</code><code class="calibre14">: </code><code class="kt">T</code><code class="p">[</code><code class="p">]</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">f</code><code class="o">:</code><code class="calibre14"> </code><code class="p">(</code><code class="nx">item</code><code class="calibre14">: </code><code class="kt">T</code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="kd">boolean</code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="nx">T</code><code class="p">[</code><code class="p">]</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-109" id="calibre_link-114"><img alt="3" src="images/000002.png" class="calibre40" /></a><code class="calibre14">
</code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">filter</code><code class="calibre14">: </code><code class="kt">Filter</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="c">// ...
</code><code class="calibre14">
</code><code class="nx">type</code><code class="calibre14"> </code><code class="nx">Filter</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">(</code><code class="nx">array</code><code class="calibre14">: </code><code class="kt">T</code><code class="p">[</code><code class="p">]</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">f</code><code class="o">:</code><code class="calibre14"> </code><code class="p">(</code><code class="nx">item</code><code class="calibre14">: </code><code class="kt">T</code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="kd">boolean</code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="nx">T</code><code class="p">[</code><code class="p">]</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-110" id="calibre_link-115"><img alt="4" src="images/000003.png" class="calibre40" /></a><code class="calibre14">
</code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">filter</code><code class="calibre14">: </code><code class="kt">Filter</code><code class="o">&lt;</code><code class="kt">string</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="c">// ...
</code><code class="calibre14">
</code><code class="kd">function</code><code class="calibre14"> </code><code class="nx">filter</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">array</code><code class="calibre14">: </code><code class="kt">T</code><code class="p">[</code><code class="p">]</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">f</code><code class="o">:</code><code class="calibre14"> </code><code class="p">(</code><code class="nx">item</code><code class="calibre14">: </code><code class="kt">T</code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="kd">boolean</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">T</code><code class="p">[</code><code class="p">]</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-111" id="calibre_link-116"><img alt="5" src="images/000004.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="c">// ...
</code><code class="p">}</code></pre>
<dl class="preface">
<dt class="calibre18"><a class="calibre4" href="#calibre_link-112" id="calibre_link-107"><img alt="1" src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">A full call signature, with <code class="calibre14">T</code> scoped to an individual signature. Because <code class="calibre14">T</code> is scoped to a single signature, TypeScript will bind the <code class="calibre14">T</code> in this signature to a concrete type when you call a function of type <code class="calibre14">filter</code>. Each call to <code class="calibre14">filter</code> will get its own binding for <code class="calibre14">T</code>.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-113" id="calibre_link-108"><img alt="2" src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">A full call signature, with <code class="calibre14">T</code> scoped to <em class="calibre5">all</em> of the signatures. Because <code class="calibre14">T</code> is declared as part of <code class="calibre14">Filter</code>’s type (and not part of a specific signature’s type), TypeScript will bind <code class="calibre14">T</code> when you declare a function of type <code class="calibre14">Filter</code>.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-114" id="calibre_link-109"><img alt="3" src="images/000002.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">Like <a class="calibre4" href="#calibre_link-112"><img alt="1" src="images/000000.png" class="calibre40" /></a>, but a shorthand call signature instead of a full one.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-115" id="calibre_link-110"><img alt="4" src="images/000003.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">Like <a class="calibre4" href="#calibre_link-113"><img alt="2" src="images/000001.png" class="calibre40" /></a>, but a shorthand call signature instead of a full one.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-116" id="calibre_link-111"><img alt="5" src="images/000004.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">A named function call signature, with <code class="calibre14">T</code> scoped to the signature. TypeScript will bind a concrete type to <code class="calibre14">T</code> when you call <code class="calibre14">filter</code>, and each call to <code class="calibre14">filter</code> will get its own binding for <code class="calibre14">T</code>.</p></dd>
</dl>

<p class="author1">As a second example, let’s write a <code class="calibre14">map</code> function. <code class="calibre14">map</code> is pretty similar to <code class="calibre14">filter</code>, but instead of removing items from an array, it transforms each item with a mapping function. We’ll start by sketching out the implementation:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">map</code><code class="p">(</code><code class="nx">array</code>: <code class="kt">unknown</code><code class="p">[],</code> <code class="nx">f</code><code class="o">:</code> <code class="p">(</code><code class="nx">item</code>: <code class="kt">unknown</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="nx">unknown</code><code class="p">)</code><code class="o">:</code> <code class="nx">unknown</code><code class="p">[]</code> <code class="p">{</code>
  <code class="kd">let</code> <code class="nx">result</code> <code class="o">=</code> <code class="p">[]</code>
  <code class="kd">for</code> <code class="p">(</code><code class="kd">let</code> <code class="nx">i</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code> <code class="nx">i</code> <code class="o">&lt;</code> <code class="nx">array</code><code class="p">.</code><code class="nx">length</code><code class="p">;</code> <code class="nx">i</code><code class="o">++</code><code class="p">)</code> <code class="p">{</code>
    <code class="nx">result</code><code class="p">[</code><code class="nx">i</code><code class="p">]</code> <code class="o">=</code> <code class="nx">f</code><code class="p">(</code><code class="nx">array</code><code class="p">[</code><code class="nx">i</code><code class="p">])</code>
  <code class="p">}</code>
  <code class="kd">return</code> <code class="nx">result</code>
<code class="p">}</code></pre>

<p class="author1">Before you go on, try to think through how you’d make <code class="calibre14">map</code> generic, replacing each <code class="calibre14">unknown</code> with some type. How many generics do you need? How do you declare your generics, and scope them to the <code class="calibre14">map</code> function? What should the types of <code class="calibre14">array</code>, <code class="calibre14">f</code>, and the return value be?</p>

<p class="author1">Ready? If you didn’t try to do it yourself first, I encourage you to give it a shot. You can do it. Really!</p>

<p class="author1">OK, no more nagging. Here’s the answer:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<code class="kd">function</code><code class="calibre14"> </code><code class="nx">map</code><strong class="calibre49"><code class="o1">&lt;</code><code class="nx1">T</code><code class="p1">,</code><code class="calibre50"> </code><code class="nx1">U</code><code class="o1">&gt;</code></strong><code class="p">(</code><code class="nx">array</code><code class="calibre14">: </code><strong class="calibre49"><code class="kt1">T</code></strong><code class="p">[</code><code class="p">]</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">f</code><code class="o">:</code><code class="calibre14"> </code><code class="p">(</code><code class="nx">item</code><code class="calibre14">: </code><strong class="calibre49"><code class="kt1">T</code></strong><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><strong class="calibre49"><code class="nx1">U</code></strong><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><strong class="calibre49"><code class="nx1">U</code></strong><code class="p">[</code><code class="p">]</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">result</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">[</code><code class="p">]</code><code class="calibre14">
  </code><code class="kd">for</code><code class="calibre14"> </code><code class="p">(</code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">i</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="mi">0</code><code class="p">;</code><code class="calibre14"> </code><code class="nx">i</code><code class="calibre14"> </code><code class="o">&lt;</code><code class="calibre14"> </code><code class="nx">array</code><code class="p">.</code><code class="nx">length</code><code class="p">;</code><code class="calibre14"> </code><code class="nx">i</code><code class="o">++</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
    </code><code class="nx">result</code><code class="p">[</code><code class="nx">i</code><code class="p">]</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="nx">f</code><code class="p">(</code><code class="nx">array</code><code class="p">[</code><code class="nx">i</code><code class="p">]</code><code class="p">)</code><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">
  </code><code class="kd">return</code><code class="calibre14"> </code><code class="nx">result</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code></pre>

<p class="author1">We need exactly two generic types: <code class="calibre14">T</code> for the type of the array members going in, and <code class="calibre14">U</code> for the type of the array members going out. We pass in an array of <code class="calibre14">T</code>s, and a mapping function that takes a <code class="calibre14">T</code> and maps it to a <code class="calibre14">U</code>. Finally, we return an array of <code class="calibre14">U</code>s.</p>
<aside data-type="sidebar" type="sidebar" class="keyterm"><div class="sidebar" id="calibre_link-1842">
<h5 class="calibre29">filter and map in the Standard Library</h5>
<p class="author1">Our definitions for <code class="calibre14">filter</code> and <code class="calibre14">map</code> are awfully similar to the ones that ship with TypeScript:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">interface</code> <code class="nb">Array</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code> <code class="p">{</code>
  <code class="nx">filter</code><code class="p">(</code>
    <code class="nx">callbackfn</code><code class="o">:</code> <code class="p">(</code><code class="nx">value</code>: <code class="kt">T</code><code class="p">,</code> <code class="nx">index</code>: <code class="kt">number</code><code class="p">,</code> <code class="nx">array</code>: <code class="kt">T</code><code class="p">[])</code> <code class="o">=&gt;</code> <code class="nx">any</code><code class="p">,</code>
    <code class="nx">thisArg?</code>: <code class="kt">any</code>
  <code class="p">)</code><code class="o">:</code> <code class="nx">T</code><code class="p">[]</code>
  <code class="nx">map</code><code class="o">&lt;</code><code class="nx">U</code><code class="o">&gt;</code><code class="p">(</code>
    <code class="nx">callbackfn</code><code class="o">:</code> <code class="p">(</code><code class="nx">value</code>: <code class="kt">T</code><code class="p">,</code> <code class="nx">index</code>: <code class="kt">number</code><code class="p">,</code> <code class="nx">array</code>: <code class="kt">T</code><code class="p">[])</code> <code class="o">=&gt;</code> <code class="nx">U</code><code class="p">,</code>
    <code class="nx">thisArg?</code>: <code class="kt">any</code>
  <code class="p">)</code><code class="o">:</code> <code class="nx">U</code><code class="p">[]</code>
<code class="p">}</code></pre>

<p class="author1">We haven’t covered interfaces yet, but this definition says that <code class="calibre14">filter</code> and <code class="calibre14">map</code> are functions on an array of type <code class="calibre14">T</code>. They both take a function <code class="calibre14">callbackfn</code>, and a type for <code class="calibre14">this</code> inside of the function.</p>

<p class="author1"><code class="calibre14">filter</code> uses the generic <code class="calibre14">T</code> that’s scoped to the entire <code class="calibre14">Array</code> interface. <code class="calibre14">map</code> uses <code class="calibre14">T</code> too, and adds a second generic <code class="calibre14">U</code> that’s scoped just to the <code class="calibre14">map</code> function.<a data-primary="arrays" data-secondary="generic functions on Array type" data-type="indexterm" id="calibre_link-648" class="calibre4"></a> That means TypeScript will bind  a concrete type to <code class="calibre14">T</code> when you create an array, and every call to <code class="calibre14">filter</code> and <code class="calibre14">map</code> on that array will share that concrete type. Every time you call <code class="calibre14">map</code>, that call will get its own binding for <code class="calibre14">U</code>, in addition to having access to the already-bound <code class="calibre14">T</code>.</p>

<p class="author1">Many functions in the JavaScript standard library are generic, especially those on <code class="calibre14">Array</code>’s prototype. Arrays can contain values of any type, so we call that type <code class="calibre14">T</code> and can say things like "<code class="calibre14">.push</code> takes an argument of type <code class="calibre14">T</code>,” or "<code class="calibre14">.map</code> maps from an array of <code class="calibre14">T</code>s to an array of <code class="calibre14">U</code>s”.<a data-primary="generics" data-secondary="binding, when it happens" data-startref="ix_genbind" data-type="indexterm" id="calibre_link-1068" class="calibre4"></a><a data-primary="binding" data-secondary="of generics, when it happens" data-startref="ix_bindgen" data-type="indexterm" id="calibre_link-688" class="calibre4"></a><a data-primary="polymorphism" data-secondary="binding of generics" data-startref="ix_polybind" data-type="indexterm" id="calibre_link-1357" class="calibre4"></a></p>
</div></aside>
</div></section>













<section data-pdf-bookmark="Generic Type Inference" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1843">
<h2 class="calibre17">Generic Type Inference</h2>

<p class="author1">In most cases, TypeScript does a great job of inferring generic types for you. When you call the <code class="calibre14">map</code> function we wrote earlier, <a data-primary="polymorphism" data-secondary="generic type inference" data-type="indexterm" id="calibre_link-1366" class="calibre4"></a><a data-primary="generics" data-secondary="type inference" data-type="indexterm" id="calibre_link-1079" class="calibre4"></a>TypeScript infers that <code class="calibre14">T</code> is <code class="calibre14">string</code> and <code class="calibre14">U</code> is <code class="calibre14">boolean</code>:</p>
<pre class="calibre30" data-code-language="ts" data-type="programlisting">
<code class="kd">function</code> <code class="nx">map</code><code class="o">&lt;</code><code class="nx">T</code><code class="p">,</code> <code class="nx">U</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">array</code>: <code class="kt">T</code><code class="p">[],</code> <code class="nx">f</code><code class="o">:</code> <code class="p">(</code><code class="nx">item</code>: <code class="kt">T</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="nx">U</code><code class="p">)</code><code class="o">:</code> <code class="nx">U</code><code class="p">[]</code> <code class="p">{</code>
  <code class="c">// ...</code>
<code class="p">}</code>

<code class="nx">map</code><code class="p">(</code>
  <code class="p">[</code><code class="s">'a'</code><code class="p">,</code> <code class="s">'b'</code><code class="p">,</code> <code class="s">'c'</code><code class="p">],</code>  <code class="c">// An array of T</code>
  <code class="nx">_</code> <code class="o">=&gt;</code> <code class="nx">_</code> <code class="o">===</code> <code class="s">'a'</code>    <code class="c">// A function that returns a U</code>
<code class="p">)</code>
</pre>

<p class="author1">You can, however, explicitly annotate your generics too. Explicit annotations for generics are all-or-nothing; either annotate every required generic type,<a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2558" data-type="indexterm" id="calibre_link-950" class="calibre4"></a> or none of them:</p>
<pre class="calibre30" data-code-language="ts" data-type="programlisting">
<code class="nx">map</code>	<code class="o">&lt;</code><code class="kt">string</code><code class="p">,</code> <code class="kd">boolean</code><code class="o">&gt;</code><code class="p">(</code>
  <code class="p">[</code><code class="s">'a'</code><code class="p">,</code> <code class="s">'b'</code><code class="p">,</code> <code class="s">'c'</code><code class="p">],</code>
  <code class="nx">_</code> <code class="o">=&gt;</code> <code class="nx">_</code> <code class="o">===</code> <code class="s">'a'</code>
<code class="p">)</code>

<code class="nx">map</code>	<code class="o">&lt;</code><code class="kt">string</code><code class="o">&gt;</code><code class="p">(</code> <code class="c">// Error TS2558: Expected 2 type arguments, but got 1.</code>
  <code class="p">[</code><code class="s">'a'</code><code class="p">,</code> <code class="s">'b'</code><code class="p">,</code> <code class="s">'c'</code><code class="p">],</code>
  <code class="nx">_</code> <code class="o">=&gt;</code> <code class="nx">_</code> <code class="o">===</code> <code class="s">'a'</code>
<code class="p">)</code>
</pre>

<p class="author1">TypeScript will check that each inferred generic type is assignable to its corresponding explicitly bound generic;<a data-primary="assignability" data-secondary="inferred generic types to explicitly bound generic" data-type="indexterm" id="calibre_link-662" class="calibre4"></a><a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2322" data-type="indexterm" id="calibre_link-906" class="calibre4"></a> if it’s not assignable, you’ll get an error:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// OK, because boolean is assignable to boolean | string</code>
<code class="nx">map</code><code class="o">&lt;</code><code class="kt">string</code><code class="p">,</code> <code class="kd">boolean</code> <code class="o">|</code> <code class="kt">string</code><code class="o">&gt;</code><code class="p">(</code>
  <code class="p">[</code><code class="s">'a'</code><code class="p">,</code> <code class="s">'b'</code><code class="p">,</code> <code class="s">'c'</code><code class="p">],</code>
  <code class="nx">_</code> <code class="o">=&gt;</code> <code class="nx">_</code> <code class="o">===</code> <code class="s">'a'</code>
<code class="p">)</code>

<code class="nx">map</code><code class="o">&lt;</code><code class="kt">string</code><code class="p">,</code> <code class="kt">number</code><code class="o">&gt;</code><code class="p">(</code>
  <code class="p">[</code><code class="s">'a'</code><code class="p">,</code> <code class="s">'b'</code><code class="p">,</code> <code class="s">'c'</code><code class="p">],</code>
  <code class="nx">_</code> <code class="o">=&gt;</code> <code class="nx">_</code> <code class="o">===</code> <code class="s">'a'</code>  <code class="c">// Error TS2322: Type 'boolean' is not assignable</code>
<code class="p">)</code>                 <code class="c">// to type 'number'.</code></pre>

<p class="author1">Since TypeScript infers concrete types for your generics from the arguments you pass into your generic function, sometimes you’ll hit a case like this:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">promise</code> <code class="o">=</code> <code class="kd">new</code> <code class="nx">Promise</code><code class="p">(</code><code class="nx">resolve</code> <code class="o">=&gt;</code>
  <code class="nx">resolve</code><code class="p">(</code><code class="mi">45</code><code class="p">)</code>
<code class="p">)</code>
<code class="nx">promise</code><code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">result</code> <code class="o">=&gt;</code> <code class="c">// Inferred as {}</code>
  <code class="nx">result</code> <code class="o">*</code> <code class="mi">4</code> <code class="c">// Error TS2362: The left-hand side of an arithmetic operation must</code>
<code class="p">)</code>            <code class="c">// be of type 'any', 'number', 'bigint', or an enum type.</code></pre>

<p class="author1">What gives? Why did TypeScript infer <code class="calibre14">result</code> to be <code class="calibre14">{}</code>?<a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2362" data-type="indexterm" id="calibre_link-931" class="calibre4"></a> Because we didn’t give it enough information to work with&mdash;since TypeScript only uses the types of a generic function’s arguments to infer a generic’s type, it defaulted <code class="calibre14">T</code> to <code class="calibre14">{}</code>!</p>

<p class="author1">To fix this, we have to explicitly annotate <code class="calibre14">Promise</code>s generic type parameter:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">promise</code> <code class="o">=</code> <code class="kd">new</code> <code class="nx">Promise</code><code class="o">&lt;</code><code class="kt">number</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">resolve</code> <code class="o">=&gt;</code>
  <code class="nx">resolve</code><code class="p">(</code><code class="mi">45</code><code class="p">)</code>
<code class="p">)</code>
<code class="nx">promise</code><code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">result</code> <code class="o">=&gt;</code> <code class="c">// number</code>
  <code class="nx">result</code> <code class="o">*</code> <code class="mi">4</code>
<code class="p">)</code></pre>
</div></section>













<section data-pdf-bookmark="Generic Type Aliases" data-type="sect2" class="preface"><div class="preface" id="calibre_link-140">
<h2 class="calibre17">Generic Type Aliases</h2>

<p class="author1">We already touched on generic type aliases with our <code class="calibre14">Filter</code> example from earlier in the chapter.<a data-primary="polymorphism" data-secondary="generic type inference" data-startref="ix_polygentypin" data-type="indexterm" id="calibre_link-1367" class="calibre4"></a><a data-primary="generics" data-secondary="type inference" data-startref="ix_gentypinf" data-type="indexterm" id="calibre_link-1080" class="calibre4"></a> And if you recall the <code class="calibre14">Array</code> and <code class="calibre14">ReadonlyArray</code> types from the last chapter (see <a data-type="xref" href="#calibre_link-117" class="calibre4">“Read-only arrays and tuples”</a>), those are generic type aliases too! Let’s take a deeper dive into using generics in type aliases by working through a brief example.<a data-primary="polymorphism" data-secondary="generic type aliases" data-type="indexterm" id="calibre_link-1364" class="calibre4"></a><a data-primary="type aliases" data-secondary="generic" data-type="indexterm" id="calibre_link-1555" class="calibre4"></a><a data-primary="generics" data-secondary="type aliases" data-type="indexterm" id="calibre_link-1077" class="calibre4"></a></p>

<p class="author1">Let’s define a <code class="calibre14">MyEvent</code> type that describes a DOM event, like a <code class="calibre14">click</code> or a <code class="calibre14">mousedown</code>:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">MyEvent</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">target</code>: <code class="kt">T</code>
  <code class="nx">type</code>: <code class="kt">string</code>
<code class="p">}</code></pre>

<p class="author1">Note that this is the only valid place to declare a generic type in a type alias: right after the type alias’s name, before its assignment (<code class="calibre14">=</code>).</p>

<p class="author1"><code class="calibre14">MyEvent</code>’s <code class="calibre14">target</code> property points to the element the event happened on: a <code class="calibre14">&lt;button /&gt;</code>, a <code class="calibre14">&lt;div /&gt;</code>, and so on. For example, you might describe a button event like this:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">ButtonEvent</code> <code class="o">=</code> <code class="nx">MyEvent</code><code class="o">&lt;</code><code class="nx">HTMLButtonElement</code><code class="o">&gt;</code></pre>

<p class="author1">When you use a generic type like <code class="calibre14">MyEvent</code>, you have to explicitly bind its type parameters when you use the type; they won’t be inferred for you:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">myEvent</code>: <code class="kt">Event</code><code class="o">&lt;</code><code class="nx">HTMLButtonElement</code> <code class="o">|</code> <code class="kd">null</code><code class="o">&gt;</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">target</code>: <code class="kt">document.querySelector</code><code class="p">(</code><code class="s">'#myButton'</code><code class="p">),</code>
  <code class="nx">type</code><code class="o">:</code> <code class="s">'click'</code>
<code class="p">}</code></pre>

<p class="author1">You can use <code class="calibre14">MyEvent</code> to build another type&mdash;say, <code class="calibre14">TimedEvent</code>. When the generic <code class="calibre14">T</code> in <span class="calibre"><code class="calibre14">TimedEvent</code></span> is bound, TypeScript will also bind it to <code class="calibre14">MyEvent</code>:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">TimedEvent</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">event</code>: <code class="kt">MyEvent</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code>
  <code class="nx">from</code>: <code class="kt">Date</code>
  <code class="nx">to</code>: <code class="kt">Date</code>
<code class="p">}</code></pre>

<p class="author1">You can use a generic type alias in a function’s signature, too. When TypeScript binds a type to <code class="calibre14">T</code>, it’ll also bind it to <code class="calibre14">MyEvent</code> for you:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">triggerEvent</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">event</code>: <code class="kt">MyEvent</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="p">)</code><code class="o">:</code> <code class="kd">void</code> <code class="p">{</code>
  <code class="c">// ...</code>
<code class="p">}</code>

<code class="nx">triggerEvent</code><code class="p">({</code> <code class="c">// T is Element | null</code>
  <code class="nx">target</code>: <code class="kt">document.querySelector</code><code class="p">(</code><code class="s">'#myButton'</code><code class="p">),</code>
  <code class="nx">type</code><code class="o">:</code> <code class="s">'mouseover'</code>
<code class="p">})</code></pre>

<p class="author1">Let’s walk through what’s happening here step by step:</p>
<ol class="calibre31">
<li class="calibre32">
<p class="author1">We call <code class="calibre14">triggerEvent</code> with an object.</p>
</li>
<li class="calibre32">
<p class="author1">TypeScript sees that according to our function’s signature, the argument we passed has to have the type <code class="calibre14">MyEvent&lt;T&gt;</code>. It also notices that we defined <code class="calibre14">MyEvent&lt;T&gt;</code> as <code class="calibre14">{target: T, type: string}</code>.</p>
</li>
<li class="calibre32">
<p class="author1">TypeScript notices that the <code class="calibre14">target</code> field of the object we passed is <code class="calibre14"><span class="calibre">document.querySelector</span>('#myButton')</code>. That implies that <code class="calibre14">T</code> must be whatever type <code class="calibre14">document.querySelector('#myButton')</code> is: <code class="calibre14">Element | null</code>. So <code class="calibre14">T</code> is now bound to <code class="calibre14">Element | null</code>.</p>
</li>
<li class="calibre32">
<p class="author1">TypeScript goes through and replaces every occurrence of <code class="calibre14">T</code> with <code class="calibre14">Element | null</code>.</p>
</li>
<li class="calibre32">
<p class="author1">TypeScript checks that all of our types satisfy assignability. They do, so our code typechecks.</p>
</li>

</ol>
</div></section>













<section data-pdf-bookmark="Bounded Polymorphism" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1844">
<h2 class="calibre17">Bounded Polymorphism</h2>
<div data-type="note" type="note" class="calibre21"><h6 class="calibre22">Note</h6>
<p class="author1">In this section I’m going to use a binary tree as an example. If you haven’t worked with binary trees before, don’t worry.<a data-primary="generics" data-secondary="bounded polymorphism" data-type="indexterm" id="calibre_link-1069" class="calibre4"></a><a data-primary="binary trees" data-type="indexterm" id="calibre_link-684" class="calibre4"></a><a data-primary="functions" data-secondary="polymorphism" data-tertiary="bounded" data-type="indexterm" id="calibre_link-1052" class="calibre4"></a><a data-primary="polymorphism" data-secondary="bounded" data-type="indexterm" id="calibre_link-1358" class="calibre4"></a><a data-primary="bounded polymorphism" data-type="indexterm" id="calibre_link-692" class="calibre4"></a> For our purposes, the basics are:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">A binary tree is a kind of data structure.</p>
</li>
<li class="calibre11">
<p class="author1">A binary tree consists of nodes.</p>
</li>
<li class="calibre11">
<p class="author1">A node holds a value, and can point to up to two child nodes.</p>
</li>
<li class="calibre11">
<p class="author1">A node can be one of two types: a <em class="calibre5">leaf node</em> (meaning it has no children) or an <em class="calibre5">inner node</em> (meaning it has at least one child).</p>
</li>
</ul>
</div>

<p class="author1">Sometimes,<a data-primary="nodes (binary tree)" data-type="indexterm" id="calibre_link-1275" class="calibre4"></a><a data-primary="leaf nodes" data-type="indexterm" id="calibre_link-1186" class="calibre4"></a><a data-primary="inner nodes" data-type="indexterm" id="calibre_link-1111" class="calibre4"></a> saying “this thing is of some generic type <code class="calibre14">T</code> and that thing has to have the same type <code class="calibre14">T</code>" just isn’t enough. Sometimes you also want to say “the type <code class="calibre14">U</code> should be <em class="calibre5">at least <code class="calibre20">T</code></em>.” We call this putting an <em class="calibre5">upper bound</em> on <code class="calibre14">U</code>.</p>

<p class="author1">Why might we want to do this? Let’s say we’re implementing a binary tree, and have three types of nodes:</p>
<ol class="calibre31">
<li class="calibre32">
<p class="author1">Regular <code class="calibre14">TreeNode</code>s</p>
</li>
<li class="calibre32">
<p class="author1"><code class="calibre14">LeafNode</code>s, which are <code class="calibre14">TreeNode</code>s that don’t have children</p>
</li>
<li class="calibre32">
<p class="author1"><code class="calibre14">InnerNode</code>s, which are <code class="calibre14">TreeNode</code>s that do have children</p>
</li>

</ol>

<p class="author1">Let’s start by declaring types for our nodes:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">TreeNode</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">value</code>: <code class="kt">string</code>
<code class="p">}</code>
<code class="nx">type</code> <code class="nx">LeafNode</code> <code class="o">=</code> <code class="nx">TreeNode</code> <code class="o">&amp;</code> <code class="p">{</code>
  <code class="nx">isLeaf</code>: <code class="kt">true</code>
<code class="p">}</code>
<code class="nx">type</code> <code class="nx">InnerNode</code> <code class="o">=</code> <code class="nx">TreeNode</code> <code class="o">&amp;</code> <code class="p">{</code>
  <code class="nx">children</code><code class="o">:</code> <code class="p">[</code><code class="nx">TreeNode</code><code class="p">]</code> <code class="o">|</code> <code class="p">[</code><code class="nx">TreeNode</code><code class="p">,</code> <code class="nx">TreeNode</code><code class="p">]</code>
<code class="p">}</code></pre>

<p class="author1">What we’re saying is: a <code class="calibre14">TreeNode</code> is an object with a single property, <code class="calibre14">value</code>. The <span class="calibre"><code class="calibre14">LeafNode</code></span> type has all the properties <code class="calibre14">TreeNode</code> has, plus a property <code class="calibre14">isLeaf</code> that’s always <code class="calibre14">true</code>. <code class="calibre14">InnerNode</code> also has all of <code class="calibre14">TreeNode</code>’s properties, plus a <code class="calibre14">children</code> property that points to either one or two children.</p>

<p class="author1">Next, let’s write a <code class="calibre14">mapNode</code> function that takes a <code class="calibre14">TreeNode</code> and maps over its value, returning a new <code class="calibre14">TreeNode</code>. We want to come up with a <code class="calibre14">mapNode</code> function that we can use like this:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">a</code>: <code class="kt">TreeNode</code> <code class="o">=</code> <code class="p">{</code><code class="nx">value</code><code class="o">:</code> <code class="s">'a'</code><code class="p">}</code>
<code class="kd">let</code> <code class="nx">b</code>: <code class="kt">LeafNode</code> <code class="o">=</code> <code class="p">{</code><code class="nx">value</code><code class="o">:</code> <code class="s">'b'</code><code class="p">,</code> <code class="nx">isLeaf</code>: <code class="kt">true</code><code class="p">}</code>
<code class="kd">let</code> <code class="nx">c</code>: <code class="kt">InnerNode</code> <code class="o">=</code> <code class="p">{</code><code class="nx">value</code><code class="o">:</code> <code class="s">'c'</code><code class="p">,</code> <code class="nx">children</code><code class="o">:</code> <code class="p">[</code><code class="nx">b</code><code class="p">]}</code>

<code class="kd">let</code> <code class="nx">a1</code> <code class="o">=</code> <code class="nx">mapNode</code><code class="p">(</code><code class="nx">a</code><code class="p">,</code> <code class="nx">_</code> <code class="o">=&gt;</code> <code class="nx">_</code><code class="p">.</code><code class="nx">toUpperCase</code><code class="p">())</code> <code class="c">// TreeNode</code>
<code class="kd">let</code> <code class="nx">b1</code> <code class="o">=</code> <code class="nx">mapNode</code><code class="p">(</code><code class="nx">b</code><code class="p">,</code> <code class="nx">_</code> <code class="o">=&gt;</code> <code class="nx">_</code><code class="p">.</code><code class="nx">toUpperCase</code><code class="p">())</code> <code class="c">// LeafNode</code>
<code class="kd">let</code> <code class="nx">c1</code> <code class="o">=</code> <code class="nx">mapNode</code><code class="p">(</code><code class="nx">c</code><code class="p">,</code> <code class="nx">_</code> <code class="o">=&gt;</code> <code class="nx">_</code><code class="p">.</code><code class="nx">toUpperCase</code><code class="p">())</code> <code class="c">// InnerNode</code></pre>

<p class="author1">Now pause, and think about how you might write a <code class="calibre14">mapNode</code> function that takes a subtype of <code class="calibre14">TreeNode</code> and returns <em class="calibre5">that same subtype</em>. Passing in a <code class="calibre14">LeafNode</code> should return a <code class="calibre14">LeafNode</code>, an <code class="calibre14">InnerNode</code> should return an <code class="calibre14">InnerNode</code>, and a <code class="calibre14">TreeNode</code> should return a <code class="calibre14">TreeNode</code>. Consider how you’d do this before you move on. Is it possible?</p>

<p class="author1">Here’s the answer:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code><code class="calibre14"> </code><code class="nx">mapNode</code><code class="o">&lt;</code><code class="nx">T</code><code class="calibre14"> </code><code class="kd">extends</code><code class="calibre14"> </code><code class="nx">TreeNode</code><code class="o">&gt;</code><code class="p">(</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-118" id="calibre_link-121"><img alt="1" src="images/000000.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="nx">node</code><code class="calibre14">: </code><code class="kt">T</code><code class="p">,</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-119" id="calibre_link-122"><img alt="2" src="images/000001.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="nx">f</code><code class="o">:</code><code class="calibre14"> </code><code class="p">(</code><code class="nx">value</code><code class="calibre14">: </code><code class="kt">string</code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="kt">string</code><code class="calibre14">
</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">T</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-120" id="calibre_link-123"><img alt="3" src="images/000002.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="kd">return</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
    </code><code class="p">.</code><code class="p">.</code><code class="p">.</code><code class="nx">node</code><code class="p">,</code><code class="calibre14">
    </code><code class="nx">value</code><code class="calibre14">: </code><code class="kt">f</code><code class="p">(</code><code class="nx">node</code><code class="p">.</code><code class="nx">value</code><code class="p">)</code><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">
</code><code class="p">}</code></pre>
<dl class="preface">
<dt class="calibre18"><a class="calibre4" href="#calibre_link-121" id="calibre_link-118"><img alt="1" src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45"><code class="calibre14">mapNode</code> is a function that defines a single generic type parameter, <code class="calibre14">T</code>. <code class="calibre14">T</code> has an upper bound of <code class="calibre14">TreeNode</code>. That is, <code class="calibre14">T</code> can be either a <code class="calibre14">TreeNode</code>, or a subtype of <code class="calibre14">TreeNode</code>.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-122" id="calibre_link-119"><img alt="2" src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45"><code class="calibre14">mapNode</code> takes two parameters, the first of which is a <code class="calibre14">node</code> of type <code class="calibre14">T</code>. Because in <a class="calibre4" href="#calibre_link-121"><img alt="1" src="images/000000.png" class="calibre40" /></a> we said <code class="calibre14">node extends TreeNode</code>, if we passed in something that’s not a <code class="calibre14"><span class="calibre">TreeNode</span></code>&mdash;say, an empty object <code class="calibre14">{}</code>, <code class="calibre14">null</code>, or an array of <code class="calibre14">TreeNode</code>s&mdash;that would be an instant red squiggly. <code class="calibre14">node</code> has to be either a <code class="calibre14">TreeNode</code> or a subtype of <code class="calibre14">TreeNode</code>.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-123" id="calibre_link-120"><img alt="3" src="images/000002.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45"><code class="calibre14">mapNode</code> returns a value of type <code class="calibre14">T</code>. Remember that <code class="calibre14">T</code> might be a <code class="calibre14">TreeNode</code>, or any subtype of <code class="calibre14">TreeNode</code>.</p></dd>
</dl>

<p class="author1">Why did we have to declare <code class="calibre14">T</code> that way?</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">If we had typed <code class="calibre14">T</code> as just <code class="calibre14">T</code> (leaving off <code class="calibre14">extends TreeNode</code>), then <code class="calibre14">mapNode</code> would have thrown a compile-time error, because you can’t safely read <code class="calibre14">node.value</code> on an unbounded <code class="calibre14">node</code> of type <code class="calibre14">T</code> (what if a user passes in a number?).</p>
</li>
<li class="calibre11">
<p class="author1">If we had left off the <code class="calibre14">T</code> entirely and declared <code class="calibre14">mapNode</code> as <code class="calibre14">(node: TreeNode, f: (value: string) =&gt; string) =&gt; TreeNode</code>, then we would have lost information after mapping a node: <code class="calibre14">a1</code>, <code class="calibre14">b1</code>, and <code class="calibre14">c1</code> would all just be <code class="calibre14">TreeNode</code>s.</p>
</li>
</ul>

<p class="author1">By saying that <code class="calibre14">T extends TreeNode</code>, we get to preserve the input node’s specific type (<code class="calibre14">TreeNode</code>, <code class="calibre14">LeafNode</code>, or <code class="calibre14">InnerNode</code>), even after mapping it.</p>










<section data-pdf-bookmark="Bounded polymorphism with multiple constraints" data-type="sect3" class="preface"><div class="preface" id="calibre_link-1845">
<h3 class="calibre39">Bounded polymorphism with multiple constraints</h3>

<p class="author1">In the last example, we put a single type constraint on <code class="calibre14">T</code>: <code class="calibre14">T</code> has to be at least a <code class="calibre14"><span class="calibre">TreeNode</span></code>. But what if you want multiple type constraints?<a data-primary="bounded polymorphism" data-secondary="with multiple constraints" data-type="indexterm" id="calibre_link-695" class="calibre4"></a><a data-primary="polymorphism" data-secondary="bounded" data-tertiary="with multiple constraints" data-type="indexterm" id="calibre_link-1361" class="calibre4"></a></p>

<p class="author1">Just extend the intersection (<code class="calibre14">&amp;</code>) of those constraints:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code><code class="calibre14"> </code><code class="nx">HasSides</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="nx">numberOfSides</code><code class="calibre14">: </code><code class="kt">number</code><code class="p">}</code><code class="calibre14">
</code><code class="nx">type</code><code class="calibre14"> </code><code class="nx">SidesHaveLength</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="nx">sideLength</code><code class="calibre14">: </code><code class="kt">number</code><code class="p">}</code><code class="calibre14">

</code><code class="kd">function</code><code class="calibre14"> </code><code class="nx">logPerimeter</code><code class="o">&lt;</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-124" id="calibre_link-127"><img alt="1" src="images/000000.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="nx">Shape</code><code class="calibre14"> </code><code class="kd">extends</code><code class="calibre14"> </code><code class="nx">HasSides</code><code class="calibre14"> </code><code class="o">&amp;</code><code class="calibre14"> </code><code class="nx">SidesHaveLength</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-125" id="calibre_link-128"><img alt="2" src="images/000001.png" class="calibre40" /></a><code class="calibre14">
</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">s</code><code class="calibre14">: </code><code class="kt">Shape</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">Shape</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-126" id="calibre_link-129"><img alt="3" src="images/000002.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">s</code><code class="p">.</code><code class="nx">numberOfSides</code><code class="calibre14"> </code><code class="o">*</code><code class="calibre14"> </code><code class="nx">s</code><code class="p">.</code><code class="nx">sideLength</code><code class="p">)</code><code class="calibre14">
  </code><code class="kd">return</code><code class="calibre14"> </code><code class="nx">s</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">

</code><code class="nx">type</code><code class="calibre14"> </code><code class="nx">Square</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="nx">HasSides</code><code class="calibre14"> </code><code class="o">&amp;</code><code class="calibre14"> </code><code class="nx">SidesHaveLength</code><code class="calibre14">
</code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">square</code><code class="calibre14">: </code><code class="kt">Square</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="nx">numberOfSides</code><code class="calibre14">: </code><code class="kt">4</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">sideLength</code><code class="calibre14">: </code><code class="kt">3</code><code class="p">}</code><code class="calibre14">
</code><code class="nx">logPerimeter</code><code class="p">(</code><code class="nx">square</code><code class="p">)</code><code class="calibre14"> </code><code class="c">// Square, logs "12"</code></pre>
<dl class="preface">
<dt class="calibre18"><a class="calibre4" href="#calibre_link-127" id="calibre_link-124"><img alt="1" src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45"><code class="calibre14">logPerimeter</code> is a function that takes a single argument <code class="calibre14">s</code> of type <code class="calibre14">Shape</code>.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-128" id="calibre_link-125"><img alt="2" src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45"><code class="calibre14">Shape</code> is a generic type that extends both the <code class="calibre14">HasSides</code> type and the <code class="calibre14"><span class="calibre">SidesHaveLength</span></code> type. In other words, a <code class="calibre14">Shape</code> has to at least have sides with lengths.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-129" id="calibre_link-126"><img alt="3" src="images/000002.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45"><code class="calibre14">logPerimeter</code> returns a value of the exact same type you gave it.</p></dd>
</dl>
</div></section>













<section data-pdf-bookmark="Using bounded polymorphism to model arity" data-type="sect3" class="preface"><div class="preface" id="calibre_link-143">
<h3 class="calibre39">Using bounded polymorphism to model arity</h3>

<p class="author1">Another place where you’ll find yourself using bounded polymorphism is to model variadic functions (functions that take any number of arguments).<a data-primary="bounded polymorphism" data-secondary="using to model arity" data-type="indexterm" id="calibre_link-694" class="calibre4"></a><a data-primary="arity" data-secondary="modeling using bounded polymorphism" data-type="indexterm" id="calibre_link-640" class="calibre4"></a><a data-primary="polymorphism" data-secondary="bounded" data-tertiary="using to model arity" data-type="indexterm" id="calibre_link-1360" class="calibre4"></a> For example, let’s implement our own version of JavaScript’s built-in <code class="calibre14">call</code> function (as a reminder, <code class="calibre14">call</code> is a function that takes a function and a variable number of arguments, and applies those arguments to the function).<sup class="calibre15"><a data-type="noteref" href="#calibre_link-130" id="calibre_link-152" class="calibre16">8</a></sup> We’ll define and use it like this, using <code class="calibre14">unknown</code> for the types we’ll fill in later:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">call</code><code class="p">(</code>
  <code class="nx">f</code><code class="o">:</code> <code class="p">(...</code><code class="nx">args</code>: <code class="kt">unknown</code><code class="p">[])</code> <code class="o">=&gt;</code> <code class="nx">unknown</code><code class="p">,</code>
  <code class="p">...</code><code class="nx">args</code>: <code class="kt">unknown</code><code class="p">[]</code>
<code class="p">)</code><code class="o">:</code> <code class="nx">unknown</code> <code class="p">{</code>
  <code class="kd">return</code> <code class="nx">f</code><code class="p">(...</code><code class="nx">args</code><code class="p">)</code>
<code class="p">}</code>

<code class="kd">function</code> <code class="nx">fill</code><code class="p">(</code><code class="nx">length</code>: <code class="kt">number</code><code class="p">,</code> <code class="nx">value</code>: <code class="kt">string</code><code class="p">)</code><code class="o">:</code> <code class="kt">string</code><code class="p">[]</code> <code class="p">{</code>
  <code class="kd">return</code> <code class="nb">Array</code><code class="p">.</code><code class="nx">from</code><code class="p">({</code><code class="nx">length</code><code class="p">},</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="nx">value</code><code class="p">)</code>
<code class="p">}</code>

<code class="nx">call</code><code class="p">(</code><code class="nx">fill</code><code class="p">,</code> <code class="mi">10</code><code class="p">,</code> <code class="s">'a'</code><code class="p">)</code> <code class="c">// evaluates to an array of 10 'a's</code></pre>

<p class="author1">Now let’s fill in the <code class="calibre14">unknown</code>s. The constraints we want to express are:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1"><code class="calibre14">f</code> should be a function that takes some set of arguments <code class="calibre14">T</code>, and returns some type <code class="calibre14">R</code>. We don’t know how many arguments it’ll have ahead of time.</p>
</li>
<li class="calibre11">
<p class="author1"><code class="calibre14">call</code> takes <code class="calibre14">f</code>, along with the same set of arguments <code class="calibre14">T</code> that <code class="calibre14">f</code> itself takes. Again, we don’t know exactly how many arguments to expect ahead of time.</p>
</li>
<li class="calibre11">
<p class="author1"><code class="calibre14">call</code> returns the same type <code class="calibre14">R</code> that <code class="calibre14">f</code> returns.</p>
</li>
</ul>

<p class="author1">We’ll need two type parameters: <code class="calibre14">T</code>, which is an array of arguments, and <code class="calibre14">R</code>, which is an arbitrary return value. Let’s fill in the types:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<code class="kd">function</code><code class="calibre14"> </code><code class="nx">call</code><strong class="calibre49"><code class="o1">&lt;</code><code class="nx1">T</code><code class="calibre50"> </code><code class="k">extends</code><code class="calibre50"> </code><code class="nx1">unknown</code><code class="p1">[</code><code class="p1">]</code><code class="p1">,</code><code class="calibre50"> </code><code class="nx1">R</code><code class="o1">&gt;</code></strong><code class="p">(</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-131" id="calibre_link-135"><img alt="1" src="images/000000.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="nx">f</code><code class="o">:</code><code class="calibre14"> </code><code class="p">(</code><code class="p">.</code><code class="p">.</code><code class="p">.</code><code class="nx">args</code><code class="calibre14">: </code><strong class="calibre49"><code class="kt1">T</code></strong><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><strong class="calibre49"><code class="nx1">R</code></strong><code class="p">,</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-132" id="calibre_link-136"><img alt="2" src="images/000001.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="p">.</code><code class="p">.</code><code class="p">.</code><code class="nx">args</code><code class="calibre14">: </code><strong class="calibre49"><code class="kt1">T</code></strong><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-133" id="calibre_link-137"><img alt="3" src="images/000002.png" class="calibre40" /></a><code class="calibre14">
</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><strong class="calibre49"><code class="nx1">R</code></strong><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-134" id="calibre_link-138"><img alt="4" src="images/000003.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="kd">return</code><code class="calibre14"> </code><code class="nx">f</code><code class="p">(</code><code class="p">.</code><code class="p">.</code><code class="p">.</code><code class="nx">args</code><code class="p">)</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code></pre>
<p class="author1">How exactly does this work? Let’s walk through it step by step:</p>

<dl class="preface">
<dt class="calibre18">
<a class="calibre4" href="#calibre_link-135" id="calibre_link-131"><img alt="1" src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44">
<p class="calibre45"><code class="calibre14">call</code> is a variadic function (as a reminder, a variadic function is a function that accepts any number of arguments) that has two type parameters: <code class="calibre14">T</code> and <code class="calibre14">R</code>. <code class="calibre14">T</code> is a subtype of <code class="calibre14">unknown[]</code>; that is, <code class="calibre14">T</code> is an array or tuple of any type.</p></dd>
<dt class="calibre18">
<a class="calibre4" href="#calibre_link-136" id="calibre_link-132"><img alt="2" src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44">
<p class="calibre45"><code class="calibre14">call</code>’s first parameter is a function <code class="calibre14">f</code>. <code class="calibre14">f</code> is also variadic, and its arguments share a type with <code class="calibre14">args</code>: whatever type <code class="calibre14">args</code> is, <code class="calibre14">f</code> arguments have the same exact type.</p></dd>
<dt class="calibre18">
<a class="calibre4" href="#calibre_link-137" id="calibre_link-133"><img alt="3" src="images/000002.png" class="calibre40" /></a></dt>
<dd class="calibre44">
<p class="calibre45">In addition to a function <code class="calibre14">f</code>, <code class="calibre14">call</code> has a variable number of additional parameters <code class="calibre14">...args</code>. <code class="calibre14">args</code> is a rest parameter&mdash;that is, a parameter that describes a variable number of arguments. <code class="calibre14">args</code>’s type is <code class="calibre14">T</code>, and <code class="calibre14">T</code> has to be an array type (in fact, if we forgot to say that <code class="calibre14">T</code> extends an array type, TypeScript would throw a squiggly at us), so TypeScript will infer a <em class="calibre5">tuple type</em> for <code class="calibre14">T</code> based on the specific arguments we passed in for <code class="calibre14">args</code>.</p></dd>
<dt class="calibre18">
<a class="calibre4" href="#calibre_link-138" id="calibre_link-134"><img alt="4" src="images/000003.png" class="calibre40" /></a></dt>
<dd class="calibre44">
<p class="calibre45"><code class="calibre14">call</code> returns a value of type <code class="calibre14">R</code> (<code class="calibre14">R</code> is bound to whatever type <code class="calibre14">f</code> returns).</p></dd>
</dl>

<p class="author1">Now when we call <code class="calibre14">call</code>, TypeScript will know exactly what the return type is, and it will complain when we<a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2554" data-type="indexterm" id="calibre_link-949" class="calibre4"></a> pass the wrong number of arguments:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">a</code> <code class="o">=</code> <code class="nx">call</code><code class="p">(</code><code class="nx">fill</code><code class="p">,</code> <code class="mi">10</code><code class="p">,</code> <code class="s">'a'</code><code class="p">)</code>      <code class="c">// string[]</code>
<code class="kd">let</code> <code class="nx">b</code> <code class="o">=</code> <code class="nx">call</code><code class="p">(</code><code class="nx">fill</code><code class="p">,</code> <code class="mi">10</code><code class="p">)</code>           <code class="c">// Error TS2554: Expected 3 arguments; got 2.</code>
<code class="kd">let</code> <code class="nx">c</code> <code class="o">=</code> <code class="nx">call</code><code class="p">(</code><code class="nx">fill</code><code class="p">,</code> <code class="mi">10</code><code class="p">,</code> <code class="s">'a'</code><code class="p">,</code> <code class="s">'z'</code><code class="p">)</code> <code class="c">// Error TS2554: Expected 3 arguments; got 4.</code></pre>

<p class="author1">We use a similar technique to take advantage of the way TypeScript infers tuple types for rest parameters to improve<a data-primary="generics" data-secondary="bounded polymorphism" data-startref="ix_genbound" data-type="indexterm" id="calibre_link-1070" class="calibre4"></a><a data-primary="functions" data-secondary="polymorphism" data-startref="ix_funcpolybnd" data-tertiary="bounded" data-type="indexterm" id="calibre_link-1053" class="calibre4"></a><a data-primary="bounded polymorphism" data-startref="ix_boundply" data-type="indexterm" id="calibre_link-693" class="calibre4"></a><a data-primary="polymorphism" data-secondary="bounded" data-startref="ix_polybound" data-type="indexterm" id="calibre_link-1359" class="calibre4"></a> type inference for tuples in <a data-type="xref" href="#calibre_link-139" class="calibre4">“Improving Type Inference for Tuples”</a>.</p>
</div></section>



</div></section>













<section data-pdf-bookmark="Generic Type Defaults" data-type="sect2" class="preface"><div class="preface" id="calibre_link-531">
<h2 class="calibre17">Generic Type Defaults</h2>

<p class="author1">Just like you can give function parameters default values, you can give generic type parameters default types.<a data-primary="generics" data-secondary="type defaults" data-type="indexterm" id="calibre_link-1078" class="calibre4"></a><a data-primary="polymorphism" data-secondary="generic type defaults" data-type="indexterm" id="calibre_link-1365" class="calibre4"></a><a data-primary="functions" data-secondary="polymorphism" data-tertiary="generic type defaults" data-type="indexterm" id="calibre_link-1054" class="calibre4"></a><a data-primary="defaults" data-secondary="generic type" data-type="indexterm" id="calibre_link-833" class="calibre4"></a> For example, let’s revisit the <code class="calibre14">MyEvent</code> type from <a data-type="xref" href="#calibre_link-140" class="calibre4">“Generic Type Aliases”</a>. As a reminder, we used the type to model DOM events, and it looks like this:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">MyEvent</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">target</code>: <code class="kt">T</code>
  <code class="nx">type</code>: <code class="kt">string</code>
<code class="p">}</code></pre>

<p class="author1">To create a new event, we have to explicitly bind a generic type to <code class="calibre14">MyEvent</code>, representing the type of HTML element that the event was dispatched on:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">buttonEvent</code>: <code class="kt">MyEvent</code><code class="o">&lt;</code><code class="nx">HTMLButtonElement</code><code class="o">&gt;</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">target</code>: <code class="kt">myButton</code><code class="p">,</code>
  <code class="nx">type</code>: <code class="kt">string</code>
<code class="p">}</code></pre>

<p class="author1">As a convenience for when we don’t know the specific element type that <code class="calibre14">MyEvent</code> will be bound to beforehand, we can add a default for <code class="calibre14">MyEvent</code>’s generic:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<code class="nx">type</code><code class="calibre14"> </code><code class="nx">MyEvent</code><code class="o">&lt;</code><code class="nx">T</code><code class="calibre14"> </code><strong class="calibre49"><code class="o1">=</code><code class="calibre50"> </code><code class="nx1">HTMLElement</code></strong><code class="o">&gt;</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="nx">target</code><code class="calibre14">: </code><code class="kt">T</code><code class="calibre14">
  </code><code class="nx">type</code><code class="calibre14">: </code><code class="kt">string</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code></pre>

<p class="author1">We can also use this opportunity to apply what we learned in the last few sections and add a bound to <code class="calibre14">T</code>, to make sure that <code class="calibre14">T</code> is an HTML element:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<code class="nx">type</code><code class="calibre14"> </code><code class="nx">MyEvent</code><code class="o">&lt;</code><code class="nx">T</code><code class="calibre14"> </code><strong class="calibre49"><code class="k">extends</code><code class="calibre50"> </code><code class="nx1">HTMLElement</code></strong><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="nx">HTMLElement</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="nx">target</code><code class="calibre14">: </code><code class="kt">T</code><code class="calibre14">
  </code><code class="nx">type</code><code class="calibre14">: </code><code class="kt">string</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code></pre>

<p class="author1">Now, we can easily create an event that’s not specific to a particular HTML element type, and we don’t have to manually bind <code class="calibre14">MyEvent</code>s <code class="calibre14">T</code> to <code class="calibre14">HTMLElement</code> when we create the event:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">myEvent</code>: <code class="kt">MyEvent</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">target</code>: <code class="kt">myElement</code><code class="p">,</code>
  <code class="nx">type</code>: <code class="kt">string</code>
<code class="p">}</code></pre>

<p class="author1">Note that like optional parameters in functions, generic types with defaults have to appear after generic<a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2706" data-type="indexterm" id="calibre_link-953" class="calibre4"></a> types without defaults:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// Good</code>
<code class="nx">type</code> <code class="nx">MyEvent2</code><code class="o">&lt;</code>
  <code class="nx">Type</code> <code class="kd">extends</code> <code class="kt">string</code><code class="p">,</code>
  <code class="nx">Target</code> <code class="kd">extends</code> <code class="nx">HTMLElement</code> <code class="o">=</code> <code class="nx">HTMLElement</code><code class="p">,</code>
<code class="o">&gt;</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">target</code>: <code class="kt">Target</code>
  <code class="nx">type</code>: <code class="kt">Type</code>
<code class="p">}</code>

<code class="c">// Bad</code>
<code class="nx">type</code> <code class="nx">MyEvent3</code><code class="o">&lt;</code>
  <code class="nx">Target</code> <code class="kd">extends</code> <code class="nx">HTMLElement</code> <code class="o">=</code> <code class="nx">HTMLElement</code><code class="p">,</code>
  <code class="nx">Type</code> <code class="kd">extends</code> <code class="kt">string</code>  <code class="c">// Error TS2706: Required type parameters may</code>
<code class="o">&gt;</code> <code class="o">=</code> <code class="p">{</code>                  <code class="c">// not follow optional type parameters.</code>
  <code class="nx">target</code>: <code class="kt">Target</code>
  <code class="nx">type</code>: <code class="kt">Type</code>
<code class="p">}</code></pre>
</div></section>





</div></section>













<section data-pdf-bookmark="Type-Driven Development" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1846">
<h1 class="calibre13">Type-Driven Development</h1>

<p class="author1">With a powerful type system comes great power.<a data-primary="functions" data-secondary="polymorphism" data-startref="ix_funcpoly" data-type="indexterm" id="calibre_link-1051" class="calibre4"></a><a data-primary="polymorphism" data-startref="ix_poly" data-type="indexterm" id="calibre_link-1355" class="calibre4"></a> When you write in TypeScript, you will often find yourself “leading with the types.” This, of course, refers to <em class="calibre5">type-driven development</em>.<a data-primary="type-driven development" data-type="indexterm" id="calibre_link-1591" class="calibre4"></a><a data-primary="functions" data-secondary="type-driven development" data-type="indexterm" id="calibre_link-1055" class="calibre4"></a></p>
<aside class="keyterm" data-type="sidebar" type="sidebar"><div class="sidebar" id="calibre_link-1847">
<h5 class="calibre29">Type-driven development</h5>
<p class="author1">A style of programming where you sketch out type signatures first, and fill in values later.<a data-primary="call signatures" data-secondary="in type-driven development" data-type="indexterm" id="calibre_link-716" class="calibre4"></a></p>
</div></aside>

<p class="author1">The point of static type systems is to constrain the types of values an expression can hold. The more expressive the type system, the more it tells you about the value contained in that expression. When you apply an expressive type system to a function, the function’s type signature might end up telling you most of what you need to know about that function.</p>

<p class="author1">Let’s look at the type signature for the <code class="calibre14">map</code> function from earlier in this chapter:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">map</code><code class="o">&lt;</code><code class="nx">T</code><code class="p">,</code> <code class="nx">U</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">array</code>: <code class="kt">T</code><code class="p">[],</code> <code class="nx">f</code><code class="o">:</code> <code class="p">(</code><code class="nx">item</code>: <code class="kt">T</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="nx">U</code><code class="p">)</code><code class="o">:</code> <code class="nx">U</code><code class="p">[]</code> <code class="p">{</code>
  <code class="c">// ...</code>
<code class="p">}</code></pre>

<p class="author1">Just looking at that signature&mdash;even if you’ve never seen <code class="calibre14">map</code> before&mdash;you should have some intuition for what <code class="calibre14">map</code> does: it takes an array of <code class="calibre14">T</code> and a function that maps from a <code class="calibre14">T</code> to a <code class="calibre14">U</code>, and returns an array of <code class="calibre14">U</code>. Notice that you didn’t have to see the function’s implementation to know that!<sup class="calibre15"><a data-type="noteref" href="#calibre_link-141" id="calibre_link-153" class="calibre16">9</a></sup></p>

<p class="author1">When you write a TypeScript program, start by defining your functions’ type signatures&mdash;in other words, <em class="calibre5">lead with the types</em>&mdash;filling in the implementations later. <a data-primary="leading with the types" data-type="indexterm" id="calibre_link-1185" class="calibre4"></a>By sketching out your program out at the type level first, you make sure that everything makes sense at a high level before you get down to your implementations.</p>

<p class="author1">You’ll notice that so far, we’ve been doing the opposite: leading with the implementation, then deducing the types. Now that you have a grasp of writing and typing functions in TypeScript, we’re going to switch modes, sketching out the types first, and filling in the details later.</p>
</div></section>













<section data-pdf-bookmark="Summary" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1848">
<h1 class="calibre13">Summary</h1>

<p class="author1">In this chapter we talked about how to declare and call functions, how to type parameters, and how to express common JavaScript function features like default parameters, rest parameters, generator functions, and iterators in TypeScript. We talked about the difference between functions’ call signatures and implementations, contextual typing, and the different ways to overload functions. Finally, we covered polymorphism for functions and type aliases in depth: why it’s useful, how and where to declare generic types, how TypeScript infers generic types, and how to declare and add bounds and defaults to your generics. We finished off with a short note on type-driven development: what it is, and how you can use your newfound knowledge of function types to do it.</p>
</div></section>













<section data-pdf-bookmark="Exercises" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1849">
<h1 class="calibre13">Exercises</h1>
<ol class="calibre31">
<li class="calibre32">
<p class="author1">Which parts of a function’s type signature does TypeScript infer: the parameters, the return type, or both?</p>
</li>
<li class="calibre32">
<p class="author1">Is JavaScript’s <code class="calibre14">arguments</code> object typesafe? If not, what can you use instead?</p>
</li>
<li class="calibre32">
<p class="author1">You want the ability to book a vacation that starts immediately. Update the overloaded <code class="calibre14">reserve</code> function from earlier in this chapter (<a data-type="xref" href="#calibre_link-142" class="calibre4">“Overloaded Function Types”</a>) with a third call signature that takes just a destination, without an explicit start date. Update <code class="calibre14">reserve</code>’s implementation to support this new overloaded signature.</p>
</li>
<li class="calibre32">
<p class="author1">[Hard] Update our <code class="calibre14">call</code> implementation from earlier in the chapter (<a data-type="xref" href="#calibre_link-143" class="calibre4">“Using bounded polymorphism to model arity”</a>) to <em class="calibre5">only</em> work for functions whose second argument is a <code class="calibre14">string</code>. For all other functions, your implementation should fail at compile time.</p>
</li>
<li class="calibre32">
<p class="author1">Implement a small typesafe assertion library, <code class="calibre14">is</code>. Start by sketching out your types.<a data-primary="functions" data-startref="ix_func" data-type="indexterm" id="calibre_link-1025" class="calibre4"></a> When you’re done, you should be able to use it like this:</p>
</li>

</ol>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// Compare a string and a string</code>
<code class="nx">is</code><code class="p">(</code><code class="s">'string'</code><code class="p">,</code> <code class="s">'otherstring'</code><code class="p">)</code> <code class="c">// false</code>

<code class="c">// Compare a boolean and a boolean</code>
<code class="nx">is</code><code class="p">(</code><code class="kd">true</code><code class="p">,</code> <code class="kd">false</code><code class="p">)</code> <code class="c">// false</code>

<code class="c">// Compare a number and a number</code>
<code class="nx">is</code><code class="p">(</code><code class="mi">42</code><code class="p">,</code> <code class="mi">42</code><code class="p">)</code> <code class="c">// true</code>

<code class="c">// Comparing two different types should give a compile-time error</code>
<code class="nx">is</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code> <code class="s">'foo'</code><code class="p">)</code> <code class="c">// Error TS2345: Argument of type '"foo"' is not assignable</code>
              <code class="c">// to parameter of type 'number'.</code>

<code class="c">// [Hard] I should be able to pass any number of arguments</code>
<code class="nx">is</code><code class="p">([</code><code class="mi">1</code><code class="p">],</code> <code class="p">[</code><code class="mi">1</code><code class="p">,</code> <code class="mi">2</code><code class="p">],</code> <code class="p">[</code><code class="mi">1</code><code class="p">,</code> <code class="mi">2</code><code class="p">,</code> <code class="mi">3</code><code class="p">])</code> <code class="c">// false</code></pre>
</div></section>







<div data-type="footnotes" class="calibre26"><p data-type="footnote" id="calibre_link-67" class="calibre27"><sup class="calibre28"><a href="#calibre_link-144" class="calibre16">1</a></sup> Why are they unsafe? If you enter that last example into your code editor, you’ll see that its type is <code class="calibre14">Function</code>. What is this <code class="calibre14">Function</code> type? It’s an object that is callable (you know, by putting <code class="calibre14">()</code> after it) and has all the prototype methods from <code class="calibre14">Function.prototype</code>. But its parameters and return type are untyped, so you can call the function with any arguments you want, and TypeScript will stand idly by, watching you do something that by all means should be illegal in whatever town you live in.</p><p data-type="footnote" id="calibre_link-70" class="calibre27"><sup class="calibre28"><a href="#calibre_link-145" class="calibre16">2</a></sup> For a deep dive into <code class="calibre14">this</code>, check out Kyle Simpson’s <a href="http://shop.oreilly.com/product/0636920033738.do" class="calibre4">You Don’t Know JS</a> series from O’Reilly.</p><p data-type="footnote" id="calibre_link-80" class="calibre27"><sup class="calibre28"><a href="#calibre_link-146" class="calibre16">3</a></sup> Notably, <code class="calibre14">Object</code> and <code class="calibre14">Number</code> are not iterators.</p><p data-type="footnote" id="calibre_link-82" class="calibre27"><sup class="calibre28"><a href="#calibre_link-147" class="calibre16">4</a></sup> The exceptions to this rule of thumb are enums and namespaces. Enums generate both a type and a value, and namespaces exist just at the value level. See <a data-type="xref" href="#calibre_link-148" class="calibre48">Appendix&nbsp;C</a> for a complete reference.</p><p data-type="footnote" id="calibre_link-91" class="calibre27"><sup class="calibre28"><a href="#calibre_link-149" class="calibre16">5</a></sup> If you haven’t heard the term “callback” before, all it is is a function that you passed as an argument to another function.</p><p data-type="footnote" id="calibre_link-97" class="calibre27"><sup class="calibre28"><a href="#calibre_link-150" class="calibre16">6</a></sup> To learn more, jump ahead to <a data-type="xref" href="#calibre_link-38" class="calibre48">“Refinement”</a>.</p><p data-type="footnote" id="calibre_link-103" class="calibre27"><sup class="calibre28"><a href="#calibre_link-151" class="calibre16">7</a></sup> Mostly&mdash;TypeScript hoists literal overloads above nonliteral ones, before resolving them in order. You might not want to depend on this feature, though, since it can make your overloads hard to understand for other engineers who aren’t familiar with this behavior.</p><p data-type="footnote" id="calibre_link-130" class="calibre27"><sup class="calibre28"><a href="#calibre_link-152" class="calibre16">8</a></sup> To simplify our implementation a little, we’re going to design our <code class="calibre14">call</code> function to not take <code class="calibre14">this</code> into account.</p><p data-type="footnote" id="calibre_link-141" class="calibre27"><sup class="calibre28"><a href="#calibre_link-153" class="calibre16">9</a></sup> There are a few programming languages (like the Haskell-like language Idris) that have built-in constraint solvers with the ability to <em class="calibre5">automatically</em> implement function bodies for you from the signatures you write!</p></div></div></section></div>

<div data-type="book" class="calibre1" id="calibre_link-154"><section data-pdf-bookmark="Chapter 5. Classes and Interfaces" data-type="chapter" type="chapter" class="preface"><div class="preface" id="calibre_link-69">
<h1 class="calibre12"><span class="calibre">Chapter 5. </span>Classes and Interfaces</h1>


<p class="author1">If you’re like most programmers coming from an object-oriented programming language, classes are your bread and butter.<a data-primary="classes" data-type="indexterm" id="calibre_link-729" class="calibre4"></a> Classes are how you organize and think about your code, and they serve as your primary unit of encapsulation. You’ll be pleased to learn that TypeScript classes borrow heavily from C#, and support things like visibility modifiers, property initializers, polymorphism, decorators, and interfaces. But because TypeScript classes compile down to regular JavaScript classes, you can also express  JavaScript idioms like mixins in a typesafe way.</p>

<p class="author1">Some of TypeScript’s class features, like property initializers and decorators, are supported by JavaScript classes too,<sup class="calibre15"><a data-type="noteref" href="#calibre_link-155" id="calibre_link-225" class="calibre16">1</a></sup> and so generate runtime code. Other features, like visibility modifiers, interfaces, and generics, are TypeScript-only features that just exist at compile time, and don’t generate any code when you compile your application to JavaScript.</p>

<p class="author1">In this chapter I’ll guide you through an extended example of how we work with classes in TypeScript, so that you can gain some intuition not only for TypeScript’s object-oriented language features, but for how and why we use them. Try to follow along, entering the code in your code editor as we go.</p>






<section data-pdf-bookmark="Classes and Inheritance" data-type="sect1" class="preface"><div class="preface" id="calibre_link-526">
<h1 class="calibre13">Classes and Inheritance</h1>

<p class="author1">We’re going to build a chess engine.<a data-primary="classes" data-secondary="and inheritance" data-type="indexterm" id="calibre_link-731" class="calibre4"></a><a data-primary="inheritance" data-type="indexterm" id="calibre_link-1109" class="calibre4"></a> Our engine will model a game of chess and provide an API for two players to take turns making moves.</p>

<p class="author1">We’ll start by sketching out the types:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// Represents a chess game</code>
<code class="kd">class</code> <code class="nx">Game</code> <code class="p">{}</code>

<code class="c">// A chess piece</code>
<code class="kd">class</code> <code class="nx">Piece</code> <code class="p">{}</code>

<code class="c">// A set of coordinates for a piece</code>
<code class="kd">class</code> <code class="nx">Position</code> <code class="p">{}</code></pre>

<p class="author1">There are six types of pieces:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// ...</code>
<code class="kd">class</code> <code class="nx">King</code> <code class="kd">extends</code> <code class="nx">Piece</code> <code class="p">{}</code>
<code class="kd">class</code> <code class="nx">Queen</code> <code class="kd">extends</code> <code class="nx">Piece</code> <code class="p">{}</code>
<code class="kd">class</code> <code class="nx">Bishop</code> <code class="kd">extends</code> <code class="nx">Piece</code> <code class="p">{}</code>
<code class="kd">class</code> <code class="nx">Knight</code> <code class="kd">extends</code> <code class="nx">Piece</code> <code class="p">{}</code>
<code class="kd">class</code> <code class="nx">Rook</code> <code class="kd">extends</code> <code class="nx">Piece</code> <code class="p">{}</code>
<code class="kd">class</code> <code class="nx">Pawn</code> <code class="kd">extends</code> <code class="nx">Piece</code> <code class="p">{}</code></pre>

<p class="author1">Every piece has a color and a current position. In chess, positions are modeled as (letter, number) coordinate pairs; letters run from left to right along the x-axis, numbers from bottom to top along the y-axis (<a data-type="xref" href="#calibre_link-156" class="calibre4">Figure&nbsp;5-1</a>).</p>

<figure class="calibre33"><div class="figure" id="calibre_link-156">
<img alt="prts 0501" src="images/000016.png" class="calibre40" />
<h6 class="calibre34"><span class="calibre">Figure 5-1. </span>Standard algebraic notation in chess: A&ndash;H (the x-axis) are called “files” and 1&ndash;8 (the inverted y-axis) “ranks”</h6>
</div></figure>

<p class="author1">Let’s add color and position to our <code class="calibre14">Piece</code> class:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<strong class="calibre49"><code class="nx1">type</code><code class="calibre50"> </code><code class="nx1">Color</code><code class="calibre50"> </code><code class="o1">=</code><code class="calibre50"> </code><code class="s1">'Black'</code><code class="calibre50"> </code><code class="o1">|</code><code class="calibre50"> </code><code class="s1">'White'</code><code class="calibre50">
</code><code class="nx1">type</code><code class="calibre50"> </code><code class="nx1">File</code><code class="calibre50"> </code><code class="o1">=</code><code class="calibre50"> </code><code class="s1">'A'</code><code class="calibre50"> </code><code class="o1">|</code><code class="calibre50"> </code><code class="s1">'B'</code><code class="calibre50"> </code><code class="o1">|</code><code class="calibre50"> </code><code class="s1">'C'</code><code class="calibre50"> </code><code class="o1">|</code><code class="calibre50"> </code><code class="s1">'D'</code><code class="calibre50"> </code><code class="o1">|</code><code class="calibre50"> </code><code class="s1">'E'</code><code class="calibre50"> </code><code class="o1">|</code><code class="calibre50"> </code><code class="s1">'F'</code><code class="calibre50"> </code><code class="o1">|</code><code class="calibre50"> </code><code class="s1">'G'</code><code class="calibre50"> </code><code class="o1">|</code><code class="calibre50"> </code><code class="s1">'H'</code><code class="calibre50">
</code><code class="nx1">type</code><code class="calibre50"> </code><code class="nx1">Rank</code><code class="calibre50"> </code><code class="o1">=</code><code class="calibre50"> </code><code class="mi1">1</code><code class="calibre50"> </code><code class="o1">|</code><code class="calibre50"> </code><code class="mi1">2</code><code class="calibre50"> </code><code class="o1">|</code><code class="calibre50"> </code><code class="mi1">3</code><code class="calibre50"> </code><code class="o1">|</code><code class="calibre50"> </code><code class="mi1">4</code><code class="calibre50"> </code><code class="o1">|</code><code class="calibre50"> </code><code class="mi1">5</code><code class="calibre50"> </code><code class="o1">|</code><code class="calibre50"> </code><code class="mi1">6</code><code class="calibre50"> </code><code class="o1">|</code><code class="calibre50"> </code><code class="mi1">7</code><code class="calibre50"> </code><code class="o1">|</code><code class="calibre50"> </code><code class="mi1">8</code></strong><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-157" id="calibre_link-161"><img alt="1" src="images/000000.png" class="calibre40" /></a><code class="calibre14">

</code><code class="kd">class</code><code class="calibre14"> </code><code class="nx">Position</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><strong class="calibre49"><code class="k">constructor</code><code class="p1">(</code><code class="calibre50">
    </code><code class="k">private</code><code class="calibre50"> </code><code class="nx1">file</code><code class="calibre50">: </code><code class="kt1">File</code><code class="p1">,</code></strong><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-158" id="calibre_link-162"><img alt="2" src="images/000001.png" class="calibre40" /></a><code class="calibre14">
    </code><strong class="calibre49"><code class="k">private</code><code class="calibre50"> </code><code class="nx1">rank</code><code class="calibre50">: </code><code class="kt1">Rank</code><code class="calibre50">
  </code><code class="p1">)</code><code class="calibre50"> </code><code class="p1">{</code><code class="p1">}</code></strong><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">

</code><code class="kd">class</code><code class="calibre14"> </code><code class="nx">Piece</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><strong class="calibre49"><code class="k">protected</code><code class="calibre50"> </code><code class="nx1">position</code><code class="calibre50">: </code><code class="kt1">Position</code></strong><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-159" id="calibre_link-163"><img alt="3" src="images/000002.png" class="calibre40" /></a><code class="calibre14">
  </code><strong class="calibre49"><code class="k">constructor</code><code class="p1">(</code><code class="calibre50">
    </code><code class="k">private</code><code class="calibre50"> </code><code class="nx1">readonly</code><code class="calibre50"> </code><code class="nx1">color</code><code class="calibre50">: </code><code class="kt1">Color</code><code class="p1">,</code></strong><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-160" id="calibre_link-164"><img alt="4" src="images/000003.png" class="calibre40" /></a><code class="calibre14">
    </code><strong class="calibre49"><code class="nx1">file</code><code class="calibre50">: </code><code class="kt1">File</code><code class="p1">,</code><code class="calibre50">
    </code><code class="nx1">rank</code><code class="calibre50">: </code><code class="kt1">Rank</code><code class="calibre50">
  </code><code class="p1">)</code><code class="calibre50"> </code><code class="p1">{</code><code class="calibre50">
    </code><code class="k">this</code><code class="p1">.</code><code class="nx1">position</code><code class="calibre50"> </code><code class="o1">=</code><code class="calibre50"> </code><code class="k">new</code><code class="calibre50"> </code><code class="nx1">Position</code><code class="p1">(</code><code class="nx1">file</code><code class="p1">,</code><code class="calibre50"> </code><code class="nx1">rank</code><code class="p1">)</code><code class="calibre50">
  </code><code class="p1">}</code></strong><code class="calibre14">
</code><code class="p">}</code>
</pre>
<dl class="preface">
<dt class="calibre18"><a class="calibre4" href="#calibre_link-161" id="calibre_link-157"><img alt="1" src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">Since there are relatively few colors, ranks, and files, we can manually enumerate their possible values as type literals. This will let us squeeze out some extra safety by constraining these types’ domains from all strings and all numbers to a handful of very specific strings and numbers.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-162" id="calibre_link-158"><img alt="2" src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">The <code class="calibre14">private</code> <em class="calibre5">access modifier</em> in the constructor automatically assigns the parameter to <code class="calibre14">this</code> (<code class="calibre14">this.file</code> and so on), and sets its visibility to private, meaning that code within a <code class="calibre14">Piece</code> instance can read and write to it, but code outside of a <code class="calibre14">Piece</code> instance can’t. Different instances of <code class="calibre14">Piece</code> can access each other’s private members; instances of any other class&mdash;even a subclass of <code class="calibre14">Piece</code>&mdash;can’t.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-163" id="calibre_link-159"><img alt="3" src="images/000002.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We declare the instance variable <code class="calibre14">position</code> as <code class="calibre14">protected</code>. Like <code class="calibre14">private</code>, <code class="calibre14">protected</code> assigns the property to <code class="calibre14">this</code>, but unlike <code class="calibre14">private</code>, <code class="calibre14">protected</code> makes the property visible both to instances of <code class="calibre14">Piece</code> and to instances of any subclass of <code class="calibre14">Piece</code>. We didn’t assign <code class="calibre14">position</code> a value when declaring it, so we have to assign a value to it in <code class="calibre14">Piece</code>’s constructor function. If we hadn’t assigned it a value in the constructor, TypeScript would have told us that the variable is not <em class="calibre5">definitely assigned</em>, i.e., we said it’s of type <code class="calibre14">T</code>, but it’s actually <code class="calibre14">T | undefined</code> because it’s not assigned a value in a property initializer or in the constructor&mdash;so we would need to update its signature to indicate that it’s not necessarily a <code class="calibre14">Position</code>, but it might also be <code class="calibre14">undefined</code>.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-164" id="calibre_link-160"><img alt="4" src="images/000003.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45"><code class="calibre14">new Piece</code> takes three parameters: <code class="calibre14">color</code>, <code class="calibre14">file</code>, and <code class="calibre14">rank</code>. We added two modifiers to <code class="calibre14">color</code>: <code class="calibre14">private</code>, meaning assign it to <code class="calibre14">this</code> and make sure it’s only accessible from an instance of <code class="calibre14">Piece</code>, and <code class="calibre14">readonly</code>, meaning that after this initial assignment it can only be read and can’t be written anymore.</p></dd>
</dl>
<div data-type="tip" class="calibre21"><h1 class="calibre42">TSC Flags: strictNullChecks and strictPropertyInitialization</h1>
<p class="author1">To opt into definite assignment checks for class instance variables, enable <code class="calibre14">strictNullChecks</code> and <code class="calibre14">strictPropertyInitialization</code> flags in your <em class="calibre5">tsconfig.json</em>.<a data-primary="TSC compiler" data-secondary="strictNullChecks and strictPropertyInitialization flags" data-type="indexterm" id="calibre_link-1528" class="calibre4"></a><a data-primary="strictNullChecks and strictPropertyInitialization TSC flags" data-type="indexterm" id="calibre_link-1449" class="calibre4"></a> If you’re already using the <code class="calibre14">strict</code> flag, you’re good to go.</p>
</div>

<p class="author1">TypeScript supports three access modifiers <a data-primary="classes" data-secondary="and inheritance" data-tertiary="access modifiers for properties and methods" data-type="indexterm" id="calibre_link-733" class="calibre4"></a><a data-primary="methods" data-secondary="access modifiers for" data-type="indexterm" id="calibre_link-1209" class="calibre4"></a><a data-primary="properties" data-secondary="access modifiers for" data-type="indexterm" id="calibre_link-1385" class="calibre4"></a>for properties and methods on a class:</p>
<dl class="preface">
<dt class="calibre18"><code class="calibre14">public</code></dt>
<dd class="calibre19">
<p class="author1">Accessible from anywhere. <a data-primary="public (access modifier)" data-type="indexterm" id="calibre_link-1397" class="calibre4"></a>This is the default access level.</p>
</dd>
<dt class="calibre18"><code class="calibre14">protected</code></dt>
<dd class="calibre19">
<p class="author1">Accessible from instances of this class and its subclasses.<a data-primary="protected (access modifier)" data-type="indexterm" id="calibre_link-1390" class="calibre4"></a></p>
</dd>
<dt class="calibre18"><code class="calibre14">private</code></dt>
<dd class="calibre19">
<p class="author1">Accessible from instances of this class only.<a data-primary="private (access modifier)" data-type="indexterm" id="calibre_link-1370" class="calibre4"></a></p>
</dd>
</dl>

<p class="author1">Using access modifiers, you can design classes that don’t expose too much information about their implementations, and instead expose well-defined APIs for others to use.</p>

<p class="author1">We’ve defined a <code class="calibre14">Piece</code> class, but we don’t want users to instantiate a new <code class="calibre14">Piece</code> directly&mdash;we want them to extend it to create a <code class="calibre14">Queen</code>, a <code class="calibre14">Bishop</code>, and so on, and instantiate <em class="calibre5">that</em>. <a data-primary="classes" data-secondary="and inheritance" data-tertiary="abstract classes" data-type="indexterm" id="calibre_link-732" class="calibre4"></a><a data-primary="abstract classes" data-type="indexterm" id="calibre_link-602" class="calibre4"></a>We can use the type system to enforce that for us, using the <code class="calibre14">abstract</code> keyword:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<em class="calibre41"><code class="c2">// ...</code></em><code class="c">
</code><strong class="calibre49"><code class="k">abstract</code></strong><code class="calibre14"> </code><code class="kd">class</code><code class="calibre14"> </code><code class="nx">Piece</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="kd">constructor</code><code class="p">(</code><code class="calibre14">
    </code><em class="calibre41"><code class="c2">// ...</code></em><code class="c">
</code></pre>

<p class="author1">Now if you try to instantiate a <code class="calibre14">Piece</code> directly,<a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2511" data-type="indexterm" id="calibre_link-942" class="calibre4"></a> TypeScript complains:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">new</code> <code class="nx">Piece</code><code class="p">(</code><code class="s">'White'</code><code class="p">,</code> <code class="s">'E'</code><code class="p">,</code> <code class="mi">1</code><code class="p">)</code>  <code class="c">// Error TS2511: Cannot create an instance</code>
                            <code class="c">// of an abstract class.</code></pre>

<p class="author1">The <code class="calibre14">abstract</code> keyword means that you can’t instantiate the class directly, but it doesn’t mean you can’t define some methods on it:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<em class="calibre41"><code class="c2">// ...</code></em><code class="c">
</code><code class="kd">abstract</code><code class="calibre14"> </code><code class="kd">class</code><code class="calibre14"> </code><code class="nx">Piece</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><em class="calibre41"><code class="c2">// ...</code></em><code class="c">
</code><code class="calibre14">  </code><strong class="calibre49"><code class="nx1">moveTo</code><code class="p1">(</code><code class="nx1">position</code><code class="calibre50">: </code><code class="kt1">Position</code><code class="p1">)</code><code class="calibre50"> </code><code class="p1">{</code><code class="calibre50">
    </code><code class="k">this</code><code class="p1">.</code><code class="nx1">position</code><code class="calibre50"> </code><code class="o1">=</code><code class="calibre50"> </code><code class="nx1">position</code><code class="calibre50">
  </code><code class="p1">}</code><code class="calibre50">
  </code><code class="k">abstract</code><code class="calibre50"> </code><code class="nx1">canMoveTo</code><code class="p1">(</code><code class="nx1">position</code><code class="calibre50">: </code><code class="kt1">Position</code><code class="p1">)</code><code class="o1">:</code><code class="calibre50"> </code><code class="k">boolean</code></strong><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code></pre>

<p class="author1">Our <code class="calibre14">Piece</code> class now:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">Tells its subclasses that they have to implement a method called <code class="calibre14">canMoveTo</code> that is compatible with the given signature. If a class extends <code class="calibre14">Piece</code> but forgets to implement the abstract <code class="calibre14">canMoveTo</code> method, that’s a type error at compile time: when you implement an abstract class, you have to implement its abstract methods too.<a data-primary="methods" data-secondary="abstract" data-type="indexterm" id="calibre_link-1208" class="calibre4"></a></p>
</li>
<li class="calibre11">
<p class="author1">Comes with a default implementation for <code class="calibre14">moveTo</code> (which its subclasses can override if they want). We didn’t put an access modifier on <code class="calibre14">moveTo</code>, so it’s <code class="calibre14">public</code> by default, meaning it’s readable and writable from any other code.<a data-primary="public (access modifier)" data-secondary="methods" data-type="indexterm" id="calibre_link-1398" class="calibre4"></a></p>
</li>
</ul>

<p class="author1">Let’s update <code class="calibre14">King</code> to implement <code class="calibre14">canMoveTo</code>, to satisfy this new requirement. We’ll also implement a <code class="calibre14">distanceFrom</code> function for convenience, so we can easily compute the distance between two pieces:</p>
<pre class="calibre30" data-code-language="ts" data-type="programlisting">
<em class="calibre41"><code class="c2">// ...</code></em><code class="c">
</code><code class="kd">class</code><code class="calibre14"> </code><code class="nx">Position</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><em class="calibre41"><code class="c2">// ...</code></em><code class="c">
</code><code class="calibre14">  </code><strong class="calibre49"><code class="nx1">distanceFrom</code><code class="p1">(</code><code class="nx1">position</code><code class="calibre50">: </code><code class="kt1">Position</code><code class="p1">)</code><code class="calibre50"> </code><code class="p1">{</code><code class="calibre50">
    </code><code class="k">return</code><code class="calibre50"> </code><code class="p1">{</code><code class="calibre50">
      </code><code class="nx1">rank</code><code class="calibre50">: </code><code class="kt1">Math.abs</code><code class="p1">(</code><code class="nx1">position</code><code class="p1">.</code><code class="nx1">rank</code><code class="calibre50"> </code><code class="o1">-</code><code class="calibre50"> </code><code class="k">this</code><code class="p1">.</code><code class="nx1">rank</code><code class="p1">)</code><code class="p1">,</code><code class="calibre50">
      </code><code class="nx1">file</code><code class="calibre50">: </code><code class="kt1">Math.abs</code><code class="p1">(</code><code class="nx1">position</code><code class="p1">.</code><code class="nx1">file</code><code class="p1">.</code><code class="nx1">charCodeAt</code><code class="p1">(</code><code class="mi1">0</code><code class="p1">)</code><code class="calibre50"> </code><code class="o1">-</code><code class="calibre50"> </code><code class="k">this</code><code class="p1">.</code><code class="nx1">file</code><code class="p1">.</code><code class="nx1">charCodeAt</code><code class="p1">(</code><code class="mi1">0</code><code class="p1">)</code><code class="p1">)</code><code class="calibre50">
    </code><code class="p1">}</code><code class="calibre50">
  </code><code class="p1">}</code></strong><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">

</code><code class="kd">class</code><code class="calibre14"> </code><code class="nx">King</code><code class="calibre14"> </code><code class="kd">extends</code><code class="calibre14"> </code><code class="nx">Piece</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><strong class="calibre49"><code class="nx1">canMoveTo</code><code class="p1">(</code><code class="nx1">position</code><code class="calibre50">: </code><code class="kt1">Position</code><code class="p1">)</code><code class="calibre50"> </code><code class="p1">{</code><code class="calibre50">
    </code><code class="k">let</code><code class="calibre50"> </code><code class="nx1">distance</code><code class="calibre50"> </code><code class="o1">=</code><code class="calibre50"> </code><code class="k">this</code><code class="p1">.</code><code class="nx1">position</code><code class="p1">.</code><code class="nx1">distanceFrom</code><code class="p1">(</code><code class="nx1">position</code><code class="p1">)</code><code class="calibre50">
    </code><code class="k">return</code><code class="calibre50"> </code><code class="nx1">distance</code><code class="p1">.</code><code class="nx1">rank</code><code class="calibre50"> </code><code class="o1">&lt;</code><code class="calibre50"> </code><code class="mi1">2</code><code class="calibre50"> </code><code class="o1">&amp;&amp;</code><code class="calibre50"> </code><code class="nx1">distance</code><code class="p1">.</code><code class="nx1">file</code><code class="calibre50"> </code><code class="o1">&lt;</code><code class="calibre50"> </code><code class="mi1">2</code><code class="calibre50">
  </code><code class="p1">}</code></strong><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code></pre>

<p class="author1">When we make a new game, we’ll automatically create a board and some pieces:</p>
<pre class="calibre30" data-code-language="ts" data-type="programlisting">
<em class="calibre41"><code class="c2">// ...</code></em><code class="c">
</code><code class="kd">class</code><code class="calibre14"> </code><code class="nx">Game</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><strong class="calibre49"><code class="k">private</code><code class="calibre50"> </code><code class="nx1">pieces</code><code class="calibre50"> </code><code class="o1">=</code><code class="calibre50"> </code><code class="nx1">Game</code><code class="p1">.</code><code class="nx1">makePieces</code><code class="p1">(</code><code class="p1">)</code><code class="calibre50">

  </code><code class="k">private</code><code class="calibre50"> </code><code class="k">static</code><code class="calibre50"> </code><code class="nx1">makePieces() {</code><code class="calibre50">
    </code><code class="k">return</code><code class="calibre50"> </code><code class="p1">[</code><code class="calibre50">

      </code><code class="c3">// Kings
</code><code class="calibre50">      </code><code class="k">new</code><code class="calibre50"> </code><code class="nx1">King</code><code class="p1">(</code><code class="s1">'White'</code><code class="p1">,</code><code class="calibre50"> </code><code class="s1">'E'</code><code class="p1">,</code><code class="calibre50"> </code><code class="mi1">1</code><code class="p1">)</code><code class="p1">,</code><code class="calibre50">
      </code><code class="k">new</code><code class="calibre50"> </code><code class="nx1">King</code><code class="p1">(</code><code class="s1">'Black'</code><code class="p1">,</code><code class="calibre50"> </code><code class="s1">'E'</code><code class="p1">,</code><code class="calibre50"> </code><code class="mi1">8</code><code class="p1">)</code><code class="p1">,</code><code class="calibre50">

      </code><code class="c3">// Queens
</code><code class="calibre50">      </code><code class="k">new</code><code class="calibre50"> </code><code class="nx1">Queen</code><code class="p1">(</code><code class="s1">'White'</code><code class="p1">,</code><code class="calibre50"> </code><code class="s1">'D'</code><code class="p1">,</code><code class="calibre50"> </code><code class="mi1">1</code><code class="p1">)</code><code class="p1">,</code><code class="calibre50">
      </code><code class="k">new</code><code class="calibre50"> </code><code class="nx1">Queen</code><code class="p1">(</code><code class="s1">'Black'</code><code class="p1">,</code><code class="calibre50"> </code><code class="s1">'D'</code><code class="p1">,</code><code class="calibre50"> </code><code class="mi1">8</code><code class="p1">)</code><code class="p1">,</code><code class="calibre50">

      </code><code class="c3">// Bishops
</code><code class="calibre50">      </code><code class="k">new</code><code class="calibre50"> </code><code class="nx1">Bishop</code><code class="p1">(</code><code class="s1">'White'</code><code class="p1">,</code><code class="calibre50"> </code><code class="s1">'C'</code><code class="p1">,</code><code class="calibre50"> </code><code class="mi1">1</code><code class="p1">)</code><code class="p1">,</code><code class="calibre50">
      </code><code class="k">new</code><code class="calibre50"> </code><code class="nx1">Bishop</code><code class="p1">(</code><code class="s1">'White'</code><code class="p1">,</code><code class="calibre50"> </code><code class="s1">'F'</code><code class="p1">,</code><code class="calibre50"> </code><code class="mi1">1</code><code class="p1">)</code><code class="p1">,</code><code class="calibre50">
      </code><code class="k">new</code><code class="calibre50"> </code><code class="nx1">Bishop</code><code class="p1">(</code><code class="s1">'Black'</code><code class="p1">,</code><code class="calibre50"> </code><code class="s1">'C'</code><code class="p1">,</code><code class="calibre50"> </code><code class="mi1">8</code><code class="p1">)</code><code class="p1">,</code><code class="calibre50">
      </code><code class="k">new</code><code class="calibre50"> </code><code class="nx1">Bishop</code><code class="p1">(</code><code class="s1">'Black'</code><code class="p1">,</code><code class="calibre50"> </code><code class="s1">'F'</code><code class="p1">,</code><code class="calibre50"> </code><code class="mi1">8</code><code class="p1">)</code><code class="p1">,</code></strong><code class="calibre14">

      </code><em class="calibre41"><code class="c2">// ...</code></em><code class="c">
</code><code class="calibre14">    </code><strong class="calibre49"><code class="p1">]</code></strong><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code></pre>

<p class="author1">Because of how strictly we typed <code class="calibre14">Rank</code> and <code class="calibre14">File</code>, if we had entered another letter (like <code class="calibre14">'J'</code>) or an out-of-range number (like <code class="calibre14">12</code>), TypeScript would have given us a compile-time error (<a data-type="xref" href="#calibre_link-165" class="calibre4">Figure&nbsp;5-2</a>).</p>

<figure class="calibre33"><div class="figure" id="calibre_link-165">
<img alt="prts 0502" src="images/000017.png" class="calibre40" />
<h6 class="calibre34"><span class="calibre">Figure 5-2. </span>TypeScript helps us stick to valid ranks and files</h6>
</div></figure>

<p class="author1">This is enough to show off how TypeScript classes work&mdash;I’ll avoid getting into the nitty-gritty details like how to know when a knight can take a piece, how bishops move, and so on. If you’re ambitious, see if you can use what we’ve done so far as a starting point to implement the rest of the game yourself.</p>

<p class="author1">To sum up:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">Declare classes with the <code class="calibre14">class</code> keyword. Extend them with the <code class="calibre14">extends</code> keyword.<a data-primary="extends keyword" data-type="indexterm" id="calibre_link-999" class="calibre4"></a><a data-primary="class keyword" data-type="indexterm" id="calibre_link-728" class="calibre4"></a></p>
</li>
<li class="calibre11">
<p class="author1">Classes can be either concrete or <code class="calibre14">abstract</code>. Abstract classes can have <code class="calibre14">abstract</code> methods and <code class="calibre14">abstract</code> properties.<a data-primary="abstract classes" data-type="indexterm" id="calibre_link-603" class="calibre4"></a></p>
</li>
<li class="calibre11">
<p class="author1">Methods can be <code class="calibre14">private</code>, <code class="calibre14">protected</code>, or, by default, <code class="calibre14">public</code>. They can be instance methods or static methods.<a data-primary="methods" data-type="indexterm" id="calibre_link-1207" class="calibre4"></a><a data-primary="instance methods" data-type="indexterm" id="calibre_link-1112" class="calibre4"></a></p>
</li>
<li class="calibre11">
<p class="author1">Classes can have instance properties, which can also be <code class="calibre14">private</code>, <code class="calibre14">protected</code>, or, by default, <code class="calibre14">public</code>. You can declare them in constructor parameters or as property initializers.</p>
</li>
<li class="calibre11">
<p class="author1">You can mark instance properties as <code class="calibre14">readonly</code> when declaring them.</p>
</li>
</ul>
</div></section>













<section data-pdf-bookmark="super" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1850">
<h1 class="calibre13">super</h1>

<p class="author1">Like JavaScript, TypeScript supports <code class="calibre14">super</code> calls.<a data-primary="classes" data-secondary="super calls" data-type="indexterm" id="calibre_link-751" class="calibre4"></a><a data-primary="super calls" data-type="indexterm" id="calibre_link-1461" class="calibre4"></a> If your child class overrides a method defined on its parent class (say, if <code class="calibre14">Queen</code> and <code class="calibre14">Piece</code> both implement the <code class="calibre14">take</code> method), the child instance can make a <code class="calibre14">super</code> call to call its parent’s version of the method (e.g., <code class="calibre14">super.take</code>). There are two kinds of <code class="calibre14">super</code> calls:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">Method calls, like <code class="calibre14">super.take</code>.</p>
</li>
<li class="calibre11">
<p class="author1">Constructor calls, which have the special form <code class="calibre14">super()</code> and can only be called from a constructor function. If your child class has a constructor function, you must call <code class="calibre14">super()</code> from the child’s constructor to correctly wire up the class (don’t worry, TypeScript will warn you if you forget; it’s like a cool futuristic robot elephant in that way).<a data-primary="constructors" data-secondary="super calls" data-type="indexterm" id="calibre_link-805" class="calibre4"></a></p>
</li>
</ul>

<p class="author1">Note that you can only access a parent class’s methods, and not its properties, with <code class="calibre14">super</code>.</p>
</div></section>













<section data-pdf-bookmark="Using this as a Return Type" data-type="sect1" class="preface"><div class="preface" id="calibre_link-223">
<h1 class="calibre13">Using this as a Return Type</h1>

<p class="author1">Just like you can use <code class="calibre14">this</code> as a value, you can also use it as a type (like we did in <a data-type="xref" href="#calibre_link-81" class="calibre4">“Typing this”</a>). When working with classes, the <code class="calibre14">this</code> type can be useful for annotating methods’ return types.<a data-primary="classes" data-secondary="using this as return type" data-type="indexterm" id="calibre_link-752" class="calibre4"></a><a data-primary="this variable" data-secondary="using as method return type" data-type="indexterm" id="calibre_link-1479" class="calibre4"></a><a data-primary="return types" data-secondary="this variable" data-type="indexterm" id="calibre_link-1423" class="calibre4"></a></p>

<p class="author1">For example, let’s build a simplified version of ES6’s <code class="calibre14">Set</code> data structure that supports two operations: adding a number to the set, and checking whether or not a given number is in the set. You use it like this:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">set</code> <code class="o">=</code> <code class="kd">new</code> <code class="nx">Set</code>
<code class="nx">set</code><code class="p">.</code><code class="nx">add</code><code class="p">(</code><code class="mi">1</code><code class="p">).</code><code class="nx">add</code><code class="p">(</code><code class="mi">2</code><code class="p">).</code><code class="nx">add</code><code class="p">(</code><code class="mi">3</code><code class="p">)</code>
<code class="nx">set</code><code class="p">.</code><code class="nx">has</code><code class="p">(</code><code class="mi">2</code><code class="p">)</code> <code class="c">// true</code>
<code class="nx">set</code><code class="p">.</code><code class="nx">has</code><code class="p">(</code><code class="mi">4</code><code class="p">)</code> <code class="c">// false</code></pre>

<p class="author1">Let’s define the <code class="calibre14">Set</code> class, starting with the <code class="calibre14">has</code> method:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">class</code> <code class="nx">Set</code> <code class="p">{</code>
  <code class="nx">has</code><code class="p">(</code><code class="nx">value</code>: <code class="kt">number</code><code class="p">)</code><code class="o">:</code> <code class="kd">boolean</code> <code class="p">{</code>
    <code class="c">// ...</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p class="author1">How about <code class="calibre14">add</code>? When you call <code class="calibre14">add</code>, you get back an instance of <code class="calibre14">Set</code>. We could type that as:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<code class="kd">class</code><code class="calibre14"> </code><code class="nx">Set</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="nx">has</code><code class="p">(</code><code class="nx">value</code><code class="calibre14">: </code><code class="kt">number</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="kd">boolean</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
    </code><em class="calibre41"><code class="c2">// ...</code></em><code class="c">
</code><code class="calibre14">  </code><code class="p">}</code><code class="calibre14">
  </code><strong class="calibre49"><code class="nx1">add</code><code class="p1">(</code><code class="nx1">value</code><code class="calibre50">: </code><code class="kt1">number</code><code class="p1">)</code><code class="o1">:</code><code class="calibre50"> </code><code class="nx1">Set</code><code class="calibre50"> </code><code class="p1">{</code></strong><code class="calibre14">
    </code><em class="calibre41"><code class="c2">// ...</code></em><code class="c">
</code><code class="calibre14">  </code><strong class="calibre49"><code class="p1">}</code></strong><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code></pre>

<p class="author1">So far, so good. What happens when we try to subclass <code class="calibre14">Set</code>?</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">class</code> <code class="nx">MutableSet</code> <code class="kd">extends</code> <code class="nx">Set</code> <code class="p">{</code>
  <code class="kd">delete</code><code class="p">(</code><code class="nx">value</code>: <code class="kt">number</code><code class="p">)</code><code class="o">:</code> <code class="kd">boolean</code> <code class="p">{</code>
    <code class="c">// ...</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p class="author1">Of course, <code class="calibre14">Set</code>’s <code class="calibre14">add</code> method still returns a <code class="calibre14">Set</code>, which we’ll need to override with <code class="calibre14">MutableSet</code> for our subclass:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<code class="kd">class</code><code class="calibre14"> </code><code class="nx">MutableSet</code><code class="calibre14"> </code><code class="kd">extends</code><code class="calibre14"> </code><code class="nx">Set</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="kd">delete</code><code class="p">(</code><code class="nx">value</code><code class="calibre14">: </code><code class="kt">number</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="kd">boolean</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
    </code><code class="c">// ...
</code><code class="calibre14">  </code><code class="p">}</code><code class="calibre14">
  </code><strong class="calibre49"><code class="nx1">add</code><code class="p1">(</code><code class="nx1">value</code><code class="calibre50">: </code><code class="kt1">number</code><code class="p1">)</code><code class="o1">:</code><code class="calibre50"> </code><code class="nx1">MutableSet</code><code class="calibre50"> </code><code class="p1">{</code><code class="calibre50">
    </code><code class="c3">// ...
</code><code class="calibre50">  </code><code class="p1">}</code></strong><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code></pre>

<p class="author1">This can get a bit tedious when working with classes that extend other classes&mdash;you have to override the signature for each method that returns <code class="calibre14">this</code>. And if you end up having to override each method to please the typechecker, what’s the point of inheriting from your base class at all?</p>

<p class="author1">Instead, you can use <code class="calibre14">this</code> as a return type annotation to let TypeScript do the work for you:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<code class="kd">class</code><code class="calibre14"> </code><code class="nx">Set</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="nx">has</code><code class="p">(</code><code class="nx">value</code><code class="calibre14">: </code><code class="kt">number</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="kd">boolean</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
    </code><code class="c">// ...
</code><code class="calibre14">  </code><code class="p">}</code><code class="calibre14">
  </code><code class="nx">add</code><code class="p">(</code><code class="nx">value</code><code class="calibre14">: </code><code class="kt">number</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><strong class="calibre49"><code class="k">this</code></strong><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
    </code><code class="c">// ...
</code><code class="calibre14">  </code><code class="p">}</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code></pre>

<p class="author1">Now, you can remove the <code class="calibre14">add</code> override from <code class="calibre14">MutableSet</code>, since <code class="calibre14">this</code> in <code class="calibre14">Set</code> points to a <code class="calibre14">Set</code> instance, and <code class="calibre14">this</code> in <code class="calibre14">MutableSet</code> points to a <code class="calibre14">MutableSet</code> instance:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">class</code> <code class="nx">MutableSet</code> <code class="kd">extends</code> <code class="nx">Set</code> <code class="p">{</code>
  <code class="kd">delete</code><code class="p">(</code><code class="nx">value</code>: <code class="kt">number</code><code class="p">)</code><code class="o">:</code> <code class="kd">boolean</code> <code class="p">{</code>
    <code class="c">// ...</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p class="author1">This is a really convenient feature for working with chained APIs, like we do in <a data-type="xref" href="#calibre_link-166" class="calibre4">“Builder Pattern”</a>.<a data-primary="classes" data-startref="ix_class" data-type="indexterm" id="calibre_link-730" class="calibre4"></a></p>
</div></section>













<section class="preface" data-pdf-bookmark="Interfaces" data-type="sect1"><div class="preface" id="calibre_link-106">
<h1 class="calibre13">Interfaces</h1>

<p class="author1">When you use classes, you will often find yourself using them with <em class="calibre5">interfaces</em>.</p>

<p class="author1">Like type aliases, interfaces are a way to name a type so you don’t have to define it inline.<a data-primary="interfaces" data-type="indexterm" id="calibre_link-1114" class="calibre4"></a> Type aliases and interfaces are mostly two syntaxes for the same thing (like function expressions and function declarations), but there are a few small differences.<a data-primary="type aliases" data-secondary="comparison with interfaces" data-type="indexterm" id="calibre_link-1553" class="calibre4"></a><a data-primary="interfaces" data-secondary="comparison with type aliases" data-type="indexterm" id="calibre_link-1118" class="calibre4"></a> Let’s start with what they have in common. Consider the following type alias:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">Sushi</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">calories</code>: <code class="kt">number</code>
  <code class="nx">salty</code>: <code class="kt">boolean</code>
  <code class="nx">tasty</code>: <code class="kt">boolean</code>
<code class="p">}</code></pre>

<p class="author1">It’s easy to rewrite it as an interface:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<strong class="calibre49"><code class="k">interface</code><code class="calibre50"> </code><code class="nx1">Sushi</code></strong><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="nx">calories</code><code class="calibre14">: </code><code class="kt">number</code><code class="calibre14">
  </code><code class="nx">salty</code><code class="calibre14">: </code><code class="kt">boolean</code><code class="calibre14">
  </code><code class="nx">tasty</code><code class="calibre14">: </code><code class="kt">boolean</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code></pre>

<p class="author1">Everywhere you used your <code class="calibre14">Sushi</code> type alias, you can also use your <code class="calibre14">Sushi</code> interface. Both declarations define shapes, and those shapes are assignable to one another (in fact, they’re identical!).</p>

<p class="author1">Things get more interesting when you start combining types. Let’s model another food in addition to <code class="calibre14">Sushi</code>:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">Cake</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">calories</code>: <code class="kt">number</code>
  <code class="nx">sweet</code>: <code class="kt">boolean</code>
  <code class="nx">tasty</code>: <code class="kt">boolean</code>
<code class="p">}</code></pre>

<p class="author1">A lot of foods have calories and are tasty&mdash;not just <code class="calibre14">Sushi</code> and <code class="calibre14">Cake</code>. Let’s pull <code class="calibre14">Food</code> out into its own type, and redefine our foods in terms of it:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<code class="nx">type</code><code class="calibre14"> </code><code class="nx">Food</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="nx">calories</code><code class="calibre14">: </code><code class="kt">number</code><code class="calibre14">
  </code><code class="nx">tasty</code><code class="calibre14">: </code><code class="kt">boolean</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code><code class="nx">type</code><code class="calibre14"> </code><code class="nx">Sushi</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><strong class="calibre49"><code class="nx1">Food</code><code class="calibre50"> </code><code class="o1">&amp;</code></strong><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="nx">salty</code><code class="calibre14">: </code><code class="kt">boolean</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code><code class="nx">type</code><code class="calibre14"> </code><code class="nx">Cake</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><strong class="calibre49"><code class="nx1">Food</code><code class="calibre50"> </code><code class="o1">&amp;</code></strong><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="nx">sweet</code><code class="calibre14">: </code><code class="kt">boolean</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code></pre>

<p class="author1">Nearly equivalently, you can do that with interfaces too:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<code class="kd">interface</code><code class="calibre14"> </code><code class="nx">Food</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="nx">calories</code><code class="calibre14">: </code><code class="kt">number</code><code class="calibre14">
  </code><code class="nx">tasty</code><code class="calibre14">: </code><code class="kt">boolean</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code><code class="kd">interface</code><code class="calibre14"> </code><code class="nx">Sushi</code><code class="calibre14"> </code><strong class="calibre49"><code class="k">extends</code><code class="calibre50"> </code><code class="nx1">Food</code></strong><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="nx">salty</code><code class="calibre14">: </code><code class="kt">boolean</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code><code class="kd">interface</code><code class="calibre14"> </code><code class="nx">Cake</code><code class="calibre14"> </code><strong class="calibre49"><code class="k">extends</code><code class="calibre50"> </code><code class="nx1">Food</code></strong><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="nx">sweet</code><code class="calibre14">: </code><code class="kt">boolean</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code></pre>
<div data-type="note" type="note" class="calibre21"><h6 class="calibre22">Note</h6>
<p class="author1">Interfaces don’t have to extend other interfaces. In fact, an interface can extend any shape: an object <code class="calibre14">type</code>, a <code class="calibre14">class</code>, or another <code class="calibre14">interface</code>.<a data-primary="interfaces" data-secondary="extending objects, classes, or other interfaces" data-type="indexterm" id="calibre_link-1120" class="calibre4"></a></p>
</div>

<p class="author1">What are the differences between types and interfaces? There are three, and they’re subtle.</p>

<p class="author1">The first is that type aliases are more general, in that their righthand side can be any type, including a type expression (a type, and maybe some type operators like <code class="calibre14">&amp;</code> or <code class="calibre14">|</code>); for an interface, the righthand side must be a shape. For example, there is no way to rewrite the following type aliases as interfaces:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">A</code> <code class="o">=</code> <code class="kt">number</code>
<code class="nx">type</code> <code class="nx">B</code> <code class="o">=</code> <code class="nx">A</code> <code class="o">|</code> <code class="kt">string</code></pre>

<p class="author1">The second difference is that when you extend an interface, TypeScript will make sure that the interface you’re extending is assignable to your extension. For <a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2430" data-type="indexterm" id="calibre_link-938" class="calibre4"></a>example:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">interface</code> <code class="nx">A</code> <code class="p">{</code>
  <code class="nx">good</code><code class="p">(</code><code class="nx">x</code>: <code class="kt">number</code><code class="p">)</code><code class="o">:</code> <code class="kt">string</code>
  <code class="nx">bad</code><code class="p">(</code><code class="nx">x</code>: <code class="kt">number</code><code class="p">)</code><code class="o">:</code> <code class="kt">string</code>
<code class="p">}</code>

<code class="kd">interface</code> <code class="nx">B</code> <code class="kd">extends</code> <code class="nx">A</code> <code class="p">{</code>
  <code class="nx">good</code><code class="p">(</code><code class="nx">x</code>: <code class="kt">string</code> <code class="o">|</code> <code class="kt">number</code><code class="p">)</code><code class="o">:</code> <code class="kt">string</code>
  <code class="nx">bad</code><code class="p">(</code><code class="nx">x</code>: <code class="kt">string</code><code class="p">)</code><code class="o">:</code> <code class="kt">string</code>  <code class="c">// Error TS2430: Interface 'B' incorrectly extends</code>
<code class="p">}</code>                         <code class="c">// interface 'A'. Type 'number' is not assignable</code>
                          <code class="c">// to type 'string'.</code></pre>

<p class="author1">This is not the case when you use <a data-primary="intersection types" data-type="indexterm" id="calibre_link-1129" class="calibre4"></a>intersection types: if you turn the interfaces from the last example into type aliases and the <code class="calibre14">extends</code> into an intersection (<code class="calibre14">&amp;</code>), TypeScript will do its best to combine your extension with the type it’s extending, resulting in an overloaded signature for <code class="calibre14">bad</code> instead of a compile-time error (try it in your code <span class="calibre">editor!</span>).</p>

<p class="author1">When you’re modeling inheritance for object types, the assignability check that TypeScript does for interfaces can be a helpful tool to catch errors.</p>

<p class="author1">The third difference is that multiple interfaces with the same name in the same scope are automatically merged; multiple <em class="calibre5">type aliases</em> with the same name in the same scope will throw a compile-time error. This is a feature called <em class="calibre5">declaration merging</em>.</p>








<section data-pdf-bookmark="Declaration Merging" data-type="sect2" class="preface"><div class="preface" id="calibre_link-329">
<h2 class="calibre17">Declaration Merging</h2>

<p class="author1">Declaration merging is TypeScript’s way of automatically combining multiple declarations that share the same name.<a data-primary="declaration merging" data-type="indexterm" id="calibre_link-819" class="calibre4"></a><a data-primary="interfaces" data-secondary="declaration merging" data-type="indexterm" id="calibre_link-1119" class="calibre4"></a>  It came up when we introduced enums (<a data-type="xref" href="#calibre_link-167" class="calibre4">“Enums”</a>), and it also comes up when working with other features like <code class="calibre14">namespace</code> declarations (see <a data-type="xref" href="#calibre_link-168" class="calibre4">“Namespaces”</a>). In this section we’ll briefly introduce declaration merging in the context of interfaces. For a deeper dive, head over to <a data-type="xref" href="#calibre_link-55" class="calibre4">“Declaration Merging”</a>.</p>

<p class="author1">For example, if you declare two identically named <code class="calibre14">User</code> interfaces, then TypeScript will automatically combine them for you into a single interface:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// User has a single field, name</code>
<code class="kd">interface</code> <code class="nx">User</code> <code class="p">{</code>
  <code class="nx">name</code>: <code class="kt">string</code>
<code class="p">}</code>

<code class="c">// User now has two fields, name and age</code>
<code class="kd">interface</code> <code class="nx">User</code> <code class="p">{</code>
  <code class="nx">age</code>: <code class="kt">number</code>
<code class="p">}</code>

<code class="kd">let</code> <code class="nx">a</code>: <code class="kt">User</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">name</code><code class="o">:</code> <code class="s">'Ashley'</code><code class="p">,</code>
  <code class="nx">age</code>: <code class="kt">30</code>
<code class="p">}</code></pre>

<p class="author1">Here’s what <a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2300" data-type="indexterm" id="calibre_link-895" class="calibre4"></a>happens if you repeat that example with type aliases:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">User</code> <code class="o">=</code> <code class="p">{</code>  <code class="c">// Error TS2300: Duplicate identifier 'User'.</code>
  <code class="nx">name</code>: <code class="kt">string</code>
<code class="p">}</code>

<code class="nx">type</code> <code class="nx">User</code> <code class="o">=</code> <code class="p">{</code>  <code class="c">// Error TS2300: Duplicate identifier 'User'.</code>
  <code class="nx">age</code>: <code class="kt">number</code>
<code class="p">}</code></pre>

<p class="author1">Note that the two interfaces can’t conflict; if one types <code class="calibre14">property</code> as a <code class="calibre14">T</code> and the other types it as a <code class="calibre14">U</code>, and <code class="calibre14">T</code> and <code class="calibre14">U</code> aren’t identical, then you’ll get an <a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2717" data-type="indexterm" id="calibre_link-954" class="calibre4"></a>error:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">interface</code> <code class="nx">User</code> <code class="p">{</code>
  <code class="nx">age</code>: <code class="kt">string</code>
<code class="p">}</code>

<code class="kd">interface</code> <code class="nx">User</code> <code class="p">{</code>
  <code class="nx">age</code>: <code class="kt">number</code>  <code class="c">// Error TS2717: Subsequent property declarations must have</code>
<code class="p">}</code>              <code class="c">// the same type. Property 'age' must be of type 'string',</code>
               <code class="c">// but here has type 'number'.</code></pre>

<p class="author1">And if your interface declares generics (skip ahead to <a data-type="xref" href="#calibre_link-105" class="calibre4">“Polymorphism”</a> to learn more),<a data-primary="generics" data-secondary="interface declaring" data-type="indexterm" id="calibre_link-1075" class="calibre4"></a> those generics have to be declared the exact same way for two interfaces to be mergeable&mdash;down to the generic’s name!</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">interface</code> <code class="nx">User</code><code class="o">&lt;</code><code class="nx">Age</code> <code class="kd">extends</code> <code class="kt">number</code><code class="o">&gt;</code> <code class="p">{</code>  <code class="c">// Error TS2428: All declarations of 'User'</code>
  <code class="nx">age</code>: <code class="kt">Age</code>                            <code class="c">// must have identical type parameters.</code>
<code class="p">}</code>

<code class="kd">interface</code> <code class="nx">User</code><code class="o">&lt;</code><code class="nx">Age</code> <code class="kd">extends</code> <code class="kt">string</code><code class="o">&gt;</code> <code class="p">{</code>
  <code class="nx">age</code>: <code class="kt">Age</code>
<code class="p">}</code></pre>

<p class="author1">Interestingly, this <a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2428" data-type="indexterm" id="calibre_link-937" class="calibre4"></a>is a rare place where TypeScript checks that two types are not only assignable, but <em class="calibre5">identical</em>.</p>
</div></section>













<section data-pdf-bookmark="Implementations" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1851">
<h2 class="calibre17">Implementations</h2>

<p class="author1">When you declare a class, you can use the <code class="calibre14">implements</code> keyword to say that it satisfies a particular interface.<a data-primary="classes" data-secondary="implementing interfaces" data-type="indexterm" id="calibre_link-744" class="calibre4"></a><a data-primary="interfaces" data-secondary="implementation" data-type="indexterm" id="calibre_link-1121" class="calibre4"></a><a data-primary="implements keyword" data-type="indexterm" id="calibre_link-1091" class="calibre4"></a> Like other explicit type annotations, this is a convenient way to add a type-level constraint that your class is implemented correctly as closely as possible to the implementation itself, so that the error from an incorrect implementation doesn’t show up downstream where it’s less clear why it was thrown. It’s also a familiar way to implement common design patterns like adapters, factories, and strategies (see the end of this chapter for some examples).</p>

<p class="author1">Here’s what that looks like:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">interface</code> <code class="nx">Animal</code> <code class="p">{</code>
  <code class="nx">eat</code><code class="p">(</code><code class="nx">food</code>: <code class="kt">string</code><code class="p">)</code><code class="o">:</code> <code class="kd">void</code>
  <code class="nx">sleep</code><code class="p">(</code><code class="nx">hours</code>: <code class="kt">number</code><code class="p">)</code><code class="o">:</code> <code class="kd">void</code>
<code class="p">}</code>

<code class="kd">class</code> <code class="nx">Cat</code> <code class="kd">implements</code> <code class="nx">Animal</code> <code class="p">{</code>
  <code class="nx">eat</code><code class="p">(</code><code class="nx">food</code>: <code class="kt">string</code><code class="p">)</code> <code class="p">{</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">info</code><code class="p">(</code><code class="s">'Ate some'</code><code class="p">,</code> <code class="nx">food</code><code class="p">,</code> <code class="s">'. Mmm!'</code><code class="p">)</code>
  <code class="p">}</code>
  <code class="nx">sleep</code><code class="p">(</code><code class="nx">hours</code>: <code class="kt">number</code><code class="p">)</code> <code class="p">{</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">info</code><code class="p">(</code><code class="s">'Slept for'</code><code class="p">,</code> <code class="nx">hours</code><code class="p">,</code> <code class="s">'hours'</code><code class="p">)</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p class="author1"><code class="calibre14">Cat</code> has to implement every method that <code class="calibre14">Animal</code> declares, and can implement more methods and properties on top if it wants.</p>

<p class="author1">Interfaces can declare instance properties, but they can’t declare visibility modifiers (<code class="calibre14">private</code>, <code class="calibre14">protected</code>, and <code class="calibre14">public</code>) and they can’t use the <code class="calibre14">static</code> keyword. You can also mark instance properties as <code class="calibre14">readonly</code>, just like we did for object types in Objects (in <a data-type="xref" href="#calibre_link-169" class="calibre4">Chapter&nbsp;3</a>):</p>
<pre class="calibre30" data-code-language="ts" data-type="programlisting">
<code class="kd">interface</code><code class="calibre14"> </code><code class="nx">Animal</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><strong class="calibre49"><code class="nx1">readonly</code><code class="calibre50"> </code><code class="nx1">name</code><code class="calibre50">: </code><code class="kt1">string</code></strong><code class="calibre14">
  </code><code class="nx">eat</code><code class="p">(</code><code class="nx">food</code><code class="calibre14">: </code><code class="kt">string</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="kd">void</code><code class="calibre14">
  </code><code class="nx">sleep</code><code class="p">(</code><code class="nx">hours</code><code class="calibre14">: </code><code class="kt">number</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="kd">void</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code></pre>

<p class="author1">You’re not limited to implementing just one interface&mdash;you can implement as many as you want:</p>
<pre class="calibre30" data-code-language="ts" data-type="programlisting">
<code class="kd">interface</code><code class="calibre14"> </code><code class="nx">Animal</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="nx">readonly</code><code class="calibre14"> </code><code class="nx">name</code><code class="calibre14">: </code><code class="kt">string</code><code class="calibre14">
  </code><code class="nx">eat</code><code class="p">(</code><code class="nx">food</code><code class="calibre14">: </code><code class="kt">string</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="kd">void</code><code class="calibre14">
  </code><code class="nx">sleep</code><code class="p">(</code><code class="nx">hours</code><code class="calibre14">: </code><code class="kt">number</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="kd">void</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">

</code><strong class="calibre49"><code class="k">interface</code><code class="calibre50"> </code><code class="nx1">Feline</code><code class="calibre50"> </code><code class="p1">{</code><code class="calibre50">
  </code><code class="nx1">meow</code><code class="p1">(</code><code class="p1">)</code><code class="o1">:</code><code class="calibre50"> </code><code class="k">void</code><code class="calibre50">
</code><code class="p1">}</code></strong><code class="calibre14">

</code><code class="kd">class</code><code class="calibre14"> </code><code class="nx">Cat</code><code class="calibre14"> </code><code class="kd">implements</code><code class="calibre14"> </code><code class="nx">Animal</code><strong class="calibre49"><code class="p1">,</code><code class="calibre50"> </code><code class="nx1">Feline</code></strong><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="nx">name</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="s">'Whiskers'</code><code class="calibre14">
  </code><code class="nx">eat</code><code class="p">(</code><code class="nx">food</code><code class="calibre14">: </code><code class="kt">string</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
    </code><code class="nx">console</code><code class="p">.</code><code class="nx">info</code><code class="p">(</code><code class="s">'Ate some'</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">food</code><code class="p">,</code><code class="calibre14"> </code><code class="s">'. Mmm!'</code><code class="p">)</code><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">
  </code><code class="nx">sleep</code><code class="p">(</code><code class="nx">hours</code><code class="calibre14">: </code><code class="kt">number</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
    </code><code class="nx">console</code><code class="p">.</code><code class="nx">info</code><code class="p">(</code><code class="s">'Slept for'</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">hours</code><code class="p">,</code><code class="calibre14"> </code><code class="s">'hours'</code><code class="p">)</code><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">
  </code><strong class="calibre49"><code class="nx1">meow() {</code><code class="calibre50">
    </code><code class="nx1">console</code><code class="p1">.</code><code class="nx1">info</code><code class="p1">(</code><code class="s1">'Meow'</code><code class="p1">)</code><code class="calibre50">
  </code><code class="p1">}</code></strong><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code></pre>

<p class="author1">All of these features are completely typesafe. If you forget to implement a method or a property, or implement it incorrectly, TypeScript will come to the rescue (see <a data-type="xref" href="#calibre_link-170" class="calibre4">Figure&nbsp;5-3</a>).</p>

<figure class="calibre33"><div class="figure" id="calibre_link-170">
<img alt="prts 0503" src="images/000018.png" class="calibre40" />
<h6 class="calibre34"><span class="calibre">Figure 5-3. </span>TypeScript throws an error when you forget to implement a required method</h6>
</div></figure>
</div></section>













<section data-pdf-bookmark="Implementing Interfaces Versus Extending Abstract Classes" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1852">
<h2 class="calibre17">Implementing Interfaces Versus Extending Abstract Classes</h2>

<p class="author1">Implementing an interface is really similar to extending an abstract class. The difference is that interfaces are more general and lightweight, and abstract classes are more special-purpose and feature-rich.<a data-primary="interfaces" data-secondary="implementing versus extending abstract classes" data-type="indexterm" id="calibre_link-1122" class="calibre4"></a><a data-primary="classes" data-secondary="implementing interfaces" data-tertiary="versus extending abstract classes" data-type="indexterm" id="calibre_link-745" class="calibre4"></a><a data-primary="abstract classes" data-secondary="extending versus implementing interfaces" data-type="indexterm" id="calibre_link-604" class="calibre4"></a></p>

<p class="author1">An interface is a way to model a shape. At the value level, that means an object, array, function, class, or class instance. Interfaces do not emit JavaScript code, and only exist at compile time.</p>

<p class="author1">An abstract class can only model, well, a class. It emits runtime code that is, you guessed it, a JavaScript class. Abstract classes can have constructors, provide default implementations, and set access modifiers for properties and methods. Interfaces can’t do any of those things.</p>

<p class="author1">Which one you use depends on your use case. When an implementation is shared among multiple classes, use an abstract class. When you need a lightweight way to say “this class is a <code class="calibre14">T</code>,” use an interface.<a data-primary="interfaces" data-startref="ix_intf" data-type="indexterm" id="calibre_link-1115" class="calibre4"></a></p>
</div></section>





</div></section>













<section data-pdf-bookmark="Classes Are Structurally Typed" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1853">
<h1 class="calibre13">Classes Are Structurally Typed</h1>

<p class="author1">Like every other type in TypeScript, TypeScript compares classes by their structure, not by their name.<a data-primary="classes" data-secondary="structural typing" data-type="indexterm" id="calibre_link-750" class="calibre4"></a><a data-primary="structural typing" data-secondary="classes in TypeScript" data-type="indexterm" id="calibre_link-1456" class="calibre4"></a> A class is compatible with any other type that shares its shape, including a regular old object that defines the same properties or methods as the class. This is important to keep in mind for those of you coming from C#, Java, Scala, and most other languages where classes are typed nominally. It means that if you have a function that takes a <code class="calibre14">Zebra</code> and you give it a <code class="calibre14">Poodle</code>, TypeScript might not mind:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">class</code> <code class="nx">Zebra</code> <code class="p">{</code>
  <code class="nx">trot() {</code>
    <code class="c">// ...</code>
  <code class="p">}</code>
<code class="p">}</code>

<code class="kd">class</code> <code class="nx">Poodle</code> <code class="p">{</code>
  <code class="nx">trot() {</code>
    <code class="c">// ...</code>
  <code class="p">}</code>
<code class="p">}</code>

<code class="kd">function</code> <code class="nx">ambleAround</code><code class="p">(</code><code class="nx">animal</code>: <code class="kt">Zebra</code><code class="p">)</code> <code class="p">{</code>
  <code class="nx">animal</code><code class="p">.</code><code class="nx">trot</code><code class="p">()</code>
<code class="p">}</code>

<code class="kd">let</code> <code class="nx">zebra</code> <code class="o">=</code> <code class="kd">new</code> <code class="nx">Zebra</code>
<code class="kd">let</code> <code class="nx">poodle</code> <code class="o">=</code> <code class="kd">new</code> <code class="nx">Poodle</code>

<code class="nx">ambleAround</code><code class="p">(</code><code class="nx">zebra</code><code class="p">)</code>   <code class="c">// OK</code>
<code class="nx">ambleAround</code><code class="p">(</code><code class="nx">poodle</code><code class="p">)</code>  <code class="c">// OK</code></pre>

<p class="author1">As the phylogeneticists among you know, a zebra is no poodle&mdash;but TypeScript doesn’t mind! As long as <code class="calibre14">Poodle</code> is assignable to <code class="calibre14">Zebra</code>, TypeScript is OK with it because from our function’s point of view, the two are interchangeable; all that matters is that they implement <code class="calibre14">.trot</code>. If you were using almost any other language that types classes nominally, this code would have raised an error; but TypeScript is structurally typed through and through, so this code is perfectly acceptable.<a data-primary="private (access modifier)" data-secondary="classes with private fields" data-type="indexterm" id="calibre_link-1372" class="calibre4"></a><a data-primary="protected (access modifier)" data-secondary="classes with protected fields" data-type="indexterm" id="calibre_link-1391" class="calibre4"></a></p>

<p class="author1">The exception to this rule is classes with <code class="calibre14">private</code> or <span class="calibre"><code class="calibre14">protected</code></span> fields: when checking whether or not a shape is assignable to a class, if the class has any <code class="calibre14">private</code> or <code class="calibre14">protected</code> fields and the shape is not an instance of that class or a subclass of that class, then <a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2345" data-type="indexterm" id="calibre_link-922" class="calibre4"></a>the shape is not assignable to the class:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">class</code> <code class="nx">A</code> <code class="p">{</code>
  <code class="kd">private</code> <code class="nx">x</code> <code class="o">=</code> <code class="mi">1</code>
<code class="p">}</code>
<code class="kd">class</code> <code class="nx">B</code> <code class="kd">extends</code> <code class="nx">A</code> <code class="p">{}</code>
<code class="kd">function</code> <code class="nx">f</code><code class="p">(</code><code class="nx">a</code>: <code class="kt">A</code><code class="p">)</code> <code class="p">{}</code>

<code class="nx">f</code><code class="p">(</code><code class="kd">new</code> <code class="nx">A</code><code class="p">)</code>   <code class="c">// OK</code>
<code class="nx">f</code><code class="p">(</code><code class="kd">new</code> <code class="nx">B</code><code class="p">)</code>   <code class="c">// OK</code>

<code class="nx">f</code><code class="p">({</code><code class="nx">x</code>: <code class="kt">1</code><code class="p">})</code>  <code class="c">// Error TS2345: Argument of type '{x: number}' is not</code>
           <code class="c">// assignable to parameter of type 'A'. Property 'x' is</code>
           <code class="c">// private in type 'A' but not in type '{x: number}'.</code></pre>
</div></section>













<section data-pdf-bookmark="Classes Declare Both Values and Types" data-type="sect1" class="preface"><div class="preface" id="calibre_link-522">
<h1 class="calibre13">Classes Declare Both Values and Types</h1>

<p class="author1">Most things that you can express in TypeScript<a data-primary="classes" data-secondary="declaring both values and types" data-type="indexterm" id="calibre_link-736" class="calibre4"></a><a data-primary="types" data-secondary="classes declaring both values and types" data-type="indexterm" id="calibre_link-1611" class="calibre4"></a><a data-primary="values" data-secondary="classes declaring both values and types" data-type="indexterm" id="calibre_link-1728" class="calibre4"></a> are either values <em class="calibre5">or</em> types:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// values</code>
<code class="kd">let</code> <code class="nx">a</code> <code class="o">=</code> <code class="mi">1999</code>
<code class="kd">function</code> <code class="nx">b() {</code><code class="p">}</code>

<code class="c">// types</code>
<code class="nx">type</code> <code class="nx">a</code> <code class="o">=</code> <code class="kt">number</code>
<code class="kd">interface</code> <code class="nx">b</code> <code class="p">{</code>
  <code class="p">()</code><code class="o">:</code> <code class="kd">void</code>
<code class="p">}</code></pre>

<p class="author1">Types and values are namespaced separately in TypeScript. Depending on how you use a term (<code class="calibre14">a</code> or <code class="calibre14">b</code> in this example), TypeScript knows whether to resolve it to a type or to a value:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// ...</code>
<code class="kd">if</code> <code class="p">(</code><code class="nx">a</code> <code class="o">+</code> <code class="mi">1</code> <code class="o">&gt;</code> <code class="mi">3</code><code class="p">)</code> <code class="c">//... // TypeScript infers from context that you mean the value a</code>
<code class="kd">let</code> <code class="nx">x</code>: <code class="kt">a</code> <code class="o">=</code> <code class="mi">3</code>         <code class="c">// TypeScript infers from context that you mean the type a</code></pre>

<p class="author1">This <em class="calibre5">contextual term resolution</em> is really nice, and lets us do cool things like implement companion types (see <a data-type="xref" href="#calibre_link-171" class="calibre4">“Companion Object Pattern”</a>).</p>

<p class="author1">Classes and enums are special. They are unique because they generate both a type in the type namespace and a value in the value namespace:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">class</code><code class="calibre14"> </code><code class="nx">C</code><code class="calibre14"> </code><code class="p">{</code><code class="p">}</code><code class="calibre14">
</code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">c</code><code class="calibre14">: </code><code class="kt">C</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-172" id="calibre_link-176"><img alt="1" src="images/000000.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="o">=</code><code class="calibre14"> </code><code class="kd">new</code><code class="calibre14"> </code><code class="nx">C</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-173" id="calibre_link-177"><img alt="2" src="images/000001.png" class="calibre40" /></a><code class="calibre14">

</code><code class="kd">enum</code><code class="calibre14"> </code><code class="nx">E</code><code class="calibre14"> </code><code class="p">{</code><code class="nx">F</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">G</code><code class="p">}</code><code class="calibre14">
</code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">e</code><code class="calibre14">: </code><code class="kt">E</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-174" id="calibre_link-178"><img alt="3" src="images/000002.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="o">=</code><code class="calibre14"> </code><code class="nx">E</code><code class="p">.</code><code class="nx">F</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-175" id="calibre_link-179"><img alt="4" src="images/000003.png" class="calibre40" /></a></pre>
<dl class="preface">
<dt class="calibre18"><a class="calibre4" href="#calibre_link-176" id="calibre_link-172"><img alt="1" src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">In this context, <code class="calibre14">C</code> refers to the instance type of our <code class="calibre14">C</code> class.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-177" id="calibre_link-173"><img alt="2" src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">In this context, <code class="calibre14">C</code> refers to <code class="calibre14">C</code> the value.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-178" id="calibre_link-174"><img alt="3" src="images/000002.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">In this context, <code class="calibre14">E</code> refers to the type of our <code class="calibre14">E</code> enum.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-179" id="calibre_link-175"><img alt="4" src="images/000003.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">In this context, <code class="calibre14">E</code> refers to <code class="calibre14">E</code> the value.</p></dd>
</dl>

<p class="author1">When we work with classes, we need a way to say “this variable should be an instance of this class” and the same goes for enums (“this variable should be a member of this enum”). Because classes and enums generate types at the type level we’re able to express this “is-a” relationship easily.<sup class="calibre15"><a data-type="noteref" href="#calibre_link-180" id="calibre_link-226" class="calibre16">2</a></sup></p>

<p class="author1">We also need a way to represent a class at runtime, so that we can instantiate it with <code class="calibre14">new</code>, call static methods on it, do metaprogramming with it, and operate on it with <code class="calibre14">instanceof</code>&mdash;so a class needs to generate a value too.<a data-primary="instanceof operator" data-type="indexterm" id="calibre_link-1113" class="calibre4"></a></p>

<p class="author1">In the previous example <code class="calibre14">C</code> refers to an <em class="calibre5">instance of</em> the class <code class="calibre14">C</code>. How do you talk about the <code class="calibre14">C</code> class itself? <a data-primary="typeof operator" data-type="indexterm" id="calibre_link-1599" class="calibre4"></a>We use the <code class="calibre14">typeof</code> keyword (a type operator provided by TypeScript, which is like JavaScript’s value-level <code class="calibre14">typeof</code> but for types).</p>

<p class="author1">Let’s create a class <code class="calibre14">StringDatabase</code>&mdash;the world’s simplest database:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">State</code> <code class="o">=</code> <code class="p">{</code>
  <code class="p">[</code><code class="nx">key</code>: <code class="kt">string</code><code class="p">]</code><code class="o">:</code> <code class="kt">string</code>
<code class="p">}</code>

<code class="kd">class</code> <code class="nx">StringDatabase</code> <code class="p">{</code>
  <code class="nx">state</code>: <code class="kt">State</code> <code class="o">=</code> <code class="p">{}</code>
  <code class="nx">get</code><code class="p">(</code><code class="nx">key</code>: <code class="kt">string</code><code class="p">)</code><code class="o">:</code> <code class="kt">string</code> <code class="o">|</code> <code class="kd">null</code> <code class="p">{</code>
    <code class="kd">return</code> <code class="nx">key</code> <code class="kd">in</code> <code class="kd">this</code><code class="p">.</code><code class="nx">state</code> <code class="o">?</code> <code class="kd">this</code><code class="p">.</code><code class="nx">state</code><code class="p">[</code><code class="nx">key</code><code class="p">]</code> <code class="o">:</code> <code class="kd">null</code>
  <code class="p">}</code>
  <code class="nx">set</code><code class="p">(</code><code class="nx">key</code>: <code class="kt">string</code><code class="p">,</code> <code class="nx">value</code>: <code class="kt">string</code><code class="p">)</code><code class="o">:</code> <code class="kd">void</code> <code class="p">{</code>
    <code class="kd">this</code><code class="p">.</code><code class="nx">state</code><code class="p">[</code><code class="nx">key</code><code class="p">]</code> <code class="o">=</code> <code class="nx">value</code>
  <code class="p">}</code>
  <code class="kd">static</code> <code class="nx">from</code><code class="p">(</code><code class="nx">state</code>: <code class="kt">State</code><code class="p">)</code> <code class="p">{</code>
    <code class="kd">let</code> <code class="nx">db</code> <code class="o">=</code> <code class="kd">new</code> <code class="nx">StringDatabase</code>
    <code class="kd">for</code> <code class="p">(</code><code class="kd">let</code> <code class="nx">key</code> <code class="kd">in</code> <code class="nx">state</code><code class="p">)</code> <code class="p">{</code>
      <code class="nx">db</code><code class="p">.</code><code class="nx">set</code><code class="p">(</code><code class="nx">key</code><code class="p">,</code> <code class="nx">state</code><code class="p">[</code><code class="nx">key</code><code class="p">])</code>
    <code class="p">}</code>
    <code class="kd">return</code> <code class="nx">db</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p class="author1">What types does this class declaration generate? The instance type <code class="calibre14">StringDatabase</code>:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">interface</code> <code class="nx">StringDatabase</code> <code class="p">{</code>
  <code class="nx">state</code>: <code class="kt">State</code>
  <code class="nx">get</code><code class="p">(</code><code class="nx">key</code>: <code class="kt">string</code><code class="p">)</code><code class="o">:</code> <code class="kt">string</code> <code class="o">|</code> <code class="kd">null</code>
  <code class="nx">set</code><code class="p">(</code><code class="nx">key</code>: <code class="kt">string</code><code class="p">,</code> <code class="nx">value</code>: <code class="kt">string</code><code class="p">)</code><code class="o">:</code> <code class="kd">void</code>
<code class="p">}</code></pre>

<p class="author1">And the constructor type <code class="calibre14">typeof StringDatabase</code>:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">interface</code> <code class="nx">StringDatabaseConstructor</code> <code class="p">{</code>
  <code class="kd">new</code><code class="p">()</code><code class="o">:</code> <code class="nx">StringDatabase</code>
  <code class="nx">from</code><code class="p">(</code><code class="nx">state</code>: <code class="kt">State</code><code class="p">)</code><code class="o">:</code> <code class="nx">StringDatabase</code>
<code class="p">}</code></pre>

<p class="author1">That is, <code class="calibre14">StringDatabaseConstructor</code> has a single method <code class="calibre14">.from</code>, and <code class="calibre14">new</code>-ing the constructor gives a <code class="calibre14">StringDatabase</code> instance. Combined, these two interfaces model both the constructor and instance sides of a class.</p>

<p class="author1">That <code class="calibre14">new()</code> bit is called a <em class="calibre5">constructor signature</em>, and is TypeScript’s way of saying that a given type can be instantiated with the <code class="calibre14">new</code> operator.<a data-primary="constructor signatures" data-type="indexterm" id="calibre_link-800" class="calibre4"></a><a data-primary="new operator" data-type="indexterm" id="calibre_link-1258" class="calibre4"></a> Because TypeScript is structurally typed, that’s the best we can do to describe what a class is: a class is anything that can be <code class="calibre14">new</code>-ed.</p>

<p class="author1">In this case the constructor doesn’t take any arguments, but you can use it to declare constructors that take arguments too. For example, say we update <code class="calibre14">StringDatabase</code> to take an optional initial state:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">class</code> <code class="nx">StringDatabase</code> <code class="p">{</code>
  <code class="kd">constructor</code><code class="p">(</code><code class="kd">public</code> <code class="nx">state</code>: <code class="kt">State</code> <code class="o">=</code> <code class="p">{})</code> <code class="p">{}</code>
  <code class="c">// ...</code>
<code class="p">}</code></pre>

<p class="author1">We could then type <code class="calibre14">StringDatabase</code>’s constructor signature as:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">interface</code> <code class="nx">StringDatabaseConstructor</code> <code class="p">{</code>
  <code class="kd">new</code><code class="p">(</code><code class="nx">state?</code>: <code class="kt">State</code><code class="p">)</code><code class="o">:</code> <code class="nx">StringDatabase</code>
  <code class="nx">from</code><code class="p">(</code><code class="nx">state</code>: <code class="kt">State</code><code class="p">)</code><code class="o">:</code> <code class="nx">StringDatabase</code>
<code class="p">}</code></pre>

<p class="author1">So, not only does a class declaration generate terms at the value and type levels, but it generates two terms at the type level: one representing an instance of the class; one representing the class constructor itself (reachable with the <code class="calibre14">typeof</code> type operator).</p>
</div></section>













<section data-pdf-bookmark="Polymorphism" data-type="sect1" class="preface"><div class="preface" id="calibre_link-105">
<h1 class="calibre13">Polymorphism</h1>

<p class="author1">Like functions and types, classes and interfaces have rich support for generic type parameters, including defaults and bounds.<a data-primary="generics" data-secondary="classes and interfaces support for" data-type="indexterm" id="calibre_link-1071" class="calibre4"></a><a data-primary="polymorphism" data-secondary="classes and interfaces" data-type="indexterm" id="calibre_link-1362" class="calibre4"></a><a data-primary="classes" data-secondary="polymorphism" data-type="indexterm" id="calibre_link-748" class="calibre4"></a> You can scope a generic to your whole class or interface, or to a specific method:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">class</code><code class="calibre14"> </code><code class="nx">MyMap</code><code class="o">&lt;</code><code class="nx">K</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">V</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-181" id="calibre_link-186"><img alt="1" src="images/000000.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="kd">constructor</code><code class="p">(</code><code class="nx">initialKey</code><code class="calibre14">: </code><code class="kt">K</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">initialValue</code><code class="calibre14">: </code><code class="kt">V</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-182" id="calibre_link-187"><img alt="2" src="images/000001.png" class="calibre40" /></a><code class="calibre14">
    </code><code class="c">// ...
</code><code class="calibre14">  </code><code class="p">}</code><code class="calibre14">
  </code><code class="nx">get</code><code class="p">(</code><code class="nx">key</code><code class="calibre14">: </code><code class="kt">K</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">V</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-183" id="calibre_link-188"><img alt="3" src="images/000002.png" class="calibre40" /></a><code class="calibre14">
    </code><code class="c">// ...
</code><code class="calibre14">  </code><code class="p">}</code><code class="calibre14">
  </code><code class="nx">set</code><code class="p">(</code><code class="nx">key</code><code class="calibre14">: </code><code class="kt">K</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">value</code><code class="calibre14">: </code><code class="kt">V</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="kd">void</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
    </code><code class="c">// ...
</code><code class="calibre14">  </code><code class="p">}</code><code class="calibre14">
  </code><code class="nx">merge</code><code class="o">&lt;</code><code class="nx">K1</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">V1</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">map</code><code class="calibre14">: </code><code class="kt">MyMap</code><code class="o">&lt;</code><code class="nx">K1</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">V1</code><code class="o">&gt;</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">MyMap</code><code class="o">&lt;</code><code class="nx">K</code><code class="calibre14"> </code><code class="o">|</code><code class="calibre14"> </code><code class="nx">K1</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">V</code><code class="calibre14"> </code><code class="o">|</code><code class="calibre14"> </code><code class="nx">V1</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-184" id="calibre_link-189"><img alt="4" src="images/000003.png" class="calibre40" /></a><code class="calibre14">
    </code><code class="c">// ...
</code><code class="calibre14">  </code><code class="p">}</code><code class="calibre14">
  </code><code class="kd">static</code><code class="calibre14"> </code><code class="nx">of</code><code class="o">&lt;</code><code class="nx">K</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">V</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">k</code><code class="calibre14">: </code><code class="kt">K</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">v</code><code class="calibre14">: </code><code class="kt">V</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">MyMap</code><code class="o">&lt;</code><code class="nx">K</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">V</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-185" id="calibre_link-190"><img alt="5" src="images/000004.png" class="calibre40" /></a><code class="calibre14">
    </code><code class="c">// ...
</code><code class="calibre14">  </code><code class="p">}</code><code class="calibre14">
</code><code class="p">}</code></pre>
<dl class="preface">
<dt class="calibre18"><a class="calibre4" href="#calibre_link-186" id="calibre_link-181"><img alt="1" src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">Bind class-scoped generic types when you declare your <code class="calibre14">class</code>. Here, <code class="calibre14">K</code> and <code class="calibre14">V</code> are available to every instance method and instance property on <code class="calibre14">MyMap</code>.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-187" id="calibre_link-182"><img alt="2" src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">Note that you cannot declare generic types in a <code class="calibre14">constructor</code>. Instead, move the declaration up to your <code class="calibre14">class</code> declaration.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-188" id="calibre_link-183"><img alt="3" src="images/000002.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">Use class-scoped generic types anywhere inside your class.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-189" id="calibre_link-184"><img alt="4" src="images/000003.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">Instance methods have access to class-level generics, and can also declare their own generics on top. <code class="calibre14">.merge</code> makes use of the <code class="calibre14">K</code> and <code class="calibre14">V</code> class-level generics, and also declares two of its own generics, <code class="calibre14">K1</code> and <code class="calibre14">V1</code>.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-190" id="calibre_link-185"><img alt="5" src="images/000004.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">Static methods do not have access to their class’s generics, just like at the value level they don’t have access to their class’s instance variables. <code class="calibre14">of</code> does not have access to the <code class="calibre14">K</code> and <code class="calibre14">V</code> declared in <a class="calibre4" href="#calibre_link-186"><img alt="1" src="images/000000.png" class="calibre40" /></a>; instead, it declares its own <code class="calibre14">K</code> and <code class="calibre14">V</code> generics.</p></dd>
</dl>

<p class="author1">You can bind <a data-primary="interfaces" data-secondary="polymorphism" data-type="indexterm" id="calibre_link-1124" class="calibre4"></a>generics to interfaces too:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">interface</code> <code class="nx">MyMap</code><code class="o">&lt;</code><code class="nx">K</code><code class="p">,</code> <code class="nx">V</code><code class="o">&gt;</code> <code class="p">{</code>
  <code class="nx">get</code><code class="p">(</code><code class="nx">key</code>: <code class="kt">K</code><code class="p">)</code><code class="o">:</code> <code class="nx">V</code>
  <code class="nx">set</code><code class="p">(</code><code class="nx">key</code>: <code class="kt">K</code><code class="p">,</code> <code class="nx">value</code>: <code class="kt">V</code><code class="p">)</code><code class="o">:</code> <code class="kd">void</code>
<code class="p">}</code></pre>

<p class="author1">And like with functions, you can bind concrete types to generics explicitly, or let TypeScript infer the types for you:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">a</code> <code class="o">=</code> <code class="kd">new</code> <code class="nx">MyMap</code><code class="o">&lt;</code><code class="kt">string</code><code class="p">,</code> <code class="kt">number</code><code class="o">&gt;</code><code class="p">(</code><code class="s">'k'</code><code class="p">,</code> <code class="mi">1</code><code class="p">)</code> <code class="c">// MyMap&lt;string, number&gt;</code>
<code class="kd">let</code> <code class="nx">b</code> <code class="o">=</code> <code class="kd">new</code> <code class="nx">MyMap</code><code class="p">(</code><code class="s">'k'</code><code class="p">,</code> <code class="kd">true</code><code class="p">)</code> <code class="c">// MyMap&lt;string, boolean&gt;</code>

<code class="nx">a</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s">'k'</code><code class="p">)</code>
<code class="nx">b</code><code class="p">.</code><code class="nx">set</code><code class="p">(</code><code class="s">'k'</code><code class="p">,</code> <code class="kd">false</code><code class="p">)</code></pre>
</div></section>













<section data-pdf-bookmark="Mixins" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1854">
<h1 class="calibre13">Mixins</h1>

<p class="author1">JavaScript and TypeScript don’t have <code class="calibre14">trait</code> or <code class="calibre14">mixin</code> keywords, but it’s straightforward to implement them ourselves.<a data-primary="generics" data-secondary="classes and interfaces support for" data-startref="ix_genclint" data-type="indexterm" id="calibre_link-1072" class="calibre4"></a><a data-primary="polymorphism" data-secondary="classes and interfaces" data-startref="ix_polycl" data-type="indexterm" id="calibre_link-1363" class="calibre4"></a><a data-primary="inheritance" data-secondary="simulating multiple inheritance" data-type="indexterm" id="calibre_link-1110" class="calibre4"></a> <a data-primary="role-oriented programming" data-type="indexterm" id="calibre_link-1424" class="calibre4"></a>Both are ways to simulate <em class="calibre5">multiple inheritance</em>  (classes that extend more than one other class) and do <em class="calibre5">role-oriented programming</em>, a style of programming where you don’t say things like “this thing is a <code class="calibre14">Shape</code>" but instead describe properties of a thing, like “it can be measured” or “it has four sides.” Instead of “is-a” relationships, you describe “can” and “has-a” relationships.<a data-primary="classes" data-secondary="mixins" data-type="indexterm" id="calibre_link-746" class="calibre4"></a><a data-primary="mixins" data-type="indexterm" id="calibre_link-1210" class="calibre4"></a><a data-primary="traits" data-seealso="mixins" data-type="indexterm" id="calibre_link-1482" class="calibre4"></a></p>

<p class="author1">Let’s build a mixin implementation.</p>

<p class="author1">Mixins are a pattern that allows us to <em class="calibre5">mix</em> behaviors and properties <em class="calibre5">into</em> a class. By convention, mixins:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">Can have state (i.e., instance properties)</p>
</li>
<li class="calibre11">
<p class="author1">Can only provide concrete methods (not abstract ones)</p>
</li>
<li class="calibre11">
<p class="author1">Can have constructors, which are called in the same order as their classes were mixed in</p>
</li>
</ul>

<p class="author1">TypeScript doesn’t have a built-in concept of mixins, but it’s easy to implement them ourselves. For example, let’s design a debugging library for TypeScript classes. We’ll call it <code class="calibre14">EZDebug</code>. The library works by letting you log out information about whatever classes use the library, so that you can inspect them at runtime. We’ll use it like this:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">class</code> <code class="nx">User</code> <code class="p">{</code>
  <code class="c">// ...</code>
<code class="p">}</code>

<code class="nx">User</code><code class="p">.</code><code class="nx">debug</code><code class="p">()</code> <code class="c">// evaluates to 'User({"id": 3, "name": "Emma Gluzman"})'</code></pre>

<p class="author1">With a standard <code class="calibre14">.debug</code> interface, our users will be able to debug anything! Let’s build it. We’ll model it with a mixin, which we’ll call <code class="calibre14">withEZDebug</code>. <a data-primary="constructors" data-secondary="class, mixins and" data-type="indexterm" id="calibre_link-801" class="calibre4"></a>A mixin is just a function that takes a class constructor and returns a class constructor, so our mixin might look like this:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code><code class="calibre14"> </code><code class="nx">ClassConstructor</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="kd">new</code><code class="p">(</code><code class="p">.</code><code class="p">.</code><code class="p">.</code><code class="nx">args</code><code class="calibre14">: </code><code class="kt">any</code><code class="p">[</code><code class="p">]</code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="p">{</code><code class="p">}</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-191" id="calibre_link-196"><img alt="1" src="images/000000.png" class="calibre40" /></a><code class="calibre14">

</code><code class="kd">function</code><code class="calibre14"> </code><code class="nx">withEZDebug</code><code class="o">&lt;</code><code class="nx">C</code><code class="calibre14"> </code><code class="kd">extends</code><code class="calibre14"> </code><code class="nx">ClassConstructor</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">Class</code><code class="calibre14">: </code><code class="kt">C</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-192" id="calibre_link-198"><img alt="2" src="images/000001.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="kd">return</code><code class="calibre14"> </code><code class="kd">class</code><code class="calibre14"> </code><code class="kd">extends</code><code class="calibre14"> </code><code class="nx">Class</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-193" id="calibre_link-199"><img alt="3" src="images/000002.png" class="calibre40" /></a><code class="calibre14">
    </code><code class="kd">constructor</code><code class="p">(</code><code class="p">.</code><code class="p">.</code><code class="p">.</code><code class="nx">args</code><code class="calibre14">: </code><code class="kt">any</code><code class="p">[</code><code class="p">]</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-194" id="calibre_link-200"><img alt="4" src="images/000003.png" class="calibre40" /></a><code class="calibre14">
      </code><code class="kd">super</code><code class="p">(</code><code class="p">.</code><code class="p">.</code><code class="p">.</code><code class="nx">args</code><code class="p">)</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-195" id="calibre_link-201"><img alt="5" src="images/000004.png" class="calibre40" /></a><code class="calibre14">
    </code><code class="p">}</code><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">
</code><code class="p">}</code></pre>
<dl class="preface">
<dt class="calibre18"><a class="calibre4" href="#calibre_link-196" id="calibre_link-191"><img alt="1" src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We start by declaring a type <code class="calibre14">ClassConstructor</code>, which represents any constructor. Since TypeScript is completely structurally typed, we say that a constructor is anything that can be <code class="calibre14">new</code>-ed. We don’t know what types of parameters the constructor might have, so we say it takes any number of arguments of any type.<sup class="calibre15"><a data-type="noteref" href="#calibre_link-197" id="calibre_link-227" class="calibre16">3</a></sup></p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-198" id="calibre_link-192"><img alt="2" src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We declare our <code class="calibre14">withEZDebug</code> mixin with a single type parameter, <code class="calibre14">C</code>. <code class="calibre14">C</code> has to be at least a class constructor, which we enforce with an <code class="calibre14">extends</code> clause. We let TypeScript infer <code class="calibre14">withEZDebug</code>’s return type, which is the intersection of <code class="calibre14">C</code> and our new anonymous class.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-199" id="calibre_link-193"><img alt="3" src="images/000002.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">Since a mixin is a function that takes a constructor and returns a constructor, we return an anonymous class constructor.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-200" id="calibre_link-194"><img alt="4" src="images/000003.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">The class constructor has to take <em class="calibre5">at least</em> the arguments that the class you pass in might take. But remember, since we don’t know what class you might pass in beforehand, I have to keep it as general as possible, which means any number of parameters of any type&mdash;just like <code class="calibre14">ClassConstructor</code>.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-201" id="calibre_link-195"><img alt="5" src="images/000004.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">Finally, since this anonymous class extends another class, to wire everything up correctly we need to remember to call <code class="calibre14">Class</code>’s constructor too.</p></dd>
</dl>

<p class="author1">Like with regular JavaScript classes, if you don’t have any more logic in the <code class="calibre14">constructor</code>, you can omit lines  <a class="calibre4" href="#calibre_link-200"><img alt="4" src="images/000003.png" class="calibre40" /></a> and  <a class="calibre4" href="#calibre_link-201"><img alt="5" src="images/000004.png" class="calibre40" /></a>. We aren’t going to put any logic into the constructor for this <code class="calibre14">withEZDebug</code> example, so we can omit them.</p>

<p class="author1">Now that we’ve set up the boilerplate, it’s time to work some debugging magic. When we call <code class="calibre14">.debug</code>, we want to log out the class’s constructor name and the instance’s value:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<code class="nx">type</code><code class="calibre14"> </code><code class="nx">ClassConstructor</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="kd">new</code><code class="p">(</code><code class="p">.</code><code class="p">.</code><code class="p">.</code><code class="nx">args</code><code class="calibre14">: </code><code class="kt">any</code><code class="p">[</code><code class="p">]</code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="p">{</code><code class="p">}</code><code class="calibre14">

</code><code class="kd">function</code><code class="calibre14"> </code><code class="nx">withEZDebug</code><code class="o">&lt;</code><code class="nx">C</code><code class="calibre14"> </code><code class="kd">extends</code><code class="calibre14"> </code><code class="nx">ClassConstructor</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">Class</code><code class="calibre14">: </code><code class="kt">C</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="kd">return</code><code class="calibre14"> </code><code class="kd">class</code><code class="calibre14"> </code><code class="kd">extends</code><code class="calibre14"> </code><code class="nx">Class</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
    </code><strong class="calibre49"><code class="nx1">debug() {</code><code class="calibre50">
      </code><code class="k">let</code><code class="calibre50"> </code><code class="nx1">Name</code><code class="calibre50"> </code><code class="o1">=</code><code class="calibre50"> </code><code class="nx1">Class</code><code class="p1">.</code><code class="k">constructor</code><code class="p1">.</code><code class="nx1">name</code><code class="calibre50">
      </code><code class="k">let</code><code class="calibre50"> </code><code class="nx1">value</code><code class="calibre50"> </code><code class="o1">=</code><code class="calibre50"> </code><code class="k">this</code><code class="p1">.</code><code class="nx1">getDebugValue</code><code class="p1">(</code><code class="p1">)</code><code class="calibre50">
      </code><code class="k">return</code><code class="calibre50"> </code><code class="nx1">Name</code><code class="calibre50"> </code><code class="o1">+</code><code class="calibre50"> </code><code class="s1">'('</code><code class="calibre50"> </code><code class="o1">+</code><code class="calibre50"> </code><code class="nx1">JSON</code><code class="p1">.</code><code class="nx1">stringify</code><code class="p1">(</code><code class="nx1">value</code><code class="p1">)</code><code class="calibre50"> </code><code class="o1">+</code><code class="calibre50"> </code><code class="s1">')'</code><code class="calibre50">
    </code><code class="p1">}</code></strong><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code></pre>

<p class="author1">But wait! How do we make sure the class implements a <code class="calibre14">.getDebugValue</code> method, so that we can call it? Think about this for a second before you move on&mdash;can you figure it out?</p>

<p class="author1">The answer is that instead of accepting any old class, we use a generic type to make sure the class passed into <code class="calibre14">withEZDebug</code> defines a <code class="calibre14">.getDebugValue</code> method:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<code class="nx">type</code><code class="calibre14"> </code><code class="nx">ClassConstructor</code><strong class="calibre49"><code class="o1">&lt;</code><code class="nx1">T</code><code class="o1">&gt;</code></strong><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="kd">new</code><code class="p">(</code><code class="p">.</code><code class="p">.</code><code class="p">.</code><code class="nx">args</code><code class="calibre14">: </code><code class="kt">any</code><code class="p">[</code><code class="p">]</code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><strong class="calibre49"><code class="nx1">T</code></strong><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-202" id="calibre_link-204"><img src="images/000000.png" class="calibre40" /></a><code class="calibre14">

</code><code class="kd">function</code><code class="calibre14"> </code><code class="nx">withEZDebug</code><code class="o">&lt;</code><code class="nx">C</code><code class="calibre14"> </code><code class="kd">extends</code><code class="calibre14"> </code><code class="nx">ClassConstructor</code><strong class="calibre49"><code class="o1">&lt;</code><code class="p1">{</code><code class="calibre50">
  </code><code class="nx1">getDebugValue</code><code class="p1">(</code><code class="p1">)</code><code class="o1">:</code><code class="calibre50"> </code><code class="nx1">object</code></strong><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-203" id="calibre_link-205"><img src="images/000001.png" class="calibre40" /></a><code class="calibre14">
</code><strong class="calibre49"><code class="p1">}</code><code class="o1">&gt;</code></strong><code class="o">&gt;</code><code class="p">(</code><code class="nx">Class</code><code class="calibre14">: </code><code class="kt">C</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><em class="calibre41"><code class="c2">// ...</code></em><code class="c">
</code><code class="p">}</code><code class="calibre14">
</code></pre>

<dl class="preface">
<dt class="calibre18"><a class="calibre4" href="#calibre_link-204" id="calibre_link-202"><img src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We add a generic type parameter to <code class="calibre14">ClassConstructor</code>.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-205" id="calibre_link-203"><img src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We bind a shape type to <code class="calibre14">ClassConstructor</code>, <code class="calibre14">C</code>, enforcing that the constructor we passed to <span class="calibre"><code class="calibre14">withEZDebug</code></span> at least defines the <code class="calibre14">.getDebugValue</code> method.</p></dd>
</dl>

<p class="author1">That’s it! So, how do you use this incredible debugging utility? Like so:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">class</code> <code class="nx">HardToDebugUser</code> <code class="p">{</code>
  <code class="kd">constructor</code><code class="p">(</code>
    <code class="kd">private</code> <code class="nx">id</code>: <code class="kt">number</code><code class="p">,</code>
    <code class="kd">private</code> <code class="nx">firstName</code>: <code class="kt">string</code><code class="p">,</code>
    <code class="kd">private</code> <code class="nx">lastName</code>: <code class="kt">string</code>
  <code class="p">)</code> <code class="p">{}</code>
  <code class="nx">getDebugValue() {</code>
    <code class="kd">return</code> <code class="p">{</code>
      <code class="nx">id</code>: <code class="kt">this.id</code><code class="p">,</code>
      <code class="nx">name</code>: <code class="kt">this.firstName</code> <code class="o">+</code> <code class="s">' '</code> <code class="o">+</code> <code class="kd">this</code><code class="p">.</code><code class="nx">lastName</code>
    <code class="p">}</code>
  <code class="p">}</code>
<code class="p">}</code>

<code class="kd">let</code> <code class="nx">User</code> <code class="o">=</code> <code class="nx">withEZDebug</code><code class="p">(</code><code class="nx">HardToDebugUser</code><code class="p">)</code>
<code class="kd">let</code> <code class="nx">user</code> <code class="o">=</code> <code class="kd">new</code> <code class="nx">User</code><code class="p">(</code><code class="mi">3</code><code class="p">,</code> <code class="s">'Emma'</code><code class="p">,</code> <code class="s">'Gluzman'</code><code class="p">)</code>
<code class="nx">user</code><code class="p">.</code><code class="nx">debug</code><code class="p">()</code> <code class="c">// evaluates to 'User({"id": 3, "name": "Emma Gluzman"})'</code></pre>

<p class="author1">Cool, right? You can apply as many mixins to a class as you want to yield a class with richer and richer behavior, all in a typesafe way. Mixins help encapsulate behavior, and are an expressive way to specify reusable behaviors.<sup class="calibre15"><a data-type="noteref" href="#calibre_link-206" id="calibre_link-228" class="calibre16">4</a></sup></p>
</div></section>













<section data-pdf-bookmark="Decorators" data-type="sect1" class="preface"><div class="preface" id="calibre_link-468">
<h1 class="calibre13">Decorators</h1>

<p class="author1">Decorators are an experimental TypeScript feature that gives us a clean syntax for metaprogramming with classes,<a data-primary="classes" data-secondary="mixins" data-startref="ix_classmix" data-type="indexterm" id="calibre_link-747" class="calibre4"></a><a data-primary="mixins" data-startref="ix_mix" data-type="indexterm" id="calibre_link-1211" class="calibre4"></a> class methods, properties, and method parameters.<a data-primary="decorators" data-type="indexterm" id="calibre_link-827" class="calibre4"></a><a data-primary="classes" data-secondary="decorators" data-type="indexterm" id="calibre_link-738" class="calibre4"></a> They’re just a syntax for calling a function on the thing you’re decorating.</p>
<div data-type="tip" class="calibre21"><h1 class="calibre42">TSC Flag: experimentalDecorators</h1>
<p class="author1">Because they’re still experimental&mdash;meaning they may change in a backward-incompatible way, or may even be entirely removed in future TypeScript releases&mdash;decorators are hidden behind a TSC flag. <a data-primary="TSC compiler" data-secondary="experimentalDecorators flag" data-type="indexterm" id="calibre_link-1510" class="calibre4"></a><a data-primary="experimentalDecorators TSC flag" data-type="indexterm" id="calibre_link-991" class="calibre4"></a>If you’re OK with that, and want to play around with the feature, set <code class="calibre14">"experimentalDecorators": true</code> in your <em class="calibre5">tsconfig.json</em> and read on.</p>
</div>

<p class="author1">To get a sense for how decorators work, let’s start with an example:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="err">@</code><code class="nx">serializable</code>
<code class="kd">class</code> <code class="nx">APIPayload</code> <code class="p">{</code>
  <code class="nx">getValue</code><code class="p">()</code><code class="o">:</code> <code class="nx">Payload</code> <code class="p">{</code>
    <code class="c">// ...</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p class="author1">The <code class="calibre14">@serializable</code> class decorator wraps our <code class="calibre14">APIPayload</code> class, and optionally returns a new class that replaces it. Without decorators, you might implement the same thing with:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">APIPayload</code> <code class="o">=</code> <code class="nx">serializable</code><code class="p">(</code><code class="kd">class</code> <code class="nx">APIPayload</code> <code class="p">{</code>
  <code class="nx">getValue</code><code class="p">()</code><code class="o">:</code> <code class="nx">Payload</code> <code class="p">{</code>
    <code class="c">// ...</code>
  <code class="p">}</code>
<code class="p">})</code></pre>

<p class="author1">For each type of decorator, TypeScript requires that you have a function in scope with the given name and the required signature<a data-primary="decorators" data-secondary="expected type signatures for decorator functions" data-type="indexterm" id="calibre_link-830" class="calibre4"></a><a data-primary="functions" data-secondary="decorator" data-type="indexterm" id="calibre_link-1045" class="calibre4"></a> for that type of decorator (see <a data-type="xref" href="#calibre_link-207" class="calibre4">Table&nbsp;5-1</a>).</p>
<table id="calibre_link-207" class="stafflist_table">
<caption class="calibre35"><span class="calibre">Table 5-1. </span>Expected type signatures for the different kinds of decorator functions</caption>
<thead class="calibre36">
<tr class="calibre7">
<th class="calibre37">What you’re decorating</th>
<th class="calibre37">Expected type signature</th>
</tr>
</thead>
<tbody class="calibre6">
<tr class="calibre7">
<td class="calibre8"><p class="author1">Class</p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">(Constructor: {new(...any[]) =&gt; any}) =&gt; any</code></p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1">Method</p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">(classPrototype: {}, methodName: string, descriptor:</code> <code class="calibre14"><span class="calibre">PropertyDescriptor</span></code><code class="calibre14">) =&gt; any</code></p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1">Static method</p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">(Constructor: {new(...any[]) =&gt; any}, methodName: string, descriptor: PropertyDescriptor) =&gt; any</code></p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1">Method parameter</p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">(classPrototype: {}, paramName: string, index: number) =&gt; void</code></p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1">Static method parameter</p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">(Constructor: {new(...any[]) =&gt; any}, paramName: string, index: number) =&gt; void</code></p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1">Property</p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">(classPrototype: {}, propertyName: string) =&gt; any</code></p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1">Static property</p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">(Constructor: {new(...any[]) =&gt; any}, propertyName: string) =&gt; any</code></p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1">Property getter/setter</p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">(classPrototype: {}, propertyName: string, descriptor:</code> <code class="calibre14"><span class="calibre">PropertyDescriptor</span></code><code class="calibre14">) =&gt; any</code></p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1">Static property getter/setter</p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">(Constructor: {new(...any[]) =&gt; any}, propertyName: string, descriptor: PropertyDescriptor) =&gt; any</code></p></td>
</tr>
</tbody>
</table>

<p class="author1">TypeScript doesn’t come with any built-in decorators: whatever decorators you use, you have to implement yourself (or install from NPM). The implementation for each kind of decorator&mdash;for classes, methods, properties, and function parameters&mdash;is a regular function that satisfies a specific signature, depending on what it’s decorating.<a data-primary="decorators" data-secondary="example, @serializable decorator" data-type="indexterm" id="calibre_link-829" class="calibre4"></a> For example, our <code class="calibre14">@serializable</code> decorator might look like this:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code><code class="calibre14"> </code><code class="nx">ClassConstructor</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="kd">new</code><code class="p">(</code><code class="p">.</code><code class="p">.</code><code class="p">.</code><code class="nx">args</code><code class="calibre14">: </code><code class="kt">any</code><code class="p">[</code><code class="p">]</code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="nx">T</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-208" id="calibre_link-212"><img alt="1" src="images/000000.png" class="calibre40" /></a><code class="calibre14">

</code><code class="kd">function</code><code class="calibre14"> </code><code class="nx">serializable</code><code class="o">&lt;</code><code class="calibre14">
  </code><code class="nx">T</code><code class="calibre14"> </code><code class="kd">extends</code><code class="calibre14"> </code><code class="nx">ClassConstructor</code><code class="o">&lt;</code><code class="p">{</code><code class="calibre14">
    </code><code class="nx">getValue</code><code class="p">(</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">Payload</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-209" id="calibre_link-213"><img alt="2" src="images/000001.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="p">}</code><code class="o">&gt;</code><code class="calibre14">
</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">Constructor</code><code class="calibre14">: </code><code class="kt">T</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-210" id="calibre_link-214"><img alt="3" src="images/000002.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="kd">return</code><code class="calibre14"> </code><code class="kd">class</code><code class="calibre14"> </code><code class="kd">extends</code><code class="calibre14"> </code><code class="nx">Constructor</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-211" id="calibre_link-215"><img alt="4" src="images/000003.png" class="calibre40" /></a><code class="calibre14">
    </code><code class="nx">serialize() {</code><code class="calibre14">
      </code><code class="kd">return</code><code class="calibre14"> </code><code class="kd">this</code><code class="p">.</code><code class="nx">getValue</code><code class="p">(</code><code class="p">)</code><code class="p">.</code><code class="nx">toString</code><code class="p">(</code><code class="p">)</code><code class="calibre14">
    </code><code class="p">}</code><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">
</code><code class="p">}</code></pre>
<dl class="preface">
<dt class="calibre18"><a class="calibre4" href="#calibre_link-212" id="calibre_link-208"><img alt="1" src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">Remember, <code class="calibre14">new()</code> is how we structurally type a class constructor in TypeScript.<a data-primary="constructors" data-secondary="extended class constructors" data-type="indexterm" id="calibre_link-802" class="calibre4"></a><a data-primary="new operator" data-secondary="new(…any[]) syntax for extended class constructors)" data-type="indexterm" id="calibre_link-1259" class="calibre4"></a> And for a class constructor that can be extended (with <code class="calibre14">extends</code>), TypeScript requires that we type its arguments with an <code class="calibre14">any</code> spread: <code class="calibre14">new(...any[])</code>.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-213" id="calibre_link-209"><img alt="2" src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45"><code class="calibre14">@serializable</code> can decorate any class whose instances implement the method <code class="calibre14">.getValue</code>, which returns a <code class="calibre14">Payload</code>.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-214" id="calibre_link-210"><img alt="3" src="images/000002.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">Class decorators are functions that take a single argument&mdash;the class. If the decorator function returns a class (as in the example) it will replace the class it’s decorating at runtime; otherwise, it will return the original class.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-215" id="calibre_link-211"><img alt="4" src="images/000003.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">To decorate the class, we return a class that extends it and adds a <code class="calibre14">.serialize</code> method along the way.</p></dd>
</dl>

<p class="author1">What happens when we try to call <code class="calibre14">.serialize</code>?</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">payload</code> <code class="o">=</code> <code class="kd">new</code> <code class="nx">APIPayload</code>
<code class="kd">let</code> <code class="nx">serialized</code> <code class="o">=</code> <code class="nx">payload</code><code class="p">.</code><code class="nx">serialize</code><code class="p">()</code> <code class="c">// Error TS2339: Property 'serialize' does</code>
                                     <code class="c">// not exist on type 'APIPayload'.</code></pre>

<p class="author1">TypeScript assumes that a decorator doesn’t change the shape of the thing it’s decorating&mdash;meaning that you didn’t add or remove methods and properties. It checks at compile time that the class you returned is assignable to the class you passed in, but at the time of writing, TypeScript does not keep track of extensions you make in your decorators.</p>

<p class="author1">Until decorators in TypeScript become a more mature feature, I recommend you avoid using them and stick to regular functions instead:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">DecoratedAPIPayload</code> <code class="o">=</code> <code class="nx">serializable</code><code class="p">(</code><code class="nx">APIPayload</code><code class="p">)</code>
<code class="kd">let</code> <code class="nx">payload</code> <code class="o">=</code> <code class="kd">new</code> <code class="nx">DecoratedAPIPayload</code>
<code class="nx">payload</code><code class="p">.</code><code class="nx">serialize</code><code class="p">()</code>                  <code class="c">// string</code></pre>

<p class="author1">We won’t delve more deeply into decorators in this book. For more information, head over to the <a href="http://bit.ly/2IDQd1U" class="calibre4">official documentation</a>.<a data-primary="decorators" data-startref="ix_deco" data-type="indexterm" id="calibre_link-828" class="calibre4"></a><a data-primary="classes" data-secondary="decorators" data-startref="ix_classdeco" data-type="indexterm" id="calibre_link-739" class="calibre4"></a></p>
</div></section>













<section data-pdf-bookmark="Simulating final Classes" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1855">
<h1 class="calibre13">Simulating final Classes</h1>

<p class="author1">Though TypeScript doesn’t support the <code class="calibre14">final</code> keyword for classes or methods, it’s easy to simulate it for classes.<a data-primary="final classes, simulating" data-type="indexterm" id="calibre_link-1003" class="calibre4"></a><a data-primary="classes" data-secondary="simulating final classes" data-type="indexterm" id="calibre_link-749" class="calibre4"></a> If you haven’t worked much with object-oriented languages before, <code class="calibre14">final</code> is the keyword some languages use to mark a class as nonextensible, or a method as nonoverridable.</p>

<p class="author1">To simulate <code class="calibre14">final</code> classes in TypeScript, we can take advantage of private constructors:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">class</code> <code class="nx">MessageQueue</code> <code class="p">{</code>
  <code class="kd">private</code> <code class="kd">constructor</code><code class="p">(</code><code class="kd">private</code> <code class="nx">messages</code>: <code class="kt">string</code><code class="p">[])</code> <code class="p">{}</code>
<code class="p">}</code></pre>

<p class="author1">When a <code class="calibre14">constructor</code> is marked <code class="calibre14">private</code>, you can’t <code class="calibre14">new</code> the <a data-primary="constructors" data-secondary="private class constructors" data-type="indexterm" id="calibre_link-803" class="calibre4"></a><a data-primary="private (access modifier)" data-secondary="class constructors" data-type="indexterm" id="calibre_link-1371" class="calibre4"></a>class or extend it:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">class</code> <code class="nx">BadQueue</code> <code class="kd">extends</code> <code class="nx">MessageQueue</code> <code class="p">{}</code>  <code class="c">// Error TS2675: Cannot extend a class</code>
                                        <code class="c">// 'MessageQueue'. Class constructor is</code>
                                        <code class="c">// marked as private.</code>

<code class="kd">new</code> <code class="nx">MessageQueue</code><code class="p">([])</code>                    <code class="c">// Error TS2673: Constructor of class</code>
                                        <code class="c">// 'MessageQueue' is private and only</code>
                                        <code class="c">// accessible within the class</code>
                                        <code class="c">// declaration.</code></pre>

<p class="author1">As well as preventing you from extending the class&mdash;which is what we want&mdash;private constructors also prevent you from directly instantiating it. But for <code class="calibre14">final</code> classes we do want the ability to instantiate a class, just not to extend it. How do we keep the first restriction but get rid of the second? Easy:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<code class="kd">class</code><code class="calibre14"> </code><code class="nx">MessageQueue</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="kd">private</code><code class="calibre14"> </code><code class="kd">constructor</code><code class="p">(</code><code class="kd">private</code><code class="calibre14"> </code><code class="nx">messages</code><code class="calibre14">: </code><code class="kt">string</code><code class="p">[</code><code class="p">]</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="p">}</code><code class="calibre14">
  </code><strong class="calibre49"><code class="k">static</code><code class="calibre50"> </code><code class="nx1">create</code><code class="p1">(</code><code class="nx1">messages</code><code class="calibre50">: </code><code class="kt1">string</code><code class="p1">[</code><code class="p1">]</code><code class="p1">)</code><code class="calibre50"> </code><code class="p1">{</code><code class="calibre50">
    </code><code class="k">return</code><code class="calibre50"> </code><code class="k">new</code><code class="calibre50"> </code><code class="nx1">MessageQueue</code><code class="p1">(</code><code class="nx1">messages</code><code class="p1">)</code><code class="calibre50">
  </code><code class="p1">}</code></strong><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code></pre>

<p class="author1">This changes <code class="calibre14">MessageQueue</code>’s API a bit, but it does a great job of preventing extensions at compile time:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">class</code> <code class="nx">BadQueue</code> <code class="kd">extends</code> <code class="nx">MessageQueue</code> <code class="p">{}</code>  <code class="c">// Error TS2675: Cannot extend a class</code>
                                        <code class="c">// 'MessageQueue'. Class constructor is</code>
                                        <code class="c">// marked as private.</code>

<code class="nx">MessageQueue</code><code class="p">.</code><code class="nx">create</code><code class="p">([])</code> <code class="c">// MessageQueue</code></pre>
</div></section>













<section data-pdf-bookmark="Design Patterns" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1856">
<h1 class="calibre13">Design Patterns</h1>

<p class="author1">This wouldn’t be a chapter on object-oriented programming if we didn’t walk through implementing a design pattern or two in TypeScript, right?<a data-primary="design patterns" data-type="indexterm" id="calibre_link-838" class="calibre4"></a><a data-primary="classes" data-secondary="design patterns" data-type="indexterm" id="calibre_link-740" class="calibre4"></a></p>








<section data-pdf-bookmark="Factory Pattern" data-type="sect2" class="preface"><div class="preface" id="calibre_link-224">
<h2 class="calibre17">Factory Pattern</h2>

<p class="author1">The <em class="calibre5">factory pattern</em> is a way to create objects of some type, leaving the decision of which concrete object to create to the specific factory that creates that object.<a data-primary="classes" data-secondary="design patterns" data-tertiary="factory pattern" data-type="indexterm" id="calibre_link-743" class="calibre4"></a><a data-primary="factory pattern" data-type="indexterm" id="calibre_link-1001" class="calibre4"></a><a data-primary="design patterns" data-secondary="factory pattern" data-type="indexterm" id="calibre_link-841" class="calibre4"></a></p>

<p class="author1">Let’s build a shoe factory. We’ll start by defining a <code class="calibre14">Shoe</code> type, and a few kinds of shoes:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">Shoe</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">purpose</code>: <code class="kt">string</code>
<code class="p">}</code>

<code class="kd">class</code> <code class="nx">BalletFlat</code> <code class="kd">implements</code> <code class="nx">Shoe</code> <code class="p">{</code>
  <code class="nx">purpose</code> <code class="o">=</code> <code class="s">'dancing'</code>
<code class="p">}</code>

<code class="kd">class</code> <code class="nx">Boot</code> <code class="kd">implements</code> <code class="nx">Shoe</code> <code class="p">{</code>
  <code class="nx">purpose</code> <code class="o">=</code> <code class="s">'woodcutting'</code>
<code class="p">}</code>

<code class="kd">class</code> <code class="nx">Sneaker</code> <code class="kd">implements</code> <code class="nx">Shoe</code> <code class="p">{</code>
  <code class="nx">purpose</code> <code class="o">=</code> <code class="s">'walking'</code>
<code class="p">}</code></pre>

<p class="author1">Note that this example uses a <code class="calibre14">type</code>, but we could have just as well used an <code class="calibre14">interface</code> instead.</p>

<p class="author1">Now, let’s make a shoe factory:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code><code class="calibre14"> </code><code class="nx">Shoe</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="nx">create</code><code class="p">(</code><code class="nx">type</code><code class="o">:</code><code class="calibre14"> </code><code class="s">'balletFlat'</code><code class="calibre14"> </code><code class="o">|</code><code class="calibre14"> </code><code class="s">'boot'</code><code class="calibre14"> </code><code class="o">|</code><code class="calibre14"> </code><code class="s">'sneaker'</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">Shoe</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-216" id="calibre_link-218"><img alt="1" src="images/000000.png" class="calibre40" /></a><code class="calibre14">
    </code><code class="kd">switch</code><code class="calibre14"> </code><code class="p">(</code><code class="nx">type</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-217" id="calibre_link-219"><img alt="2" src="images/000001.png" class="calibre40" /></a><code class="calibre14">
      </code><code class="kd">case</code><code class="calibre14"> </code><code class="s">'balletFlat'</code><code class="o">:</code><code class="calibre14"> </code><code class="kd">return</code><code class="calibre14"> </code><code class="kd">new</code><code class="calibre14"> </code><code class="nx">BalletFlat</code><code class="calibre14">
      </code><code class="kd">case</code><code class="calibre14"> </code><code class="s">'boot'</code><code class="o">:</code><code class="calibre14"> </code><code class="kd">return</code><code class="calibre14"> </code><code class="kd">new</code><code class="calibre14"> </code><code class="nx">Boot</code><code class="calibre14">
      </code><code class="kd">case</code><code class="calibre14"> </code><code class="s">'sneaker'</code><code class="o">:</code><code class="calibre14"> </code><code class="kd">return</code><code class="calibre14"> </code><code class="kd">new</code><code class="calibre14"> </code><code class="nx">Sneaker</code><code class="calibre14">
    </code><code class="p">}</code><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">
</code><code class="p">}</code></pre>
<dl class="preface">
<dt class="calibre18"><a class="calibre4" href="#calibre_link-218" id="calibre_link-216"><img alt="1" src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">Using a union type for <code class="calibre14">type</code> helps make <code class="calibre14">.create</code> as typesafe as possible, preventing consumers from passing in an invalid <code class="calibre14">type</code> at compile time.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-219" id="calibre_link-217"><img alt="2" src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">Switching on <code class="calibre14">type</code> makes it easy for TypeScript to enforce that we’ve handled every type of <code class="calibre14">Shoe</code>.</p></dd>
</dl>

<p class="author1">In this example we use the companion object pattern (see <a data-type="xref" href="#calibre_link-171" class="calibre4">“Companion Object Pattern”</a>) to declare a type <code class="calibre14">Shoe</code> and a value <code class="calibre14">Shoe</code> with the same name (remember that TypeScript has separate namespaces for values and for types), as a way to signal that the value provides methods for operating on the type. To use the factory, we can just call <code class="calibre14">.create</code>:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">Shoe</code><code class="p">.</code><code class="nx">create</code><code class="p">(</code><code class="s">'boot'</code><code class="p">)</code> <code class="c">// Shoe</code></pre>

<p class="author1">Voilà! We have a factory pattern. Note that we could have gone further and indicated in <code class="calibre14">Shoe.create</code>’s type signature that passing in <code class="calibre14">'boot'</code> will give a <code class="calibre14">Boot</code>, <code class="calibre14">'sneaker'</code> will give a <code class="calibre14">Sneaker</code>, and so on, but that would break the abstraction that the factory pattern gives us (that the consumer shouldn’t know what concrete class they’ll get back, just that the class satisfies a particular interface).</p>
</div></section>













<section data-pdf-bookmark="Builder Pattern" data-type="sect2" class="preface"><div class="preface" id="calibre_link-166">
<h2 class="calibre17">Builder Pattern</h2>

<p class="author1">The <em class="calibre5">builder pattern</em> is a way to separate the construction of an object from the way that object is actually implemented.<a data-primary="design patterns" data-secondary="builder pattern" data-type="indexterm" id="calibre_link-840" class="calibre4"></a><a data-primary="classes" data-secondary="design patterns" data-tertiary="builder pattern" data-type="indexterm" id="calibre_link-742" class="calibre4"></a><a data-primary="builder pattern" data-type="indexterm" id="calibre_link-709" class="calibre4"></a> If you’ve used JQuery, or ES6 data structures like <code class="calibre14">Map</code> and <code class="calibre14">Set</code>, this style of API should look familiar. Here’s what it looks like:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">new</code> <code class="nx">RequestBuilder</code><code class="p">()</code>
  <code class="p">.</code><code class="nx">setURL</code><code class="p">(</code><code class="s">'/users'</code><code class="p">)</code>
  <code class="p">.</code><code class="nx">setMethod</code><code class="p">(</code><code class="s">'get'</code><code class="p">)</code>
  <code class="p">.</code><code class="nx">setData</code><code class="p">({</code><code class="nx">firstName</code><code class="o">:</code> <code class="s">'Anna'</code><code class="p">})</code>
  <code class="p">.</code><code class="nx">send</code><code class="p">()</code></pre>

<p class="author1">How do we implement <code class="calibre14">RequestBuilder</code>? Easy&mdash;we’ll start with a bare class:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">class</code> <code class="nx">RequestBuilder</code> <code class="p">{}</code></pre>

<p class="author1">First we’ll add the <code class="calibre14">.setURL</code> method:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<code class="kd">class</code><code class="calibre14"> </code><code class="nx">RequestBuilder</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">

  </code><strong class="calibre49"><code class="k">private</code><code class="calibre50"> </code><code class="nx1">url</code><code class="calibre50">: </code><code class="kt1">string</code><code class="calibre50"> </code><code class="o1">|</code><code class="calibre50"> </code><code class="k">null</code><code class="calibre50"> </code><code class="o1">=</code><code class="calibre50"> </code><code class="k">null</code></strong><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-220" id="calibre_link-221"><img src="images/000000.png" class="calibre40" /></a><code class="calibre14">

  </code><strong class="calibre49"><code class="nx1">setURL</code><code class="p1">(</code><code class="nx1">url</code><code class="calibre50">: </code><code class="kt1">string</code><code class="p1">)</code><code class="o1">:</code><code class="calibre50"> </code><code class="k">this</code><code class="calibre50"> </code><code class="p1">{</code></strong><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-220" id="calibre_link-222"><img src="images/000001.png" class="calibre40" /></a><code class="calibre14">
    </code><strong class="calibre49"><code class="k">this</code><code class="p1">.</code><code class="nx1">url</code><code class="calibre50"> </code><code class="o1">=</code><code class="calibre50"> </code><code class="nx1">url</code><code class="calibre50">
    </code><code class="k">return</code><code class="calibre50"> </code><code class="k">this</code><code class="calibre50">
  </code><code class="p1">}</code></strong><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code></pre>

<dl class="preface">
<dt class="calibre18"><a class="calibre4" href="#calibre_link-221" id="calibre_link-220"><img src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We keep track of the URL the user set in a private instance variable <code class="calibre14">url</code>, which we initialize to <code class="calibre14">null</code>.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-222" id="calibre_link-1857"><img src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45"><code class="calibre14">setURL</code>’s return type is <code class="calibre14">this</code> (see <a data-type="xref" href="#calibre_link-223" class="calibre4">“Using this as a Return Type”</a>), that is, the specific instance of <code class="calibre14">RequestBuilder</code> that the user called <code class="calibre14">setURL</code> on.</p></dd>
</dl>

<p class="author1">Now let’s add the other methods from our example:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<code class="kd">class</code><code class="calibre14"> </code><code class="nx">RequestBuilder</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">

  </code><strong class="calibre49"><code class="k">private</code><code class="calibre50"> </code><code class="nx1">data</code><code class="calibre50">: </code><code class="kt1">object</code><code class="calibre50"> </code><code class="o1">|</code><code class="calibre50"> </code><code class="k">null</code><code class="calibre50"> </code><code class="o1">=</code><code class="calibre50"> </code><code class="k">null</code><code class="calibre50">
  </code><code class="k">private</code><code class="calibre50"> </code><code class="nx1">method</code><code class="o1">:</code><code class="calibre50"> </code><code class="s1">'get'</code><code class="calibre50"> </code><code class="o1">|</code><code class="calibre50"> </code><code class="s1">'post'</code><code class="calibre50"> </code><code class="o1">|</code><code class="calibre50"> </code><code class="k">null</code><code class="calibre50"> </code><code class="o1">=</code><code class="calibre50"> </code><code class="k">null</code></strong><code class="calibre14">
  </code><code class="kd">private</code><code class="calibre14"> </code><code class="nx">url</code><code class="calibre14">: </code><code class="kt">string</code><code class="calibre14"> </code><code class="o">|</code><code class="calibre14"> </code><code class="kd">null</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="kd">null</code><code class="calibre14">

  </code><strong class="calibre49"><code class="nx1">setMethod</code><code class="p1">(</code><code class="nx1">method</code><code class="o1">:</code><code class="calibre50"> </code><code class="s1">'get'</code><code class="calibre50"> </code><code class="o1">|</code><code class="calibre50"> </code><code class="s1">'post'</code><code class="p1">)</code><code class="o1">:</code><code class="calibre50"> </code><code class="k">this</code><code class="calibre50"> </code><code class="p1">{</code><code class="calibre50">
    </code><code class="k">this</code><code class="p1">.</code><code class="nx1">method</code><code class="calibre50"> </code><code class="o1">=</code><code class="calibre50"> </code><code class="nx1">method</code><code class="calibre50">
    </code><code class="k">return</code><code class="calibre50"> </code><code class="k">this</code><code class="calibre50">
  </code><code class="p1">}</code><code class="calibre50">
  </code><code class="nx1">setData</code><code class="p1">(</code><code class="nx1">data</code><code class="calibre50">: </code><code class="kt1">object</code><code class="p1">)</code><code class="o1">:</code><code class="calibre50"> </code><code class="k">this</code><code class="calibre50"> </code><code class="p1">{</code><code class="calibre50">
    </code><code class="k">this</code><code class="p1">.</code><code class="nx1">data</code><code class="calibre50"> </code><code class="o1">=</code><code class="calibre50"> </code><code class="nx1">data</code><code class="calibre50">
    </code><code class="k">return</code><code class="calibre50"> </code><code class="k">this</code><code class="calibre50">
  </code><code class="p1">}</code></strong><code class="calibre14">
  </code><code class="nx">setURL</code><code class="p">(</code><code class="nx">url</code><code class="calibre14">: </code><code class="kt">string</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="kd">this</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
    </code><code class="kd">this</code><code class="p">.</code><code class="nx">url</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="nx">url</code><code class="calibre14">
    </code><code class="kd">return</code><code class="calibre14"> </code><code class="kd">this</code><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">

  </code><strong class="calibre49"><code class="nx1">send() {</code><code class="calibre50">
    </code><code class="c3">// ...
</code><code class="calibre50">  </code><code class="p1">}</code></strong><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code></pre>

<p class="author1">That’s all there is to it.</p>
<div data-type="note" type="note" class="calibre21"><h6 class="calibre22">Note</h6>
<p class="author1">This traditional builder design is not completely safe: we can call <code class="calibre14">.send</code> before we set the method, URL, or data, resulting in a runtime exception (remember, that’s the bad kind of exception). See Exercise 4 for some ideas about how to improve this design.<a data-primary="classes" data-secondary="design patterns" data-startref="ix_classdes" data-type="indexterm" id="calibre_link-741" class="calibre4"></a><a data-primary="design patterns" data-startref="ix_despatt" data-type="indexterm" id="calibre_link-839" class="calibre4"></a></p>
</div>
</div></section>





</div></section>













<section data-pdf-bookmark="Summary" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1858">
<h1 class="calibre13">Summary</h1>

<p class="author1">We’ve now explored TypeScript classes from all sides: how to declare classes; how to inherit from classes and implement interfaces; how to mark classes as <code class="calibre14">abstract</code> so they can’t be instantiated; how to put a field or method on a class with <code class="calibre14">static</code> and on an instance without it; how to control access to a field or method with the <code class="calibre14">private</code>, <code class="calibre14">protected</code>, and <code class="calibre14">public</code> visibility modifiers; and how to mark a field as nonwritable using the <code class="calibre14">readonly</code> modifier. We’ve covered how to safely use <code class="calibre14">this</code> and <code class="calibre14">super</code>, explored what it means for classes to be both values and types at the same time, and talked about the differences between type aliases and interfaces, the basics of declaration merging, and using generic types in classes. Finally, we covered a few more advanced patterns for working with classes: mixins, decorators, and simulating <code class="calibre14">final</code> classes. And to cap the chapter off, we went through and derived a couple of common patterns for working with classes.</p>
</div></section>













<section data-pdf-bookmark="Exercises" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1859">
<h1 class="calibre13">Exercises</h1>
<ol class="calibre31">
<li class="calibre32">
<p class="author1">What are the differences between a class and an interface?</p>
</li>
<li class="calibre32">
<p class="author1">When you mark a class’s constructor as <code class="calibre14">private</code>, that means you can’t instantiate or extend the class. What happens when you mark it as <code class="calibre14">protected</code> instead? Play around with this in your code editor, and see if you can figure it out.</p>
</li>
<li class="calibre32">
<p class="author1">Extend the implementation we developed <a data-type="xref" href="#calibre_link-224" class="calibre4">“Factory Pattern”</a> to make it safer, at the expense of breaking the abstraction a bit. Update the implementation so that a consumer knows at compile time that calling <code class="calibre14">Shoe.create('boot')</code> returns a <code class="calibre14">Boot</code> and calling <code class="calibre14">Shoe.create('balletFlat')</code> returns a <code class="calibre14">BalletFlat</code> (rather than both returning a <code class="calibre14">Shoe</code>). Hint: think back to <a data-type="xref" href="#calibre_link-142" class="calibre4">“Overloaded Function Types”</a>.</p>
</li>
<li class="calibre32">
<p class="author1">[Hard] As an exercise, think about how you might design a typesafe builder pattern. Extend the Builder pattern <a data-type="xref" href="#calibre_link-166" class="calibre4">“Builder Pattern”</a> to:</p>
<ol class="calibre46">
<li class="calibre47">
<p class="author1">Guarantee at compile time that someone can’t call <code class="calibre14">.send</code> before setting at least a URL and a method. Would it be easier to make this guarantee if you also force the user to call methods in a specific order? (Hint: what can you return instead of <code class="calibre14">this</code>?)</p>
</li>
<li class="calibre47">
<p class="author1">[Harder] How would you change your design if you wanted to make this guarantee, but still let people call methods in any order? (Hint: what TypeScript feature can you use to make each method’s return type “add” to the <code class="calibre14">this</code> type after each method call?)</p>
</li>

</ol>
</li>

</ol>
</div></section>







<div data-type="footnotes" class="calibre26"><p data-type="footnote" id="calibre_link-155" class="calibre27"><sup class="calibre28"><a href="#calibre_link-225" class="calibre16">1</a></sup> Or are on track to soon be supported by JavaScript classes.</p><p data-type="footnote" id="calibre_link-180" class="calibre27"><sup class="calibre28"><a href="#calibre_link-226" class="calibre16">2</a></sup> Because TypeScript is structurally typed, of course, the relationship for classes is more of a “looks-like”&mdash;any object that implements the same shape as your class will be assignable to the type of your class.</p><p data-type="footnote" id="calibre_link-197" class="calibre27"><sup class="calibre28"><a href="#calibre_link-227" class="calibre16">3</a></sup> Note that TypeScript is picky here: the type of a constructor type’s arguments has to be <code class="calibre14">any[]</code> (not <code class="calibre14">void</code>, <code class="calibre14">unknown[]</code>, etc.) in order for us to be able to extend it.</p><p data-type="footnote" id="calibre_link-206" class="calibre27"><sup class="calibre28"><a href="#calibre_link-228" class="calibre16">4</a></sup> A handful of languages&mdash;Scala, PHP, Kotlin, and Rust, to name a few&mdash;implement a pared-down version of mixins, called <em class="calibre5">traits</em>. Traits are like mixins, but don’t have constructors and don’t support instance properties. This makes it easier to wire them up and prevent collisions between multiple traits accessing state that is shared between them and the base class.</p></div></div></section></div>

<div data-type="book" class="calibre1" id="calibre_link-229"><section data-pdf-bookmark="Chapter 6. Advanced Types" data-type="chapter" type="chapter" class="preface"><div class="preface" id="calibre_link-36">
<h1 class="calibre12"><span class="calibre">Chapter 6. </span>Advanced Types</h1>


<p class="author1">TypeScript has a world-class type system that supports powerful type-level programming features that might make even the crotchetiest Haskell programmer jealous. As you by now know, that type system isn’t just incredibly expressive, but also easy to use, and makes declaring type constraints and relationships simple, terse, and most of the time, inferred.</p>

<p class="author1">We need such an expressive and unusual type system because JavaScript is so dynamic. Modeling things like prototypes, dynamically bound <code class="calibre14">this</code>, function overloads, and always-changing objects requires a rich type system and a utility belt of type operators that would make Batman do a double-take.</p>

<p class="author1">I’ll start this chapter with a deep dive into subtyping, assignability, variance, and widening in TypeScript, giving more definition to the intuitions you’ve been developing over the last several chapters. I’ll then cover TypeScript’s control-flow-based typechecking features in more detail, including refinement and totality, and continue with some advanced type-level programming features: keying into and mapping over object types, using conditional types, defining your own type guards, and escape hatches like type assertions and definite assignment assertions. Finally, I’ll cover advanced patterns for squeezing more safety out of your types: the companion object pattern, improving inference for tuple types, simulating nominal types, and safely extending the prototype.</p>






<section class="preface" data-pdf-bookmark="Relationships Between Types" data-type="sect1"><div class="preface" id="calibre_link-1860">
<h1 class="calibre13">Relationships Between Types</h1>

<p class="author1">Let’s begin by taking a closer look at type relations in TypeScript.<a data-primary="types" data-secondary="relationships between" data-type="indexterm" id="calibre_link-1637" class="calibre4"></a></p>








<section data-pdf-bookmark="Subtypes and Supertypes" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1861">
<h2 class="calibre17">Subtypes and Supertypes</h2>

<p class="author1">We talked a little about assignability in <a data-type="xref" href="#calibre_link-230" class="calibre4">“Talking About Types”</a>. Now that you’ve seen most of the types TypeScript has to offer we can dive deeper, starting from the top: what’s a subtype?<a data-primary="types" data-secondary="relationships between" data-tertiary="subtypes and supertypes" data-type="indexterm" id="calibre_link-1642" class="calibre4"></a></p>
<aside class="keyterm" data-type="sidebar" type="sidebar"><div class="sidebar" id="calibre_link-1862">
<h5 class="calibre29">Subtype</h5>
<p class="author1">If you have two types <code class="calibre14">A</code> and <code class="calibre14">B</code>, and <code class="calibre14">B</code> is a subtype of <code class="calibre14">A</code>, then you can safely use a <code class="calibre14">B</code> anywhere an <code class="calibre14">A</code> is required (<a data-type="xref" href="#calibre_link-231" class="calibre4">Figure&nbsp;6-1</a>).<a data-primary="subtypes" data-type="indexterm" id="calibre_link-1457" class="calibre4"></a></p>
</div></aside>

<figure class="calibre33"><div class="figure" id="calibre_link-231">
<img alt="prts 0601" src="images/000019.png" class="calibre40" />
<h6 class="calibre34"><span class="calibre">Figure 6-1. </span>B is a subtype of A</h6>
</div></figure>

<p class="author1">If you look back at <a data-type="xref" href="#calibre_link-35" class="calibre4">Figure&nbsp;3-1</a> at the very beginning of Chapter 3, you’ll see what the subtype relations built into TypeScript are. For example:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">Array is a subtype of Object.</p>
</li>
<li class="calibre11">
<p class="author1">Tuple is a subtype of Array.</p>
</li>
<li class="calibre11">
<p class="author1">Everything is a subtype of <code class="calibre14">any</code>.</p>
</li>
<li class="calibre11">
<p class="author1"><code class="calibre14">never</code> is a subtype of everything.</p>
</li>
<li class="calibre11">
<p class="author1">If you have a class <code class="calibre14">Bird</code> that extends <code class="calibre14">Animal</code>, then <code class="calibre14">Bird</code> is a subtype of <code class="calibre14">Animal</code>.</p>
</li>
</ul>

<p class="author1">From the definition I just gave for subtype, that means:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">Anywhere you need an Object you can also use an Array.</p>
</li>
<li class="calibre11">
<p class="author1">Anywhere you need an Array you can also use a Tuple.</p>
</li>
<li class="calibre11">
<p class="author1">Anywhere you need an <code class="calibre14">any</code> you can also use an Object.</p>
</li>
<li class="calibre11">
<p class="author1">You can use a <code class="calibre14">never</code> anywhere.</p>
</li>
<li class="calibre11">
<p class="author1">Anywhere you need an <code class="calibre14">Animal</code> you can also use a <code class="calibre14">Bird</code>.</p>
</li>
</ul>

<p class="author1">As you might have guessed, <a data-primary="supertypes" data-type="indexterm" id="calibre_link-1462" class="calibre4"></a>a supertype is the opposite of a subtype.</p>
<aside class="keyterm" data-type="sidebar" type="sidebar"><div class="sidebar" id="calibre_link-1863">
<h5 class="calibre29">Supertype</h5>
<p class="author1">If you have two types <code class="calibre14">A</code> and <code class="calibre14">B</code>, and <code class="calibre14">B</code> is a supertype of <code class="calibre14">A</code>, then you can safely use an <code class="calibre14">A</code> anywhere a <code class="calibre14">B</code> is required (<a data-type="xref" href="#calibre_link-232" class="calibre4">Figure&nbsp;6-2</a>).</p>
</div></aside>

<figure class="calibre33"><div class="figure" id="calibre_link-232">
<img alt="prts 0602" src="images/000020.png" class="calibre40" />
<h6 class="calibre34"><span class="calibre">Figure 6-2. </span>B is a supertype of A</h6>
</div></figure>

<p class="author1">Again from the flowchart in <a data-type="xref" href="#calibre_link-35" class="calibre4">Figure&nbsp;3-1</a>:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">Array is a supertype of Tuple.</p>
</li>
<li class="calibre11">
<p class="author1">Object is a supertype of Array.</p>
</li>
<li class="calibre11">
<p class="author1">Any is a supertype of everything.</p>
</li>
<li class="calibre11">
<p class="author1">Never is a supertype of nothing.</p>
</li>
<li class="calibre11">
<p class="author1"><code class="calibre14">Animal</code> is a supertype of <code class="calibre14">Bird</code>.</p>
</li>
</ul>

<p class="author1">This is just the opposite of how subtypes work, and nothing more.</p>
</div></section>













<section data-pdf-bookmark="Variance" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1864">
<h2 class="calibre17">Variance</h2>

<p class="author1">For most types it’s pretty easy to intuit whether or not some type <code class="calibre14">A</code> is a subtype of another type <code class="calibre14">B</code>.<a data-primary="variance" data-type="indexterm" id="calibre_link-1745" class="calibre4"></a><a data-primary="types" data-secondary="relationships between" data-tertiary="variance" data-type="indexterm" id="calibre_link-1645" class="calibre4"></a> For simple types like <code class="calibre14">number</code>, <code class="calibre14">string</code>, and so on, you can just look them up in the flowchart in <a data-type="xref" href="#calibre_link-35" class="calibre4">Figure&nbsp;3-1</a>, or reason through it (”<code class="calibre14">number</code> is contained in the union <code class="calibre14">number | string</code>, so it must be a subtype of it”).</p>

<p class="author1">But for parameterized (generic) types<a data-primary="generics" data-secondary="subtyping" data-type="indexterm" id="calibre_link-1076" class="calibre4"></a><a data-primary="subtypes" data-secondary="subtyping rules for more complex types" data-type="indexterm" id="calibre_link-1459" class="calibre4"></a> and other more complex types, it gets more complicated. Consider these cases:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">When is <code class="calibre14">Array&lt;A&gt;</code> a subtype of <code class="calibre14">Array&lt;B&gt;</code>?</p>
</li>
<li class="calibre11">
<p class="author1">When is a shape <code class="calibre14">A</code> a subtype of another shape <code class="calibre14">B</code>?</p>
</li>
<li class="calibre11">
<p class="author1">When is a function <code class="calibre14">(a: A) =&gt; B</code> a subtype of another function <code class="calibre14">(c: C) =&gt; D</code>?</p>
</li>
</ul>

<p class="author1">Subtyping rules for types that contain other types (i.e., things with type parameters like <code class="calibre14">Array&lt;A&gt;</code>, shapes with fields like <code class="calibre14">{a: number}</code>, or functions like <code class="calibre14">(a: A) =&gt; B</code>) are harder to reason about, and the answers aren’t as clear-cut. In fact, subtyping rules for these kinds of complex types are a big point of disagreement among programming languages&mdash;almost no two languages are alike!</p>

<p class="author1">To make the following rules easier to read, I’m going to introduce a few pieces of syntax that let us talk about types a little more precisely and tersely. This syntax is not valid TypeScript; it’s just a way for you and me to share a common language when we talk about types. And don’t worry, I swear the syntax isn’t math:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1"><code class="calibre14">A &lt;: B</code> means "<code class="calibre14">A</code> is a subtype of or the same as the type <code class="calibre14">B</code>.”</p>
</li>
<li class="calibre11">
<p class="author1"><code class="calibre14">A &gt;: B</code> means "<code class="calibre14">A</code> is a supertype of or the same as the type <code class="calibre14">B</code>.”</p>
</li>
</ul>










<section data-pdf-bookmark="Shape and array variance" data-type="sect3" class="preface"><div class="preface" id="calibre_link-234">
<h3 class="calibre39">Shape and array variance</h3>

<p class="author1">To get some intuition for why exactly languages disagree on subtyping rules for complex types, <a data-primary="subtypes" data-secondary="subtyping rules for more complex types" data-tertiary="shapes and arrays" data-type="indexterm" id="calibre_link-1460" class="calibre4"></a><a data-primary="variance" data-secondary="shape and array" data-type="indexterm" id="calibre_link-1749" class="calibre4"></a><a data-primary="shapes" data-secondary="subtyping" data-type="indexterm" id="calibre_link-1437" class="calibre4"></a>let me take you through an example complex type: shapes. Say you have a shape describing a user in your application. You might represent it with a pair of types that look something like this:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// An existing user that we got from the server</code>
<code class="nx">type</code> <code class="nx">ExistingUser</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">id</code>: <code class="kt">number</code>
  <code class="nx">name</code>: <code class="kt">string</code>
<code class="p">}</code>

<code class="c">// A new user that hasn't been saved to the server yet</code>
<code class="nx">type</code> <code class="nx">NewUser</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">name</code>: <code class="kt">string</code>
<code class="p">}</code></pre>

<p class="author1">Now suppose an intern at your company is tasked with writing some code to delete a user. They start it like this:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">deleteUser</code><code class="p">(</code><code class="nx">user</code><code class="o">:</code> <code class="p">{</code><code class="nx">id?</code>: <code class="kt">number</code><code class="p">,</code> <code class="nx">name</code>: <code class="kt">string</code><code class="p">})</code> <code class="p">{</code>
  <code class="kd">delete</code> <code class="nx">user</code><code class="p">.</code><code class="nx">id</code>
<code class="p">}</code>

<code class="kd">let</code> <code class="nx">existingUser</code>: <code class="kt">ExistingUser</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">id</code>: <code class="kt">123456</code><code class="p">,</code>
  <code class="nx">name</code><code class="o">:</code> <code class="s">'Ima User'</code>
<code class="p">}</code>

<code class="nx">deleteUser</code><code class="p">(</code><code class="nx">existingUser</code><code class="p">)</code></pre>

<p class="author1"><code class="calibre14">deleteUser</code> takes an object of<a data-primary="objects" data-secondary="covariant members" data-type="indexterm" id="calibre_link-1308" class="calibre4"></a><a data-primary="supertypes" data-secondary="using object type in place of expected supertype" data-type="indexterm" id="calibre_link-1464" class="calibre4"></a> type <code class="calibre14">{id?: number, name: string}</code>, and it’s passed an <code class="calibre14">existingUser</code> of type <code class="calibre14">{id: number, name: string}</code>. Notice that the type of the <code class="calibre14">id</code> property (<code class="calibre14">number</code>) is a <em class="calibre5">subtype</em> of the expected type (<code class="calibre14">number | undefined</code>). Therefore the entire object <code class="calibre14">{id: number, name: string}</code> is a subtype of <code class="calibre14">{id?: number, name: string}</code>, so TypeScript lets it fly.</p>

<p class="author1">Do you see the safety issue here? It’s a subtle one: after passing an <code class="calibre14">ExistingUser</code> to <code class="calibre14">deleteUser</code>, TypeScript doesn’t know that the user’s <code class="calibre14">id</code> has been deleted, so if we read <code class="calibre14">existingUser.id</code> after deleting it with <code class="calibre14">deleteUser(existingUser)</code>, TypeScript still thinks <code class="calibre14">existingUser.id</code> is of type <code class="calibre14">number</code>!</p>

<p class="author1">Clearly, using an object type in a place where something expects its supertype can be unsafe. So why does TypeScript allow it? In general, TypeScript is not designed to be perfectly safe; instead, its type system tries to strike a balance between catching real mistakes and being easy to use, without you needing to get a degree in programming language theory to understand why something is an error. This specific case of un<span class="calibre">safety</span> is a practical one: since destructive updates (like deleting a property) are relatively rare in practice, TypeScript is lax and lets you assign an object to a place where its supertype is expected.</p>

<p class="author1">What about the opposite direction&mdash;can you assign an object to a place where its subtype is expected?</p>

<p class="author1">Let’s add a new type for a legacy user, then delete a user of that type (imagine you’re adding types to code your coworker wrote before you started using TypeScript):</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">LegacyUser</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">id?</code>: <code class="kt">number</code> <code class="o">|</code> <code class="kt">string</code>
  <code class="nx">name</code>: <code class="kt">string</code>
<code class="p">}</code>

<code class="kd">let</code> <code class="nx">legacyUser</code>: <code class="kt">LegacyUser</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">id</code><code class="o">:</code> <code class="s">'793331'</code><code class="p">,</code>
  <code class="nx">name</code><code class="o">:</code> <code class="s">'Xin Yang'</code>
<code class="p">}</code>

<code class="nx">deleteUser</code><code class="p">(</code><code class="nx">legacyUser</code><code class="p">)</code> <code class="c">// Error TS2345: Argument of type 'LegacyUser' is not</code>
                       <code class="c">// assignable to parameter of type '{id?: number |</code>
                       <code class="c">// undefined, name: string}'. Type 'string' is not</code>
                       <code class="c">// assignable to type 'number | undefined'.</code></pre>

<p class="author1">When we pass a shape with a property whose type is a supertype of the expected type, TypeScript complains.<a data-primary="shapes" data-secondary="subtype and supertype rules" data-type="indexterm" id="calibre_link-1436" class="calibre4"></a><a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2345" data-type="indexterm" id="calibre_link-923" class="calibre4"></a> That’s because <code class="calibre14">id</code> is a <code class="calibre14">string | number |</code> <code class="calibre14"><span class="calibre">undefined</span></code>, and <code class="calibre14">deleteUser</code> only handles the case of an <code class="calibre14">id</code> that’s a <code class="calibre14">number | undefined</code>.</p>

<p class="author1">TypeScript’s behavior is as follows: if you expect a shape, you can also pass a type with property types that are <code class="calibre14">&lt;:</code> their expected types, but you cannot pass a shape with property types that are supertypes of their expected types. When talking about types, we say that TypeScript shapes (objects and classes) are <em class="calibre5">covariant</em> in their property types.<a data-primary="covariance" data-type="indexterm" id="calibre_link-811" class="calibre4"></a><a data-primary="properties" data-secondary="object and class, covariance in" data-type="indexterm" id="calibre_link-1388" class="calibre4"></a> That is, for an object <code class="calibre14">A</code> to be assignable to an object <code class="calibre14">B</code>, each of its properties must be <code class="calibre14">&lt;:</code> its corresponding property in <code class="calibre14">B</code>.<a data-primary="invariance" data-type="indexterm" id="calibre_link-1133" class="calibre4"></a></p>

<p class="author1">More generally, covariance is just one<a data-primary="variance" data-secondary="kinds of" data-type="indexterm" id="calibre_link-1748" class="calibre4"></a> of four sorts of variance:</p>
<dl class="preface">
<dt class="calibre18"><em class="calibre5">Invariance</em></dt>
<dd class="calibre19">
<p class="author1">You want exactly a <code class="calibre14">T</code>.</p>
</dd>
<dt class="calibre18"><em class="calibre5">Covariance</em></dt>
<dd class="calibre19">
<p class="author1">You want a <code class="calibre14">&lt;:T</code>.</p>
</dd>
<dt class="calibre18"><em class="calibre5">Contravariance</em></dt>
<dd class="calibre19">
<p class="author1">You want a <code class="calibre14">&gt;:T</code>.</p>
</dd>
<dt class="calibre18"><em class="calibre5">Bivariance</em></dt>
<dd class="calibre19">
<p class="author1">You’re OK with either <code class="calibre14">&lt;:T</code> or <code class="calibre14">&gt;:T</code>.</p>
</dd>
</dl>

<p class="author1">In TypeScript, every complex type is covariant in its members&mdash;objects, classes, arrays, and function return types&mdash;with one exception: function parameter types, which are <em class="calibre5">contravariant</em>.<a data-primary="arrays" data-secondary="covariance in array members" data-type="indexterm" id="calibre_link-646" class="calibre4"></a><a data-primary="classes" data-secondary="covariance in class members" data-type="indexterm" id="calibre_link-735" class="calibre4"></a><a data-primary="contravariance" data-type="indexterm" id="calibre_link-807" class="calibre4"></a></p>
<div data-type="note" type="note" class="calibre21"><h6 class="calibre22">Note</h6>
<p class="author1">Not all languages make this same design decision. In some languages objects are <em class="calibre5">invariant</em> in their property types, because as we saw, covariant property types can lead to unsafe behavior.<a data-primary="objects" data-secondary="invariant property types in some languages" data-type="indexterm" id="calibre_link-1313" class="calibre4"></a> Some languages have different rules for mutable and immutable objects (try to reason through it yourself!). Some languages&mdash;like Scala, Kotlin, and Flow&mdash;even have explicit syntax for programmers to specify variance for their own data types.</p>

<p class="author1">When designing TypeScript, its authors opted for a balance between ease of use and safety. When you make objects invariant in their property types, even though it’s safer, it can make a type system tedious to use because you end up banning things that are safe in practice (e.g., if we didn’t <code class="calibre14">delete</code> the <code class="calibre14">id</code> in <code class="calibre14">deleteUser</code>, then it would have been perfectly safe to pass in an object that’s a supertype of the expected type).</p>
</div>
</div></section>













<section data-pdf-bookmark="Function variance" data-type="sect3" class="preface"><div class="preface" id="calibre_link-556">
<h3 class="calibre39">Function variance</h3>

<p class="author1">Let’s start with a few examples.</p>

<p class="author1">A function <code class="calibre14">A</code> is a subtype of function <code class="calibre14">B</code> if <code class="calibre14">A</code> has the same or<a data-primary="functions" data-secondary="variance" data-type="indexterm" id="calibre_link-1057" class="calibre4"></a><a data-primary="variance" data-secondary="function" data-type="indexterm" id="calibre_link-1747" class="calibre4"></a> lower arity (number of parameters) than <code class="calibre14">B</code> and:</p>
<ol class="calibre31">
<li class="calibre32">
<p class="author1"><code class="calibre14">A</code>’s <code class="calibre14">this</code> type either isn’t specified, or is <code class="calibre14">&gt;: B</code>’s <code class="calibre14">this</code> type.</p>
</li>
<li class="calibre32">
<p class="author1">Each of <code class="calibre14">A</code>’s parameters is <code class="calibre14">&gt;:</code> its corresponding parameter in <code class="calibre14">B</code>.</p>
</li>
<li class="calibre32">
<p class="author1"><code class="calibre14">A</code>’s return type is <code class="calibre14">&lt;: B</code>’s return type.</p>
</li>

</ol>

<p class="author1">Read that over a few times, and make sure you understand what each rule means. You might have noticed that for a function <code class="calibre14">A</code> to be a subtype of function <code class="calibre14">B</code>, we say that its <code class="calibre14">this</code> type and parameters must be <code class="calibre14">&gt;:</code> their counterparts in <code class="calibre14">B</code>, while its return type has to be <code class="calibre14">&lt;:</code>! Why does the direction flip like that? Why isn’t it simply <code class="calibre14">&lt;:</code> for each component (<code class="calibre14">this</code> type, parameter types, and return type), like it is for objects, arrays, unions, and so on?</p>

<p class="author1">To answer this question, let’s derive it ourselves. We’ll start by defining three types (we’re going to use a <code class="calibre14">class</code> for clarity, but this works for any choice of types where <code class="calibre14">A &lt;: B &lt;: C</code>):</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">class</code> <code class="nx">Animal</code> <code class="p">{}</code>
<code class="kd">class</code> <code class="nx">Bird</code> <code class="kd">extends</code> <code class="nx">Animal</code> <code class="p">{</code>
  <code class="nx">chirp() {</code><code class="p">}</code>
<code class="p">}</code>
<code class="kd">class</code> <code class="nx">Crow</code> <code class="kd">extends</code> <code class="nx">Bird</code> <code class="p">{</code>
  <code class="nx">caw() {</code><code class="p">}</code>
<code class="p">}</code></pre>

<p class="author1">In this example, <code class="calibre14">Crow</code> is a subtype of <code class="calibre14">Bird</code>, which is a subtype of <code class="calibre14">Animal</code>. That is, <code class="calibre14">Crow &lt;: Bird &lt;: Animal</code>.</p>

<p class="author1">Now, let’s define a function that takes a <code class="calibre14">Bird</code>, and makes it chirp:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">chirp</code><code class="p">(</code><code class="nx">bird</code>: <code class="kt">Bird</code><code class="p">)</code><code class="o">:</code> <code class="nx">Bird</code> <code class="p">{</code>
  <code class="nx">bird</code><code class="p">.</code><code class="nx">chirp</code><code class="p">()</code>
  <code class="kd">return</code> <code class="nx">bird</code>
<code class="p">}</code></pre>

<p class="author1">So far, so good. What kinds of things does TypeScript let you pass into <code class="calibre14">chirp</code>?</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">chirp</code><code class="p">(</code><code class="kd">new</code> <code class="nx">Animal</code><code class="p">)</code> <code class="c">// Error TS2345: Argument of type 'Animal' is not assignable</code>
<code class="nx">chirp</code><code class="p">(</code><code class="kd">new</code> <code class="nx">Bird</code><code class="p">)</code>   <code class="c">// to parameter of type 'Bird'.</code>
<code class="nx">chirp</code><code class="p">(</code><code class="kd">new</code> <code class="nx">Crow</code><code class="p">)</code></pre>

<p class="author1">You can<a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2345" data-type="indexterm" id="calibre_link-924" class="calibre4"></a> pass an instance of <code class="calibre14">Bird</code> (because that’s what <code class="calibre14">chirp</code>’s parameter <code class="calibre14">bird</code>’s type is) or an instance of <code class="calibre14">Crow</code> (because it’s a subtype of <code class="calibre14">Bird</code>). Great: passing in a subtype works as expected.</p>

<p class="author1">Let’s make a new function. This time, its parameter will be a <em class="calibre5">function</em>:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">clone</code><code class="p">(</code><code class="nx">f</code><code class="o">:</code> <code class="p">(</code><code class="nx">b</code>: <code class="kt">Bird</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="nx">Bird</code><code class="p">)</code><code class="o">:</code> <code class="kd">void</code> <code class="p">{</code>
  <code class="c">// ...</code>
<code class="p">}</code></pre>

<p class="author1"><code class="calibre14">clone</code> needs a function <code class="calibre14">f</code> that takes a <code class="calibre14">Bird</code> and returns a <code class="calibre14">Bird</code>. What types of functions can you safely pass for <code class="calibre14">f</code>? Clearly you can pass a function that takes a <code class="calibre14">Bird</code> and returns a <code class="calibre14">Bird</code>:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">birdToBird</code><code class="p">(</code><code class="nx">b</code>: <code class="kt">Bird</code><code class="p">)</code><code class="o">:</code> <code class="nx">Bird</code> <code class="p">{</code>
  <code class="c">// ...</code>
<code class="p">}</code>
<code class="nx">clone</code><code class="p">(</code><code class="nx">birdToBird</code><code class="p">)</code> <code class="c">// OK</code></pre>

<p class="author1">What about a function that takes a <code class="calibre14">Bird</code> and returns a <code class="calibre14">Crow</code>, or an <code class="calibre14">Animal</code>?</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">birdToCrow</code><code class="p">(</code><code class="nx">d</code>: <code class="kt">Bird</code><code class="p">)</code><code class="o">:</code> <code class="nx">Crow</code> <code class="p">{</code>
  <code class="c">// ...</code>
<code class="p">}</code>
<code class="nx">clone</code><code class="p">(</code><code class="nx">birdToCrow</code><code class="p">)</code> <code class="c">// OK</code>

<code class="kd">function</code> <code class="nx">birdToAnimal</code><code class="p">(</code><code class="nx">d</code>: <code class="kt">Bird</code><code class="p">)</code><code class="o">:</code> <code class="nx">Animal</code> <code class="p">{</code>
  <code class="c">// ...</code>
<code class="p">}</code>
<code class="nx">clone</code><code class="p">(</code><code class="nx">birdToAnimal</code><code class="p">)</code> <code class="c">// Error TS2345: Argument of type '(d: Bird) =&gt; Animal' is</code>
                    <code class="c">// not assignable to parameter of type '(b: Bird) =&gt; Bird'.</code>
                    <code class="c">// Type 'Animal' is not assignable to type 'Bird'.</code></pre>

<p class="author1"><code class="calibre14">birdToCrow</code> works as expected, but <code class="calibre14">birdToAnimal</code> gives us an error. Why? Imagine that <code class="calibre14">clone</code>’s implementation looks like this:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">clone</code><code class="p">(</code><code class="nx">f</code><code class="o">:</code> <code class="p">(</code><code class="nx">b</code>: <code class="kt">Bird</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="nx">Bird</code><code class="p">)</code><code class="o">:</code> <code class="kd">void</code> <code class="p">{</code>
  <code class="kd">let</code> <code class="nx">parent</code> <code class="o">=</code> <code class="kd">new</code> <code class="nx">Bird</code>
  <code class="kd">let</code> <code class="nx">babyBird</code> <code class="o">=</code> <code class="nx">f</code><code class="p">(</code><code class="nx">parent</code><code class="p">)</code>
  <code class="nx">babyBird</code><code class="p">.</code><code class="nx">chirp</code><code class="p">()</code>
<code class="p">}</code></pre>

<p class="author1">If we passed to our <code class="calibre14">clone</code> function an <code class="calibre14">f</code> that returned an <code class="calibre14">Animal</code>, then we couldn’t call <code class="calibre14">.chirp</code> on it! So TypeScript has to make sure, at compile time, that the function we passed in returns <em class="calibre5">at least</em> a <code class="calibre14">Bird</code>.</p>

<p class="author1">We say <a data-primary="functions" data-secondary="variance" data-tertiary="covariant return types" data-type="indexterm" id="calibre_link-1058" class="calibre4"></a><a data-primary="covariance" data-secondary="in function return types" data-type="indexterm" id="calibre_link-812" class="calibre4"></a><a data-primary="return types" data-secondary="covariance in" data-type="indexterm" id="calibre_link-1422" class="calibre4"></a>that functions are <em class="calibre5">covariant</em> in their return types, which is a fancy way of saying that for a function to be a subtype of another function, its return type has to be <code class="calibre14">&lt;:</code> the other function’s return type.</p>

<p class="author1">OK, what about<a data-primary="parameters" data-secondary="contravariance in function parameters" data-type="indexterm" id="calibre_link-1340" class="calibre4"></a> parameter types?</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">animalToBird</code><code class="p">(</code><code class="nx">a</code>: <code class="kt">Animal</code><code class="p">)</code><code class="o">:</code> <code class="nx">Bird</code> <code class="p">{</code>
  <code class="c">// ...</code>
<code class="p">}</code>
<code class="nx">clone</code><code class="p">(</code><code class="nx">animalToBird</code><code class="p">)</code> <code class="c">// OK</code>

<code class="kd">function</code> <code class="nx">crowToBird</code><code class="p">(</code><code class="nx">c</code>: <code class="kt">Crow</code><code class="p">)</code><code class="o">:</code> <code class="nx">Bird</code> <code class="p">{</code>
  <code class="c">// ...</code>
<code class="p">}</code>
<code class="nx">clone</code><code class="p">(</code><code class="nx">crowToBird</code><code class="p">)</code> <code class="c">// Error TS2345: Argument of type '(c: Crow) =&gt; Bird' is not</code>
                  <code class="c">// assignable to parameter of type '(b: Bird) =&gt; Bird'.</code></pre>

<p class="author1">For a function to be assignable to another function, its parameter types (including <code class="calibre14">this</code>) all have to be <code class="calibre14">&gt;:</code> their corresponding parameter <a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2345" data-type="indexterm" id="calibre_link-925" class="calibre4"></a><a data-primary="this variable" data-secondary="contravariance in function this types" data-type="indexterm" id="calibre_link-1477" class="calibre4"></a>types in the other function. To see why, think about how a user might have implemented <code class="calibre14">crowToBird</code> before passing it into <code class="calibre14">clone</code>. What if they did this?</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">crowToBird</code><code class="p">(</code><code class="nx">c</code>: <code class="kt">Crow</code><code class="p">)</code><code class="o">:</code> <code class="nx">Bird</code> <code class="p">{</code>
  <code class="nx">c</code><code class="p">.</code><code class="nx">caw</code><code class="p">()</code>
  <code class="kd">return</code> <code class="kd">new</code> <code class="nx">Bird</code>
<code class="p">}</code></pre>

<p class="author1">Now if <code class="calibre14">clone</code> called <code class="calibre14">crowToBird</code> with a <code class="calibre14">new Bird</code>, we’d get an exception because <code class="calibre14">.caw</code> is only defined on <code class="calibre14">Crow</code>s, not on all <code class="calibre14">Bird</code>s.</p>

<p class="author1">This means functions are <em class="calibre5">contravariant</em> in their parameter and <code class="calibre14">this</code> types. That is, for a function to be a subtype of another function, each of its parameters and its <code class="calibre14">this</code> type must be <code class="calibre14">&gt;:</code> its corresponding parameter in the other function.<a data-primary="contravariance" data-secondary="in function parameters and this types" data-type="indexterm" id="calibre_link-808" class="calibre4"></a></p>

<p class="author1">Thankfully, you don’t have to memorize and recite these rules. Just have them in the back of your mind when your code editor gives you a red squiggly when you pass an incorrectly typed function somewhere, so you know why TypeScript is giving you the error it does.</p>
<div data-type="tip" class="calibre21"><h1 class="calibre42">TSC Flag: strictFunctionTypes</h1>
<p class="author1">For legacy reasons, functions in TypeScript are actually covariant in their parameter and <code class="calibre14">this</code> types by default. To opt into the safer, contravariant behavior we just explored, be sure to enable the <code class="calibre14">{"strictFunctionTypes": true}</code> flag in your <em class="calibre5">tsconfig.json</em>.<a data-primary="TSC compiler" data-secondary="strictFunctionTypes flag" data-type="indexterm" id="calibre_link-1527" class="calibre4"></a><a data-primary="strictFunctionTypes TSC flag" data-type="indexterm" id="calibre_link-1448" class="calibre4"></a></p>

<p class="author1"><code class="calibre14">strict</code> mode includes <code class="calibre14">strictFunctionTypes</code>, so if you’re already using <code class="calibre14">{"strict": true}</code>, you’re good to go.<a data-primary="variance" data-startref="ix_varia" data-type="indexterm" id="calibre_link-1746" class="calibre4"></a><a data-primary="types" data-secondary="relationships between" data-startref="ix_typerelvar" data-tertiary="variance" data-type="indexterm" id="calibre_link-1646" class="calibre4"></a></p>
</div>
</div></section>



</div></section>













<section data-pdf-bookmark="Assignability" data-type="sect2" class="preface"><div class="preface" id="calibre_link-314">
<h2 class="calibre17">Assignability</h2>

<p class="author1">Subtype and supertype relations are core concepts in any statically typed language. They’re also important to understanding how <em class="calibre5">assignability</em> works (as a reminder, assignability refers to TypeScript’s rules for whether or not you can use a type <code class="calibre14">A</code> where another type <code class="calibre14">B</code> is required).<a data-primary="subtypes" data-secondary="assignability and" data-type="indexterm" id="calibre_link-1458" class="calibre4"></a><a data-primary="supertypes" data-secondary="assignability and" data-type="indexterm" id="calibre_link-1463" class="calibre4"></a><a data-primary="types" data-secondary="relationships between" data-tertiary="assignability" data-type="indexterm" id="calibre_link-1639" class="calibre4"></a><a data-primary="assignability" data-type="indexterm" id="calibre_link-660" class="calibre4"></a></p>

<p class="author1">When TypeScript wants to answer the question “Is type <code class="calibre14">A</code> assignable to type <code class="calibre14">B</code>?” it follows a few simple rules. For <em class="calibre5">non-enum types</em>&mdash;like arrays, booleans, numbers, objects, functions, classes, class instances, and strings, including literal types&mdash;<code class="calibre14">A</code> is assignable to <code class="calibre14">B</code> if either of the following is true:</p>
<ol class="calibre31">
<li class="calibre32">
<p class="author1"><code class="calibre14">A &lt;: B</code>.</p>
</li>
<li class="calibre32">
<p class="author1"><code class="calibre14">A</code> is <code class="calibre14">any</code>.</p>
</li>

</ol>

<p class="author1">Rule 1 is just the definition of what a subtype is: if <code class="calibre14">A</code> is a subtype of <code class="calibre14">B</code>, then wherever you need a <code class="calibre14">B</code> you can also use an <code class="calibre14">A</code>.</p>

<p class="author1">Rule 2 is the exception to rule 1, and is a convenience for interoperating with JavaScript code.</p>

<p class="author1">For <em class="calibre5">enum types</em> created with the <code class="calibre14">enum</code> or <code class="calibre14">const enum</code> keywords, a type <code class="calibre14">A</code> is assignable to an enum <code class="calibre14">B</code> if  either<a data-primary="enums" data-secondary="assignability" data-type="indexterm" id="calibre_link-867" class="calibre4"></a> of these is true:</p>
<ol class="calibre31">
<li class="calibre32">
<p class="author1"><code class="calibre14">A</code> is a member of enum <code class="calibre14">B</code>.</p>
</li>
<li class="calibre32">
<p class="author1"><code class="calibre14">B</code> has at least one member that’s a <code class="calibre14">number</code>, and <code class="calibre14">A</code> is a <code class="calibre14">number</code>.</p>
</li>

</ol>

<p class="author1">Rule 1 is exactly the same as for simple types (if <code class="calibre14">A</code> is a member of enum <code class="calibre14">B</code>, then <code class="calibre14">A</code>’s type is <code class="calibre14">B</code>, so all we’re saying is <code class="calibre14">B &lt;: B</code>).</p>

<p class="author1">Rule 2 is a convenience for working with enums. As we talked about in <a data-type="xref" href="#calibre_link-167" class="calibre4">“Enums”</a>, rule 2 is a big source of unsafety in TypeScript, and this is one reason I suggest throwing the baby out with the bathwater and avoiding enums entirely.</p>
</div></section>













<section data-pdf-bookmark="Type Widening" data-type="sect2" class="preface"><div class="preface" id="calibre_link-40">
<h2 class="calibre17">Type Widening</h2>

<p class="author1"><em class="calibre5">Type widening</em> is key to understanding how TypeScript’s type inference works. In general, TypeScript<a data-primary="types" data-secondary="relationships between" data-tertiary="type widening" data-type="indexterm" id="calibre_link-1643" class="calibre4"></a><a data-primary="type widening" data-type="indexterm" id="calibre_link-1587" class="calibre4"></a> will be lenient when inferring your types, and will err on the side of inferring a more general type rather than the most specific type possible. This makes your life as a programmer easier, and means less time spent quelling the typechecker’s complaints.<a data-primary="widening types" data-see="type widening" data-type="indexterm" id="calibre_link-1865" class="calibre4"></a></p>

<p class="author1">In <a data-type="xref" href="#calibre_link-169" class="calibre4">Chapter&nbsp;3</a>, you already saw a few instances of type widening in action. Let’s look at a few more examples.</p>

<p class="author1">When you declare a variable in a way that allows it to be mutated later (e.g., with <code class="calibre14">let</code> or <code class="calibre14">var</code>), its type<a data-primary="variables" data-secondary="mutable, type widening" data-type="indexterm" id="calibre_link-1741" class="calibre4"></a> is widened from its literal value to the base type that literal belongs to:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">a</code> <code class="o">=</code> <code class="s">'x'</code>               <code class="c">// string</code>
<code class="kd">let</code> <code class="nx">b</code> <code class="o">=</code> <code class="mi">3</code>                 <code class="c">// number</code>
<code class="kd">var</code> <code class="nx">c</code> <code class="o">=</code> <code class="kd">true</code>              <code class="c">// boolean</code>
<code class="kd">const</code> <code class="nx">d</code> <code class="o">=</code> <code class="p">{</code><code class="nx">x</code>: <code class="kt">3</code><code class="p">}</code>          <code class="c">// {x: number}</code>

<code class="kd">enum</code> <code class="nx">E</code> <code class="p">{</code><code class="nx">X</code><code class="p">,</code> <code class="nx">Y</code><code class="p">,</code> <code class="nx">Z</code><code class="p">}</code>
<code class="kd">let</code> <code class="nx">e</code> <code class="o">=</code> <code class="nx">E</code><code class="p">.</code><code class="nx">X</code>               <code class="c">// E</code></pre>

<p class="author1">Not so for<a data-primary="variables" data-secondary="immutable, no type widening" data-type="indexterm" id="calibre_link-1740" class="calibre4"></a> immutable declarations:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">const</code> <code class="nx">a</code> <code class="o">=</code> <code class="s">'x'</code>             <code class="c">// 'x'</code>
<code class="kd">const</code> <code class="nx">b</code> <code class="o">=</code> <code class="mi">3</code>               <code class="c">// 3</code>
<code class="kd">const</code> <code class="nx">c</code> <code class="o">=</code> <code class="kd">true</code>            <code class="c">// true</code>

<code class="kd">enum</code> <code class="nx">E</code> <code class="p">{</code><code class="nx">X</code><code class="p">,</code> <code class="nx">Y</code><code class="p">,</code> <code class="nx">Z</code><code class="p">}</code>
<code class="kd">const</code> <code class="nx">e</code> <code class="o">=</code> <code class="nx">E</code><code class="p">.</code><code class="nx">X</code>             <code class="c">// E.X</code></pre>

<p class="author1">You can use an explicit type annotation to prevent your type from being widened:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">a</code><code class="o">:</code> <code class="s">'x'</code> <code class="o">=</code> <code class="s">'x'</code>          <code class="c">// 'x'</code>
<code class="kd">let</code> <code class="nx">b</code>: <code class="kt">3</code> <code class="o">=</code> <code class="mi">3</code>              <code class="c">// 3</code>
<code class="kd">var</code> <code class="nx">c</code>: <code class="kt">true</code> <code class="o">=</code> <code class="kd">true</code>        <code class="c">// true</code>
<code class="kd">const</code> <code class="nx">d</code><code class="o">:</code> <code class="p">{</code><code class="nx">x</code>: <code class="kt">3</code><code class="p">}</code> <code class="o">=</code> <code class="p">{</code><code class="nx">x</code>: <code class="kt">3</code><code class="p">}</code>  <code class="c">// {x: 3}</code></pre>

<p class="author1">When you reassign a nonwidened type using <code class="calibre14">let</code> or <code class="calibre14">var</code>, TypeScript widens it for you. To tell TypeScript to keep it narrow, add an explicit type annotation to your original declaration:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">const</code> <code class="nx">a</code> <code class="o">=</code> <code class="s">'x'</code>             <code class="c">// 'x'</code>
<code class="kd">let</code> <code class="nx">b</code> <code class="o">=</code> <code class="nx">a</code>                 <code class="c">// string</code>

<code class="kd">const</code> <code class="nx">c</code><code class="o">:</code> <code class="s">'x'</code> <code class="o">=</code> <code class="s">'x'</code>        <code class="c">// 'x'</code>
<code class="kd">let</code> <code class="nx">d</code> <code class="o">=</code> <code class="nx">c</code>                 <code class="c">// 'x'</code></pre>

<p class="author1">Variables initialized to <code class="calibre14">null</code> or <code class="calibre14">undefined</code> are widened to <code class="calibre14">any</code>:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">a</code> <code class="o">=</code> <code class="kd">null</code>              <code class="c">// any</code>
<code class="nx">a</code> <code class="o">=</code> <code class="mi">3</code>                     <code class="c">// any</code>
<code class="nx">a</code> <code class="o">=</code> <code class="s">'b'</code>                   <code class="c">// any</code></pre>

<p class="author1">But when a variable <a data-primary="null type" data-secondary="variables initialized to, type widening" data-type="indexterm" id="calibre_link-1296" class="calibre4"></a><a data-primary="undefined type" data-secondary="variables initialized to, type widening" data-type="indexterm" id="calibre_link-1715" class="calibre4"></a><a data-primary="any type" data-secondary="widening of variables initialized as null or undefined to" data-type="indexterm" id="calibre_link-632" class="calibre4"></a>initialized to <code class="calibre14">null</code> or <code class="calibre14">undefined</code> leaves the scope it was declared in, TypeScript assigns it a definite type:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<b class="calibre"><code class="kd">function</code><code class="calibre14"> </code><code class="nx">x() {</code></b><code class="calibre14">
  </code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">a</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="kd">null</code><code class="calibre14">            </code><em class="calibre41"><code class="c2">// any</code></em><code class="c">
</code><code class="calibre14">  </code><code class="nx">a</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="mi">3</code><code class="calibre14">                   </code><em class="calibre41"><code class="c2">// any</code></em><code class="c">
</code><code class="calibre14">  </code><code class="nx">a</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="s">'b'</code><code class="calibre14">                 </code><em class="calibre41"><code class="c2">// any</code></em><code class="c">
</code><code class="calibre14">  </code><b class="calibre"><code class="kd">return</code><code class="calibre14"> </code><code class="nx">a</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">

</code><code class="nx">x</code><code class="p">(</code><code class="p">)</code></b><code class="calibre14">                       </code><em class="calibre41"><code class="c2">// string</code></em><code class="c">
</code></pre>










<section data-pdf-bookmark="The const type" data-type="sect3" class="preface"><div class="preface" id="calibre_link-290">
<h3 class="calibre39">The const type</h3>

<p class="author1">TypeScript comes with a special <code class="calibre14">const</code> type that you can use to opt out of type widening a declaration at a time. <a data-primary="const" data-secondary="using to opt out of type widening at declaration time" data-type="indexterm" id="calibre_link-795" class="calibre4"></a><a data-primary="type widening" data-secondary="preventing with const type" data-type="indexterm" id="calibre_link-1590" class="calibre4"></a>Use it as a type assertion (read ahead to <a data-type="xref" href="#calibre_link-233" class="calibre4">“Type Assertions”</a>):</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">a</code> <code class="o">=</code> <code class="p">{</code><code class="nx">x</code>: <code class="kt">3</code><code class="p">}</code>                <code class="c">// {x: number}</code>
<code class="kd">let</code> <code class="nx">b</code><code class="o">:</code> <code class="p">{</code><code class="nx">x</code>: <code class="kt">3</code><code class="p">}</code>                 <code class="c">// {x: 3}</code>
<code class="kd">let</code> <code class="nx">c</code> <code class="o">=</code> <code class="p">{</code><code class="nx">x</code>: <code class="kt">3</code><code class="p">}</code> <code class="kd">as</code> <code class="kd">const</code>       <code class="c">// {readonly x: 3}</code></pre>

<p class="author1"><code class="calibre14">const</code> opts your type out of widening and recursively marks its members as <code class="calibre14">readonly</code>, even for deeply nested data structures:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">d</code> <code class="o">=</code> <code class="p">[</code><code class="mi">1</code><code class="p">,</code> <code class="p">{</code><code class="nx">x</code>: <code class="kt">2</code><code class="p">}]</code>           <code class="c">// (number | {x: number})[]</code>
<code class="kd">let</code> <code class="nx">e</code> <code class="o">=</code> <code class="p">[</code><code class="mi">1</code><code class="p">,</code> <code class="p">{</code><code class="nx">x</code>: <code class="kt">2</code><code class="p">}]</code> <code class="kd">as</code> <code class="kd">const</code>  <code class="c">// readonly [1, {readonly x: 2}]</code></pre>

<p class="author1">Use <code class="calibre14">as const</code> when you want TypeScript to infer your type as narrowly as possible.<a data-primary="as const" data-type="indexterm" id="calibre_link-655" class="calibre4"></a><a data-primary="type widening" data-startref="ix_typwide" data-type="indexterm" id="calibre_link-1588" class="calibre4"></a><a data-primary="types" data-secondary="relationships between" data-startref="ix_typerelwide" data-tertiary="type widening" data-type="indexterm" id="calibre_link-1644" class="calibre4"></a></p>
</div></section>













<section data-pdf-bookmark="Excess property checking" data-type="sect3" class="preface"><div class="preface" id="calibre_link-1866">
<h3 class="calibre39">Excess property checking</h3>

<p class="author1">Type widening also comes into the picture when TypeScript checks whether or not one object type is assignable to another object type.<a data-primary="properties" data-secondary="excess property checking" data-type="indexterm" id="calibre_link-1386" class="calibre4"></a><a data-primary="type widening" data-secondary="excess property checking" data-type="indexterm" id="calibre_link-1589" class="calibre4"></a><a data-primary="excess property checking" data-type="indexterm" id="calibre_link-988" class="calibre4"></a></p>

<p class="author1">Recall from <a data-type="xref" href="#calibre_link-234" class="calibre4">“Shape and array variance”</a> that object types are covariant in their members. But if TypeScript stuck to this rule without doing any additional checks, it could lead to a problem.</p>

<p class="author1">For example, consider an <code class="calibre14">Options</code> object you might pass into a class to configure it:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">Options</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">baseURL</code>: <code class="kt">string</code>
  <code class="nx">cacheSize?</code>: <code class="kt">number</code>
  <code class="nx">tier</code><code class="o">?:</code> <code class="s">'prod'</code> <code class="o">|</code> <code class="s">'dev'</code>
<code class="p">}</code>

<code class="kd">class</code> <code class="nx">API</code> <code class="p">{</code>
  <code class="kd">constructor</code><code class="p">(</code><code class="kd">private</code> <code class="nx">options</code>: <code class="kt">Options</code><code class="p">)</code> <code class="p">{}</code>
<code class="p">}</code>

<code class="kd">new</code> <code class="nx">API</code><code class="p">({</code>
  <code class="nx">baseURL</code><code class="o">:</code> <code class="s">'https://api.mysite.com'</code><code class="p">,</code>
  <code class="nx">tier</code><code class="o">:</code> <code class="s">'prod'</code>
<code class="p">})</code></pre>

<p class="author1">Now, what happens if you misspell an option?</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">new</code> <code class="nx">API</code><code class="p">({</code>
  <code class="nx">baseURL</code><code class="o">:</code> <code class="s">'https://api.mysite.com'</code><code class="p">,</code>
  <code class="nx">tierr</code><code class="o">:</code> <code class="s">'prod'</code>      <code class="c">// Error TS2345: Argument of type '{tierr: string}'</code>
<code class="p">})</code>                   <code class="c">// is not assignable to parameter of type 'Options'.</code>
                     <code class="c">// Object literal may only specify known properties,</code>
                     <code class="c">// but 'tierr' does not exist in type 'Options'.</code>
                     <code class="c">// Did you mean to write 'tier'?</code></pre>

<p class="author1">This is a common bug when working with JavaScript, so it’s really helpful that TypeScript helps us catch it.<a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2345" data-type="indexterm" id="calibre_link-926" class="calibre4"></a> But if object types are covariant in their members, how is it that TypeScript catches this?</p>

<p class="author1">That is:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">We expected the type <code class="calibre14">{baseURL: string, cacheSize?: number, tier?: 'prod' | 'dev'}</code>.</p>
</li>
<li class="calibre11">
<p class="author1">We passed in the type <code class="calibre14">{baseURL: string, tierr: string}</code>.</p>
</li>
<li class="calibre11">
<p class="author1">The type we passed in is a subtype of the type we expected, but somehow, TypeScript knew to report an error.</p>
</li>
</ul>

<p class="author1">TypeScript was able to catch this due to its <em class="calibre5">excess property checking</em>, which works like this: when you try to assign a fresh object literal type <code class="calibre14">T</code> to another type <code class="calibre14">U</code>, and <code class="calibre14">T</code> has properties that aren’t present in <code class="calibre14">U</code>, TypeScript reports an error.<a data-primary="object literals" data-secondary="fresh object literal type" data-type="indexterm" id="calibre_link-1301" class="calibre4"></a><a data-primary="fresh object literal type" data-type="indexterm" id="calibre_link-1021" class="calibre4"></a></p>

<p class="author1">A <em class="calibre5">fresh object literal type</em> is the type TypeScript infers from an object literal. If that object literal either uses a type assertion (see <a data-type="xref" href="#calibre_link-233" class="calibre4">“Type Assertions”</a>) or is assigned to a variable, then the fresh object literal type is <em class="calibre5">widened</em> to a regular object type, and its freshness disappears.</p>

<p class="author1">This definition is dense, so let’s walk through our example again, trying a few more variations on the theme this time:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code><code class="calibre14"> </code><code class="nx">Options</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="nx">baseURL</code><code class="calibre14">: </code><code class="kt">string</code><code class="calibre14">
  </code><code class="nx">cacheSize?</code><code class="calibre14">: </code><code class="kt">number</code><code class="calibre14">
  </code><code class="nx">tier</code><code class="o">?</code><code class="o">:</code><code class="calibre14"> </code><code class="s">'prod'</code><code class="calibre14"> </code><code class="o">|</code><code class="calibre14"> </code><code class="s">'dev'</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">

</code><code class="kd">class</code><code class="calibre14"> </code><code class="nx">API</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="kd">constructor</code><code class="p">(</code><code class="kd">private</code><code class="calibre14"> </code><code class="nx">options</code><code class="calibre14">: </code><code class="kt">Options</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="p">}</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">

</code><code class="kd">new</code><code class="calibre14"> </code><code class="nx">API</code><code class="p">(</code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-235" id="calibre_link-240"><img alt="1" src="images/000000.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="nx">baseURL</code><code class="o">:</code><code class="calibre14"> </code><code class="s">'https://api.mysite.com'</code><code class="p">,</code><code class="calibre14">
  </code><code class="nx">tier</code><code class="o">:</code><code class="calibre14"> </code><code class="s">'prod'</code><code class="calibre14">
</code><code class="p">}</code><code class="p">)</code><code class="calibre14">

</code><code class="kd">new</code><code class="calibre14"> </code><code class="nx">API</code><code class="p">(</code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-236" id="calibre_link-241"><img alt="2" src="images/000001.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="nx">baseURL</code><code class="o">:</code><code class="calibre14"> </code><code class="s">'https://api.mysite.com'</code><code class="p">,</code><code class="calibre14">
  </code><code class="nx">badTier</code><code class="o">:</code><code class="calibre14"> </code><code class="s">'prod'</code><code class="calibre14">    </code><code class="c">// Error TS2345: Argument of type '{baseURL: string; badTier:
</code><code class="p">}</code><code class="p">)</code><code class="calibre14">                   </code><code class="c">// string}' is not assignable to parameter of type 'Options'.
</code><code class="calibre14">
</code><code class="kd">new</code><code class="calibre14"> </code><code class="nx">API</code><code class="p">(</code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-237" id="calibre_link-242"><img alt="3" src="images/000002.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="nx">baseURL</code><code class="o">:</code><code class="calibre14"> </code><code class="s">'https://api.mysite.com'</code><code class="p">,</code><code class="calibre14">
  </code><code class="nx">badTier</code><code class="o">:</code><code class="calibre14"> </code><code class="s">'prod'</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14"> </code><code class="kd">as</code><code class="calibre14"> </code><code class="nx">Options</code><code class="p">)</code><code class="calibre14">

</code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">badOptions</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-238" id="calibre_link-243"><img alt="4" src="images/000003.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="nx">baseURL</code><code class="o">:</code><code class="calibre14"> </code><code class="s">'https://api.mysite.com'</code><code class="p">,</code><code class="calibre14">
  </code><code class="nx">badTier</code><code class="o">:</code><code class="calibre14"> </code><code class="s">'prod'</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code><code class="kd">new</code><code class="calibre14"> </code><code class="nx">API</code><code class="p">(</code><code class="nx">badOptions</code><code class="p">)</code><code class="calibre14">

</code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">options</code><code class="calibre14">: </code><code class="kt">Options</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-239" id="calibre_link-244"><img alt="5" src="images/000004.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="nx">baseURL</code><code class="o">:</code><code class="calibre14"> </code><code class="s">'https://api.mysite.com'</code><code class="p">,</code><code class="calibre14">
  </code><code class="nx">badTier</code><code class="o">:</code><code class="calibre14"> </code><code class="s">'prod'</code><code class="calibre14">    </code><code class="c">// Error TS2322: Type '{baseURL: string; badTier: string}'
</code><code class="p">}</code><code class="calibre14">                    </code><code class="c">// is not assignable to type 'Options'.
</code><code class="kd">new</code><code class="calibre14"> </code><code class="nx">API</code><code class="p">(</code><code class="nx">options</code><code class="p">)</code></pre>
<dl class="preface">
<dt class="calibre18"><a class="calibre4" href="#calibre_link-240" id="calibre_link-235"><img alt="1" src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We instantiate <code class="calibre14">API</code> with a <code class="calibre14">baseURL</code> and one of our two optional properties, <code class="calibre14">tier</code>. This works as expected.<a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2345" data-type="indexterm" id="calibre_link-927" class="calibre4"></a><a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2322" data-type="indexterm" id="calibre_link-907" class="calibre4"></a></p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-241" id="calibre_link-236"><img alt="2" src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">Here, we misspell <code class="calibre14">tier</code> as <code class="calibre14">badTier</code>. The options object we pass to <code class="calibre14">new API</code> is fresh (because its type is inferred, it isn’t assigned to a variable, and we don’t make a type assertion about its type), so TypeScript runs an excess property check on it, revealing the excess <code class="calibre14">badTier</code> property (which is defined in our options object but not on the <code class="calibre14">Options</code> type).</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-242" id="calibre_link-237"><img alt="3" src="images/000002.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We assert that our invalid options object is of type <code class="calibre14">Options</code>. TypeScript no longer considers it fresh, and bails out of excess property checking: no error. If you’re not familiar with the <code class="calibre14">as T</code> syntax, read ahead to <a data-type="xref" href="#calibre_link-233" class="calibre4">“Type Assertions”</a>.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-243" id="calibre_link-238"><img alt="4" src="images/000003.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We assign our options object to a variable, <code class="calibre14">badOptions</code>. TypeScript no longer considers it to be fresh, and bails out of excess property checking: no error.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-244" id="calibre_link-239"><img alt="5" src="images/000004.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">When we explicitly type <code class="calibre14">options</code> as <code class="calibre14">Options</code>, the object we assign to <code class="calibre14">options</code> is fresh, so TypeScript performs excess property checking, catching our bug. Note that in this case the excess property check doesn’t happen when we pass <code class="calibre14">options</code> to <code class="calibre14">new API</code>; rather, it happens when we try to assign our options object to the variable <code class="calibre14">options</code>.</p></dd>
</dl>

<p class="author1">Don’t worry&mdash;you don’t need to memorize these rules. They are TypeScript’s internal heuristics for catching the most bugs possible in a practical way, so as not to be a burden on you, the programmer. Just keep them in mind when you’re wondering how TypeScript knew to complain about that one bug that even Ivan, the battle-weathered gatekeeper of your company’s codebase and master code reviewer, didn’t notice.</p>
</div></section>



</div></section>













<section data-pdf-bookmark="Refinement" data-type="sect2" class="preface"><div class="preface" id="calibre_link-38">
<h2 class="calibre17">Refinement</h2>

<p class="author1">TypeScript<a data-primary="types" data-secondary="relationships between" data-tertiary="refinement" data-type="indexterm" id="calibre_link-1640" class="calibre4"></a><a data-primary="refinement (types)" data-type="indexterm" id="calibre_link-1413" class="calibre4"></a><a data-primary="flow-based type inference" data-type="indexterm" id="calibre_link-1006" class="calibre4"></a> performs flow-based type inference, which is a kind of symbolic execution where the typechecker uses control flow statements like <code class="calibre14">if</code>, <code class="calibre14">?</code>, <code class="calibre14">||</code>, and <code class="calibre14">switch</code>, as well as type queries like <code class="calibre14">typeof</code>, <code class="calibre14">instanceof</code>, and <code class="calibre14">in</code>, to <em class="calibre5">refine</em> types as it goes, just like a programmer reading through the code would.<sup class="calibre15"><a data-type="noteref" href="#calibre_link-245" id="calibre_link-336" class="calibre16">1</a></sup> It’s an incredibly convenient feature for a typechecker to have, but is another one of those things that remarkably few languages support.<sup class="calibre15"><a data-type="noteref" href="#calibre_link-246" id="calibre_link-337" class="calibre16">2</a></sup></p>

<p class="author1">Let’s walk through an example. Say we’ve built an API for defining CSS rules in TypeScript, and a coworker wants to use it to set an HTML element’s <code class="calibre14">width</code>. They pass in the width, which we then want to parse and validate.</p>

<p class="author1">We’ll first implement a function to parse a CSS string into a value and a unit:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// We use a union of string literals to describe</code>
<code class="c">// the possible values a CSS unit can have</code>
<code class="nx">type</code> <code class="nx">Unit</code> <code class="o">=</code> <code class="s">'cm'</code> <code class="o">|</code> <code class="s">'px'</code> <code class="o">|</code> <code class="s">'%'</code>

<code class="c">// Enumerate the units</code>
<code class="kd">let</code> <code class="nx">units</code>: <code class="kt">Unit</code><code class="p">[]</code> <code class="o">=</code> <code class="p">[</code><code class="s">'cm'</code><code class="p">,</code> <code class="s">'px'</code><code class="p">,</code> <code class="s">'%'</code><code class="p">]</code>

<code class="c">// Check each unit, and return null if there is no match</code>
<code class="kd">function</code> <code class="nx">parseUnit</code><code class="p">(</code><code class="nx">value</code>: <code class="kt">string</code><code class="p">)</code><code class="o">:</code> <code class="nx">Unit</code> <code class="o">|</code> <code class="kd">null</code> <code class="p">{</code>
  <code class="kd">for</code> <code class="p">(</code><code class="kd">let</code> <code class="nx">i</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code> <code class="nx">i</code> <code class="o">&lt;</code> <code class="nx">units</code><code class="p">.</code><code class="nx">length</code><code class="p">;</code> <code class="nx">i</code><code class="o">++</code><code class="p">)</code> <code class="p">{</code>
    <code class="kd">if</code> <code class="p">(</code><code class="nx">value</code><code class="p">.</code><code class="nx">endsWith</code><code class="p">(</code><code class="nx">units</code><code class="p">[</code><code class="nx">i</code><code class="p">]))</code> <code class="p">{</code>
      <code class="kd">return</code> <code class="nx">units</code><code class="p">[</code><code class="nx">i</code><code class="p">]</code>
    <code class="p">}</code>
  <code class="p">}</code>
  <code class="kd">return</code> <code class="kd">null</code>
<code class="p">}</code></pre>

<p class="author1">We can then use <code class="calibre14">parseUnit</code> to parse a width value passed to us by a user. <code class="calibre14">width</code> might be a number (which we assume is in pixels), or a string with units attached, or it might be <code class="calibre14">null</code> or <code class="calibre14">undefined</code>.<a data-primary="type refinement" data-see="refinement" data-type="indexterm" id="calibre_link-1867" class="calibre4"></a></p>

<p class="author1">We take advantage of type refinement a few times in this example:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code><code class="calibre14"> </code><code class="nx">Width</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="nx">unit</code><code class="calibre14">: </code><code class="kt">Unit</code><code class="p">,</code><code class="calibre14">
  </code><code class="nx">value</code><code class="calibre14">: </code><code class="kt">number</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">

</code><code class="kd">function</code><code class="calibre14"> </code><code class="nx">parseWidth</code><code class="p">(</code><code class="nx">width</code><code class="calibre14">: </code><code class="kt">number</code><code class="calibre14"> </code><code class="o">|</code><code class="calibre14"> </code><code class="kt">string</code><code class="calibre14"> </code><code class="o">|</code><code class="calibre14"> </code><code class="kd">null</code><code class="calibre14"> </code><code class="o">|</code><code class="calibre14"> </code><code class="kd">undefined</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">Width</code><code class="calibre14"> </code><code class="o">|</code><code class="calibre14"> </code><code class="kd">null</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="c">// If width is null or undefined, return early
</code><code class="calibre14">  </code><code class="kd">if</code><code class="calibre14"> </code><code class="p">(</code><code class="nx">width</code><code class="calibre14"> </code><code class="o">==</code><code class="calibre14"> </code><code class="kd">null</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-247" id="calibre_link-251"><img alt="1" src="images/000000.png" class="calibre40" /></a><code class="calibre14">
    </code><code class="kd">return</code><code class="calibre14"> </code><code class="kd">null</code><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">

  </code><code class="c">// If width is a number, default to pixels
</code><code class="calibre14">  </code><code class="kd">if</code><code class="calibre14"> </code><code class="p">(</code><code class="kd">typeof</code><code class="calibre14"> </code><code class="nx">width</code><code class="calibre14"> </code><code class="o">===</code><code class="calibre14"> </code><code class="s">'number'</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-248" id="calibre_link-252"><img alt="2" src="images/000001.png" class="calibre40" /></a><code class="calibre14">
    </code><code class="kd">return</code><code class="calibre14"> </code><code class="p">{</code><code class="nx">unit</code><code class="o">:</code><code class="calibre14"> </code><code class="s">'px'</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">value</code><code class="calibre14">: </code><code class="kt">width</code><code class="p">}</code><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">

  </code><code class="c">// Try to parse a unit from width
</code><code class="calibre14">  </code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">unit</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="nx">parseUnit</code><code class="p">(</code><code class="nx">width</code><code class="p">)</code><code class="calibre14">
  </code><code class="kd">if</code><code class="calibre14"> </code><code class="p">(</code><code class="nx">unit</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-249" id="calibre_link-253"><img alt="3" src="images/000002.png" class="calibre40" /></a><code class="calibre14">
    </code><code class="kd">return</code><code class="calibre14"> </code><code class="p">{</code><code class="nx">unit</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">value</code><code class="calibre14">: </code><code class="kt">parseFloat</code><code class="p">(</code><code class="nx">width</code><code class="p">)</code><code class="p">}</code><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">

  </code><code class="c">// Otherwise, return null
</code><code class="calibre14">  </code><code class="kd">return</code><code class="calibre14"> </code><code class="kd">null</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-250" id="calibre_link-255"><img alt="4" src="images/000003.png" class="calibre40" /></a><code class="calibre14">
</code><code class="p">}</code></pre>
<dl class="preface">
<dt class="calibre18"><a class="calibre4" href="#calibre_link-251" id="calibre_link-247"><img alt="1" src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">TypeScript is smart enough to know that doing a loose equality check against <code class="calibre14">null</code> will return <code class="calibre14">true</code> for both <code class="calibre14">null</code> and <code class="calibre14">undefined</code> in JavaScript. It knows that if this check passes then we will return, and if we didn’t return that means the check didn’t pass, so from then on <code class="calibre14">width</code>’s type is <code class="calibre14">number | string</code> (it can’t be <code class="calibre14">null</code> or <code class="calibre14">undefined</code> anymore). We say that the type was refined from <code class="calibre14">number | string | null | undefined</code> to <code class="calibre14">number | string</code>.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-252" id="calibre_link-248"><img alt="2" src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">A <code class="calibre14">typeof</code> check queries a value at runtime to see what its type is. TypeScript takes advantage of <code class="calibre14">typeof</code> at compile time too: in the <code class="calibre14">if</code> branch where the check passes, TypeScript knows that <code class="calibre14">width</code> is a <code class="calibre14">number</code>; otherwise (since that branch <code class="calibre14">return</code>s) <code class="calibre14">width</code> must be a <code class="calibre14">string</code>&mdash;it’s the only type left.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-253" id="calibre_link-249"><img alt="3" src="images/000002.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">Because calling <code class="calibre14">parseUnit</code> might return <code class="calibre14">null</code>, we check if it did by testing whether its result is truthy.<sup class="calibre15"><a data-type="noteref" href="#calibre_link-254" id="calibre_link-338" class="calibre16">3</a></sup> TypeScript knows that if <code class="calibre14">unit</code> is truthy then it must be of type <code class="calibre14">Unit</code> in the <code class="calibre14">if</code> branch&mdash;otherwise, <code class="calibre14">unit</code> must be falsy, meaning it must be of type <code class="calibre14">null</code> (refined from <code class="calibre14">Unit | null</code>).</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-255" id="calibre_link-250"><img alt="4" src="images/000003.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">Finally, we return <code class="calibre14">null</code>. This can only happen if the user passed a <code class="calibre14">string</code> for <code class="calibre14">width</code>, but that string contained a unit that we don’t support.</p></dd>
</dl>

<p class="author1">I’ve spelled out exactly what TypeScript was thinking for each of the type refinements it performed here, but I hope this was already intuitive and obvious for you, the programmer reading that code. TypeScript does a superb job of taking what’s going through your mind as you read and write code, and crystallizing it in the form of typechecking and inference rules.</p>










<section data-pdf-bookmark="Discriminated union types" data-type="sect3" class="preface"><div class="preface" id="calibre_link-63">
<h3 class="calibre39">Discriminated union types</h3>

<p class="author1">As we just learned, TypeScript has a deep understanding of how JavaScript works, and is able to follow along as you refine your types, just like you would when you trace through your program in your head.<a data-primary="refinement (types)" data-secondary="discriminated union types" data-type="indexterm" id="calibre_link-1415" class="calibre4"></a><a data-primary="union types" data-secondary="discriminated" data-type="indexterm" id="calibre_link-1719" class="calibre4"></a></p>

<p class="author1">For example, say we’re building a custom event system for an application. We start by defining a couple of event types, along with a function to handle events that come in. Imagine that <code class="calibre14">UserTextEvent</code> models a keyboard event (e.g., the user typed something in a text <code class="calibre14">&lt;input /&gt;</code>) and <code class="calibre14">UserMouseEvent</code> models a mouse event (e.g., the user moved their mouse to the coordinates <code class="calibre14">[100, 200]</code>):</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">UserTextEvent</code> <code class="o">=</code> <code class="p">{</code><code class="nx">value</code>: <code class="kt">string</code><code class="p">}</code>
<code class="nx">type</code> <code class="nx">UserMouseEvent</code> <code class="o">=</code> <code class="p">{</code><code class="nx">value</code><code class="o">:</code> <code class="p">[</code><code class="kt">number</code><code class="p">,</code> <code class="kt">number</code><code class="p">]}</code>

<code class="nx">type</code> <code class="nx">UserEvent</code> <code class="o">=</code> <code class="nx">UserTextEvent</code> <code class="o">|</code> <code class="nx">UserMouseEvent</code>

<code class="kd">function</code> <code class="nx">handle</code><code class="p">(</code><code class="nx">event</code>: <code class="kt">UserEvent</code><code class="p">)</code> <code class="p">{</code>
  <code class="kd">if</code> <code class="p">(</code><code class="kd">typeof</code> <code class="nx">event</code><code class="p">.</code><code class="nx">value</code> <code class="o">===</code> <code class="s">'string'</code><code class="p">)</code> <code class="p">{</code>
    <code class="nx">event</code><code class="p">.</code><code class="nx">value</code>  <code class="c">// string</code>
    <code class="c">// ...</code>
    <code class="kd">return</code>
  <code class="p">}</code>
  <code class="nx">event</code><code class="p">.</code><code class="nx">value</code>    <code class="c">// [number, number]</code>
<code class="p">}</code></pre>

<p class="author1">Inside the <code class="calibre14">if</code> block, TypeScript knows that <code class="calibre14">event.value</code> has to be a <code class="calibre14">string</code> (because of the <code class="calibre14">typeof</code> check), which implies that after the <code class="calibre14">if</code> block <code class="calibre14">event.value</code> has to be a tuple of <code class="calibre14">[number, number]</code> (because of the <code class="calibre14">return</code> in the <code class="calibre14">if</code> block).</p>

<p class="author1">What happens if we make this a little more complicated? Let’s add some more information to our event types, and see how TypeScript fares when we refine our types:</p>
<pre data-type="programlisting" class="calibre30">
<code class="nx">type</code><code class="calibre14"> </code><code class="nx">UserTextEvent</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="nx">value</code><code class="calibre14">: </code><code class="kt">string</code><strong class="calibre49"><code class="p1">,</code><code class="calibre50"> </code><code class="nx1">target</code><code class="calibre50">: </code><code class="kt1">HTMLInputElement</code></strong><code class="p">}</code><code class="calibre14">
</code><code class="nx">type</code><code class="calibre14"> </code><code class="nx">UserMouseEvent</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="nx">value</code><code class="o">:</code><code class="calibre14"> </code><code class="p">[</code><code class="kt">number</code><code class="p">,</code><code class="calibre14"> </code><code class="kt">number</code><code class="p">]</code><strong class="calibre49"><code class="p1">,</code><code class="calibre50"> </code><code class="nx1">target</code><code class="calibre50">: </code><code class="kt1">HTMLElement</code></strong><code class="p">}</code><code class="calibre14">

</code><code class="nx">type</code><code class="calibre14"> </code><code class="nx">UserEvent</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="nx">UserTextEvent</code><code class="calibre14"> </code><code class="o">|</code><code class="calibre14"> </code><code class="nx">UserMouseEvent</code><code class="calibre14">

</code><code class="kd">function</code><code class="calibre14"> </code><code class="nx">handle</code><code class="p">(</code><code class="nx">event</code><code class="calibre14">: </code><code class="kt">UserEvent</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="kd">if</code><code class="calibre14"> </code><code class="p">(</code><code class="kd">typeof</code><code class="calibre14"> </code><code class="nx">event</code><code class="p">.</code><code class="nx">value</code><code class="calibre14"> </code><code class="o">===</code><code class="calibre14"> </code><code class="s">'string'</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
    </code><code class="nx">event</code><code class="p">.</code><code class="nx">value</code><code class="calibre14">  </code><em class="calibre41"><code class="c2">// string</code></em><code class="c">
</code><code class="calibre14">    </code><strong class="calibre49"><code class="nx1">event</code><code class="p1">.</code><code class="nx1">target</code></strong><code class="calibre14"> </code><em class="calibre41"><code class="c2">// HTMLInputElement | HTMLElement (!!!)</code></em><code class="c">
</code><code class="calibre14">    </code><code class="c">// ...
</code><code class="calibre14">    </code><code class="kd">return</code><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">
  </code><code class="nx">event</code><code class="p">.</code><code class="nx">value</code><code class="calibre14">    </code><em class="calibre41"><code class="c2">// [number, number]</code></em><code class="c">
</code><code class="calibre14">  </code><strong class="calibre49"><code class="nx1">event</code><code class="p1">.</code><code class="nx1">target</code></strong><code class="calibre14">   </code><em class="calibre41"><code class="c2">// HTMLInputElement | HTMLElement (!!!)</code></em><code class="c">
</code><code class="p">}</code>
</pre>

<p class="author1">While the refinement worked for <code class="calibre14">event.value</code>, it didn’t carry over to <code class="calibre14">event.target</code>. Why? When <code class="calibre14">handle</code> takes a parameter of type <code class="calibre14">UserEvent</code>, that doesn’t mean we have to pass a <code class="calibre14">UserTextEvent</code> or <code class="calibre14">UserMouseEvent</code>&mdash;in fact, we could pass an argument of type <code class="calibre14">UserMouseEvent | UserTextEvent</code>. And since members of a union might overlap, TypeScript needs a more reliable way to know when we’re in one case of a union type versus another case.</p>

<p class="author1">The way to do this is to use a literal type to <em class="calibre5">tag</em> each case of your union type.<a data-primary="tags for union types" data-type="indexterm" id="calibre_link-1468" class="calibre4"></a> A good tag is:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">On the same place in each case of your union type. That means the same object field if it’s a union of object types, or the same index if it’s a union of tuple types. In practice, tagged unions usually use object types.</p>
</li>
<li class="calibre11">
<p class="author1">Typed as a literal type (a literal string, number, boolean, etc.). You can mix and match different types of literals, but it’s good practice to stick to a single type; typically, that’s a string literal type.</p>
</li>
<li class="calibre11">
<p class="author1">Not generic. Tags should not take any generic type arguments.</p>
</li>
<li class="calibre11">
<p class="author1">Mutually exclusive (i.e., unique within the union type).</p>
</li>
</ul>

<p class="author1">With that in mind, let’s update our event types again:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<code class="nx">type</code><code class="calibre14"> </code><code class="nx">UserTextEvent</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><strong class="calibre49"><code class="nx1">type</code><code class="o1">:</code><code class="calibre50"> </code><code class="s1">'TextEvent'</code><code class="p1">,</code></strong><code class="calibre14"> </code><code class="nx">value</code><code class="calibre14">: </code><code class="kt">string</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">target</code><code class="calibre14">: </code><code class="kt">HTMLInputElement</code><code class="p">}</code><code class="calibre14">
</code><code class="nx">type</code><code class="calibre14"> </code><code class="nx">UserMouseEvent</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><strong class="calibre49"><code class="nx1">type</code><code class="o1">:</code><code class="calibre50"> </code><code class="s1">'MouseEvent'</code><code class="p1">,</code></strong><code class="calibre14"> </code><code class="nx">value</code><code class="o">:</code><code class="calibre14"> </code><code class="p">[</code><code class="kt">number</code><code class="p">,</code><code class="calibre14"> </code><code class="kt">number</code><code class="p">]</code><code class="p">,</code><code class="calibre14">
                       </code><code class="nx">target</code><code class="calibre14">: </code><code class="kt">HTMLElement</code><code class="p">}</code><code class="calibre14">

</code><code class="nx">type</code><code class="calibre14"> </code><code class="nx">UserEvent</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="nx">UserTextEvent</code><code class="calibre14"> </code><code class="o">|</code><code class="calibre14"> </code><code class="nx">UserMouseEvent</code><code class="calibre14">

</code><code class="kd">function</code><code class="calibre14"> </code><code class="nx">handle</code><code class="p">(</code><code class="nx">event</code><code class="calibre14">: </code><code class="kt">UserEvent</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="kd">if</code><code class="calibre14"> </code><code class="p">(</code><strong class="calibre49"><code class="nx1">event</code><code class="p1">.</code><code class="nx1">type</code><code class="calibre50"> </code><code class="o1">===</code><code class="calibre50"> </code><code class="s1">'TextEvent'</code></strong><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
    </code><code class="nx">event</code><code class="p">.</code><code class="nx">value</code><code class="calibre14">  </code><em class="calibre41"><code class="c2">// string</code></em><code class="c">
</code><code class="calibre14">    </code><code class="nx">event</code><code class="p">.</code><code class="nx">target</code><code class="calibre14"> </code><em class="calibre41"><code class="c2">// HTMLInputElement</code></em><code class="c">
</code><code class="calibre14">    </code><code class="c">// ...
</code><code class="calibre14">    </code><code class="kd">return</code><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">
  </code><code class="nx">event</code><code class="p">.</code><code class="nx">value</code><code class="calibre14">    </code><em class="calibre41"><code class="c2">// [number, number]</code></em><code class="c">
</code><code class="calibre14">  </code><code class="nx">event</code><code class="p">.</code><code class="nx">target</code><code class="calibre14">   </code><em class="calibre41"><code class="c2">// HTMLElement</code></em><code class="c">
</code><code class="p">}</code><code class="calibre14">
</code></pre>

<p class="author1">Now when we refine <code class="calibre14">event</code> based on the value of its tagged field (<code class="calibre14">event.type</code>), TypeScript knows that in the <code class="calibre14">if</code> branch <code class="calibre14">event</code> has to be a <code class="calibre14">UserTextEvent</code>, and after the <code class="calibre14">if</code> branch it has to be a <code class="calibre14">UserMouseEvent</code>. Since the tag is unique per union type, TypeScript knows that the two are mutually exclusive.</p>

<p class="author1">Use tagged unions when writing a function that has to handle the different cases of a union type. For example, they’re invaluable when working with Flux actions, Redux reducers, or React’s <code class="calibre14">useReducer</code>.<a data-primary="types" data-secondary="relationships between" data-startref="ix_typerelref" data-tertiary="refinement" data-type="indexterm" id="calibre_link-1641" class="calibre4"></a><a data-primary="refinement (types)" data-startref="ix_refine" data-type="indexterm" id="calibre_link-1414" class="calibre4"></a><a data-primary="types" data-secondary="relationships between" data-startref="ix_typerel" data-type="indexterm" id="calibre_link-1638" class="calibre4"></a></p>
</div></section>



</div></section>





</div></section>













<section data-pdf-bookmark="Totality" data-type="sect1" class="preface"><div class="preface" id="calibre_link-275">
<h1 class="calibre13">Totality</h1>
<blockquote class="pcalibre2 pcalibre4 pcalibre3">A programmer puts two glasses on her bedside table before going to sleep: a full one, in case she gets thirsty, and an empty one, in case she doesn’t.<a data-primary="totality" data-type="indexterm" id="calibre_link-1480" class="calibre4"></a><a data-primary="types" data-secondary="totality" data-type="indexterm" id="calibre_link-1669" class="calibre4"></a>
<p data-type="attribution" class="calibre51 pcalibre5">Anonymous</p>
</blockquote>

<p class="author1">Totality, also called <em class="calibre5">exhaustiveness checking</em>, is what allows the typechecker to make sure you’ve covered all your cases.<a data-primary="exhaustiveness checking" data-seealso="totality" data-type="indexterm" id="calibre_link-990" class="calibre4"></a> It comes to us from Haskell, OCaml, and other languages that are based around pattern matching.</p>

<p class="author1">TypeScript will check for totality in a variety of cases, and give you helpful warnings when you’ve missed a case. This is an incredibly helpful feature for preventing real bugs.<a data-primary="return statements, totality checking" data-type="indexterm" id="calibre_link-1420" class="calibre4"></a> For example:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">Weekday</code> <code class="o">=</code> <code class="s">'Mon'</code> <code class="o">|</code> <code class="s">'Tue'</code><code class="o">|</code> <code class="s">'Wed'</code> <code class="o">|</code> <code class="s">'Thu'</code> <code class="o">|</code> <code class="s">'Fri'</code>
<code class="nx">type</code> <code class="nx">Day</code> <code class="o">=</code> <code class="nx">Weekday</code> <code class="o">|</code> <code class="s">'Sat'</code> <code class="o">|</code> <code class="s">'Sun'</code>

<code class="kd">function</code> <code class="nx">getNextDay</code><code class="p">(</code><code class="nx">w</code>: <code class="kt">Weekday</code><code class="p">)</code><code class="o">:</code> <code class="nx">Day</code> <code class="p">{</code>
  <code class="kd">switch</code> <code class="p">(</code><code class="nx">w</code><code class="p">)</code> <code class="p">{</code>
    <code class="kd">case</code> <code class="s">'Mon'</code><code class="o">:</code> <code class="kd">return</code> <code class="s">'Tue'</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p class="author1">We clearly missed a few days (it’s been a long week). <a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2366" data-type="indexterm" id="calibre_link-934" class="calibre4"></a>TypeScript comes to the rescue:</p>

<pre data-type="programlisting" class="calibre30">Error TS2366: Function lacks ending return statement and
return type does not include 'undefined'.</pre>
<div data-type="tip" class="calibre21"><h1 class="calibre42">TSC Flag: noImplicitReturns</h1>
<p class="author1">To ask TypeScript to check that all of your functions’ code paths return a value (and throw the preceding warning if you missed a spot), enable the <code class="calibre14">noImplicitReturns</code> flag in your <em class="calibre5">tsconfig.json</em>.<a data-primary="noImplicitReturns TSC flag" data-type="indexterm" id="calibre_link-1278" class="calibre4"></a><a data-primary="TSC compiler" data-secondary="noImplicitReturns flag" data-type="indexterm" id="calibre_link-1519" class="calibre4"></a> Whether you enable this flag or not is up to you: some people prefer a code style with fewer explicit <code class="calibre14">return</code>s, and some people are fine with a few extra <code class="calibre14">return</code>s in the name of better type safety and more bugs caught by the typechecker.</p>
</div>

<p class="author1">This error message is telling us that either we missed some cases and should cover them with a catchall <code class="calibre14">return</code> statement at the end that returns something like <code class="calibre14">'Sat'</code> (that’d be nice, huh), or we should adjust <code class="calibre14">getNextDay</code>’s return type to <code class="calibre14">Day |</code> <code class="calibre14"><span class="calibre">undefined</span></code>. After we add a <code class="calibre14">case</code> for each <code class="calibre14">Day</code>, the error goes away (try it!). Because we annotated <code class="calibre14">getNextDay</code>’s return type, and not all branches are guaranteed to return a value of that type, TypeScript warns us.</p>

<p class="author1">The implementation details in this example aren’t important: no matter what kind of control structure you use&mdash;<code class="calibre14">switch</code>, <code class="calibre14">if</code>, <code class="calibre14">throw</code>, and so on&mdash;TypeScript will watch your back to make sure you have every case covered.</p>

<p class="author1">Here’s another example:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">isBig</code><code class="p">(</code><code class="nx">n</code>: <code class="kt">number</code><code class="p">)</code> <code class="p">{</code>
  <code class="kd">if</code> <code class="p">(</code><code class="nx">n</code> <code class="o">&gt;=</code> <code class="mi">100</code><code class="p">)</code> <code class="p">{</code>
    <code class="kd">return</code> <code class="kd">true</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p class="author1">Maybe a client’s continued voicemails about that missed deadline have you jittery, and you forgot to handle numbers under <code class="calibre14">100</code> in your business-critical <code class="calibre14">isBig</code> function.<a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS7030" data-type="indexterm" id="calibre_link-959" class="calibre4"></a> Again, never fear&mdash;TypeScript is watching out for you:</p>

<pre data-type="programlisting" class="calibre30">Error TS7030: Not all code paths return a value.</pre>

<p class="author1">Or maybe the weekend gave you a chance to clear your mind, and you realized that you should rewrite that <code class="calibre14">getNextDay</code> example from earlier to be more efficient. Instead of using a <code class="calibre14">switch</code>, why not a constant-time lookup in an object?</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">nextDay</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">Mon</code><code class="o">:</code> <code class="s">'Tue'</code>
<code class="p">}</code>

<code class="nx">nextDay</code><code class="p">.</code><code class="nx">Mon</code> <code class="c">// 'Tue'</code></pre>

<p class="author1">With your Bichon Frise yapping away in the other room (something about the neighbor’s dog?), you absentmindedly forgot to fill in the other days in your new <code class="calibre14">nextDay</code> object before you committed your code and moved on to other things.</p>

<p class="author1">While TypeScript will give you an error the next time you try to access <code class="calibre14">nextDay.Tue</code>, you could have been more proactive about it when declaring <code class="calibre14">nextDay</code> in the first place. There are two ways to do that, as you’ll learn in <a data-type="xref" href="#calibre_link-256" class="calibre4">“The Record Type”</a> and  <a data-type="xref" href="#calibre_link-257" class="calibre4">“Mapped Types”</a>; but before we get there, let’s take a slight detour into type operators for object types.<a data-primary="totality" data-startref="ix_total" data-type="indexterm" id="calibre_link-1481" class="calibre4"></a><a data-primary="types" data-secondary="totality" data-startref="ix_typetotl" data-type="indexterm" id="calibre_link-1670" class="calibre4"></a></p>
</div></section>













<section data-pdf-bookmark="Advanced Object Types" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1868">
<h1 class="calibre13">Advanced Object Types</h1>

<p class="author1">Objects are central to JavaScript, and TypeScript gives you a whole bunch of ways to express and manipulate them safely.<a data-primary="objects" data-type="indexterm" id="calibre_link-1305" class="calibre4"></a><a data-primary="types" data-secondary="advanced object types" data-type="indexterm" id="calibre_link-1602" class="calibre4"></a></p>








<section data-pdf-bookmark="Type Operators for Object Types" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1869">
<h2 class="calibre17">Type Operators for Object Types</h2>

<p class="author1">Remember union (<code class="calibre14">|</code>) and intersection (<code class="calibre14">&amp;</code>), the two type operators I introduced in <a data-type="xref" href="#calibre_link-58" class="calibre4">“Union and intersection types”</a>?<a data-primary="type operators" data-secondary="for object types" data-type="indexterm" id="calibre_link-1575" class="calibre4"></a><a data-primary="objects" data-secondary="type operators for" data-type="indexterm" id="calibre_link-1319" class="calibre4"></a> It turns out they’re not the only type operators TypeScript gives you! Let’s run through a few more type operators that come in handy for working with shapes.<a data-primary="types" data-secondary="advanced object types" data-tertiary="type operators" data-type="indexterm" id="calibre_link-1608" class="calibre4"></a><a data-primary="| (pipe symbol), for union types" data-type="indexterm" id="calibre_link-598" class="calibre4"></a><a data-primary="&amp; (ampersand), for intersection types" data-type="indexterm" id="calibre_link-579" class="calibre4"></a></p>










<section data-pdf-bookmark="The keying-in operator" data-type="sect3" class="preface"><div class="preface" id="calibre_link-524">
<h3 class="calibre39">The keying-in operator</h3>

<p class="author1">Say you have a complex nested type to model the GraphQL API response you got back from your <a data-primary="objects" data-secondary="type operators for" data-tertiary="keying-in operator" data-type="indexterm" id="calibre_link-1321" class="calibre4"></a><a data-primary="type operators" data-secondary="for object types" data-tertiary="keying-in operator" data-type="indexterm" id="calibre_link-1577" class="calibre4"></a><a data-primary="keying-in operator" data-type="indexterm" id="calibre_link-1177" class="calibre4"></a>social media API of choice:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">APIResponse</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">user</code><code class="o">:</code> <code class="p">{</code>
    <code class="nx">userId</code>: <code class="kt">string</code>
    <code class="nx">friendList</code><code class="o">:</code> <code class="p">{</code>
      <code class="nx">count</code>: <code class="kt">number</code>
      <code class="nx">friends</code><code class="o">:</code> <code class="p">{</code>
        <code class="nx">firstName</code>: <code class="kt">string</code>
        <code class="nx">lastName</code>: <code class="kt">string</code>
      <code class="p">}[]</code>
    <code class="p">}</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p class="author1">You might fetch that response from the API, then render it:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">getAPIResponse</code><code class="p">()</code><code class="o">:</code> <code class="nx">Promise</code><code class="o">&lt;</code><code class="nx">APIResponse</code><code class="o">&gt;</code> <code class="p">{</code>
  <code class="c">// ...</code>
<code class="p">}</code>

<code class="kd">function</code> <code class="nx">renderFriendList</code><code class="p">(</code><code class="nx">friendList</code>: <code class="kt">unknown</code><code class="p">)</code> <code class="p">{</code>
  <code class="c">// ...</code>
<code class="p">}</code>

<code class="kd">let</code> <code class="nx">response</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">getAPIResponse</code><code class="p">()</code>
<code class="nx">renderFriendList</code><code class="p">(</code><code class="nx">response</code><code class="p">.</code><code class="nx">user</code><code class="p">.</code><code class="nx">friendList</code><code class="p">)</code></pre>

<p class="author1">What should the type of <code class="calibre14">friendList</code> be? (It’s stubbed out as <code class="calibre14">unknown</code> for now.) You could type it out and reimplement your top-level <code class="calibre14">APIResponse</code> type in terms of it:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">FriendList</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">count</code>: <code class="kt">number</code>
  <code class="nx">friends</code><code class="o">:</code> <code class="p">{</code>
    <code class="nx">firstName</code>: <code class="kt">string</code>
    <code class="nx">lastName</code>: <code class="kt">string</code>
  <code class="p">}[]</code>
<code class="p">}</code>

<code class="nx">type</code> <code class="nx">APIResponse</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">user</code><code class="o">:</code> <code class="p">{</code>
    <code class="nx">userId</code>: <code class="kt">string</code>
    <code class="nx">friendList</code>: <code class="kt">FriendList</code>
  <code class="p">}</code>
<code class="p">}</code>

<code class="kd">function</code> <code class="nx">renderFriendList</code><code class="p">(</code><code class="nx">friendList</code>: <code class="kt">FriendList</code><code class="p">)</code> <code class="p">{</code>
  <code class="c">// ...</code>
<code class="p">}</code></pre>

<p class="author1">But then you’d have to come up with names for each of your top-level types, which you don’t always want (e.g., if you used a build tool to generate TypeScript types from your GraphQL schema). Instead, you can <em class="calibre5">key in</em> to your type:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<code class="nx">type</code><code class="calibre14"> </code><code class="nx">APIResponse</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="nx">user</code><code class="o">:</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
    </code><code class="nx">userId</code><code class="calibre14">: </code><code class="kt">string</code><code class="calibre14">
    </code><code class="nx">friendList</code><code class="o">:</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
      </code><code class="nx">count</code><code class="calibre14">: </code><code class="kt">number</code><code class="calibre14">
      </code><code class="nx">friends</code><code class="o">:</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
        </code><code class="nx">firstName</code><code class="calibre14">: </code><code class="kt">string</code><code class="calibre14">
        </code><code class="nx">lastName</code><code class="calibre14">: </code><code class="kt">string</code><code class="calibre14">
      </code><code class="p">}</code><code class="p">[</code><code class="p">]</code><code class="calibre14">
    </code><code class="p">}</code><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">

</code><strong class="calibre49"><code class="nx1">type</code><code class="calibre50"> </code><code class="nx1">FriendList</code><code class="calibre50"> </code><code class="o1">=</code><code class="calibre50"> </code><code class="nx1">APIResponse</code><code class="p1">[</code><code class="s1">'user'</code><code class="p1">]</code><code class="p1">[</code><code class="s1">'friendList'</code><code class="p1">]</code></strong><code class="calibre14">

</code><code class="kd">function</code><code class="calibre14"> </code><code class="nx">renderFriendList</code><code class="p">(</code><code class="nx">friendList</code><code class="calibre14">: </code><code class="kt">FriendList</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><em class="calibre41"><code class="c2">// ...</code></em><code class="c">
</code><code class="p">}</code><code class="calibre14">
</code></pre>

<p class="author1">You can key in to any shape (object, class constructor, or class instance), and any array. For example, to get the type of an individual friend:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">Friend</code> <code class="o">=</code> <code class="nx">FriendList</code><code class="p">[</code><code class="s">'friends'</code><code class="p">][</code><code class="kt">number</code><code class="p">]</code></pre>

<p class="author1"><code class="calibre14">number</code> is a way to key in to an array type; for tuples, use <code class="calibre14">0</code>, <code class="calibre14">1</code>, or another number literal type to represent the index you want to key in to.</p>

<p class="author1">The syntax for keying in is intentionally similar to how you look up fields in regular JavaScript objects&mdash;just as you might look up a value in an object, so you can look up a type in a shape. Note that you have to use bracket notation, not dot notation, to look up property types when keying in.</p>
</div></section>













<section data-pdf-bookmark="The keyof operator" data-type="sect3" class="preface"><div class="preface" id="calibre_link-523">
<h3 class="calibre39">The keyof operator</h3>

<p class="author1">Use <code class="calibre14">keyof</code> to get all of an object’s keys as a union<a data-primary="keyof operator" data-type="indexterm" id="calibre_link-1179" class="calibre4"></a> of string literal types.<a data-primary="objects" data-secondary="type operators for" data-tertiary="keyof operator" data-type="indexterm" id="calibre_link-1322" class="calibre4"></a><a data-primary="type operators" data-secondary="for object types" data-tertiary="keyof" data-type="indexterm" id="calibre_link-1578" class="calibre4"></a> Using the previous <code class="calibre14">APIResponse</code> example:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">ResponseKeys</code> <code class="o">=</code> <code class="nx">keyof</code> <code class="nx">APIResponse</code> <code class="c">// 'user'</code>
<code class="nx">type</code> <code class="nx">UserKeys</code> <code class="o">=</code> <code class="nx">keyof</code> <code class="nx">APIResponse</code><code class="p">[</code><code class="s">'user'</code><code class="p">]</code> <code class="c">// 'userId' | 'friendList'</code>
<code class="nx">type</code> <code class="nx">FriendListKeys</code> <code class="o">=</code>
  <code class="nx">keyof</code> <code class="nx">APIResponse</code><code class="p">[</code><code class="s">'user'</code><code class="p">][</code><code class="s">'friendList'</code><code class="p">]</code> <code class="c">// 'count' | 'friends'</code></pre>

<p class="author1">Combining the keying-in and <code class="calibre14">keyof</code> operators, you can implement a typesafe getter function that looks up the value at the given key in an object:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code><code class="calibre14"> </code><code class="nx">get</code><code class="o">&lt;</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-258" id="calibre_link-261"><img alt="1" src="images/000000.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="nx">O</code><code class="calibre14"> </code><code class="kd">extends</code><code class="calibre14"> </code><code class="nx">object</code><code class="p">,</code><code class="calibre14">
  </code><code class="nx">K</code><code class="calibre14"> </code><code class="kd">extends</code><code class="calibre14"> </code><code class="nx">keyof</code><code class="calibre14"> </code><code class="nx">O</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-259" id="calibre_link-262"><img alt="2" src="images/000001.png" class="calibre40" /></a><code class="calibre14">
</code><code class="o">&gt;</code><code class="p">(</code><code class="calibre14">
  </code><code class="nx">o</code><code class="calibre14">: </code><code class="kt">O</code><code class="p">,</code><code class="calibre14">
  </code><code class="nx">k</code><code class="calibre14">: </code><code class="kt">K</code><code class="calibre14">
</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">O</code><code class="p">[</code><code class="nx">K</code><code class="p">]</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-260" id="calibre_link-263"><img alt="3" src="images/000002.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="kd">return</code><code class="calibre14"> </code><code class="nx">o</code><code class="p">[</code><code class="nx">k</code><code class="p">]</code><code class="calibre14">
</code><code class="p">}</code></pre>
<dl class="preface">
<dt class="calibre18"><a class="calibre4" href="#calibre_link-261" id="calibre_link-258"><img alt="1" src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45"><code class="calibre14">get</code> is a function that takes an object <code class="calibre14">o</code> and a key <code class="calibre14">k</code>.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-262" id="calibre_link-259"><img alt="2" src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45"><code class="calibre14">keyof O</code> is a union of string literal types,  representing all of <code class="calibre14">o</code>’s keys. The generic type <code class="calibre14">K</code> extends&mdash;and is a subtype of&mdash;that union. For example, if <code class="calibre14">o</code> has the type <code class="calibre14">{a: number, b: string, c: boolean}</code>, then <code class="calibre14">keyof o</code> is the type <code class="calibre14">'a' | 'b' | 'c'</code>, and <code class="calibre14">K</code> (which extends <code class="calibre14">keyof o</code>) could be the type <code class="calibre14">'a'</code>, <code class="calibre14">'b'</code>, <code class="calibre14">'a' | 'c'</code>, or any other subtype of <code class="calibre14">keyof o</code>.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-263" id="calibre_link-260"><img alt="3" src="images/000002.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45"><code class="calibre14">O[K]</code> is the type you get when you look up <code class="calibre14">K</code> in <code class="calibre14">O</code>. Continuing the example from <a class="calibre4" href="#calibre_link-262"><img alt="2" src="images/000001.png" class="calibre40" /></a>, if <code class="calibre14">K</code> is <code class="calibre14">'a'</code>, then we know at compile time that <code class="calibre14">get</code> returns a <code class="calibre14">number</code>. Or, if <code class="calibre14">K</code> is <code class="calibre14">'b' | 'c'</code>, then we know <code class="calibre14">get</code> returns <code class="calibre14">string | boolean</code>.</p></dd>
</dl>

<p class="author1">What’s cool about these type operators is how precisely and safely they let you describe shape types:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">ActivityLog</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">lastEvent</code>: <code class="kt">Date</code>
  <code class="nx">events</code><code class="o">:</code> <code class="p">{</code>
    <code class="nx">id</code>: <code class="kt">string</code>
    <code class="nx">timestamp</code>: <code class="kt">Date</code>
    <code class="nx">type</code><code class="o">:</code> <code class="s">'Read'</code> <code class="o">|</code> <code class="s">'Write'</code>
  <code class="p">}[]</code>
<code class="p">}</code>

<code class="kd">let</code> <code class="nx">activityLog</code>: <code class="kt">ActivityLog</code> <code class="o">=</code> <code class="c">// ...</code>
<code class="kd">let</code> <code class="nx">lastEvent</code> <code class="o">=</code> <code class="nx">get</code><code class="p">(</code><code class="nx">activityLog</code><code class="p">,</code> <code class="s">'lastEvent'</code><code class="p">)</code> <code class="c">// Date</code></pre>

<p class="author1">TypeScript goes to work for you, verifying <em class="calibre5">at compile time</em> that the type of <code class="calibre14">lastEvent</code> is <code class="calibre14">Date</code>. Of course, you could extend this in order to key in to an object more deeply too. Let’s overload <code class="calibre14">get</code> to accept up to three keys:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code><code class="calibre14"> </code><code class="nx">Get</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-264" id="calibre_link-269"><img alt="1" src="images/000000.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="o">&lt;</code><code class="calibre14">
    </code><code class="nx">O</code><code class="calibre14"> </code><code class="kd">extends</code><code class="calibre14"> </code><code class="nx">object</code><code class="p">,</code><code class="calibre14">
    </code><code class="nx">K1</code><code class="calibre14"> </code><code class="kd">extends</code><code class="calibre14"> </code><code class="nx">keyof</code><code class="calibre14"> </code><code class="nx">O</code><code class="calibre14">
  </code><code class="o">&gt;</code><code class="p">(</code><code class="nx">o</code><code class="calibre14">: </code><code class="kt">O</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">k1</code><code class="calibre14">: </code><code class="kt">K1</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">O</code><code class="p">[</code><code class="nx">K1</code><code class="p">]</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-265" id="calibre_link-270"><img alt="2" src="images/000001.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="o">&lt;</code><code class="calibre14">
    </code><code class="nx">O</code><code class="calibre14"> </code><code class="kd">extends</code><code class="calibre14"> </code><code class="nx">object</code><code class="p">,</code><code class="calibre14">
    </code><code class="nx">K1</code><code class="calibre14"> </code><code class="kd">extends</code><code class="calibre14"> </code><code class="nx">keyof</code><code class="calibre14"> </code><code class="nx">O</code><code class="p">,</code><code class="calibre14">
    </code><code class="nx">K2</code><code class="calibre14"> </code><code class="kd">extends</code><code class="calibre14"> </code><code class="nx">keyof</code><code class="calibre14"> </code><code class="nx">O</code><code class="p">[</code><code class="nx">K1</code><code class="p">]</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-266" id="calibre_link-271"><img alt="3" src="images/000002.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="o">&gt;</code><code class="p">(</code><code class="nx">o</code><code class="calibre14">: </code><code class="kt">O</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">k1</code><code class="calibre14">: </code><code class="kt">K1</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">k2</code><code class="calibre14">: </code><code class="kt">K2</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">O</code><code class="p">[</code><code class="nx">K1</code><code class="p">]</code><code class="p">[</code><code class="nx">K2</code><code class="p">]</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-267" id="calibre_link-272"><img alt="4" src="images/000003.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="o">&lt;</code><code class="calibre14">
    </code><code class="nx">O</code><code class="calibre14"> </code><code class="kd">extends</code><code class="calibre14"> </code><code class="nx">object</code><code class="p">,</code><code class="calibre14">
    </code><code class="nx">K1</code><code class="calibre14"> </code><code class="kd">extends</code><code class="calibre14"> </code><code class="nx">keyof</code><code class="calibre14"> </code><code class="nx">O</code><code class="p">,</code><code class="calibre14">
    </code><code class="nx">K2</code><code class="calibre14"> </code><code class="kd">extends</code><code class="calibre14"> </code><code class="nx">keyof</code><code class="calibre14"> </code><code class="nx">O</code><code class="p">[</code><code class="nx">K1</code><code class="p">]</code><code class="p">,</code><code class="calibre14">
    </code><code class="nx">K3</code><code class="calibre14"> </code><code class="kd">extends</code><code class="calibre14"> </code><code class="nx">keyof</code><code class="calibre14"> </code><code class="nx">O</code><code class="p">[</code><code class="nx">K1</code><code class="p">]</code><code class="p">[</code><code class="nx">K2</code><code class="p">]</code><code class="calibre14">
  </code><code class="o">&gt;</code><code class="p">(</code><code class="nx">o</code><code class="calibre14">: </code><code class="kt">O</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">k1</code><code class="calibre14">: </code><code class="kt">K1</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">k2</code><code class="calibre14">: </code><code class="kt">K2</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">k3</code><code class="calibre14">: </code><code class="kt">K3</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">O</code><code class="p">[</code><code class="nx">K1</code><code class="p">]</code><code class="p">[</code><code class="nx">K2</code><code class="p">]</code><code class="p">[</code><code class="nx">K3</code><code class="p">]</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-268" id="calibre_link-273"><img alt="5" src="images/000004.png" class="calibre40" /></a><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">

</code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">get</code><code class="calibre14">: </code><code class="kt">Get</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">(</code><code class="nx">object</code><code class="calibre14">: </code><code class="kt">any</code><code class="p">,</code><code class="calibre14"> </code><code class="p">.</code><code class="p">.</code><code class="p">.</code><code class="nx">keys</code><code class="calibre14">: </code><code class="kt">string</code><code class="p">[</code><code class="p">]</code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">result</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="nx">object</code><code class="calibre14">
  </code><code class="nx">keys</code><code class="p">.</code><code class="nx">forEach</code><code class="p">(</code><code class="nx">k</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="nx">result</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="nx">result</code><code class="p">[</code><code class="nx">k</code><code class="p">]</code><code class="p">)</code><code class="calibre14">
  </code><code class="kd">return</code><code class="calibre14"> </code><code class="nx">result</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">

</code><code class="nx">get</code><code class="p">(</code><code class="nx">activityLog</code><code class="p">,</code><code class="calibre14"> </code><code class="s">'events'</code><code class="p">,</code><code class="calibre14"> </code><code class="mi">0</code><code class="p">,</code><code class="calibre14"> </code><code class="s">'type'</code><code class="p">)</code><code class="calibre14"> </code><code class="c">// 'Read' | 'Write'
</code><code class="calibre14">

</code><code class="nx">get</code><code class="p">(</code><code class="nx">activityLog</code><code class="p">,</code><code class="calibre14"> </code><code class="s">'bad'</code><code class="p">)</code><code class="calibre14"> </code><code class="c">// Error TS2345: Argument of type '"bad"'
</code><code class="calibre14">                        </code><code class="c">// is not assignable to parameter of type
</code><code class="calibre14">                        </code><code class="c">// '"lastEvent" | "events"'.</code></pre>
<dl class="preface">
<dt class="calibre18"><a class="calibre4" href="#calibre_link-269" id="calibre_link-264"><img alt="1" src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We declare an overloaded function signature for <code class="calibre14">get</code> with three cases for when we call <code class="calibre14">get</code> with one key, two keys, and three keys.<a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2345" data-type="indexterm" id="calibre_link-928" class="calibre4"></a></p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-270" id="calibre_link-265"><img alt="2" src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">This one-key case is the same as the last example: <code class="calibre14">O</code> is a subtype of <code class="calibre14">object</code>, <code class="calibre14">K1</code> is a subtype of that object’s keys, and the return type is whatever specific type you get when you key in to <code class="calibre14">O</code> with <code class="calibre14">K1</code>.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-271" id="calibre_link-266"><img alt="3" src="images/000002.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">The two-key case is like the one-key case, but we declare one more generic type, <code class="calibre14">K2</code>, to model the possible keys on the nested object that results from keying into <code class="calibre14">O</code> with <code class="calibre14">K1</code>.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-272" id="calibre_link-267"><img alt="4" src="images/000003.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We build on <a class="calibre4" href="#calibre_link-270"><img alt="2" src="images/000001.png" class="calibre40" /></a> by keying in twice&mdash;we first get the type of <code class="calibre14">O[K1]</code>, then get the type of <code class="calibre14">[K2]</code> on the result.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-273" id="calibre_link-268"><img alt="5" src="images/000004.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">For this example we handle up to three nested keys; if you’re writing a real-world library, you’ll probably want to handle a few more cases than that.</p></dd>
</dl>

<p class="author1">Cool, huh? If you have a minute, show this example to your Java friends, and be sure to gloat as you walk them through it.</p>
</div></section>



</div></section>













</div></section>













</div></section></div>

<div data-type="book" class="calibre1" id="calibre_link-274">
<section data-pdf-bookmark="Chapter 6. Advanced Types" data-type="chapter" type="chapter" class="preface">
<div class="preface" id="calibre_link-1870">
<section data-pdf-bookmark="Advanced Object Types" data-type="sect1" class="preface">
<div class="preface" id="calibre_link-1871">
<section data-pdf-bookmark="Type Operators for Object Types" data-type="sect2" class="preface">
<div class="preface" id="calibre_link-1872">
<section data-pdf-bookmark="The keyof operator" data-type="sect3" class="preface">
<div class="preface" id="calibre_link-1873">
<div data-type="tip" class="calibre21"><h1 class="calibre42">TSC Flag: keyofStringsOnly</h1>
<p class="author1">In JavaScript, objects and arrays can have both string and symbol keys. And by convention, we usually use number keys for arrays, which are coerced to strings at runtime.<a data-primary="keyofStringsOnly TSC flag" data-type="indexterm" id="calibre_link-1180" class="calibre4"></a><a data-primary="TSC compiler" data-secondary="keyofStringsOnly flag" data-type="indexterm" id="calibre_link-1515" class="calibre4"></a></p>

<p class="author1">Because of this, <code class="calibre14">keyof</code> in TypeScript returns a value of type <code class="calibre14">number | string | symbol</code> by default (though if you call it on a more specific shape, TypeScript can infer a more specific subtype of that union).</p>

<p class="author1">This behavior is correct, but can make working with <code class="calibre14">keyof</code> wordy, as you may have to prove to TypeScript that the particular key you’re manipulating is a <code class="calibre14">string</code>, and not a <code class="calibre14">number</code> or a <code class="calibre14">symbol</code>.</p>

<p class="author1">To opt into TypeScript’s legacy behavior&mdash;where keys must be strings&mdash;enable the <code class="calibre14">keyofStringsOnly</code> <em class="calibre5">tsconfig.json</em> flag.<a data-primary="types" data-secondary="advanced object types" data-startref="ix_typeadvobjops" data-tertiary="type operators" data-type="indexterm" id="calibre_link-1609" class="calibre4"></a><a data-primary="objects" data-secondary="type operators for" data-startref="ix_objsadvtop" data-type="indexterm" id="calibre_link-1320" class="calibre4"></a><a data-primary="type operators" data-secondary="for object types" data-startref="ix_typeops" data-type="indexterm" id="calibre_link-1576" class="calibre4"></a></p>
</div>
</div></section>



</div></section>













<section data-pdf-bookmark="The Record Type" data-type="sect2" class="preface"><div class="preface" id="calibre_link-256">
<h2 class="calibre17">The Record Type</h2>

<p class="author1">TypeScript’s built-in <code class="calibre14">Record</code> type is a way to describe an object as a map from something to something.<a data-primary="Record type" data-type="indexterm" id="calibre_link-1409" class="calibre4"></a><a data-primary="types" data-secondary="advanced object types" data-tertiary="Record" data-type="indexterm" id="calibre_link-1607" class="calibre4"></a><a data-primary="objects" data-secondary="Record type" data-type="indexterm" id="calibre_link-1317" class="calibre4"></a></p>

<p class="author1">Recall from the <code class="calibre14">Weekday</code> example in <a data-type="xref" href="#calibre_link-275" class="calibre4">“Totality”</a> that there are two ways to enforce that an object defines a specific set of keys. <code class="calibre14">Record</code> types are the first.</p>

<p class="author1">Let’s use <code class="calibre14">Record</code> to build a map from each day of the week to the next day of the week. With <code class="calibre14">Record</code>, you can put some constraints on the keys and values in <code class="calibre14">nextDay</code>:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">Weekday</code> <code class="o">=</code> <code class="s">'Mon'</code> <code class="o">|</code> <code class="s">'Tue'</code><code class="o">|</code> <code class="s">'Wed'</code> <code class="o">|</code> <code class="s">'Thu'</code> <code class="o">|</code> <code class="s">'Fri'</code>
<code class="nx">type</code> <code class="nx">Day</code> <code class="o">=</code> <code class="nx">Weekday</code> <code class="o">|</code> <code class="s">'Sat'</code> <code class="o">|</code> <code class="s">'Sun'</code>

<code class="kd">let</code> <code class="nx">nextDay</code>: <code class="kt">Record</code><code class="o">&lt;</code><code class="nx">Weekday</code><code class="p">,</code> <code class="nx">Day</code><code class="o">&gt;</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">Mon</code><code class="o">:</code> <code class="s">'Tue'</code>
<code class="p">}</code></pre>

<p class="author1">Now, you get a nice, helpful error <a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2739" data-type="indexterm" id="calibre_link-955" class="calibre4"></a>message right away:</p>

<pre data-type="programlisting" class="calibre30">Error TS2739: Type '{Mon: "Tue"}' is missing the following properties
from type 'Record&lt;Weekday, Day&gt;': Tue, Wed, Thu, Fri.</pre>

<p class="author1">Adding the missing <code class="calibre14">Weekday</code>s to your object, of course, makes the error go away.</p>

<p class="author1"><code class="calibre14">Record</code> gives you one extra degree of freedom compared to regular object index signatures: with a regular<a data-primary="index signatures" data-secondary="Record object" data-type="indexterm" id="calibre_link-1105" class="calibre4"></a> index signature you can constrain the types of an object’s values, but the key can only be a regular <code class="calibre14">string</code>, <code class="calibre14">number</code>, or <code class="calibre14">symbol</code>; with <code class="calibre14">Record</code>, you can also constrain the types of an object’s keys to subtypes of <code class="calibre14">string</code> and <code class="calibre14">number</code>.</p>
</div></section>













<section data-pdf-bookmark="Mapped Types" data-type="sect2" class="preface"><div class="preface" id="calibre_link-257">
<h2 class="calibre17">Mapped Types</h2>

<p class="author1">TypeScript gives us a second, more powerful way to declare a safer <code class="calibre14">nextDay</code> type: mapped types.<a data-primary="types" data-secondary="advanced object types" data-tertiary="mapped types" data-type="indexterm" id="calibre_link-1605" class="calibre4"></a><a data-primary="objects" data-secondary="mapped types" data-type="indexterm" id="calibre_link-1314" class="calibre4"></a><a data-primary="mapped types" data-type="indexterm" id="calibre_link-1198" class="calibre4"></a> Let’s use mapped types to say that <code class="calibre14">nextDay</code> is an object with a key for each <code class="calibre14">Weekday</code>, whose value is a <code class="calibre14">Day</code>:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">nextDay</code><code class="o">:</code> <code class="p">{[</code><code class="nx">K</code> <code class="kd">in</code> <code class="nx">Weekday</code><code class="p">]</code><code class="o">:</code> <code class="nx">Day</code><code class="p">}</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">Mon</code><code class="o">:</code> <code class="s">'Tue'</code>
<code class="p">}</code></pre>

<p class="author1">This is another way to get a helpful hint for how to fix what you missed:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nb">Error</code> <code class="nx">TS2739</code>: <code class="kt">Type</code> <code class="s">'{Mon: "Tue"}'</code> <code class="nx">is</code> <code class="nx">missing</code> <code class="nx">the</code> <code class="nx">following</code> <code class="nx">properties</code>
<code class="nx">from</code> <code class="nx">type</code> <code class="s">'{Mon: Weekday; Tue: Weekday; Wed: Weekday; Thu: Weekday;</code>
<code class="s">Fri: Weekday}'</code><code class="o">:</code> <code class="nx">Tue</code><code class="p">,</code> <code class="nx">Wed</code><code class="p">,</code> <code class="nx">Thu</code><code class="p">,</code> <code class="nx">Fri</code><code class="p">.</code></pre>

<p class="author1">Mapped types are a language feature unique to TypeScript. Like literal types, they’re a utility feature that just makes sense for the challenge that is statically typing JavaScript.</p>

<p class="author1">As you saw, mapped types have their own special syntax. And like index signatures, you can have at most one mapped type per object:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">MyMappedType</code> <code class="o">=</code> <code class="p">{</code>
  <code class="p">[</code><code class="nx">Key</code> <code class="kd">in</code> <code class="nx">UnionType</code><code class="p">]</code><code class="o">:</code> <code class="nx">ValueType</code>
<code class="p">}</code></pre>

<p class="author1">As the name implies, it’s a way to map over an object’s key and value types. In fact, TypeScript uses mapped types to implement its built-in <code class="calibre14">Record</code> type we used earlier:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">Record</code><code class="o">&lt;</code><code class="nx">K</code> <code class="kd">extends</code> <code class="nx">keyof</code> <code class="nx">any</code><code class="p">,</code> <code class="nx">T</code><code class="o">&gt;</code> <code class="o">=</code> <code class="p">{</code>
  <code class="p">[</code><code class="nx">P</code> <code class="kd">in</code> <code class="nx">K</code><code class="p">]</code><code class="o">:</code> <code class="nx">T</code>
<code class="p">}</code></pre>

<p class="author1">Mapped types give you more power than a mere <code class="calibre14">Record</code> because in addition to letting you give types to an object’s keys and values, when you combine them with keyed-in types, they let you put constraints on which value type corresponds to which key name.</p>

<p class="author1">Let’s quickly run through some of the things you can do with mapped types.</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code><code class="calibre14"> </code><code class="nx">Account</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="nx">id</code><code class="calibre14">: </code><code class="kt">number</code><code class="calibre14">
  </code><code class="nx">isEmployee</code><code class="calibre14">: </code><code class="kt">boolean</code><code class="calibre14">
  </code><code class="nx">notes</code><code class="calibre14">: </code><code class="kt">string</code><code class="p">[</code><code class="p">]</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">

</code><code class="c">// Make all fields optional
</code><code class="nx">type</code><code class="calibre14"> </code><code class="nx">OptionalAccount</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="p">[</code><code class="nx">K</code><code class="calibre14"> </code><code class="kd">in</code><code class="calibre14"> </code><code class="nx">keyof</code><code class="calibre14"> </code><code class="nx">Account</code><code class="p">]</code><code class="o">?</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">Account</code><code class="p">[</code><code class="nx">K</code><code class="p">]</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-276" id="calibre_link-281"><img alt="1" src="images/000000.png" class="calibre40" /></a><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">

</code><code class="c">// Make all fields nullable
</code><code class="nx">type</code><code class="calibre14"> </code><code class="nx">NullableAccount</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="p">[</code><code class="nx">K</code><code class="calibre14"> </code><code class="kd">in</code><code class="calibre14"> </code><code class="nx">keyof</code><code class="calibre14"> </code><code class="nx">Account</code><code class="p">]</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">Account</code><code class="p">[</code><code class="nx">K</code><code class="p">]</code><code class="calibre14"> </code><code class="o">|</code><code class="calibre14"> </code><code class="kd">null</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-277" id="calibre_link-282"><img alt="2" src="images/000001.png" class="calibre40" /></a><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">

</code><code class="c">// Make all fields read-only
</code><code class="nx">type</code><code class="calibre14"> </code><code class="nx">ReadonlyAccount</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="nx">readonly</code><code class="calibre14"> </code><code class="p">[</code><code class="nx">K</code><code class="calibre14"> </code><code class="kd">in</code><code class="calibre14"> </code><code class="nx">keyof</code><code class="calibre14"> </code><code class="nx">Account</code><code class="p">]</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">Account</code><code class="p">[</code><code class="nx">K</code><code class="p">]</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-278" id="calibre_link-283"><img alt="3" src="images/000002.png" class="calibre40" /></a><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">

</code><code class="c">// Make all fields writable again (equivalent to Account)
</code><code class="nx">type</code><code class="calibre14"> </code><code class="nx">Account2</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="o">-</code><code class="nx">readonly</code><code class="calibre14"> </code><code class="p">[</code><code class="nx">K</code><code class="calibre14"> </code><code class="kd">in</code><code class="calibre14"> </code><code class="nx">keyof</code><code class="calibre14"> </code><code class="nx">ReadonlyAccount</code><code class="p">]</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">Account</code><code class="p">[</code><code class="nx">K</code><code class="p">]</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-279" id="calibre_link-284"><img alt="4" src="images/000003.png" class="calibre40" /></a><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">

</code><code class="c">// Make all fields required again (equivalent to Account)
</code><code class="nx">type</code><code class="calibre14"> </code><code class="nx">Account3</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="p">[</code><code class="nx">K</code><code class="calibre14"> </code><code class="kd">in</code><code class="calibre14"> </code><code class="nx">keyof</code><code class="calibre14"> </code><code class="nx">OptionalAccount</code><code class="p">]</code><code class="o">-</code><code class="o">?</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">Account</code><code class="p">[</code><code class="nx">K</code><code class="p">]</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-280" id="calibre_link-285"><img alt="5" src="images/000004.png" class="calibre40" /></a><code class="calibre14">
</code><code class="p">}</code></pre>
<dl class="preface">
<dt class="calibre18"><a class="calibre4" href="#calibre_link-281" id="calibre_link-276"><img alt="1" src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We create a new object type <code class="calibre14">OptionalAccount</code> by mapping over <code class="calibre14">Account</code>, marking each field as optional along the way.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-282" id="calibre_link-277"><img alt="2" src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We create a new object type <code class="calibre14">NullableAccount</code> by mapping over <code class="calibre14">Account</code>, adding <code class="calibre14">null</code> as a possible value for each field along the way.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-283" id="calibre_link-278"><img alt="3" src="images/000002.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We create a new object type <code class="calibre14">ReadonlyAccount</code> by taking <code class="calibre14">Account</code> and making each of its fields read-only (that is, readable but not writable).</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-284" id="calibre_link-279"><img alt="4" src="images/000003.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We can mark fields as optional (<code class="calibre14">?</code>) or <code class="calibre14">readonly</code>, and we can also unmark them. With the minus (<code class="calibre14">&ndash;</code>) operator&mdash;a special type operator only available with mapped types&mdash;we can undo <code class="calibre14">?</code> and <code class="calibre14">readonly</code>, making fields required and writable again, respectively. Here we create a new object type <code class="calibre14">Account2</code>, equivalent to our <code class="calibre14">Account</code> type, by mapping over <code class="calibre14">ReadonlyAccount</code> and removing the <code class="calibre14">readonly</code> modifier with the minus (<code class="calibre14">&ndash;</code>) operator.<a data-primary="type operators" data-secondary="– (minus) and + (plus)" data-type="indexterm" id="calibre_link-1579" class="calibre4"></a></p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-285" id="calibre_link-280"><img alt="5" src="images/000004.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We create a new object type <code class="calibre14">Account3</code>, equivalent to our original <code class="calibre14">Account</code> type, by mapping over <code class="calibre14">OptionalAccount</code> and removing the optional (<code class="calibre14">?</code>) operator with the minus (<code class="calibre14">&ndash;</code>) operator.<a data-primary="+ (plus) type operator" data-type="indexterm" id="calibre_link-582" class="calibre4"></a><a data-primary="– (minus) type operator" data-type="indexterm" id="calibre_link-600" class="calibre4"></a></p></dd>
</dl>
<div data-type="note" type="note" class="calibre21"><h6 class="calibre22">Note</h6>
<p class="author1">Minus (<code class="calibre14">&ndash;</code>) has a corresponding plus (<code class="calibre14">+</code>) type operator. You will probably never use this operator directly, because it’s implied: within a mapped type, <code class="calibre14">readonly</code> is equivalent to <code class="calibre14">+readonly</code>, and <code class="calibre14">?</code> is equivalent to <code class="calibre14">+?</code>. <code class="calibre14">+</code> is just there for completeness.</p>
</div>










<section data-pdf-bookmark="Built-in mapped types" data-type="sect3" class="preface"><div class="preface" id="calibre_link-1874">
<h3 class="calibre39">Built-in mapped types</h3>

<p class="author1">The mapped types we derived in the last section are so useful<a data-primary="mapped types" data-secondary="built-in" data-type="indexterm" id="calibre_link-1200" class="calibre4"></a> that TypeScript ships with many of them built in:</p>
<dl class="preface">
<dt class="calibre18"><code class="calibre14">Record&lt;Keys, Values&gt;</code></dt>
<dd class="calibre19">
<p class="author1">An object with keys of type <code class="calibre14">Keys</code> and values of type <code class="calibre14">Values</code></p>
</dd>
<dt class="calibre18"><code class="calibre14">Partial&lt;Object&gt;</code></dt>
<dd class="calibre19">
<p class="author1">Marks every field in <code class="calibre14">Object</code> as optional</p>
</dd>
<dt class="calibre18"><code class="calibre14">Required&lt;Object&gt;</code></dt>
<dd class="calibre19">
<p class="author1">Marks every field in <code class="calibre14">Object</code> as nonoptional</p>
</dd>
<dt class="calibre18"><code class="calibre14">Readonly&lt;Object&gt;</code></dt>
<dd class="calibre19">
<p class="author1">Marks every field in <code class="calibre14">Object</code> as read-only</p>
</dd>
<dt class="calibre18"><code class="calibre14">Pick&lt;Object, Keys&gt;</code></dt>
<dd class="calibre19">
<p class="author1">Returns a subtype of <code class="calibre14">Object</code>, with just the given <code class="calibre14">Keys</code></p>
</dd>
</dl>
</div></section>



</div></section>













<section data-pdf-bookmark="Companion Object Pattern" data-type="sect2" class="preface"><div class="preface" id="calibre_link-171">
<h2 class="calibre17">Companion Object Pattern</h2>

<p class="author1">The companion object pattern comes <a data-primary="objects" data-secondary="mapped types" data-startref="ix_objsadvmap" data-type="indexterm" id="calibre_link-1315" class="calibre4"></a><a data-primary="types" data-secondary="advanced object types" data-startref="ix_typeadvobjmap" data-tertiary="mapped types" data-type="indexterm" id="calibre_link-1606" class="calibre4"></a><a data-primary="mapped types" data-startref="ix_mapp" data-type="indexterm" id="calibre_link-1199" class="calibre4"></a>to us from <a href="http://bit.ly/2I9Nqg2" class="calibre4">Scala</a>, and is a way to pair together objects and classes that share the same name.<a data-primary="objects" data-secondary="companion object pattern" data-type="indexterm" id="calibre_link-1307" class="calibre4"></a><a data-primary="types" data-secondary="advanced object types" data-tertiary="companion object pattern" data-type="indexterm" id="calibre_link-1604" class="calibre4"></a><a data-primary="companion object pattern" data-type="indexterm" id="calibre_link-769" class="calibre4"></a> In TypeScript, there’s a similar pattern that’s similarly useful&mdash;we’ll also call it the companion object pattern&mdash;that we can use to pair together a type and an object.</p>

<p class="author1">It looks like this:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">Currency</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">unit</code><code class="o">:</code> <code class="s">'EUR'</code> <code class="o">|</code> <code class="s">'GBP'</code> <code class="o">|</code> <code class="s">'JPY'</code> <code class="o">|</code> <code class="s">'USD'</code>
  <code class="nx">value</code>: <code class="kt">number</code>
<code class="p">}</code>

<code class="kd">let</code> <code class="nx">Currency</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">DEFAULT</code><code class="o">:</code> <code class="s">'USD'</code><code class="p">,</code>
  <code class="nx">from</code><code class="p">(</code><code class="nx">value</code>: <code class="kt">number</code><code class="p">,</code> <code class="nx">unit</code> <code class="o">=</code> <code class="nx">Currency</code><code class="p">.</code><code class="nx">DEFAULT</code><code class="p">)</code><code class="o">:</code> <code class="nx">Currency</code> <code class="p">{</code>
    <code class="kd">return</code> <code class="p">{</code><code class="nx">unit</code><code class="p">,</code> <code class="nx">value</code><code class="p">}</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p class="author1">Remember that in TypeScript, types and values live in separate namespaces; you’ll read a little more about this in <a data-type="xref" href="#calibre_link-55" class="calibre4">“Declaration Merging”</a>. That means in the same scope, you can have the same name (in this example, <code class="calibre14">Currency</code>) bound to both a type and a value. With the companion object pattern, we exploit this separate namespacing to declare a name twice: first as a type, then  as a value.</p>

<p class="author1">This pattern has a few nice properties. It lets you group type and value information that’s semantically part of a single name (like <code class="calibre14">Currency</code>) together. It also lets consumers import both at once:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">import</code><code class="calibre14"> </code><code class="p">{</code><code class="nx">Currency</code><code class="p">}</code><code class="calibre14"> </code><code class="nx">from</code><code class="calibre14"> </code><code class="s">'./Currency'</code><code class="calibre14">

</code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">amountDue</code><code class="calibre14">: </code><code class="kt">Currency</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-286" id="calibre_link-288"><img alt="1" src="images/000000.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="nx">unit</code><code class="o">:</code><code class="calibre14"> </code><code class="s">'JPY'</code><code class="p">,</code><code class="calibre14">
  </code><code class="nx">value</code><code class="calibre14">: </code><code class="kt">83733.10</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">

</code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">otherAmountDue</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="nx">Currency</code><code class="p">.</code><code class="nx">from</code><code class="p">(</code><code class="mi">330</code><code class="p">,</code><code class="calibre14"> </code><code class="s">'EUR'</code><code class="p">)</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-287" id="calibre_link-289"><img alt="2" src="images/000001.png" class="calibre40" /></a></pre>
<dl class="preface">
<dt class="calibre18"><a class="calibre4" href="#calibre_link-288" id="calibre_link-286"><img alt="1" src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">Using <code class="calibre14">Currency</code> as a type</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-289" id="calibre_link-287"><img alt="2" src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">Using <code class="calibre14">Currency</code> as a value</p></dd>
</dl>

<p class="author1">Use the companion object pattern when a type and an object are semantically related, with the object providing utility methods that operate on the type.<a data-primary="types" data-secondary="advanced object types" data-startref="ix_typeadvobj" data-type="indexterm" id="calibre_link-1603" class="calibre4"></a><a data-primary="objects" data-startref="ix_objsadv" data-type="indexterm" id="calibre_link-1306" class="calibre4"></a></p>
</div></section>





</div></section>













<section data-pdf-bookmark="Advanced Function Types" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1875">
<h1 class="calibre13">Advanced Function Types</h1>

<p class="author1">Let’s take a look at a few more advanced techniques that are often used with function types.<a data-primary="types" data-secondary="function" data-type="indexterm" id="calibre_link-1632" class="calibre4"></a><a data-primary="functions" data-type="indexterm" id="calibre_link-1026" class="calibre4"></a></p>








<section data-pdf-bookmark="Improving Type Inference for Tuples" data-type="sect2" class="preface"><div class="preface" id="calibre_link-139">
<h2 class="calibre17">Improving Type Inference for Tuples</h2>

<p class="author1">When you declare a tuple in TypeScript, TypeScript will be lenient about inferring that tuple’s type. <a data-primary="tuples" data-secondary="improving type inference for" data-type="indexterm" id="calibre_link-1547" class="calibre4"></a><a data-primary="types" data-secondary="function" data-tertiary="improving type inference for tuples" data-type="indexterm" id="calibre_link-1634" class="calibre4"></a><a data-primary="functions" data-secondary="improving type inference for tuples" data-type="indexterm" id="calibre_link-1046" class="calibre4"></a><a data-primary="type inference" data-secondary="improving for tuples" data-type="indexterm" id="calibre_link-1571" class="calibre4"></a>It will infer the most general possible type based on what you gave it, ignoring the length of your tuple and which position holds which type:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">a</code> <code class="o">=</code> <code class="p">[</code><code class="mi">1</code><code class="p">,</code> <code class="kd">true</code><code class="p">]</code> <code class="c">// (number | boolean)[]</code></pre>

<p class="author1">But sometimes you want inference that’s stricter, that would treat <code class="calibre14">a</code> as a fixed-length tuple and not as an array. You could, of course, use a type assertion to cast your tuple to a tuple type (more on this in <a data-type="xref" href="#calibre_link-233" class="calibre4">“Type Assertions”</a>). Or, you could use an <code class="calibre14">as const</code> assertion (<a data-type="xref" href="#calibre_link-290" class="calibre4">“The const type”</a>) <a data-primary="rest parameters" data-secondary="type inference for" data-type="indexterm" id="calibre_link-1419" class="calibre4"></a>to infer the tuple’s type as narrowly as possible, marking it as read-only.</p>

<p class="author1">What if you want to type your tuple as a tuple, but avoid a type assertion, and avoid the narrow inference and read-only modifier that <code class="calibre14">as const</code> gives you? To do that, you can take advantage of the way TypeScript infers types for rest parameters (jump back to <a data-type="xref" href="#calibre_link-143" class="calibre4">“Using bounded polymorphism to model arity”</a> for more about that):</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code><code class="calibre14"> </code><code class="nx">tuple</code><code class="o">&lt;</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-291" id="calibre_link-296"><img alt="1" src="images/000000.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="nx">T</code><code class="calibre14"> </code><code class="kd">extends</code><code class="calibre14"> </code><code class="nx">unknown</code><code class="p">[</code><code class="p">]</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-292" id="calibre_link-297"><img alt="2" src="images/000001.png" class="calibre40" /></a><code class="calibre14">
</code><code class="o">&gt;</code><code class="p">(</code><code class="calibre14">
  </code><code class="p">.</code><code class="p">.</code><code class="p">.</code><code class="nx">ts</code><code class="calibre14">: </code><code class="kt">T</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-293" id="calibre_link-298"><img alt="3" src="images/000002.png" class="calibre40" /></a><code class="calibre14">
</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">T</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-294" id="calibre_link-299"><img alt="4" src="images/000003.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="kd">return</code><code class="calibre14"> </code><code class="nx">ts</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-295" id="calibre_link-300"><img alt="5" src="images/000004.png" class="calibre40" /></a><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">

</code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">a</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="nx">tuple</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code><code class="calibre14"> </code><code class="kd">true</code><code class="p">)</code><code class="calibre14"> </code><code class="c">// [number, boolean]</code></pre>
<dl class="preface">
<dt class="calibre18"><a class="calibre4" href="#calibre_link-296" id="calibre_link-291"><img alt="1" src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We declare a <code class="calibre14">tuple</code> function that we’ll use to construct tuple types (instead of using the built-in <code class="calibre14">[]</code> syntax).</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-297" id="calibre_link-292"><img alt="2" src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We declare a single type parameter <code class="calibre14">T</code> that’s a subtype of <code class="calibre14">unknown[]</code> (meaning <code class="calibre14">T</code> is an array of any kind of type).</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-298" id="calibre_link-293"><img alt="3" src="images/000002.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45"><code class="calibre14">tuple</code> takes a variable number of parameters, <code class="calibre14">ts</code>. Because <code class="calibre14">T</code> describes a rest parameter, TypeScript will infer a tuple type for it.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-299" id="calibre_link-294"><img alt="4" src="images/000003.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45"><code class="calibre14">tuple</code> returns a value of the same tuple type that it inferred <code class="calibre14">ts</code> as.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-300" id="calibre_link-295"><img alt="5" src="images/000004.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">Our function returns the same argument that we passed it. The magic is all in the types.</p></dd>
</dl>

<p class="author1">Take advantage of this technique in order to avoid type assertions when your code uses lots of tuple types.</p>
</div></section>













<section data-pdf-bookmark="User-Defined Type Guards" data-type="sect2" class="preface"><div class="preface" id="calibre_link-532">
<h2 class="calibre17">User-Defined Type Guards</h2>

<p class="author1">For some kinds of <code class="calibre14">boolean</code>-returning functions, simply saying that your function returns a <code class="calibre14">boolean</code> may not be enough.<a data-primary="types" data-secondary="function" data-tertiary="user-defined type guards" data-type="indexterm" id="calibre_link-1635" class="calibre4"></a><a data-primary="functions" data-secondary="user-defined type guards" data-type="indexterm" id="calibre_link-1056" class="calibre4"></a><a data-primary="user-defined type guards" data-type="indexterm" id="calibre_link-1723" class="calibre4"></a> For example, let’s write a function that tells you if you passed it a <code class="calibre14">string</code> or not:</p>

<pre data-code-language="js" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">isString</code><code class="p">(</code><code class="nx">a</code><code class="o">:</code> <code class="nx">unknown</code><code class="p">)</code><code class="o">:</code> <code class="kd">boolean</code> <code class="p">{</code>
  <code class="kd">return</code> <code class="kd">typeof</code> <code class="nx">a</code> <code class="o">===</code> <code class="s">'string'</code>
<code class="p">}</code>

<code class="nx">isString</code><code class="p">(</code><code class="s">'a'</code><code class="p">)</code> <code class="c">// evaluates to true</code>
<code class="nx">isString</code><code class="p">([</code><code class="mi">7</code><code class="p">])</code> <code class="c">// evaluates to false</code></pre>

<p class="author1">So far so good. What happens if you try to use <code class="calibre14">isString</code> in some real-world code?</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">parseInput</code><code class="p">(</code><code class="nx">input</code>: <code class="kt">string</code> <code class="o">|</code> <code class="kt">number</code><code class="p">)</code> <code class="p">{</code>
  <code class="kd">let</code> <code class="nx">formattedInput</code>: <code class="kt">string</code>
  <code class="kd">if</code> <code class="p">(</code><code class="nx">isString</code><code class="p">(</code><code class="nx">input</code><code class="p">))</code> <code class="p">{</code>
    <code class="nx">formattedInput</code> <code class="o">=</code> <code class="nx">input</code><code class="p">.</code><code class="nx">toUpperCase</code><code class="p">()</code> <code class="c">// Error TS2339: Property 'toUpperCase'</code>
  <code class="p">}</code>                                      <code class="c">// does not exist on type 'number'.</code>
<code class="p">}</code></pre>

<p class="author1">What gives? If <code class="calibre14">typeof</code> works for regular<a data-primary="typeof operator" data-type="indexterm" id="calibre_link-1600" class="calibre4"></a> type refinement (see <a data-type="xref" href="#calibre_link-38" class="calibre4">“Refinement”</a>), why doesn’t it work here?<a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2339" data-type="indexterm" id="calibre_link-914" class="calibre4"></a></p>

<p class="author1">The thing about type refinement is it’s only powerful <a data-primary="refinement (types)" data-secondary="typeof operator and changing scopes" data-type="indexterm" id="calibre_link-1416" class="calibre4"></a>enough to refine the type of a variable in the scope you’re in. As soon as you leave that scope, the refinement doesn’t carry over to whatever new scope you’re in. In our <code class="calibre14">isString</code> implementation, we refined the input parameter’s type to <code class="calibre14">string</code> using <code class="calibre14">typeof</code>, but because type refinement doesn’t carry over to new scopes, it got lost&mdash;all TypeScript knows is that <code class="calibre14">isString</code> returned a <code class="calibre14">boolean</code>.</p>

<p class="author1">What we can do is tell the typechecker that not only does <code class="calibre14">isString</code> return a <code class="calibre14">boolean</code>, but whenever that <code class="calibre14">boolean</code> is <code class="calibre14">true</code>, the argument we passed to <code class="calibre14">isString</code> is a <code class="calibre14">string</code>. To do that, we use something called a <em class="calibre5">user-defined type guard</em>:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<code class="kd">function</code><code class="calibre14"> </code><code class="nx">isString</code><code class="p">(</code><code class="nx">a</code><code class="calibre14">: </code><code class="kt">unknown</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><strong class="calibre49"><code class="nx1">a</code><code class="calibre50"> </code><code class="nx1">is</code><code class="calibre50"> </code><code class="kt1">string</code></strong><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="kd">return</code><code class="calibre14"> </code><code class="kd">typeof</code><code class="calibre14"> </code><code class="nx">a</code><code class="calibre14"> </code><code class="o">===</code><code class="calibre14"> </code><code class="s">'string'</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code></pre>

<p class="author1">Type guards are a built-in TypeScript feature, and are what lets you refine types with <code class="calibre14">typeof</code> and <code class="calibre14">instanceof</code>.<a data-primary="type guards" data-type="indexterm" id="calibre_link-1570" class="calibre4"></a> But sometimes, you need the ability to declare type guards yourself&mdash;that’s what the <code class="calibre14">is</code> operator is for. When you have a function that refines its parameters’ types and returns a <code class="calibre14">boolean</code>, you can use a user-defined type guard to make sure that refinement is flowed whenever you use that function.</p>

<p class="author1">User-defined type guards are limited to a single parameter, but they aren’t limited to simple types:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">LegacyDialog</code> <code class="o">=</code> <code class="c">// ...</code>
<code class="nx">type</code> <code class="nx">Dialog</code> <code class="o">=</code> <code class="c">// ...</code>

<code class="kd">function</code> <code class="nx">isLegacyDialog</code><code class="p">(</code>
  <code class="nx">dialog</code>: <code class="kt">LegacyDialog</code> <code class="o">|</code> <code class="nx">Dialog</code>
<code class="p">)</code><code class="o">:</code> <code class="nx">dialog</code> <code class="nx">is</code> <code class="nx">LegacyDialog</code> <code class="p">{</code>
  <code class="c">// ...</code>
<code class="p">}</code></pre>

<p class="author1">You won’t use user-defined type guards often, but when you do, they’re awesome for writing clean, reusable code. Without them, you’d have to inline all your <code class="calibre14">typeof</code> and <code class="calibre14">instanceof</code> type guards instead of building functions like <code class="calibre14">isLegacyDialog</code> and <code class="calibre14">isString</code> to perform those same checks in a better-encapsulated, more readable way.<a data-primary="types" data-secondary="function" data-startref="ix_typeadvfun" data-type="indexterm" id="calibre_link-1633" class="calibre4"></a><a data-primary="functions" data-startref="ix_funcs" data-type="indexterm" id="calibre_link-1027" class="calibre4"></a></p>
</div></section>





</div></section>













<section data-pdf-bookmark="Conditional Types" data-type="sect1" class="preface"><div class="preface" id="calibre_link-529">
<h1 class="calibre13">Conditional Types</h1>

<p class="author1">Conditional types might be the single most unique feature in all of TypeScript.<a data-primary="conditional types" data-type="indexterm" id="calibre_link-784" class="calibre4"></a><a data-primary="types" data-secondary="conditional" data-type="indexterm" id="calibre_link-1612" class="calibre4"></a> At a high level, conditional types let you say, “Declare a type <code class="calibre14">T</code> that depends on types <code class="calibre14">U</code> and <code class="calibre14">V</code>; if <code class="calibre14">U &lt;: V</code>, then assign <code class="calibre14">T</code> to <code class="calibre14">A</code>, and otherwise,<a data-primary="generics" data-secondary="declaring as part of a condition" data-type="indexterm" id="calibre_link-1073" class="calibre4"></a> assign <code class="calibre14">T</code> to <code class="calibre14">B</code>.”</p>

<p class="author1">In code it might look like this:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code><code class="calibre14"> </code><code class="nx">IsString</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="nx">T</code><code class="calibre14"> </code><code class="kd">extends</code><code class="calibre14"> </code><code class="kt">string</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-301" id="calibre_link-304"><img alt="1" src="images/000000.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="o">?</code><code class="calibre14"> </code><code class="kd">true</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-302" id="calibre_link-305"><img alt="2" src="images/000001.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="o">:</code><code class="calibre14"> </code><code class="kd">false</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-303" id="calibre_link-306"><img alt="3" src="images/000002.png" class="calibre40" /></a><code class="calibre14">

</code><code class="nx">type</code><code class="calibre14"> </code><code class="nx">A</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="nx">IsString</code><code class="o">&lt;</code><code class="kt">string</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="c">// true
</code><code class="nx">type</code><code class="calibre14"> </code><code class="nx">B</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="nx">IsString</code><code class="o">&lt;</code><code class="kt">number</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="c">// false</code></pre>

<p class="author1">Let’s break that down line by line.</p>
<dl class="preface">
<dt class="calibre18"><a class="calibre4" href="#calibre_link-304" id="calibre_link-301"><img alt="1" src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We declare a new conditional type <code class="calibre14">IsString</code> that takes a generic type <code class="calibre14">T</code>. The “condition” part of this conditional type is <code class="calibre14">T extends string</code>; that is, “Is <code class="calibre14">T</code> a subtype of <code class="calibre14">string</code>?”</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-305" id="calibre_link-302"><img alt="2" src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">If <code class="calibre14">T</code> is a subtype of <code class="calibre14">string</code>, we resolve to the type <code class="calibre14">true</code>.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-306" id="calibre_link-303"><img alt="3" src="images/000002.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">Otherwise, we resolve to the type <code class="calibre14">false</code>.</p></dd>
</dl>

<p class="author1">Note how the syntax looks just like a regular value-level ternary expression, but at the type level. And like regular ternary expressions, you can nest them too.</p>

<p class="author1">Conditional types aren’t limited to type aliases. You can use them almost anywhere you can use a type: in type aliases, interfaces, classes, parameter types, and generic defaults in functions and methods.</p>








<section data-pdf-bookmark="Distributive Conditionals" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1876">
<h2 class="calibre17">Distributive Conditionals</h2>

<p class="author1">While you can express simple conditions like the examples we just looked at in a variety of ways in TypeScript&mdash;with conditional types, overloaded function signatures,<a data-primary="conditional types" data-secondary="distributive" data-type="indexterm" id="calibre_link-787" class="calibre4"></a><a data-primary="types" data-secondary="conditional" data-tertiary="distributive conditionals" data-type="indexterm" id="calibre_link-1616" class="calibre4"></a><a data-primary="distributive property of conditional types following" data-type="indexterm" id="calibre_link-848" class="calibre4"></a> and mapped types&mdash;conditional types let you do more. The reason for this is that they follow the <em class="calibre5">distributive law</em> (remember, from algebra class?). That means if you have a conditional type, then the expressions on the right are equivalent to those on the left in <a data-type="xref" href="#calibre_link-307" class="calibre4">Table&nbsp;6-1</a>.</p>
<table id="calibre_link-307" class="stafflist_table">
<caption class="calibre35"><span class="calibre">Table 6-1. </span>Distributing conditional types</caption>
<thead class="calibre36">
<tr class="calibre7">
<th class="calibre37">This…</th>
<th class="calibre37">Is equivalent to</th>
</tr>
</thead>
<tbody class="calibre6">
<tr class="calibre7">
<td class="calibre8"><p class="author1"><code class="calibre14">string extends T ? A : B</code></p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">string extends T ? A : B</code></p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1"><code class="calibre14">(string | number) extends T ? A : B</code></p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">(string extends T ? A : B) | (number extends T ? A : B)</code></p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1"><code class="calibre14">(string | number | boolean) extends T ? A : B</code></p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">(string extends T ? A : B) | (number extends T ? A : B) | (boolean extends T ? A : B)</code></p></td>
</tr>
</tbody>
</table>

<p class="author1">I know, I know, you didn’t shell out for this book to learn about math&mdash;you’re here for the types. So let’s get more concrete. Let’s say we have a function that takes some variable of type <code class="calibre14">T</code>, and lifts it to an array of type <code class="calibre14">T[]</code>. What happens if we pass in a union type for <code class="calibre14">T</code>?</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">ToArray</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code> <code class="o">=</code> <code class="nx">T</code><code class="p">[]</code>
<code class="nx">type</code> <code class="nx">A</code> <code class="o">=</code> <code class="nx">ToArray</code><code class="o">&lt;</code><code class="kt">number</code><code class="o">&gt;</code>          <code class="c">// number[]</code>
<code class="nx">type</code> <code class="nx">B</code> <code class="o">=</code> <code class="nx">ToArray</code><code class="o">&lt;</code><code class="kt">number</code> <code class="o">|</code> <code class="kt">string</code><code class="o">&gt;</code> <code class="c">// (number | string)[]</code></pre>

<p class="author1">Pretty straightforward.<a data-primary="union types" data-secondary="adding conditional type" data-type="indexterm" id="calibre_link-1717" class="calibre4"></a> Now what happens if we add a conditional type? (Note that the conditional doesn’t actually do anything here because both its branches resolve to the same type <code class="calibre14">T[]</code>; it’s just here to tell TypeScript to <em class="calibre5">distribute</em> <code class="calibre14">T</code> over the tuple type.) Take a look:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<code class="nx">type</code><code class="calibre14"> </code><code class="nx">ToArray2</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="nx">T</code><code class="calibre14"> </code><code class="kd">extends</code><code class="calibre14"> </code><code class="nx">unknown</code><code class="calibre14"> </code><code class="o">?</code><code class="calibre14"> </code><code class="nx">T</code><code class="p">[</code><code class="p">]</code><code class="calibre14"> </code><code class="o">:</code><code class="calibre14"> </code><code class="nx">T</code><code class="p">[</code><code class="p">]</code><code class="calibre14">
</code><code class="nx">type</code><code class="calibre14"> </code><code class="nx">A</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="nx">ToArray2</code><code class="o">&lt;</code><code class="kt">number</code><code class="o">&gt;</code><code class="calibre14"> </code><em class="calibre41"><code class="c2">// number[]</code></em><code class="c">
</code><code class="nx">type</code><code class="calibre14"> </code><code class="nx">B</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="nx">ToArray2</code><code class="o">&lt;</code><code class="kt">number</code><code class="calibre14"> </code><code class="o">|</code><code class="calibre14"> </code><code class="kt">string</code><code class="o">&gt;</code><code class="calibre14"> </code><em class="calibre41"><code class="c2">// number[] | string[]</code></em><code class="c">
</code></pre>

<p class="author1">Did you catch that? When you use a conditional type, TypeScript will distribute union types over the conditional’s branches. It’s like taking the conditional type and mapping (er, <em class="calibre5">distributing</em>) it over each element in the union.</p>

<p class="author1">Why does any of this matter? Well, it lets you safely express a bunch of common operations.</p>

<p class="author1">For example, TypeScript comes<a data-primary="Without type" data-type="indexterm" id="calibre_link-1763" class="calibre4"></a> with <code class="calibre14">&amp;</code> for computing what two types have in common and <code class="calibre14">|</code> for taking a union of two types. Let’s build <code class="calibre14">Without&lt;T, U&gt;</code>, which computes the types that are in <code class="calibre14">T</code> but not in <code class="calibre14">U</code>.</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">Without</code><code class="o">&lt;</code><code class="nx">T</code><code class="p">,</code> <code class="nx">U</code><code class="o">&gt;</code> <code class="o">=</code> <code class="nx">T</code> <code class="kd">extends</code> <code class="nx">U</code> <code class="o">?</code> <code class="nx">never</code> : <code class="kt">T</code></pre>

<p class="author1">You use <code class="calibre14">Without</code> like so:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">A</code> <code class="o">=</code> <code class="nx">Without</code><code class="o">&lt;</code>
  <code class="kd">boolean</code> <code class="o">|</code> <code class="kt">number</code> <code class="o">|</code> <code class="kt">string</code><code class="p">,</code>
  <code class="kd">boolean</code>
<code class="o">&gt;</code> <code class="c">// number | string</code></pre>

<p class="author1">Let’s walk through how TypeScript computes this type:</p>
<ol class="calibre31">
<li class="calibre32">
<p class="author1">Start with the inputs:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">A</code> <code class="o">=</code> <code class="nx">Without</code><code class="o">&lt;</code><code class="kd">boolean</code> <code class="o">|</code> <code class="kt">number</code> <code class="o">|</code> <code class="kt">string</code><code class="p">,</code> <code class="kd">boolean</code><code class="o">&gt;</code></pre>
</li>
<li class="calibre32">
<p class="author1">Distribute the condition over the union:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">A</code> <code class="o">=</code> <code class="nx">Without</code><code class="o">&lt;</code><code class="kd">boolean</code><code class="p">,</code> <code class="kd">boolean</code><code class="o">&gt;</code>
       <code class="o">|</code> <code class="nx">Without</code><code class="o">&lt;</code><code class="kt">number</code><code class="p">,</code> <code class="kd">boolean</code><code class="o">&gt;</code>
       <code class="o">|</code> <code class="nx">Without</code><code class="o">&lt;</code><code class="kt">string</code><code class="p">,</code> <code class="kd">boolean</code><code class="o">&gt;</code></pre>
</li>
<li class="calibre32">
<p class="author1">Substitute in <code class="calibre14">Without</code>’s definition and apply <code class="calibre14">T</code> and <code class="calibre14">U</code>:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">A</code> <code class="o">=</code> <code class="p">(</code><code class="kd">boolean</code> <code class="kd">extends</code> <code class="kd">boolean</code> <code class="o">?</code> <code class="nx">never</code> : <code class="kt">boolean</code><code class="p">)</code>
       <code class="o">|</code> <code class="p">(</code><code class="kt">number</code> <code class="kd">extends</code> <code class="kd">boolean</code> <code class="o">?</code> <code class="nx">never</code> : <code class="kt">number</code><code class="p">)</code>
       <code class="o">|</code> <code class="p">(</code><code class="kt">string</code> <code class="kd">extends</code> <code class="kd">boolean</code> <code class="o">?</code> <code class="nx">never</code> : <code class="kt">string</code><code class="p">)</code></pre>
</li>
<li class="calibre32">
<p class="author1">Evaluate the conditions:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">A</code> <code class="o">=</code> <code class="nx">never</code>
       <code class="o">|</code> <code class="kt">number</code>
       <code class="o">|</code> <code class="kt">string</code></pre>
</li>
<li class="calibre32">
<p class="author1">Simplify:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">A</code> <code class="o">=</code> <code class="kt">number</code> <code class="o">|</code> <code class="kt">string</code></pre>
</li>

</ol>

<p class="author1">If it wasn’t for the distributive property <a data-primary="never type" data-type="indexterm" id="calibre_link-1256" class="calibre4"></a>of conditional types, we would have ended up with <code class="calibre14">never</code> (if you’re not sure why, walk through what would happen for yourself!).</p>
</div></section>













<section data-pdf-bookmark="The infer Keyword" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1877">
<h2 class="calibre17">The infer Keyword</h2>

<p class="author1">The final feature of conditional types is the ability to declare generic types as part of a condition.<a data-primary="types" data-secondary="conditional" data-tertiary="declaring generics inline with infer keyword" data-type="indexterm" id="calibre_link-1615" class="calibre4"></a><a data-primary="generics" data-secondary="declaring as part of a condition" data-type="indexterm" id="calibre_link-1074" class="calibre4"></a><a data-primary="conditional types" data-secondary="infer keyword, declaring generics inline" data-type="indexterm" id="calibre_link-788" class="calibre4"></a> As a refresher, so far we’ve seen just one way to declare generic type parameters: using angle brackets (<code class="calibre14">&lt;T&gt;</code>). Conditional types have their own syntax for declaring generic types inline: the <code class="calibre14">infer</code> keyword.<a data-primary="infer keyword" data-type="indexterm" id="calibre_link-1107" class="calibre4"></a></p>

<p class="author1">Let’s declare a conditional type <code class="calibre14">ElementType</code>, which gets the type of an array’s elements:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">ElementType</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code> <code class="o">=</code> <code class="nx">T</code> <code class="kd">extends</code> <code class="nx">unknown</code><code class="p">[]</code> <code class="o">?</code> <code class="nx">T</code><code class="p">[</code><code class="kt">number</code><code class="p">]</code> <code class="o">:</code> <code class="nx">T</code>
<code class="nx">type</code> <code class="nx">A</code> <code class="o">=</code> <code class="nx">ElementType</code><code class="o">&lt;</code><code class="kt">number</code><code class="p">[]</code><code class="o">&gt;</code> <code class="c">// number</code></pre>

<p class="author1">Now, let’s rewrite it using <code class="calibre14">infer</code>:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">ElementType2</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code> <code class="o">=</code> <code class="nx">T</code> <code class="kd">extends</code> <code class="p">(</code><code class="nx">infer</code> <code class="nx">U</code><code class="p">)[]</code> <code class="o">?</code> <code class="nx">U</code> : <code class="kt">T</code>
<code class="nx">type</code> <code class="nx">B</code> <code class="o">=</code> <code class="nx">ElementType2</code><code class="o">&lt;</code><code class="kt">number</code><code class="p">[]</code><code class="o">&gt;</code> <code class="c">// number</code></pre>

<p class="author1">In this simple example <code class="calibre14">ElementType</code> is equivalent to <code class="calibre14">ElementType2</code>. Notice how the <code class="calibre14">infer</code> clause declares a new type variable, <code class="calibre14">U</code>&mdash;TypeScript will infer the type of <code class="calibre14">U</code> from context, based on what <code class="calibre14">T</code> you passed to <code class="calibre14">ElementType2</code>.</p>

<p class="author1">Also notice why we declared <code class="calibre14">U</code> inline instead of declaring it up front, alongside <code class="calibre14">T</code>. What would have happened if we did declare it up front?</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">ElementUgly</code><code class="o">&lt;</code><code class="nx">T</code><code class="p">,</code> <code class="nx">U</code><code class="o">&gt;</code> <code class="o">=</code> <code class="nx">T</code> <code class="kd">extends</code> <code class="nx">U</code><code class="p">[]</code> <code class="o">?</code> <code class="nx">U</code> : <code class="kt">T</code>
<code class="nx">type</code> <code class="nx">C</code> <code class="o">=</code> <code class="nx">ElementUgly</code><code class="o">&lt;</code><code class="kt">number</code><code class="p">[]</code><code class="o">&gt;</code> <code class="c">// Error TS2314: Generic type 'ElementUgly'</code>
                               <code class="c">// requires 2 type argument(s).</code></pre>

<p class="author1">Uh-oh. Because <code class="calibre14">ElementUgly</code> defines two generic types, <code class="calibre14">T</code> and <code class="calibre14">U</code>, we have to pass both<a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2314" data-type="indexterm" id="calibre_link-899" class="calibre4"></a> of them in when instantiating <code class="calibre14">ElementUgly</code>. But if we do that, that defeats the point of having an <code class="calibre14">ElementUgly</code> type in the first place; it puts the burden of computing <code class="calibre14">U</code> on the caller, when we wanted <code class="calibre14">ElementUgly</code> to compute the type itself.</p>

<p class="author1">Honestly, this was a bit of a silly example because we already have the keying-in operator (<code class="calibre14">[]</code>) to look up the type of an array’s elements.<a data-primary="keying-in operator" data-type="indexterm" id="calibre_link-1178" class="calibre4"></a><a data-primary="[] (square brackets)" data-secondary="keying-in operator" data-type="indexterm" id="calibre_link-593" class="calibre4"></a> What about a more complicated example?</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">SecondArg</code><code class="o">&lt;</code><code class="nx">F</code><code class="o">&gt;</code> <code class="o">=</code> <code class="nx">F</code> <code class="kd">extends</code> <code class="p">(</code><code class="nx">a</code>: <code class="kt">any</code><code class="p">,</code> <code class="nx">b</code>: <code class="kt">infer</code> <code class="nx">B</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="nx">any</code> <code class="o">?</code> <code class="nx">B</code> : <code class="kt">never</code>

<code class="c">// Get the type of Array.slice</code>
<code class="nx">type</code> <code class="nx">F</code> <code class="o">=</code> <code class="kd">typeof</code> <code class="nb">Array</code><code class="p">[</code><code class="s">'prototype'</code><code class="p">][</code><code class="s">'slice'</code><code class="p">]</code>

<code class="nx">type</code> <code class="nx">A</code> <code class="o">=</code> <code class="nx">SecondArg</code><code class="o">&lt;</code><code class="nx">F</code><code class="o">&gt;</code> <code class="c">// number | undefined</code></pre>

<p class="author1">So, <code class="calibre14">[].slice</code>’s second argument is a <code class="calibre14">number | undefined</code>. And we know this at compile time&mdash;try doing <em class="calibre5">that</em> in Java.</p>
</div></section>













<section data-pdf-bookmark="Built-in Conditional Types" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1878">
<h2 class="calibre17">Built-in Conditional Types</h2>

<p class="author1">Conditional types let you express some really powerful operations at the type level.<a data-primary="conditional types" data-secondary="built-in" data-type="indexterm" id="calibre_link-786" class="calibre4"></a><a data-primary="types" data-secondary="conditional" data-tertiary="built-in" data-type="indexterm" id="calibre_link-1614" class="calibre4"></a> That’s why TypeScript ships with a few globally available conditional types out of the box:</p>
<dl class="preface">
<dt class="calibre18"><code class="calibre14">Exclude&lt;T, U&gt;</code></dt>
<dd class="calibre19">
<p class="author1">Like our <code class="calibre14">Without</code> type from before, computes those types in <code class="calibre14">T</code> that are not in <code class="calibre14">U</code>:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">A</code> <code class="o">=</code> <code class="kt">number</code> <code class="o">|</code> <code class="kt">string</code>
<code class="nx">type</code> <code class="nx">B</code> <code class="o">=</code> <code class="kt">string</code>
<code class="nx">type</code> <code class="nx">C</code> <code class="o">=</code> <code class="nx">Exclude</code><code class="o">&lt;</code><code class="nx">A</code><code class="p">,</code> <code class="nx">B</code><code class="o">&gt;</code>  <code class="c">// number</code></pre>
</dd>
<dt class="calibre18"><code class="calibre14">Extract&lt;T, U&gt;</code></dt>
<dd class="calibre19">
<p class="author1">Computes the types in <code class="calibre14">T</code> that you can assign to <code class="calibre14">U</code>:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">A</code> <code class="o">=</code> <code class="kt">number</code> <code class="o">|</code> <code class="kt">string</code>
<code class="nx">type</code> <code class="nx">B</code> <code class="o">=</code> <code class="kt">string</code>
<code class="nx">type</code> <code class="nx">C</code> <code class="o">=</code> <code class="nx">Extract</code><code class="o">&lt;</code><code class="nx">A</code><code class="p">,</code> <code class="nx">B</code><code class="o">&gt;</code>  <code class="c">// string</code></pre>
</dd>
<dt class="calibre18"><code class="calibre14">NonNullable&lt;T&gt;</code></dt>
<dd class="calibre19">
<p class="author1">Computes a version of <code class="calibre14">T</code> that excludes <code class="calibre14">null</code> and <code class="calibre14">undefined</code>:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">A</code> <code class="o">=</code> <code class="p">{</code><code class="nx">a?</code>: <code class="kt">number</code> <code class="o">|</code> <code class="kd">null</code><code class="p">}</code>
<code class="nx">type</code> <code class="nx">B</code> <code class="o">=</code> <code class="nx">NonNullable</code><code class="o">&lt;</code><code class="nx">A</code><code class="p">[</code><code class="s">'a'</code><code class="p">]</code><code class="o">&gt;</code>  <code class="c">// number</code></pre>
</dd>
<dt class="calibre18"><code class="calibre14">ReturnType&lt;F&gt;</code></dt>
<dd class="calibre19">
<p class="author1">Computes a function’s return type (note that this doesn’t work as you’d expect for generic and overloaded functions):</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">F</code> <code class="o">=</code> <code class="p">(</code><code class="nx">a</code>: <code class="kt">number</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="kt">string</code>
<code class="nx">type</code> <code class="nx">R</code> <code class="o">=</code> <code class="nx">ReturnType</code><code class="o">&lt;</code><code class="nx">F</code><code class="o">&gt;</code>  <code class="c">// string</code></pre>
</dd>
<dt class="calibre18"><code class="calibre14">InstanceType&lt;C&gt;</code></dt>
<dd class="calibre19">
<p class="author1">Computes the instance type of a class constructor:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">A</code> <code class="o">=</code> <code class="p">{</code><code class="kd">new</code><code class="p">()</code><code class="o">:</code> <code class="nx">B</code><code class="p">}</code>
<code class="nx">type</code> <code class="nx">B</code> <code class="o">=</code> <code class="p">{</code><code class="nx">b</code>: <code class="kt">number</code><code class="p">}</code>
<code class="nx">type</code> <code class="nx">I</code> <code class="o">=</code> <code class="nx">InstanceType</code><code class="o">&lt;</code><code class="nx">A</code><code class="o">&gt;</code>  <code class="c">// {b: number}</code></pre>
</dd>
</dl>
</div></section>





</div></section>













<section data-pdf-bookmark="Escape Hatches" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1879">
<h1 class="calibre13">Escape Hatches</h1>

<p class="author1">Sometimes you don’t have time to type something perfectly, and you just want TypeScript to trust that what you’re doing is safe.<a data-primary="conditional types" data-startref="ix_condtyp" data-type="indexterm" id="calibre_link-785" class="calibre4"></a><a data-primary="types" data-secondary="conditional" data-startref="ix_typecond" data-type="indexterm" id="calibre_link-1613" class="calibre4"></a><a data-primary="escape hatches" data-type="indexterm" id="calibre_link-961" class="calibre4"></a><a data-primary="types" data-secondary="escape hatches" data-type="indexterm" id="calibre_link-1622" class="calibre4"></a> Maybe a type declaration for a third party module you’re using is wrong and you want to test your code before contributing the fix back to DefinitelyTyped,<sup class="calibre15"><a data-type="noteref" href="#calibre_link-308" id="calibre_link-339" class="calibre16">4</a></sup> or maybe you’re getting data from an API and you haven’t regenerated type declarations with Apollo yet.</p>

<p class="author1">Luckily, TypeScript knows that we’re only human, and gives us a few escape hatches for when we just want to do something and don’t have time to prove to TypeScript that it’s safe.</p>
<div data-type="note" type="note" class="calibre21"><h6 class="calibre22">Note</h6>
<p class="author1">In case it’s not obvious, you should use the following TypeScript features as little as possible. If you find yourself relying on them, you might be doing something wrong.</p>
</div>








<section data-pdf-bookmark="Type Assertions" data-type="sect2" class="preface"><div class="preface" id="calibre_link-233">
<h2 class="calibre17">Type Assertions</h2>

<p class="author1">If you have a type <code class="calibre14">B</code> and <code class="calibre14">A &lt;: B &lt;: C</code>, then you can assert to the typechecker that <code class="calibre14">B</code> is actually an <code class="calibre14">A</code> or a <code class="calibre14">C</code>.<a data-primary="escape hatches" data-secondary="type assertions" data-type="indexterm" id="calibre_link-967" class="calibre4"></a><a data-primary="types" data-secondary="escape hatches" data-tertiary="type assertions" data-type="indexterm" id="calibre_link-1628" class="calibre4"></a> Notably, you can only assert that a type is a supertype or a subtype of itself&mdash;you can’t, for example, assert that a <code class="calibre14">number</code> is a <code class="calibre14">string</code>, because those types aren’t related.<a data-primary="assertions" data-secondary="type" data-type="indexterm" id="calibre_link-658" class="calibre4"></a></p>

<p class="author1">TypeScript gives us two syntaxes for type assertions:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code><code class="calibre14"> </code><code class="nx">formatInput</code><code class="p">(</code><code class="nx">input</code><code class="calibre14">: </code><code class="kt">string</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="c">// ...
</code><code class="p">}</code><code class="calibre14">

</code><code class="kd">function</code><code class="calibre14"> </code><code class="nx">getUserInput</code><code class="p">(</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="kt">string</code><code class="calibre14"> </code><code class="o">|</code><code class="calibre14"> </code><code class="kt">number</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="c">// ...
</code><code class="p">}</code><code class="calibre14">

</code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">input</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="nx">getUserInput</code><code class="p">(</code><code class="p">)</code><code class="calibre14">

</code><code class="c">// Assert that input is a string
</code><code class="nx">formatInput</code><code class="p">(</code><code class="nx">input</code><code class="calibre14"> </code><code class="kd">as</code><code class="calibre14"> </code><code class="kt">string</code><code class="p">)</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-309" id="calibre_link-311"><img alt="1" src="images/000000.png" class="calibre40" /></a><code class="calibre14">

</code><code class="c">// This is equivalent to
</code><code class="nx">formatInput</code><code class="p">(</code><code class="o">&lt;</code><code class="kt">string</code><code class="o">&gt;</code><code class="nx">input</code><code class="p">)</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-310" id="calibre_link-312"><img alt="2" src="images/000001.png" class="calibre40" /></a></pre>
<dl class="preface">
<dt class="calibre18"><a class="calibre4" href="#calibre_link-311" id="calibre_link-309"><img alt="1" src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We use a type assertion (<code class="calibre14">as</code>) to tell TypeScript that <code class="calibre14">input</code> is a <code class="calibre14">string</code>, not a <code class="calibre14">string | number</code> as the types would have us believe.<a data-primary="as (type assertion)" data-type="indexterm" id="calibre_link-654" class="calibre4"></a> You might do this, for example, if you want to quickly test out your <code class="calibre14">formatInput</code> function and you know for sure that <code class="calibre14">getUserInput</code> returns a <code class="calibre14">string</code> for your test.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-312" id="calibre_link-310"><img alt="2" src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">The legacy syntax for type assertions uses angle brackets.<a data-primary="&lt; &gt; (angle brackets)" data-secondary="in type assertions" data-type="indexterm" id="calibre_link-585" class="calibre4"></a> The two syntaxes are functionally equivalent.</p></dd>
</dl>
<div data-type="note" type="note" class="calibre21"><h6 class="calibre22">Note</h6>
<p class="author1">Prefer <code class="calibre14">as</code> syntax for type assertions over angle bracket (<code class="calibre14">&lt;&gt;</code>) syntax. The former is unambiguous, but the latter can clash with TSX syntax (see <a data-type="xref" href="#calibre_link-313" class="calibre4">“TSX = JSX + TypeScript”</a>). Use TSLint’s <a href="http://bit.ly/2WEGGKe" class="calibre4"><code class="calibre14">no-angle-bracket-type-assertion</code></a> rule to automatically enforce this for your codebase.<a data-primary="TSLint" data-secondary="no-angle-bracket-type-assertion rule" data-type="indexterm" id="calibre_link-1539" class="calibre4"></a></p>
</div>

<p class="author1">Sometimes, two types might not be sufficiently related, so you can’t assert that one is the other. To get around this, simply assert as <code class="calibre14">any</code> (remember from <a data-type="xref" href="#calibre_link-314" class="calibre4">“Assignability”</a> that <code class="calibre14">any</code> is assignable to anything), <a data-primary="any type" data-secondary="type assertions as" data-type="indexterm" id="calibre_link-631" class="calibre4"></a>then spend a few minutes in the corner thinking about what you’ve done:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">addToList</code><code class="p">(</code><code class="nx">list</code>: <code class="kt">string</code><code class="p">[],</code> <code class="nx">item</code>: <code class="kt">string</code><code class="p">)</code> <code class="p">{</code>
  <code class="c">// ...</code>
<code class="p">}</code>

<code class="nx">addToList</code><code class="p">(</code><code class="s">'this is really,'</code> <code class="kd">as</code> <code class="nx">any</code><code class="p">,</code> <code class="s">'really unsafe'</code><code class="p">)</code></pre>

<p class="author1">Clearly, type assertions are unsafe, and you should avoid using them when possible.<a data-primary="types" data-secondary="escape hatches" data-startref="ix_typeescta" data-tertiary="type assertions" data-type="indexterm" id="calibre_link-1629" class="calibre4"></a><a data-primary="escape hatches" data-secondary="type assertions" data-startref="ix_esctypass" data-type="indexterm" id="calibre_link-968" class="calibre4"></a></p>
</div></section>













<section data-pdf-bookmark="Nonnull Assertions" data-type="sect2" class="preface"><div class="preface" id="calibre_link-530">
<h2 class="calibre17">Nonnull Assertions</h2>

<p class="author1">For the special case of nullable types&mdash;that is, a type that’s <code class="calibre14">T | null</code> or <code class="calibre14">T | null | undefined</code>&mdash;TypeScript has special syntax for asserting that a value of that type is a <code class="calibre14">T</code>, and not <code class="calibre14">null</code> or <code class="calibre14">undefined</code>. This comes up in a few places.<a data-primary="escape hatches" data-secondary="nonnull assertions" data-type="indexterm" id="calibre_link-964" class="calibre4"></a><a data-primary="types" data-secondary="escape hatches" data-tertiary="nonnull assertions" data-type="indexterm" id="calibre_link-1625" class="calibre4"></a><a data-primary="null type" data-secondary="nonnull assertions" data-type="indexterm" id="calibre_link-1292" class="calibre4"></a><a data-primary="undefined type" data-secondary="nonnull assertions" data-type="indexterm" id="calibre_link-1713" class="calibre4"></a><a data-primary="nonnull assertions" data-type="indexterm" id="calibre_link-1283" class="calibre4"></a></p>

<p class="author1">For example, say we’ve written a framework for showing and hiding dialogs in a web app. Each dialog gets a unique ID, which we use to get a reference to the dialog’s DOM node. <a data-primary="dialog, closing with nonnull assertions" data-type="indexterm" id="calibre_link-842" class="calibre4"></a><a data-primary="assertions" data-secondary="nonnull" data-type="indexterm" id="calibre_link-657" class="calibre4"></a>Once a dialog is removed from the DOM, we delete its ID, indicating that it’s no longer live in the DOM:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code><code class="calibre14"> </code><code class="nx">Dialog</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="nx">id?</code><code class="calibre14">: </code><code class="kt">string</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">

</code><code class="kd">function</code><code class="calibre14"> </code><code class="nx">closeDialog</code><code class="p">(</code><code class="nx">dialog</code><code class="calibre14">: </code><code class="kt">Dialog</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="kd">if</code><code class="calibre14"> </code><code class="p">(</code><code class="o">!</code><code class="nx">dialog</code><code class="p">.</code><code class="nx">id</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-315" id="calibre_link-319"><img alt="1" src="images/000000.png" class="calibre40" /></a><code class="calibre14">
    </code><code class="kd">return</code><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">
  </code><code class="nx">setTimeout</code><code class="p">(</code><code class="p">(</code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-316" id="calibre_link-320"><img alt="2" src="images/000001.png" class="calibre40" /></a><code class="calibre14">
    </code><code class="nx">removeFromDOM</code><code class="p">(</code><code class="calibre14">
      </code><code class="nx">dialog</code><code class="p">,</code><code class="calibre14">
      </code><code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="nx">dialog</code><code class="p">.</code><code class="nx">id</code><code class="p">)</code><code class="calibre14"> </code><code class="c">// Error TS2345: Argument of type
</code><code class="calibre14">                                         </code><code class="c">// 'string | undefined' is not assignable
</code><code class="calibre14">                                         </code><code class="c">// to parameter of type 'string'. </code><a class="calibre4" href="#calibre_link-317" id="calibre_link-321"><img alt="3" src="images/000002.png" class="calibre40" /></a><code class="c">
</code><code class="calibre14">    </code><code class="p">)</code><code class="calibre14">
  </code><code class="p">)</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">

</code><code class="kd">function</code><code class="calibre14"> </code><code class="nx">removeFromDOM</code><code class="p">(</code><code class="nx">dialog</code><code class="calibre14">: </code><code class="kt">Dialog</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">element</code><code class="calibre14">: </code><code class="kt">Element</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="nx">element</code><code class="p">.</code><code class="nx">parentNode</code><code class="p">.</code><code class="nx">removeChild</code><code class="p">(</code><code class="nx">element</code><code class="p">)</code><code class="calibre14"> </code><code class="c">// Error TS2531: Object is possibly
</code><code class="calibre14">                                          </code><code class="c">//'null'. </code><a class="calibre4" href="#calibre_link-318" id="calibre_link-322"><img alt="4" src="images/000003.png" class="calibre40" /></a><code class="c">
</code><code class="calibre14">  </code><code class="kd">delete</code><code class="calibre14"> </code><code class="nx">dialog</code><code class="p">.</code><code class="nx">id</code><code class="calibre14">
</code><code class="p">}</code></pre>
<dl class="preface">
<dt class="calibre18"><a class="calibre4" href="#calibre_link-319" id="calibre_link-315"><img alt="1" src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">If the dialog is already deleted (so it has no <code class="calibre14">id</code>), we return early.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-320" id="calibre_link-316"><img alt="2" src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We remove<a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2345" data-type="indexterm" id="calibre_link-929" class="calibre4"></a><a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2531" data-type="indexterm" id="calibre_link-943" class="calibre4"></a> the dialog from the DOM on the next turn of the event loop, so that any other code that depends on <code class="calibre14">dialog</code> has a chance to finish running.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-321" id="calibre_link-317"><img alt="3" src="images/000002.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">Because we’re inside the arrow function, we’re now in a new scope. TypeScript doesn’t know if some code mutated <code class="calibre14">dialog</code> between <a class="calibre4" href="#calibre_link-319"><img alt="1" src="images/000000.png" class="calibre40" /></a> and <a class="calibre4" href="#calibre_link-321"><img alt="3" src="images/000002.png" class="calibre40" /></a>, so it invalidates the refinement we made in <a class="calibre4" href="#calibre_link-319"><img alt="1" src="images/000000.png" class="calibre40" /></a>. On top of that, while we know that if <code class="calibre14">dialog.id</code> is defined then an element with that ID definitely exists in the DOM (because we designed our framework that way), all TypeScript knows is that calling <code class="calibre14">document.</code><code class="calibre14"><span class="calibre">getElementById</span></code> returns an <code class="calibre14">HTMLElement | null</code>. We know it’ll always be a nonnullable <code class="calibre14">HTMLElement</code>, but TypeScript doesn’t know that&mdash;it only knows about the types we gave it.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-322" id="calibre_link-318"><img alt="4" src="images/000003.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">Similarly, while we know that the dialog is definitely in the DOM and it definitely has a parent DOM node, all TypeScript knows is that the type of <code class="calibre14">element.</code><code class="calibre14"><span class="calibre">parentNode</span></code> is <code class="calibre14">Node | null</code>.</p></dd>
</dl>

<p class="author1">One way to fix this is to add a bunch of <code class="calibre14">if (_ === null)</code> checks everywhere. While that’s the right way to do it if you’re unsure if something is <code class="calibre14">null</code> or not, TypeScript comes with special syntax for when you’re sure it’s not <code class="calibre14">null | undefined</code>:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<code class="nx">type</code><code class="calibre14"> </code><code class="nx">Dialog</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="nx">id?</code><code class="calibre14">: </code><code class="kt">string</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">

</code><code class="kd">function</code><code class="calibre14"> </code><code class="nx">closeDialog</code><code class="p">(</code><code class="nx">dialog</code><code class="calibre14">: </code><code class="kt">Dialog</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="kd">if</code><code class="calibre14"> </code><code class="p">(</code><code class="o">!</code><code class="nx">dialog</code><code class="p">.</code><code class="nx">id</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
    </code><code class="kd">return</code><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">
  </code><code class="nx">setTimeout</code><code class="p">(</code><code class="p">(</code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14">
    </code><code class="nx">removeFromDOM</code><code class="p">(</code><code class="calibre14">
      </code><code class="nx">dialog</code><code class="p">,</code><code class="calibre14">
      </code><code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="nx">dialog</code><code class="p">.</code><code class="nx">id</code><strong class="calibre49"><code class="o1">!</code></strong><code class="p">)</code><strong class="calibre49"><code class="o1">!</code></strong><code class="calibre14">
    </code><code class="p">)</code><code class="calibre14">
  </code><code class="p">)</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">

</code><code class="kd">function</code><code class="calibre14"> </code><code class="nx">removeFromDOM</code><code class="p">(</code><code class="nx">dialog</code><code class="calibre14">: </code><code class="kt">Dialog</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">element</code><code class="calibre14">: </code><code class="kt">Element</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="nx">element</code><code class="p">.</code><code class="nx">parentNode</code><strong class="calibre49"><code class="o1">!</code></strong><code class="p">.</code><code class="nx">removeChild</code><code class="p">(</code><code class="nx">element</code><code class="p">)</code><code class="calibre14">
  </code><code class="kd">delete</code><code class="calibre14"> </code><code class="nx">dialog</code><code class="p">.</code><code class="nx">id</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code></pre>

<p class="author1">Notice the <a data-primary="! (exclamation mark), nonnull assertion operator" data-type="indexterm" id="calibre_link-577" class="calibre4"></a>sprinkling of non<code class="calibre14">null</code> assertion operators (<code class="calibre14">!</code>) that tell TypeScript that we’re sure <code class="calibre14">dialog.id</code>, the result of our <code class="calibre14">document.getElementById</code> call, and <code class="calibre14">element.parentNode</code> are defined. When a non<code class="calibre14">null</code> assertion follows a type that might be <code class="calibre14">null</code> or <code class="calibre14">undefined</code>, TypeScript will assume that the type is defined: <code class="calibre14">T | null | undefined</code> becomes a <code class="calibre14">T</code>, <code class="calibre14">number | string | null</code> becomes <code class="calibre14">number | string</code>, and so on.</p>

<p class="author1">When you find yourself using non<code class="calibre14">null</code> assertions a lot, it’s often a sign that you should refactor your code. For example, we could get rid of an assertion by splitting <code class="calibre14">Dialog</code> into a union of two types:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">VisibleDialog</code> <code class="o">=</code> <code class="p">{</code><code class="nx">id</code>: <code class="kt">string</code><code class="p">}</code>
<code class="nx">type</code> <code class="nx">DestroyedDialog</code> <code class="o">=</code> <code class="p">{}</code>
<code class="nx">type</code> <code class="nx">Dialog</code> <code class="o">=</code> <code class="nx">VisibleDialog</code> <code class="o">|</code> <code class="nx">DestroyedDialog</code></pre>

<p class="author1">We can then update <code class="calibre14">closeDialog</code> to take advantage of the union:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<code class="kd">function</code><code class="calibre14"> </code><code class="nx">closeDialog</code><code class="p">(</code><code class="nx">dialog</code><code class="calibre14">: </code><code class="kt">Dialog</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="kd">if</code><code class="calibre14"> </code><code class="p">(</code><code class="o">!</code><strong class="calibre49"><code class="p1">(</code><code class="s1">'id'</code><code class="calibre50"> </code><code class="k">in</code><code class="calibre50"> </code><code class="nx1">dialog</code><code class="p1">)</code></strong><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
    </code><code class="kd">return</code><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">
  </code><code class="nx">setTimeout</code><code class="p">(</code><code class="p">(</code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14">
    </code><code class="nx">removeFromDOM</code><code class="p">(</code><code class="calibre14">
      </code><code class="nx">dialog</code><code class="p">,</code><code class="calibre14">
      </code><code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><strong class="calibre49"><code class="nx1">dialog</code><code class="p1">.</code><code class="nx1">id</code></strong><code class="p">)</code><code class="o">!</code><code class="calibre14">
    </code><code class="p">)</code><code class="calibre14">
  </code><code class="p">)</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">

</code><code class="kd">function</code><code class="calibre14"> </code><code class="nx">removeFromDOM</code><code class="p">(</code><code class="nx">dialog</code><code class="calibre14">: </code><strong class="calibre49"><code class="kt1">VisibleDialog</code></strong><code class="p">,</code><code class="calibre14"> </code><code class="nx">element</code><code class="calibre14">: </code><code class="kt">Element</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="nx">element</code><code class="p">.</code><code class="nx">parentNode</code><code class="o">!</code><code class="p">.</code><code class="nx">removeChild</code><code class="p">(</code><code class="nx">element</code><code class="p">)</code><code class="calibre14">
  </code><code class="kd">delete</code><code class="calibre14"> </code><code class="nx">dialog</code><code class="p">.</code><code class="nx">id</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code></pre>

<p class="author1">After we check that <code class="calibre14">dialog</code> has an <code class="calibre14">id</code> property defined&mdash;implying that it’s a <code class="calibre14">Visible</code><code class="calibre14"><span class="calibre">Dialog</span></code>&mdash;even inside the arrow function TypeScript knows that the reference to <code class="calibre14">dialog</code> hasn’t changed: the <code class="calibre14">dialog</code> inside the arrow function is the same <code class="calibre14">dialog</code> outside the function, so the refinement carries over instead of being invalidated like it was in the last example.</p>
</div></section>













<section data-pdf-bookmark="Definite Assignment Assertions" data-type="sect2" class="preface"><div class="preface" id="calibre_link-335">
<h2 class="calibre17">Definite Assignment Assertions</h2>

<p class="author1">TypeScript has special syntax for the special case of non<code class="calibre14">null</code> assertions for definite assignment checks (as a reminder, a definite assignment check is TypeScript’s way of making sure that by the time you use a variable, that variable has been assigned a value).<a data-primary="assertions" data-secondary="definite assignment" data-type="indexterm" id="calibre_link-656" class="calibre4"></a><a data-primary="escape hatches" data-secondary="definite assignment assertions" data-type="indexterm" id="calibre_link-963" class="calibre4"></a><a data-primary="types" data-secondary="escape hatches" data-tertiary="definite assignment assertions" data-type="indexterm" id="calibre_link-1624" class="calibre4"></a><a data-primary="definite assignment assertions" data-type="indexterm" id="calibre_link-834" class="calibre4"></a> For example:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">userId</code>: <code class="kt">string</code>

<code class="nx">userId</code><code class="p">.</code><code class="nx">toUpperCase</code><code class="p">()</code> <code class="c">// Error TS2454: Variable 'userId' is used</code>
                     <code class="c">// before being assigned.</code></pre>

<p class="author1">Clearly, TypeScript just did us a great service by<a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2454" data-type="indexterm" id="calibre_link-939" class="calibre4"></a> catching this error. We declared the variable <code class="calibre14">userId</code>, but forgot to assign a value to it before we tried to convert it to uppercase. This would have been a runtime error if TypeScript hadn’t noticed it!</p>

<p class="author1">But, what if our code looks more like this?</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<code class="kd">let</code><code class="calibre14"> </code><code class="nx">userId</code><code class="calibre14">: </code><code class="kt">string</code><code class="calibre14">
</code><strong class="calibre49"><code class="nx1">fetchUser</code><code class="p1">(</code><code class="p1">)</code></strong><code class="calibre14">

</code><code class="nx">userId</code><code class="p">.</code><code class="nx">toUpperCase</code><code class="p">(</code><code class="p">)</code><code class="calibre14"> </code><em class="calibre41"><code class="c2">// Error TS2454: Variable 'userId' is used</code></em><code class="c">
</code><code class="calibre14">                     </code><em class="calibre41"><code class="c2">// before being assigned.</code></em><code class="c">
</code><code class="calibre14">
</code><strong class="calibre49"><code class="k">function</code><code class="calibre50"> </code><code class="nx1">fetchUser() {</code><code class="calibre50">
  </code><code class="nx1">userId</code><code class="calibre50"> </code><code class="o1">=</code><code class="calibre50"> </code><code class="nx1">globalCache</code><code class="p1">.</code><code class="nx1">get</code><code class="p1">(</code><code class="s1">'userId'</code><code class="p1">)</code><code class="calibre50">
</code><code class="p1">}</code></strong><code class="calibre14">
</code></pre>

<p class="author1">We happen to have the world’s greatest cache, and when we query this cache we get a cache hit 100% of of the time. So after the call to <code class="calibre14">fetchUser</code>, <code class="calibre14">userId</code> is guaranteed to be defined. But TypeScript isn’t able to statically detect that, so it still throws the same error as before. We can use a definite assignment assertion to tell TypeScript that <code class="calibre14">userId</code> will definitely be assigned by the time we read it (notice the exclamation mark):</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<code class="kd">let</code><code class="calibre14"> </code><code class="nx">userId</code><strong class="calibre49"><code class="o1">!</code></strong><code class="o">:</code><code class="calibre14"> </code><code class="kt">string</code><code class="calibre14">
</code><code class="nx">fetchUser</code><code class="p">(</code><code class="p">)</code><code class="calibre14">

</code><code class="nx">userId</code><code class="p">.</code><code class="nx">toUpperCase</code><code class="p">(</code><code class="p">)</code><code class="calibre14"> </code><em class="calibre41"><code class="c2">// OK</code></em><code class="c">
</code><code class="calibre14">
</code><code class="kd">function</code><code class="calibre14"> </code><code class="nx">fetchUser() {</code><code class="calibre14">
  </code><code class="nx">userId</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="nx">globalCache</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s">'userId'</code><code class="p">)</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code></pre>

<p class="author1">As with type assertions and non<code class="calibre14">null</code> assertions, if you find yourself using definite assignment assertions often, you might be doing something wrong.<a data-primary="types" data-secondary="escape hatches" data-startref="ix_typeesc" data-type="indexterm" id="calibre_link-1623" class="calibre4"></a><a data-primary="escape hatches" data-startref="ix_esc" data-type="indexterm" id="calibre_link-962" class="calibre4"></a></p>
</div></section>





</div></section>













<section data-pdf-bookmark="Simulating Nominal Types" data-type="sect1" class="preface"><div class="preface" id="calibre_link-492">
<h1 class="calibre13">Simulating Nominal Types</h1>

<p class="author1">By this point in the book, if I were to shake you awake at three in the morning <a data-primary="nominal types, simulating" data-type="indexterm" id="calibre_link-1280" class="calibre4"></a>and yell “IS TYPESCRIPT’S TYPE SYSTEM STRUCTURAL OR NOMINAL?!” you’d yell back “OF COURSE IT’S STRUCTURAL! NOW GET OUT OF MY HOUSE OR I’LL CALL THE POLICE!”<a data-primary="types" data-secondary="escape hatches" data-tertiary="simulating nominal types" data-type="indexterm" id="calibre_link-1626" class="calibre4"></a><a data-primary="escape hatches" data-secondary="simulating nominal types" data-type="indexterm" id="calibre_link-965" class="calibre4"></a> That would be a fair response to me breaking in for early morning type system questions.</p>

<p class="author1">Laws aside, the reality is that sometimes nominal types really are useful. For example, let’s say you have a few <code class="calibre14">ID</code> types in your application, representing unique ways of addressing the different types of objects in your system:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">CompanyID</code> <code class="o">=</code> <code class="kt">string</code>
<code class="nx">type</code> <code class="nx">OrderID</code> <code class="o">=</code> <code class="kt">string</code>
<code class="nx">type</code> <code class="nx">UserID</code> <code class="o">=</code> <code class="kt">string</code>
<code class="nx">type</code> <code class="nx">ID</code> <code class="o">=</code> <code class="nx">CompanyID</code> <code class="o">|</code> <code class="nx">OrderID</code> <code class="o">|</code> <code class="nx">UserID</code></pre>

<p class="author1">A value of type <code class="calibre14">UserID</code> might be a simple hash that looks like <code class="calibre14">"d21b1dbf"</code>. So while you might alias it as <code class="calibre14">UserID</code>, under the hood it’s of course just a regular <code class="calibre14">string</code>. A function that takes a <code class="calibre14">UserID</code> might look like this:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">queryForUser</code><code class="p">(</code><code class="nx">id</code>: <code class="kt">UserID</code><code class="p">)</code> <code class="p">{</code>
  <code class="c">// ...</code>
<code class="p">}</code></pre>

<p class="author1">This is great documentation, and it helps other engineers on your team know for sure which type of <code class="calibre14">ID</code> they should pass in. But since <code class="calibre14">UserID</code> is just an alias for <code class="calibre14">string</code>, this approach does little to prevent bugs. An engineer might accidentally pass in the wrong type of <code class="calibre14">ID</code>, and the types system will be none the wiser!</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">id</code>: <code class="kt">CompanyID</code> <code class="o">=</code> <code class="s">'b4843361'</code>
<code class="nx">queryForUser</code><code class="p">(</code><code class="nx">id</code><code class="p">)</code> <code class="c">// OK (!!!)</code></pre>

<p class="author1">This is where <em class="calibre5">nominal types</em> come in handy.<sup class="calibre15"><a data-type="noteref" href="#calibre_link-323" id="calibre_link-341" class="calibre16">5</a></sup> While TypeScript doesn’t support nominal types out of the box, we can simulate them with a technique called <em class="calibre5">type branding</em>. <a data-primary="type branding" data-type="indexterm" id="calibre_link-1556" class="calibre4"></a>Type branding takes a little work to set up, and using it in TypeScript is not as smooth an experience as it is in languages that have built-in support for nominal type aliases. That said, branded types can make your program significantly safer.</p>
<div data-type="note" type="note" class="calibre21"><h6 class="calibre22">Note</h6>
<p class="author1">Depending on your application and the size of your engineering team (the larger your team, the more likely this technique will come in handy for preventing mistakes), you may not need to do this.</p>
</div>

<p class="author1">Start by creating a synthetic <em class="calibre5">type brand</em> for each of your nominal types:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<strong class="calibre49"><code class="nx1">type</code><code class="calibre50"> </code><code class="nx1">CompanyID</code><code class="calibre50"> </code><code class="o1">=</code><code class="calibre50"> </code><code class="kt1">string</code><code class="calibre50"> </code><code class="o1">&amp;</code><code class="calibre50"> </code><code class="p1">{</code><code class="nx1">readonly</code><code class="calibre50"> </code><code class="nx1">brand</code><code class="calibre50">: </code><code class="kt1">unique</code><code class="calibre50"> </code><code class="nx1">symbol</code><code class="p1">}</code><code class="calibre50">
</code><code class="nx1">type</code><code class="calibre50"> </code><code class="nx1">OrderID</code><code class="calibre50"> </code><code class="o1">=</code><code class="calibre50"> </code><code class="kt1">string</code><code class="calibre50"> </code><code class="o1">&amp;</code><code class="calibre50"> </code><code class="p1">{</code><code class="nx1">readonly</code><code class="calibre50"> </code><code class="nx1">brand</code><code class="calibre50">: </code><code class="kt1">unique</code><code class="calibre50"> </code><code class="nx1">symbol</code><code class="p1">}</code><code class="calibre50">
</code><code class="nx1">type</code><code class="calibre50"> </code><code class="nx1">UserID</code><code class="calibre50"> </code><code class="o1">=</code><code class="calibre50"> </code><code class="kt1">string</code><code class="calibre50"> </code><code class="o1">&amp;</code><code class="calibre50"> </code><code class="p1">{</code><code class="nx1">readonly</code><code class="calibre50"> </code><code class="nx1">brand</code><code class="calibre50">: </code><code class="kt1">unique</code><code class="calibre50"> </code><code class="nx1">symbol</code><code class="p1">}</code></strong><code class="calibre14">
</code><code class="nx">type</code><code class="calibre14"> </code><code class="nx">ID</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="nx">CompanyID</code><code class="calibre14"> </code><code class="o">|</code><code class="calibre14"> </code><code class="nx">OrderID</code><code class="calibre14"> </code><code class="o">|</code><code class="calibre14"> </code><code class="nx">UserID</code><code class="calibre14">
</code></pre>

<p class="author1">An intersection of <code class="calibre14">string</code> and <code class="calibre14">{readonly brand: unique symbol}</code> is, of course, gibberish. I chose it because it’s impossible to naturally construct that type, and the only way to create a value of that type is with an assertion. That’s the crucial property of branded types: they make it hard to accidentally use a wrong type in their place.<a data-primary="unique symbols" data-type="indexterm" id="calibre_link-1721" class="calibre4"></a> I used <code class="calibre14">unique symbol</code> as the “brand” because it’s one of two truly nominal kinds of types in TypeScript (the other is <code class="calibre14">enum</code>); I took an intersection of that brand with <code class="calibre14">string</code> so that we can assert that a given <code class="calibre14">string</code> is a given branded type.<a data-primary="enums" data-type="indexterm" id="calibre_link-866" class="calibre4"></a></p>

<p class="author1">We now need a way to create values of type <code class="calibre14">CompanyID</code>, <code class="calibre14">OrderID</code>, and <code class="calibre14">UserID</code>. To do that, we’ll use the companion object pattern (introduced in <a data-type="xref" href="#calibre_link-171" class="calibre4">“Companion Object Pattern”</a>). We’ll make a constructor for each branded type, using a type assertion to construct a value of each of our gibberish types:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">CompanyID</code><code class="p">(</code><code class="nx">id</code>: <code class="kt">string</code><code class="p">)</code> <code class="p">{</code>
  <code class="kd">return</code> <code class="nx">id</code> <code class="kd">as</code> <code class="nx">CompanyID</code>
<code class="p">}</code>

<code class="kd">function</code> <code class="nx">OrderID</code><code class="p">(</code><code class="nx">id</code>: <code class="kt">string</code><code class="p">)</code> <code class="p">{</code>
  <code class="kd">return</code> <code class="nx">id</code> <code class="kd">as</code> <code class="nx">OrderID</code>
<code class="p">}</code>

<code class="kd">function</code> <code class="nx">UserID</code><code class="p">(</code><code class="nx">id</code>: <code class="kt">string</code><code class="p">)</code> <code class="p">{</code>
  <code class="kd">return</code> <code class="nx">id</code> <code class="kd">as</code> <code class="nx">UserID</code>
<code class="p">}</code></pre>

<p class="author1">Finally, let’s see what it feels like to use these types:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">queryForUser</code><code class="p">(</code><code class="nx">id</code>: <code class="kt">UserID</code><code class="p">)</code> <code class="p">{</code>
  <code class="c">// ...</code>
<code class="p">}</code>

<code class="kd">let</code> <code class="nx">companyId</code> <code class="o">=</code> <code class="nx">CompanyID</code><code class="p">(</code><code class="s">'8a6076cf'</code><code class="p">)</code>
<code class="kd">let</code> <code class="nx">orderId</code> <code class="o">=</code> <code class="nx">OrderID</code><code class="p">(</code><code class="s">'9994acc1'</code><code class="p">)</code>
<code class="kd">let</code> <code class="nx">userId</code> <code class="o">=</code> <code class="nx">UserID</code><code class="p">(</code><code class="s">'d21b1dbf'</code><code class="p">)</code>

<code class="nx">queryForUser</code><code class="p">(</code><code class="nx">userId</code><code class="p">)</code>    <code class="c">// OK</code>
<code class="nx">queryForUser</code><code class="p">(</code><code class="nx">companyId</code><code class="p">)</code> <code class="c">// Error TS2345: Argument of type 'CompanyID' is not</code>
                        <code class="c">// assignable to parameter of type 'UserID'.</code></pre>

<p class="author1">What’s nice about this<a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2345" data-type="indexterm" id="calibre_link-930" class="calibre4"></a> approach is how little runtime overhead it has: just one function call per <code class="calibre14">ID</code> construction, which will probably be inlined by your JavaScript VM anyway. At runtime, each <code class="calibre14">ID</code> is simply a <code class="calibre14">string</code>&mdash;the brand is purely a compile-time construct.</p>

<p class="author1">Again, for most applications this approach is overkill. But for large applications, and when working with easily confused types like different kinds of IDs, branded types can be a killer safety feature.<a data-primary="escape hatches" data-secondary="simulating nominal types" data-startref="ix_escnom" data-type="indexterm" id="calibre_link-966" class="calibre4"></a><a data-primary="types" data-secondary="escape hatches" data-startref="ix_typeescnom" data-tertiary="simulating nominal types" data-type="indexterm" id="calibre_link-1627" class="calibre4"></a><a data-primary="nominal types, simulating" data-startref="ix_nomtype" data-type="indexterm" id="calibre_link-1281" class="calibre4"></a></p>
</div></section>













<section data-pdf-bookmark="Safely Extending the Prototype" data-type="sect1" class="preface"><div class="preface" id="calibre_link-513">
<h1 class="calibre13">Safely Extending the Prototype</h1>

<p class="author1">When building JavaScript applications, tradition holds that it’s unsafe to extend prototypes for built-in types.<a data-primary="prototypes, extending safely" data-type="indexterm" id="calibre_link-1395" class="calibre4"></a><a data-primary="types" data-secondary="extending the prototype safely" data-type="indexterm" id="calibre_link-1630" class="calibre4"></a> This rule of thumb goes back to before the days of jQuery, when wise JavaScript mages built libraries like <a href="https://mootools.net" class="calibre4">MooTools</a> that extended and overwrote built-in prototype methods directly. But when too many mages augmented prototypes at once, conflicts arose. And without static type systems, you’d only find out about these conflicts from angry users at runtime.</p>

<p class="author1">If you’re not coming from JavaScript, you may be surprised to learn that in JavaScript, you can modify any built-in method (like <code class="calibre14">[].push</code>, <code class="calibre14">'abc'.toUpperCase</code>, or <code class="calibre14">Object.assign</code>) at runtime. Because it’s such a dynamic language, JavaScript gives you direct access to prototypes for every built-in object&mdash;<code class="calibre14">Array.prototype</code>, <code class="calibre14">Function.prototype</code>, <code class="calibre14">Object.prototype</code>, and so on.<a data-primary="arrays" data-secondary="Array type, extending safely" data-type="indexterm" id="calibre_link-644" class="calibre4"></a></p>

<p class="author1">While back in the day extending these prototypes was unsafe, if your code is covered by a static type system like TypeScript, then you can now do it safely.<sup class="calibre15"><a data-type="noteref" href="#calibre_link-324" id="calibre_link-342" class="calibre16">6</a></sup></p>

<p class="author1">For example, we’ll add a <code class="calibre14">zip</code> method to the <code class="calibre14">Array</code> prototype. It takes two things to safely extend the prototype. First, in a <em class="calibre5">.ts</em> file (say, <em class="calibre5">zip.ts</em>), we extend the type of <code class="calibre14">Array</code>’s prototype; then, we augment the prototype with our new <code class="calibre14">zip</code> method:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// Tell TypeScript about .zip
</code><code class="kd">interface</code><code class="calibre14"> </code><code class="nb">Array</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-325" id="calibre_link-328"><img alt="1" src="images/000000.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="nx">zip</code><code class="o">&lt;</code><code class="nx">U</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">list</code><code class="calibre14">: </code><code class="kt">U</code><code class="p">[</code><code class="p">]</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="p">[</code><code class="nx">T</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">U</code><code class="p">]</code><code class="p">[</code><code class="p">]</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">

</code><code class="c">// Implement .zip
</code><code class="nb">Array</code><code class="p">.</code><code class="nx">prototype</code><code class="p">.</code><code class="nx">zip</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="kd">function</code><code class="o">&lt;</code><code class="nx">T</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">U</code><code class="o">&gt;</code><code class="p">(</code><code class="calibre14">
  </code><code class="kd">this</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">T</code><code class="p">[</code><code class="p">]</code><code class="p">,</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-326" id="calibre_link-333"><img alt="2" src="images/000001.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="nx">list</code><code class="calibre14">: </code><code class="kt">U</code><code class="p">[</code><code class="p">]</code><code class="calibre14">
</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="p">[</code><code class="nx">T</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">U</code><code class="p">]</code><code class="p">[</code><code class="p">]</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="kd">return</code><code class="calibre14"> </code><code class="kd">this</code><code class="p">.</code><code class="nx">map</code><code class="p">(</code><code class="p">(</code><code class="nx">v</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">k</code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14">
    </code><code class="nx">tuple</code><code class="p">(</code><code class="nx">v</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">list</code><code class="p">[</code><code class="nx">k</code><code class="p">]</code><code class="p">)</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-327" id="calibre_link-334"><img alt="3" src="images/000002.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="p">)</code><code class="calibre14">
</code><code class="p">}</code></pre>
<dl class="preface">
<dt class="calibre18"><a class="calibre4" href="#calibre_link-328" id="calibre_link-325"><img alt="1" src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We start by telling TypeScript that we’re adding <code class="calibre14">zip</code> to <code class="calibre14">Array</code>. We take advantage of interface merging (<a data-type="xref" href="#calibre_link-329" class="calibre4">“Declaration Merging”</a>) to augment the global <code class="calibre14">Array&lt;T&gt;</code> interface, adding our own <code class="calibre14">zip</code> method to the already globally defined interface.</p>

<p class="author1">Since our file doesn’t have any explicit imports or exports&mdash;meaning it’s in script mode, as described in <a data-type="xref" href="#calibre_link-330" class="calibre4">“Module Mode Versus Script Mode”</a>&mdash;we were able to augment the global <code class="calibre14">Array</code> interface directly by declaring an interface with the exact same name as the existing <code class="calibre14">Array&lt;T&gt;</code> interface, and letting TypeScript take care of merging the two for us. <a data-primary="import statements" data-type="indexterm" id="calibre_link-1093" class="calibre4"></a>If our file were in module mode (which might be the case if, for example, we needed to <code class="calibre14">import</code> something for our <code class="calibre14">zip</code> implementation), we’d have to wrap our global extension in a <code class="calibre14">declare global</code> type declaration (see <a data-type="xref" href="#calibre_link-331" class="calibre4">“Type Declarations”</a>):</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<strong class="calibre49"><code class="k">declare</code><code class="calibre50"> </code><code class="nx1">global</code><code class="calibre50"> </code><code class="p1">{</code></strong><code class="calibre14">
  </code><code class="kd">interface</code><code class="calibre14"> </code><code class="nb">Array</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
    </code><code class="nx">zip</code><code class="o">&lt;</code><code class="nx">U</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">list</code><code class="calibre14">: </code><code class="kt">U</code><code class="p">[</code><code class="p">]</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="p">[</code><code class="nx">T</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">U</code><code class="p">]</code><code class="p">[</code><code class="p">]</code><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">
</code><strong class="calibre49"><code class="p1">}</code></strong><code class="calibre14">
</code></pre>

<p class="author1"><code class="calibre14">global</code> is a special namespace containing all the globally<a data-primary="global namespace" data-type="indexterm" id="calibre_link-1081" class="calibre4"></a>  defined values (anything that you can use in a module-mode file without <code class="calibre14">import</code>ing it first; see <a data-type="xref" href="#calibre_link-332" class="calibre4">Chapter&nbsp;10</a>) that lets you augment names in the global scope from a file in module mode.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-333" id="calibre_link-326"><img alt="2" src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We then implement the <code class="calibre14">zip</code> method on <code class="calibre14">Array</code>’s prototype. We use a <code class="calibre14">this</code> type so that TypeScript correctly infers the <code class="calibre14">T</code> type of the array we’re calling <code class="calibre14">.zip</code> on.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-334" id="calibre_link-327"><img alt="3" src="images/000002.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">Because TypeScript infers the mapping function’s return type as <code class="calibre14">(T | U)[]</code> (TypeScript isn’t smart enough to realize that it’s in fact always a tuple with <code class="calibre14">T</code> in the zeroth index and <code class="calibre14">U</code> in the first), we use our <code class="calibre14">tuple</code> utility (from <a data-type="xref" href="#calibre_link-139" class="calibre4">“Improving Type Inference for Tuples”</a>) to create a tuple type without resorting to a type assertion.</p></dd>
</dl>

<p class="author1">Notice that when we declare <code class="calibre14">interface Array&lt;T&gt;</code> we augment the global <code class="calibre14">Array</code> namespace for our whole TypeScript project&mdash;meaning even if we don’t import <em class="calibre5">zip.ts</em> from our file, TypeScript will think that <code class="calibre14">[].zip</code> is available. But in order to augment <code class="calibre14">Array.prototype</code>, we have to be sure that whatever file uses <code class="calibre14">zip</code> loads <em class="calibre5">zip.ts</em> first, in order to install the <code class="calibre14">zip</code> method on <code class="calibre14">Array.prototype</code>. How do we make sure that any file that uses <code class="calibre14">zip</code> loads <em class="calibre5">zip.ts</em> first?</p>

<p class="author1">Easy: we update our <em class="calibre5">tsconfig.json</em> to explicitly exclude <em class="calibre5">zip.ts</em> from our project, so that consumers have to explicitly <code class="calibre14">import</code> it first:</p>

<pre data-code-language="json" data-type="programlisting" class="calibre30"><code class="p">{</code>
  <code class="err">*exclude*:</code> <code class="err">[</code>
    <code class="nt">"./zip.ts"</code>
  <code class="err">]</code>
<code class="p">}</code></pre>

<p class="author1">Now we can use <code class="calibre14">zip</code> as we please, with total safety:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">import</code> <code class="s">'./zip'</code>

<code class="p">[</code><code class="mi">1</code><code class="p">,</code> <code class="mi">2</code><code class="p">,</code> <code class="mi">3</code><code class="p">]</code>
  <code class="p">.</code><code class="nx">map</code><code class="p">(</code><code class="nx">n</code> <code class="o">=&gt;</code> <code class="nx">n</code> <code class="o">*</code> <code class="mi">2</code><code class="p">)</code>        <code class="c">// number[]</code>
  <code class="p">.</code><code class="nx">zip</code><code class="p">([</code><code class="s">'a'</code><code class="p">,</code> <code class="s">'b'</code><code class="p">,</code> <code class="s">'c'</code><code class="p">])</code>   <code class="c">// [number, string][]</code></pre>

<p class="author1">Running this gives us the result of first mapping, then zipping the array:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="p">[</code>
  <code class="p">[</code><code class="mi">2</code><code class="p">,</code> <code class="s">'a'</code><code class="p">],</code>
  <code class="p">[</code><code class="mi">4</code><code class="p">,</code> <code class="s">'b'</code><code class="p">],</code>
  <code class="p">[</code><code class="mi">6</code><code class="p">,</code> <code class="s">'c'</code><code class="p">]</code>
<code class="p">]</code></pre>
</div></section>













<section data-pdf-bookmark="Summary" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1880">
<h1 class="calibre13">Summary</h1>

<p class="author1">In this chapter we covered the most advanced features of TypeScript’s type system: from the ins and outs of variance to <a data-primary="prototypes, extending safely" data-startref="ix_protoext" data-type="indexterm" id="calibre_link-1396" class="calibre4"></a><a data-primary="types" data-secondary="extending the prototype safely" data-startref="ix_typeext" data-type="indexterm" id="calibre_link-1631" class="calibre4"></a>flow-based type inference, refinement, type widening, totality, and mapped and conditional types. We then derived a few advanced patterns for working with types: type branding to simulate nominal types, taking advantage of the distributive property of conditional types to operate on types at the type level, and safely extending prototypes.</p>

<p class="author1">If you didn’t understand or don’t remember everything, that’s OK&mdash;come back to this chapter later, and use it as a reference when you’re struggling with how to express something more safely.</p>
</div></section>













<section data-pdf-bookmark="Exercises" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1881">
<h1 class="calibre13">Exercises</h1>
<ol class="calibre31">
<li class="calibre32">
<p class="author1">For each of the following pairs of types, decide if the first type is assignable to the second type, and why or why not. Think about these in terms of subtyping and variance, and refer to the rules at the start of the chapter if you’re unsure (if you’re still unsure, just type it into your code editor to check!):</p>
<ol class="calibre46">
<li class="calibre47">
<p class="author1"><code class="calibre14">1</code> and <code class="calibre14">number</code></p>
</li>
<li class="calibre47">
<p class="author1"><code class="calibre14">number</code> and <code class="calibre14">1</code></p>
</li>
<li class="calibre47">
<p class="author1"><code class="calibre14">string</code> and <code class="calibre14">number | string</code></p>
</li>
<li class="calibre47">
<p class="author1"><code class="calibre14">boolean</code> and <code class="calibre14">number</code></p>
</li>
<li class="calibre47">
<p class="author1"><code class="calibre14">number[]</code> and <code class="calibre14">(number | string)[]</code></p>
</li>
<li class="calibre47">
<p class="author1"><code class="calibre14">(number | string)[]</code> and <code class="calibre14">number[]</code></p>
</li>
<li class="calibre47">
<p class="author1"><code class="calibre14">{a: true}</code> and <code class="calibre14">{a: boolean}</code></p>
</li>
<li class="calibre47">
<p class="author1"><code class="calibre14">{a: {b: [string]}}</code> and <code class="calibre14">{a: {b: [number | string]}}</code></p>
</li>
<li class="calibre47">
<p class="author1"><code class="calibre14">(a: number) =&gt; string</code> and <code class="calibre14">(b: number) =&gt; string</code></p>
</li>
<li class="calibre47">
<p class="author1"><code class="calibre14">(a: number) =&gt; string</code> and <code class="calibre14">(a: string) =&gt; string</code></p>
</li>
<li class="calibre47">
<p class="author1"><code class="calibre14">(a: number | string) =&gt; string</code> and <code class="calibre14">(a: string) =&gt; string</code></p>
</li>
<li class="calibre47">
<p class="author1"><code class="calibre14">E.X</code> (defined in an enum <code class="calibre14">enum E {X = 'X'}</code>) and <code class="calibre14">F.X</code> (defined in an enum <code class="calibre14">enum F {X = 'X'}</code>)</p>
</li>

</ol>
</li>
<li class="calibre32">
<p class="author1">If you have an object type <code class="calibre14">type O = {a: {b: {c: string}}}</code>, what’s the type of <code class="calibre14">keyof O</code>? What about <code class="calibre14">O['a']['b']</code>?</p>
</li>
<li class="calibre32">
<p class="author1">Write an <code class="calibre14">Exclusive&lt;T, U&gt;</code> type that computes the types that are in either <code class="calibre14">T</code> or <code class="calibre14">U</code>, but not both. For example, <code class="calibre14">Exclusive&lt;1 | 2 | 3, 2 | 3 | 4&gt;</code> should resolve to <code class="calibre14">1 | 4</code>. Write out step by step how the typechecker evaluates <code class="calibre14">Exclusive&lt;1 | 2, 2 | 4&gt;</code>.</p>
</li>
<li class="calibre32">
<p class="author1">Rewrite the example (from <a data-type="xref" href="#calibre_link-335" class="calibre4">“Definite Assignment Assertions”</a>) to avoid the definite assignment assertion.</p>
</li>

</ol>
</div></section>







<div data-type="footnotes" class="calibre26"><p data-type="footnote" id="calibre_link-245" class="calibre27"><sup class="calibre28"><a href="#calibre_link-336" class="calibre16">1</a></sup> Symbolic execution is a form of program analysis where you use a special program called a symbolic evaluator to run your program the same way a runtime would, but without assigning definite values to variables; instead, each variable is modelled as a <em class="calibre5">symbol</em> whose value gets constrained as the program runs. Symbolic execution lets you say things like “this variable is never used,” or “this function never returns,” or “in the positive branch of the <code class="calibre14">if</code> statement on line 102, variable <code class="calibre14">x</code> is guaranteed not to be <code class="calibre14">null</code>.”</p><p data-type="footnote" id="calibre_link-246" class="calibre27"><sup class="calibre28"><a href="#calibre_link-337" class="calibre16">2</a></sup> Flow-based type inference is supported by a handful of languages, including TypeScript, Flow, Kotlin, and Ceylon. It’s a way to refine types within a block of code, and is an alternative to C/Java-style explicit type annotations and Haskell/OCaml/Scala-style pattern matching. The idea is to take a symbolic execution engine and embed it right in the typechecker, in order to give feedback to the typechecker and reason through a program in a way that is closer to how a human programmer might do it.</p><p data-type="footnote" id="calibre_link-254" class="calibre27"><sup class="calibre28"><a href="#calibre_link-338" class="calibre16">3</a></sup> JavaScript has seven falsy values: <code class="calibre14">null</code>, <code class="calibre14">undefined</code>, <code class="calibre14">NaN</code>, <code class="calibre14">0</code>, <code class="calibre14">-0</code>, <code class="calibre14">""</code>, and of course, <code class="calibre14">false</code>. Everything else is <span class="calibre">truthy</span>.</p><p data-type="footnote" id="calibre_link-308" class="calibre27"><sup class="calibre28"><a href="#calibre_link-339" class="calibre16">4</a></sup> <a href="https://github.com/DefinitelyTyped/DefinitelyTyped" class="calibre4">DefinitelyTyped</a> is the open source repository for type declarations for third-party JavaScript. To learn more, jump ahead to <a data-type="xref" href="#calibre_link-340" class="calibre48">“JavaScript That Has Type Declarations on DefinitelyTyped”</a>.</p><p data-type="footnote" id="calibre_link-323" class="calibre27"><sup class="calibre28"><a href="#calibre_link-341" class="calibre16">5</a></sup> In some languages, these are also called <em class="calibre5">opaque types</em>.</p><p data-type="footnote" id="calibre_link-324" class="calibre27"><sup class="calibre28"><a href="#calibre_link-342" class="calibre16">6</a></sup> There are other reasons why you might want to avoid extending the prototype, like code portability, making your dependency graphs more explicit, or improving performance by only loading those methods that you actually use. However, safety is no longer one of those reasons.</p></div></div></section></div>

<div data-type="book" class="calibre1" id="calibre_link-343"><section data-pdf-bookmark="Chapter 7. Handling Errors" data-type="chapter" type="chapter" class="preface"><div class="preface" id="calibre_link-426">
<h1 class="calibre12"><span class="calibre">Chapter 7. </span>Handling Errors</h1>

<blockquote class="pcalibre2 pcalibre4 pcalibre3">
<p class="calibre52">A physicist, a structural engineer, and a programmer were in a car driving over a steep alpine pass when the brakes failed.<a data-primary="errors" data-secondary="handling" data-type="indexterm" id="calibre_link-877" class="calibre4"></a> The car went faster and faster, they were struggling to get around the corners, and once or twice the flimsy crash barrier saved them from tumbling down the side of the mountain. They were sure they were all going to die, when suddenly they spotted an escape lane. They pulled into the escape lane, and came safely to a halt.</p>

<p class="calibre52">The physicist said, “We need to model the friction in the brake pads and the resultant temperature rise, and see if we can work out why they failed.”</p>

<p class="calibre52">The structural engineer said, “I think I’ve got a few spanners in the back. I’ll take a look and see if I can work out what’s wrong.”</p>

<p class="calibre52">The programmer said, “Why don’t we see if it’s reproducible?”</p>
<p data-type="attribution" class="calibre51 pcalibre5">Anonymous</p>
</blockquote>

<p class="author1">TypeScript does everything it can to move runtime exceptions<a data-primary="runtime" data-secondary="exceptions" data-type="indexterm" id="calibre_link-1426" class="calibre4"></a><a data-primary="exceptions" data-type="indexterm" id="calibre_link-980" class="calibre4"></a> to compile time: from the rich type system it provides to the powerful static and symbolic analyses it performs, it works hard so you don’t have to spend your Friday nights debugging misspelled variables and null pointer exceptions (and so your on-call coworker doesn’t have to be late to their great aunt’s birthday party because of it).</p>

<p class="author1">Unfortunately, regardless of what language you write in, sometimes runtime exceptions do sneak through. TypeScript is really good about preventing them, but even it can’t prevent things like network and filesystem failures, errors parsing user input, stack overflows, and out of memory errors. What it does do&mdash;thanks to its lush type system&mdash;is give you lots of ways to deal with the runtime errors that end up making it through.</p>

<p class="author1">In this chapter <a data-primary="exceptions" data-secondary="handling" data-seealso="errors, handling" data-type="indexterm" id="calibre_link-981" class="calibre4"></a>I’ll walk you through the most common patterns for representing and handling errors in TypeScript:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">Returning <code class="calibre14">null</code></p>
</li>
<li class="calibre11">
<p class="author1">Throwing exceptions</p>
</li>
<li class="calibre11">
<p class="author1">Returning exceptions</p>
</li>
<li class="calibre11">
<p class="author1">The <code class="calibre14">Option</code> type</p>
</li>
</ul>

<p class="author1">Which mechanism you use is up to you, and depends on your application. As I cover each error-handling mechanism, I’ll talk about its pros and cons so you can make the right choice for yourself.</p>






<section data-pdf-bookmark="Returning null" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1882">
<h1 class="calibre13">Returning null</h1>

<p class="author1">We’re going to write a program that asks a user for their birthday, which we will then<a data-primary="errors" data-secondary="handling" data-tertiary="returning null" data-type="indexterm" id="calibre_link-882" class="calibre4"></a><a data-primary="null type" data-secondary="function returning null" data-type="indexterm" id="calibre_link-1291" class="calibre4"></a> parse into a <code class="calibre14">Date</code> object:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">ask() {</code>
  <code class="kd">return</code> <code class="nx">prompt</code><code class="p">(</code><code class="s">'When is your birthday?'</code><code class="p">)</code>
<code class="p">}</code>

<code class="kd">function</code> <code class="nx">parse</code><code class="p">(</code><code class="nx">birthday</code>: <code class="kt">string</code><code class="p">)</code><code class="o">:</code> <code class="nb">Date</code> <code class="p">{</code>
  <code class="kd">return</code> <code class="kd">new</code> <code class="nb">Date</code><code class="p">(</code><code class="nx">birthday</code><code class="p">)</code>
<code class="p">}</code>

<code class="kd">let</code> <code class="nx">date</code> <code class="o">=</code> <code class="nx">parse</code><code class="p">(</code><code class="nx">ask</code><code class="p">())</code>
<code class="nx">console</code><code class="p">.</code><code class="nx">info</code><code class="p">(</code><code class="s">'Date is'</code><code class="p">,</code> <code class="nx">date</code><code class="p">.</code><code class="nx">toISOString</code><code class="p">())</code></pre>

<p class="author1">We should probably validate the date the user entered&mdash;it’s just a text prompt, after all:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<em class="calibre41"><code class="c2">// ...</code></em><code class="c">
</code><code class="kd">function</code><code class="calibre14"> </code><code class="nx">parse</code><code class="p">(</code><code class="nx">birthday</code><code class="calibre14">: </code><code class="kt">string</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="nb">Date</code><code class="calibre14"> </code><strong class="calibre49"><code class="o1">|</code><code class="calibre50"> </code><code class="k">null</code></strong><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><strong class="calibre49"><code class="k">let</code><code class="calibre50"> </code><code class="nx1">date</code><code class="calibre50"> </code><code class="o1">=</code><code class="calibre50"> </code><code class="k">new</code><code class="calibre50"> </code><code class="nb1">Date</code><code class="p1">(</code><code class="nx1">birthday</code><code class="p1">)</code><code class="calibre50">
  </code><code class="k">if</code><code class="calibre50"> </code><code class="p1">(</code><code class="o1">!</code><code class="nx1">isValid</code><code class="p1">(</code><code class="nx1">date</code><code class="p1">)</code><code class="p1">)</code><code class="calibre50"> </code><code class="p1">{</code><code class="calibre50">
    </code><code class="k">return</code><code class="calibre50"> </code><code class="k">null</code><code class="calibre50">
  </code><code class="p1">}</code></strong><code class="calibre14">
  </code><code class="kd">return</code><code class="calibre14"> </code><strong class="calibre49"><code class="nx1">date</code></strong><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">

</code><code class="c">// </code><em class="calibre41"><code class="c2">Checks if the given date is valid</code></em><code class="c">
</code><strong class="calibre49"><code class="k">function</code><code class="calibre50"> </code><code class="nx1">isValid</code><code class="p1">(</code><code class="nx1">date</code><code class="calibre50">: </code><code class="kt1">Date</code><code class="p1">)</code><code class="calibre50"> </code><code class="p1">{</code><code class="calibre50">
  </code><code class="k">return</code><code class="calibre50"> </code><code class="nb1">Object</code><code class="p1">.</code><code class="nx1">prototype</code><code class="p1">.</code><code class="nx1">toString</code><code class="p1">.</code><code class="nx1">call</code><code class="p1">(</code><code class="nx1">date</code><code class="p1">)</code><code class="calibre50"> </code><code class="o1">===</code><code class="calibre50"> </code><code class="s1">'[object Date]'</code><code class="calibre50">
      </code><code class="o1">&amp;&amp;</code><code class="calibre50"> </code><code class="o1">!</code><code class="nb1">Number</code><code class="p1">.</code><code class="nb1">isNaN</code><code class="p1">(</code><code class="nx1">date</code><code class="p1">.</code><code class="nx1">getTime</code><code class="p1">(</code><code class="p1">)</code><code class="p1">)</code><code class="calibre50">
</code><code class="p1">}</code></strong><code class="calibre14">
</code></pre>

<p class="author1">When we consume this, we’re forced to first check if the result is <code class="calibre14">null</code> before we can use it:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<code class="c">// ...
</code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">date</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="nx">parse</code><code class="p">(</code><code class="nx">ask</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code class="calibre14">
</code><strong class="calibre49"><code class="k">if</code><code class="calibre50"> </code><code class="p1">(</code><code class="nx1">date</code><code class="p1">)</code><code class="calibre50"> </code><code class="p1">{</code></strong><code class="calibre14">
  </code><code class="nx">console</code><code class="p">.</code><code class="nx">info</code><code class="p">(</code><code class="s">'Date is'</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">date</code><code class="p">.</code><code class="nx">toISOString</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code class="calibre14">
</code><strong class="calibre49"><code class="p1">}</code><code class="calibre50"> </code><code class="k">else</code><code class="calibre50"> </code><code class="p1">{</code><code class="calibre50">
  </code><code class="nx1">console</code><code class="p1">.</code><code class="nx1">error</code><code class="p1">(</code><code class="s1">'Error parsing date for some reason'</code><code class="p1">)</code><code class="calibre50">
</code><code class="p1">}</code></strong><code class="calibre14">
</code></pre>

<p class="author1">Returning <code class="calibre14">null</code> is the most lightweight way to handle errors in a typesafe way. Valid user input results in a <code class="calibre14">Date</code>, invalid user input in a <code class="calibre14">null</code>, and the type system checks for us that we handled both.</p>

<p class="author1">However, we lose some information doing it this way <code class="calibre14">parse</code> doesn’t tell us why exactly the operation failed, which stinks for whatever engineer has to comb through our logs to debug this, as well as the user who gets a pop up saying that there was an “Error parsing date for some reason” rather than a specific, actionable error like “Enter a date in the form YYYY/MM/DD.”</p>

<p class="author1">Returning <code class="calibre14">null</code> is also difficult to compose: having to check for <code class="calibre14">null</code> after every operation can become verbose as you start to nest and chain operations.</p>
</div></section>













<section data-pdf-bookmark="Throwing Exceptions" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1883">
<h1 class="calibre13">Throwing Exceptions</h1>

<p class="author1">Let’s throw an exception instead of returning <code class="calibre14">null</code>, so that we can handle specific failure modes and have some metadata about the failure so we can debug it more easily.<a data-primary="errors" data-secondary="handling" data-tertiary="throwing exceptions" data-type="indexterm" id="calibre_link-883" class="calibre4"></a><a data-primary="exceptions" data-secondary="throwing" data-type="indexterm" id="calibre_link-985" class="calibre4"></a></p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<em class="calibre41"><code class="c2">// ...</code></em><code class="c">
</code><code class="kd">function</code><code class="calibre14"> </code><code class="nx">parse</code><code class="p">(</code><code class="nx">birthday</code><code class="calibre14">: </code><code class="kt">string</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><strong class="calibre49"><code class="nb1">Date</code></strong><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">date</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="kd">new</code><code class="calibre14"> </code><code class="nb">Date</code><code class="p">(</code><code class="nx">birthday</code><code class="p">)</code><code class="calibre14">
  </code><code class="kd">if</code><code class="calibre14"> </code><code class="p">(</code><code class="o">!</code><code class="nx">isValid</code><code class="p">(</code><code class="nx">date</code><code class="p">)</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
    </code><strong class="calibre49"><code class="k">throw</code><code class="calibre50"> </code><code class="k">new</code><code class="calibre50"> </code><code class="nx1">RangeError</code><code class="p1">(</code><code class="s1">'Enter a date in the form YYYY/MM/DD'</code><code class="p1">)</code></strong><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">
  </code><code class="kd">return</code><code class="calibre14"> </code><code class="nx">date</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code></pre>

<p class="author1">Now when we consume this code, we need to be careful to catch the exception so that we can handle it <a data-primary="try/catch statements" data-type="indexterm" id="calibre_link-1494" class="calibre4"></a>gracefully without crashing our whole application:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<em class="calibre41"><code class="c2">// ...</code></em><code class="c">
</code><strong class="calibre49"><code class="k">try</code><code class="calibre50"> </code><code class="p1">{</code></strong><code class="calibre14">
  </code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">date</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="nx">parse</code><code class="p">(</code><code class="nx">ask</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code class="calibre14">
  </code><code class="nx">console</code><code class="p">.</code><code class="nx">info</code><code class="p">(</code><code class="s">'Date is'</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">date</code><code class="p">.</code><code class="nx">toISOString</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code class="calibre14">
</code><strong class="calibre49"><code class="p1">}</code><code class="calibre50"> </code><code class="k">catch</code><code class="calibre50"> </code><code class="p1">(</code><code class="nx1">e</code><code class="p1">)</code><code class="calibre50"> </code><code class="p1">{</code><code class="calibre50">
  </code><code class="nx1">console</code><code class="p1">.</code><code class="nx1">error</code><code class="p1">(</code><code class="nx1">e</code><code class="p1">.</code><code class="nx1">message</code><code class="p1">)</code><code class="calibre50">
</code><code class="p1">}</code></strong><code class="calibre14">
</code></pre>

<p class="author1">We probably want to be careful to rethrow other exceptions, so we don’t silently swallow every possible error:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<em class="calibre41"><code class="c2">// ...</code></em><code class="c">
</code><code class="kd">try</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">date</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="nx">parse</code><code class="p">(</code><code class="nx">ask</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code class="calibre14">
  </code><code class="nx">console</code><code class="p">.</code><code class="nx">info</code><code class="p">(</code><code class="s">'Date is'</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">date</code><code class="p">.</code><code class="nx">toISOString</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14"> </code><code class="kd">catch</code><code class="calibre14"> </code><code class="p">(</code><code class="nx">e</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><strong class="calibre49"><code class="k">if</code><code class="calibre50"> </code><code class="p1">(</code><code class="nx1">e</code><code class="calibre50"> </code><code class="k">instanceof</code><code class="calibre50"> </code><code class="nx1">RangeError</code><code class="p1">)</code><code class="calibre50"> </code><code class="p1">{</code></strong><code class="calibre14">
    </code><code class="nx">console</code><code class="p">.</code><code class="nx">error</code><code class="p">(</code><code class="nx">e</code><code class="p">.</code><code class="nx">message</code><code class="p">)</code><code class="calibre14">
  </code><strong class="calibre49"><code class="p1">}</code><code class="calibre50"> </code><code class="k">else</code><code class="calibre50"> </code><code class="p1">{</code><code class="calibre50">
    </code><code class="k">throw</code><code class="calibre50"> </code><code class="nx1">e</code><code class="calibre50">
  </code><code class="p1">}</code></strong><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code></pre>

<p class="author1">We might want to subclass the error for something more specific, so that when another engineer changes <code class="calibre14">parse</code> or <code class="calibre14">ask</code> to throw other <code class="calibre14">RangeError</code>s, we can differentiate between our error and the one they added:</p>
<pre data-type="programlisting" class="calibre30">
<em class="calibre41"><code class="c2">// ...</code></em><code class="c">
</code><code class="calibre14">
</code><em class="calibre41"><code class="c2">// Custom error types
</code></em><strong class="calibre49"><code class="k">class</code><code class="calibre50"> </code><code class="nx1">InvalidDateFormatError</code><code class="calibre50"> </code><code class="k">extends</code><code class="calibre50"> </code><code class="nx1">RangeError</code><code class="calibre50"> </code><code class="p1">{</code><code class="p1">}</code><code class="calibre50">
</code><code class="k">class</code><code class="calibre50"> </code><code class="nx1">DateIsInTheFutureError</code><code class="calibre50"> </code><code class="k">extends</code><code class="calibre50"> </code><code class="nx1">RangeError</code><code class="calibre50"> </code><code class="p1">{</code><code class="p1">}</code></strong><code class="calibre14">

</code><code class="kd">function</code><code class="calibre14"> </code><code class="nx">parse</code><code class="p">(</code><code class="nx">birthday</code><code class="calibre14">: </code><code class="kt">string</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="nb">Date</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">date</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="kd">new</code><code class="calibre14"> </code><code class="nb">Date</code><code class="p">(</code><code class="nx">birthday</code><code class="p">)</code><code class="calibre14">
  </code><code class="kd">if</code><code class="calibre14"> </code><code class="p">(</code><code class="o">!</code><code class="nx">isValid</code><code class="p">(</code><code class="nx">date</code><code class="p">)</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
    </code><code class="kd">throw</code><code class="calibre14"> </code><strong class="calibre49"><code class="k">new</code><code class="calibre50"> </code><code class="nx1">InvalidDateFormatError</code></strong><code class="p">(</code><code class="s">'Enter a date in the form YYYY/MM/DD'</code><code class="p">)</code><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">
  </code><strong class="calibre49"><code class="k">if</code><code class="calibre50"> </code><code class="p1">(</code><code class="nx1">date</code><code class="p1">.</code><code class="nx1">getTime</code><code class="p1">(</code><code class="p1">)</code><code class="calibre50"> </code><code class="o1">&gt;</code><code class="calibre50"> </code><code class="nb1">Date</code><code class="p1">.</code><code class="nx1">now</code><code class="p1">(</code><code class="p1">)</code><code class="p1">)</code><code class="calibre50"> </code><code class="p1">{</code><code class="calibre50">
    </code><code class="k">throw</code><code class="calibre50"> </code><code class="k">new</code><code class="calibre50"> </code><code class="nx1">DateIsInTheFutureError</code><code class="p1">(</code><code class="s1">'Are you a timelord?'</code><code class="p1">)</code><code class="calibre50">
  </code><code class="p1">}</code></strong><code class="calibre14">
  </code><code class="kd">return</code><code class="calibre14"> </code><code class="nx">date</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">

</code><code class="kd">try</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">date</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="nx">parse</code><code class="p">(</code><code class="nx">ask</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code class="calibre14">
  </code><code class="nx">console</code><code class="p">.</code><code class="nx">info</code><code class="p">(</code><code class="s">'Date is'</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">date</code><code class="p">.</code><code class="nx">toISOString</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14"> </code><code class="kd">catch</code><code class="calibre14"> </code><code class="p">(</code><code class="nx">e</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="kd">if</code><code class="calibre14"> </code><code class="p">(</code><code class="nx">e</code><code class="calibre14"> </code><code class="kd">instanceof</code><code class="calibre14"> </code><strong class="calibre49"><code class="nx1">InvalidDateFormatError</code></strong><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
    </code><code class="nx">console</code><code class="p">.</code><code class="nx">error</code><code class="p">(</code><code class="nx">e</code><code class="p">.</code><code class="nx">message</code><code class="p">)</code><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14"> </code><strong class="calibre49"><code class="k">else</code><code class="calibre50"> </code><code class="k">if</code><code class="calibre50"> </code><code class="p1">(</code><code class="nx1">e</code><code class="calibre50"> </code><code class="k">instanceof</code><code class="calibre50"> </code><code class="nx1">DateIsInTheFutureError</code><code class="p1">)</code><code class="calibre50"> </code><code class="p1">{</code><code class="calibre50">
    </code><code class="nx1">console</code><code class="p1">.</code><code class="nx1">info</code><code class="p1">(</code><code class="nx1">e</code><code class="p1">.</code><code class="nx1">message</code><code class="p1">)</code></strong><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14"> </code><code class="kd">else</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
    </code><code class="kd">throw</code><code class="calibre14"> </code><code class="nx">e</code><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code>
</pre>

<p class="author1">Looking good. We can now do more than just signal that something failed: we can use a custom error to indicate <em class="calibre5">why</em> it failed. These errors might come in handy when combing through our server logs to debug an issue, or we can map them to specific error dialogs to give our users actionable feedback about what they did wrong and how they can fix it. We can also effectively chain and nest operations by wrapping any number of operations in a single <code class="calibre14">try</code>/<code class="calibre14">catch</code> (we don’t have to check each operation for failure, like we did when returning <code class="calibre14">null</code>).</p>

<p class="author1">What does it feel like to use this code? Say the big <code class="calibre14">try</code>/<code class="calibre14">catch</code> is in one file, and the rest of the code is in a library being imported from somewhere else. How would an engineer know to catch those specific types of errors (<code class="calibre14">InvalidDateFormatError</code> and <code class="calibre14">DateIsInTheFutureError</code>), or to even just check for a regular old <code class="calibre14">RangeError</code>? (Remember that TypeScript doesn’t encode exceptions as part of a function’s signature.) We could indicate it in our function’s name (<code class="calibre14">parseThrows</code>), or include it in a docblock:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<strong class="calibre49"><code class="c3">/**
 * @throws {InvalidDateFormatError} The user entered their birthday incorrectly.
 * @throws {DateIsInTheFutureError} The user entered a birthday in the future.
 */</code></strong><code class="calibre14">
</code><code class="kd">function</code><code class="calibre14"> </code><code class="nx">parse</code><code class="p">(</code><code class="nx">birthday</code><code class="calibre14">: </code><code class="kt">string</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="nb">Date</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><em class="calibre41"><code class="c2">// ...</code></em><code class="c">
</code></pre>

<p class="author1">But in practice, an engineer probably wouldn’t wrap this code in a <code class="calibre14">try</code>/<code class="calibre14">catch</code> and check for exceptions at all, because engineers are lazy (at least, I am), and the type system isn’t telling them that they missed a case and should handle it. Sometimes, though&mdash;like in this example&mdash;errors are so expected that downstream code really should handle them, lest they cause the program to crash.</p>

<p class="author1">How else can we indicate to consumers that they should handle both the success and the error cases?<a data-primary="errors" data-secondary="handling" data-startref="ix_errhanthrexc" data-tertiary="throwing exceptions" data-type="indexterm" id="calibre_link-884" class="calibre4"></a><a data-primary="exceptions" data-secondary="throwing" data-startref="ix_excptthrow" data-type="indexterm" id="calibre_link-986" class="calibre4"></a></p>
</div></section>













<section data-pdf-bookmark="Returning Exceptions" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1884">
<h1 class="calibre13">Returning Exceptions</h1>

<p class="author1">TypeScript isn’t Java,<a data-primary="errors" data-secondary="handling" data-tertiary="returning exceptions" data-type="indexterm" id="calibre_link-880" class="calibre4"></a><a data-primary="exceptions" data-secondary="returning" data-type="indexterm" id="calibre_link-983" class="calibre4"></a> and doesn’t support <code class="calibre14">throws</code> clauses.<sup class="calibre15"><a data-type="noteref" href="#calibre_link-344" id="calibre_link-369" class="calibre16">1</a></sup> But we can achieve something similar with union types:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<code class="c">// ...
</code><code class="kd">function</code><code class="calibre14"> </code><code class="nx">parse</code><code class="p">(</code><code class="calibre14">
  </code><code class="nx">birthday</code><code class="calibre14">: </code><code class="kt">string</code><code class="calibre14">
</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="nb">Date</code><code class="calibre14"> </code><strong class="calibre49"><code class="o1">|</code><code class="calibre50"> </code><code class="nx1">InvalidDateFormatError</code><code class="calibre50"> </code><code class="o1">|</code><code class="calibre50"> </code><code class="nx1">DateIsInTheFutureError</code></strong><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">date</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="kd">new</code><code class="calibre14"> </code><code class="nb">Date</code><code class="p">(</code><code class="nx">birthday</code><code class="p">)</code><code class="calibre14">
  </code><code class="kd">if</code><code class="calibre14"> </code><code class="p">(</code><code class="o">!</code><code class="nx">isValid</code><code class="p">(</code><code class="nx">date</code><code class="p">)</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
    </code><strong class="calibre49"><code class="k">return</code></strong><code class="calibre14"> </code><code class="kd">new</code><code class="calibre14"> </code><code class="nx">InvalidDateFormatError</code><code class="p">(</code><code class="s">'Enter a date in the form YYYY/MM/DD'</code><code class="p">)</code><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">
  </code><code class="kd">if</code><code class="calibre14"> </code><code class="p">(</code><code class="nx">date</code><code class="p">.</code><code class="nx">getTime</code><code class="p">(</code><code class="p">)</code><code class="calibre14"> </code><code class="o">&gt;</code><code class="calibre14"> </code><code class="nb">Date</code><code class="p">.</code><code class="nx">now</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
    </code><strong class="calibre49"><code class="k">return</code></strong><code class="calibre14"> </code><code class="kd">new</code><code class="calibre14"> </code><code class="nx">DateIsInTheFutureError</code><code class="p">(</code><code class="s">'Are you a timelord?'</code><code class="p">)</code><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">
  </code><code class="kd">return</code><code class="calibre14"> </code><code class="nx">date</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code></pre>

<p class="author1">Now a consumer is forced to handle all three cases&mdash;<code class="calibre14">InvalidDateFormatError</code>, <code class="calibre14">DateIsInTheFutureError</code>, and successful parse&mdash;or they’ll get a <code class="calibre14">TypeError</code> at compile time:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// ...</code>
<code class="kd">let</code> <code class="nx">result</code> <code class="o">=</code> <code class="nx">parse</code><code class="p">(</code><code class="nx">ask</code><code class="p">())</code> <code class="c">// Either a date or an error</code>
<code class="kd">if</code> <code class="p">(</code><code class="nx">result</code> <code class="kd">instanceof</code> <code class="nx">InvalidDateFormatError</code><code class="p">)</code> <code class="p">{</code>
  <code class="nx">console</code><code class="p">.</code><code class="nx">error</code><code class="p">(</code><code class="nx">result</code><code class="p">.</code><code class="nx">message</code><code class="p">)</code>
<code class="p">}</code> <code class="kd">else</code> <code class="kd">if</code> <code class="p">(</code><code class="nx">result</code> <code class="kd">instanceof</code> <code class="nx">DateIsInTheFutureError</code><code class="p">)</code> <code class="p">{</code>
  <code class="nx">console</code><code class="p">.</code><code class="nx">info</code><code class="p">(</code><code class="nx">result</code><code class="p">.</code><code class="nx">message</code><code class="p">)</code>
<code class="p">}</code> <code class="kd">else</code> <code class="p">{</code>
  <code class="nx">console</code><code class="p">.</code><code class="nx">info</code><code class="p">(</code><code class="s">'Date is'</code><code class="p">,</code> <code class="nx">result</code><code class="p">.</code><code class="nx">toISOString</code><code class="p">())</code>
<code class="p">}</code></pre>

<p class="author1">Here, we successfully took advantage of TypeScript’s type system to:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">Encode likely exceptions in <code class="calibre14">parse</code>’s signature.</p>
</li>
<li class="calibre11">
<p class="author1">Communicate to consumers which specific exceptions might be thrown.</p>
</li>
<li class="calibre11">
<p class="author1">Force consumers to handle (or rethrow) each of the exceptions.</p>
</li>
</ul>

<p class="author1">A lazy consumer can avoid handling each error individually. But they have to do so explicitly:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<em class="calibre41"><code class="c2">// ...</code></em><code class="c">
</code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">result</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="nx">parse</code><code class="p">(</code><code class="nx">ask</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code class="calibre14"> </code><code class="c">// Either a date or an error
</code><code class="kd">if</code><code class="calibre14"> </code><code class="p">(</code><code class="nx">result</code><code class="calibre14"> </code><code class="kd">instanceof</code><code class="calibre14"> </code><strong class="calibre49"><code class="nb1">Error</code></strong><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="nx">console</code><code class="p">.</code><code class="nx">error</code><code class="p">(</code><code class="nx">result</code><code class="p">.</code><code class="nx">message</code><code class="p">)</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14"> </code><code class="kd">else</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="nx">console</code><code class="p">.</code><code class="nx">info</code><code class="p">(</code><code class="s">'Date is'</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">result</code><code class="p">.</code><code class="nx">toISOString</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code></pre>

<p class="author1">Of course, your program might still crash due to an out of memory error or a stack overflow exception, but there’s not much we can do to recover from those.</p>

<p class="author1">This approach is lightweight and doesn’t require fancy data structures, but it’s also informative enough that consumers will know what type of failure an error represents and what to search for to find more information.</p>

<p class="author1">A downside is that chaining and nesting error-giving operations can quickly get verbose. If a function returns <code class="calibre14">T | Error1</code>, then any function that consumes that function has two options:</p>
<ol class="calibre31">
<li class="calibre32">
<p class="author1">Explicitly handle <code class="calibre14">Error1</code>.</p>
</li>
<li class="calibre32">
<p class="author1">Handle <code class="calibre14">T</code> (the success case) and pass <code class="calibre14">Error1</code> through to its consumers to handle. If you do this enough, the list of possible errors that a consumer has to handle grows quickly:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">x</code><code class="p">()</code><code class="o">:</code> <code class="nx">T</code> <code class="o">|</code> <code class="nx">Error1</code> <code class="p">{</code>
  <code class="c">// ...</code>
<code class="p">}</code>
<code class="kd">function</code> <code class="nx">y</code><code class="p">()</code><code class="o">:</code> <code class="nx">U</code> <code class="o">|</code> <code class="nx">Error1</code> <code class="o">|</code> <code class="nx">Error2</code> <code class="p">{</code>
  <code class="kd">let</code> <code class="nx">a</code> <code class="o">=</code> <code class="nx">x</code><code class="p">()</code>
  <code class="kd">if</code> <code class="p">(</code><code class="nx">a</code> <code class="kd">instanceof</code> <code class="nb">Error</code><code class="p">)</code> <code class="p">{</code>
    <code class="kd">return</code> <code class="nx">a</code>
  <code class="p">}</code>
  <code class="c">// Do something with a</code>
<code class="p">}</code>
<code class="kd">function</code> <code class="nx">z</code><code class="p">()</code><code class="o">:</code> <code class="nx">U</code> <code class="o">|</code> <code class="nx">Error1</code> <code class="o">|</code> <code class="nx">Error2</code> <code class="o">|</code> <code class="nx">Error3</code> <code class="p">{</code>
  <code class="kd">let</code> <code class="nx">a</code> <code class="o">=</code> <code class="nx">y</code><code class="p">()</code>
  <code class="kd">if</code> <code class="p">(</code><code class="nx">a</code> <code class="kd">instanceof</code> <code class="nb">Error</code><code class="p">)</code> <code class="p">{</code>
    <code class="kd">return</code> <code class="nx">a</code>
  <code class="p">}</code>
  <code class="c">// Do something with a</code>
<code class="p">}</code></pre>
</li>

</ol>

<p class="author1">This approach is verbose, but gives us excellent safety.<a data-primary="errors" data-secondary="handling" data-startref="ix_errhanretexc" data-tertiary="returning exceptions" data-type="indexterm" id="calibre_link-881" class="calibre4"></a><a data-primary="exceptions" data-secondary="returning" data-startref="ix_excptret" data-type="indexterm" id="calibre_link-984" class="calibre4"></a></p>
</div></section>













<section data-pdf-bookmark="The Option Type" data-type="sect1" class="preface"><div class="preface" id="calibre_link-430">
<h1 class="calibre13">The Option Type</h1>

<p class="author1">You can also describe exceptions using special-purpose data types.<a data-primary="errors" data-secondary="handling" data-tertiary="using Option type" data-type="indexterm" id="calibre_link-885" class="calibre4"></a><a data-primary="Option type" data-type="indexterm" id="calibre_link-1324" class="calibre4"></a> This approach has some downsides compared to returning unions of values and errors (notably, interoperability with code that doesn’t use these data types), but it does give you the ability to chain operations over possibly errored computations.<a data-primary="Try type" data-type="indexterm" id="calibre_link-1493" class="calibre4"></a><a data-primary="Either type" data-type="indexterm" id="calibre_link-862" class="calibre4"></a> Three of the most popular options (heh!) are the <code class="calibre14">Try</code>, <code class="calibre14">Option</code>,<sup class="calibre15"><a data-type="noteref" href="#calibre_link-345" id="calibre_link-370" class="calibre16">2</a></sup> and <code class="calibre14">Either</code> types. In this chapter, we’ll just cover the <code class="calibre14">Option</code> type;<sup class="calibre15"><a data-type="noteref" href="#calibre_link-346" id="calibre_link-371" class="calibre16">3</a></sup> the other two are similar in spirit.</p>
<div data-type="note" type="note" class="calibre21"><h6 class="calibre22">Note</h6>
<p class="author1">Note that the <code class="calibre14">Try</code>, <code class="calibre14">Option</code>, and <code class="calibre14">Either</code> data types don’t come built into JavaScript environments the same way that <code class="calibre14">Array</code>, <code class="calibre14">Error</code>, <code class="calibre14">Map</code>, or <code class="calibre14">Promise</code> are. If you want to use these types, you’ll have to find implementations on NPM, or write them yourself.</p>
</div>

<p class="author1">The <code class="calibre14">Option</code> type comes to us from languages like Haskell, OCaml, Scala, and Rust. The idea is that instead of returning a value, you return a <em class="calibre5">container</em> that may or may not have a value in it. The container has a few methods defined on it, which lets you chain operations even though there may not actually be a value inside. The container can be pretty much any data structure, so long as it can hold a value. For example, you could use an array as the container:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<em class="calibre41"><code class="c2">// ...</code></em><code class="c">
</code><code class="kd">function</code><code class="calibre14"> </code><code class="nx">parse</code><code class="p">(</code><code class="nx">birthday</code><code class="calibre14">: </code><code class="kt">string</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><strong class="calibre49"><code class="nb1">Date</code><code class="p1">[</code><code class="p1">]</code></strong><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">date</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="kd">new</code><code class="calibre14"> </code><code class="nb">Date</code><code class="p">(</code><code class="nx">birthday</code><code class="p">)</code><code class="calibre14">
  </code><code class="kd">if</code><code class="calibre14"> </code><code class="p">(</code><code class="o">!</code><code class="nx">isValid</code><code class="p">(</code><code class="nx">date</code><code class="p">)</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
    </code><strong class="calibre49"><code class="k">return</code><code class="calibre50"> </code><code class="p1">[</code><code class="p1">]</code></strong><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">
  </code><strong class="calibre49"><code class="k">return</code><code class="calibre50"> </code><code class="p1">[</code><code class="nx1">date</code><code class="p1">]</code></strong><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">

</code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">date</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="nx">parse</code><code class="p">(</code><code class="nx">ask</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code class="calibre14">
</code><strong class="calibre49"><code class="nx1">date</code><code class="calibre50">
  </code><code class="p1">.</code><code class="nx1">map</code><code class="p1">(</code><code class="nx1">_</code><code class="calibre50"> </code><code class="o1">=</code><code class="o1">&gt;</code><code class="calibre50"> </code><code class="nx1">_</code><code class="p1">.</code><code class="nx1">toISOString</code><code class="p1">(</code><code class="p1">)</code><code class="p1">)</code><code class="calibre50">
  </code><code class="p1">.</code><code class="nx1">forEach</code><code class="p1">(</code><code class="nx1">_</code><code class="calibre50"> </code><code class="o1">=</code><code class="o1">&gt;</code><code class="calibre50"> </code><code class="nx1">console</code><code class="p1">.</code><code class="nx1">info</code><code class="p1">(</code><code class="s1">'Date is'</code><code class="p1">,</code><code class="calibre50"> </code><code class="nx1">_</code><code class="p1">)</code><code class="p1">)</code></strong><code class="calibre14">
</code></pre>
<div data-type="note" type="note" class="calibre21"><h6 class="calibre22">Note</h6>
<p class="author1">As you may have noticed, a downside of <code class="calibre14">Option</code> is that, much like our original <code class="calibre14">null</code>-returning approach, it doesn’t tell the consumer why the error happened; it just signals that something went wrong.</p>
</div>

<p class="author1">Where <code class="calibre14">Option</code> really shines is when you need to do multiple operations in a row, each of which might fail.</p>

<p class="author1">For example, before we assumed that <code class="calibre14">prompt</code> always succeeds, and <code class="calibre14">parse</code> might fail. But what if <code class="calibre14">prompt</code> can fail too? That might happen if the user cancelled out of the birthday prompt&mdash;that’s an error and we shouldn’t continue our computation. We can model that with… another <code class="calibre14">Option</code>!</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<code class="kd">function</code><code class="calibre14"> </code><code class="nx">ask() {</code><code class="calibre14">
  </code><strong class="calibre49"><code class="k">let</code><code class="calibre50"> </code><code class="nx1">result</code><code class="calibre50"> </code><code class="o1">=</code></strong><code class="calibre14"> </code><code class="nx">prompt</code><code class="p">(</code><code class="s">'When is your birthday?'</code><code class="p">)</code><code class="calibre14">
  </code><strong class="calibre49"><code class="k">if</code><code class="calibre50"> </code><code class="p1">(</code><code class="nx1">result</code><code class="calibre50"> </code><code class="o1">===</code><code class="calibre50"> </code><code class="k">null</code><code class="p1">)</code><code class="calibre50"> </code><code class="p1">{</code><code class="calibre50">
    </code><code class="k">return</code><code class="calibre50"> </code><code class="p1">[</code><code class="p1">]</code><code class="calibre50">
  </code><code class="p1">}</code><code class="calibre50">
  </code><code class="k">return</code><code class="calibre50"> </code><code class="p1">[</code><code class="nx1">result</code><code class="p1">]</code></strong><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code><em class="calibre41"><code class="c2">// ...</code></em><code class="c">
</code><strong class="calibre49"><code class="nx1">ask</code><code class="p1">(</code><code class="p1">)</code><code class="calibre50">
  </code><code class="p1">.</code><code class="nx1">map</code><code class="p1">(</code><code class="nx1">parse</code><code class="p1">)</code></strong><code class="calibre14">
  </code><code class="p">.</code><code class="nx">map</code><code class="p">(</code><code class="nx">date</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="nx">date</code><code class="p">.</code><code class="nx">toISOString</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code class="calibre14">
    </code><em class="calibre41"><code class="c2">// Error TS2339: Property 'toISOString' does not exist on type 'Date[]'.</code></em><code class="c">
</code><code class="calibre14">  </code><code class="p">.</code><code class="nx">forEach</code><code class="p">(</code><code class="nx">date</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="nx">console</code><code class="p">.</code><code class="nx">info</code><code class="p">(</code><code class="s">'Date is'</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">date</code><code class="p">)</code><code class="p">)</code><code class="calibre14">
</code></pre>

<p class="author1">Yikes&mdash;that didn’t work. Since we mapped an array of <code class="calibre14">Date</code>s (<code class="calibre14">Date[]</code>) to an array of arrays of <code class="calibre14">Date</code>s (<code class="calibre14">Date[][]</code>), we need to flatten it back to an array of <code class="calibre14">Date</code>s before we can keep going:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<strong class="calibre49"><code class="nx1">flatten</code><code class="p1">(</code></strong><code class="nx">ask</code><code class="p">(</code><code class="p">)</code><code class="calibre14">
  </code><code class="p">.</code><code class="nx">map</code><code class="p">(</code><code class="nx">parse</code><code class="p">)</code><strong class="calibre49"><code class="p1">)</code></strong><code class="calibre14">
  </code><code class="p">.</code><code class="nx">map</code><code class="p">(</code><code class="nx">date</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="nx">date</code><code class="p">.</code><code class="nx">toISOString</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code class="calibre14">
  </code><code class="p">.</code><code class="nx">forEach</code><code class="p">(</code><code class="nx">date</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="nx">console</code><code class="p">.</code><code class="nx">info</code><code class="p">(</code><code class="s">'Date is'</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">date</code><code class="p">)</code><code class="p">)</code><code class="calibre14">

</code><em class="calibre41"><code class="c2">// Flattens an array of arrays into an array</code></em><code class="c">
</code><strong class="calibre49"><code class="k">function</code><code class="calibre50"> </code><code class="nx1">flatten</code><code class="o1">&lt;</code><code class="nx1">T</code><code class="o1">&gt;</code><code class="p1">(</code><code class="nx1">array</code><code class="calibre50">: </code><code class="kt1">T</code><code class="p1">[</code><code class="p1">]</code><code class="p1">[</code><code class="p1">]</code><code class="p1">)</code><code class="o1">:</code><code class="calibre50"> </code><code class="nx1">T</code><code class="p1">[</code><code class="p1">]</code><code class="calibre50"> </code><code class="p1">{</code><code class="calibre50">
  </code><code class="k">return</code><code class="calibre50"> </code><code class="nb1">Array</code><code class="p1">.</code><code class="nx1">prototype</code><code class="p1">.</code><code class="nx1">concat</code><code class="p1">.</code><code class="nx1">apply</code><code class="p1">(</code><code class="p1">[</code><code class="p1">]</code><code class="p1">,</code><code class="calibre50"> </code><code class="nx1">array</code><code class="p1">)</code><code class="calibre50">
</code><code class="p1">}</code></strong><code class="calibre14">
</code></pre>

<p class="author1">This is all getting a bit unwieldy. Because the types don’t tell you much (everything is a regular array), it’s hard to understand what’s going on in that code at a glance. To fix this, let’s wrap what we’re doing&mdash;putting a value in a container, exposing a way to operate on that value, and exposing a way to get a result back from the container&mdash;in a special data type that helps document our approach. Once we’re done implementing it, you’ll be able to use the data type like this:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">ask</code><code class="p">()</code>
  <code class="p">.</code><code class="nx">flatMap</code><code class="p">(</code><code class="nx">parse</code><code class="p">)</code>
  <code class="p">.</code><code class="nx">flatMap</code><code class="p">(</code><code class="nx">date</code> <code class="o">=&gt;</code> <code class="kd">new</code> <code class="nx">Some</code><code class="p">(</code><code class="nx">date</code><code class="p">.</code><code class="nx">toISOString</code><code class="p">()))</code>
  <code class="p">.</code><code class="nx">flatMap</code><code class="p">(</code><code class="nx">date</code> <code class="o">=&gt;</code> <code class="kd">new</code> <code class="nx">Some</code><code class="p">(</code><code class="s">'Date is '</code> <code class="o">+</code> <code class="nx">date</code><code class="p">))</code>
  <code class="p">.</code><code class="nx">getOrElse</code><code class="p">(</code><code class="s">'Error parsing date for some reason'</code><code class="p">)</code></pre>

<p class="author1">We’ll define our <code class="calibre14">Option</code> type like this:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1"><code class="calibre14">Option</code> is an interface that’s implemented by two classes: <code class="calibre14">Some&lt;T&gt;</code> and <code class="calibre14">None</code> (see <a data-type="xref" href="#calibre_link-347" class="calibre4">Figure&nbsp;7-1</a>). They are<a data-primary="Option type" data-secondary="implementation in Some&lt;T&gt; and None classes" data-type="indexterm" id="calibre_link-1327" class="calibre4"></a> the two kinds of <code class="calibre14">Option</code>s. <code class="calibre14">Some&lt;T&gt;</code> is an <code class="calibre14">Option</code> that contains a value of type <code class="calibre14">T</code>, and <code class="calibre14">None</code> is an <code class="calibre14">Option</code> without a value, which represents a failure.</p>
</li>
<li class="calibre11">
<p class="author1"><code class="calibre14">Option</code> is both a type and a function. Its type is an interface that simply serves as the supertype of <code class="calibre14">Some</code> and <code class="calibre14">None</code>. Its function is the way to create a new value of type <code class="calibre14">Option</code>.</p>
</li>
</ul>

<figure class="calibre33"><div class="figure" id="calibre_link-347">
<img alt="prts 0701" src="images/000021.png" class="calibre40" />
<h6 class="calibre34"><span class="calibre">Figure 7-1. </span>Option&lt;T&gt; has two cases: Some&lt;T&gt; and None</h6>
</div></figure>

<p class="author1">Let’s start by sketching out the types:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">interface</code><code class="calibre14"> </code><code class="nx">Option</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="p">{</code><code class="p">}</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-348" id="calibre_link-351"><img alt="1" src="images/000000.png" class="calibre40" /></a><code class="calibre14">
</code><code class="kd">class</code><code class="calibre14"> </code><code class="nx">Some</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="kd">implements</code><code class="calibre14"> </code><code class="nx">Option</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-349" id="calibre_link-352"><img alt="2" src="images/000001.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="kd">constructor</code><code class="p">(</code><code class="kd">private</code><code class="calibre14"> </code><code class="nx">value</code><code class="calibre14">: </code><code class="kt">T</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="p">}</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code><code class="kd">class</code><code class="calibre14"> </code><code class="nx">None</code><code class="calibre14"> </code><code class="kd">implements</code><code class="calibre14"> </code><code class="nx">Option</code><code class="o">&lt;</code><code class="nx">never</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="p">{</code><code class="p">}</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-350" id="calibre_link-353"><img alt="3" src="images/000002.png" class="calibre40" /></a></pre>
<dl class="preface">
<dt class="calibre18"><a class="calibre4" href="#calibre_link-351" id="calibre_link-348"><img alt="1" src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45"><code class="calibre14">Option&lt;T&gt;</code> is an interface that we’ll share between <code class="calibre14">Some&lt;T&gt;</code> and <code class="calibre14">None</code>.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-352" id="calibre_link-349"><img alt="2" src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45"><code class="calibre14">Some&lt;T&gt;</code> represents a successful operation that resulted in a value. Like the array we used before, <code class="calibre14">Some&lt;T&gt;</code> is a container for that value.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-353" id="calibre_link-350"><img alt="3" src="images/000002.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45"><code class="calibre14">None</code> represents an operation that failed, and does not contain a value.</p></dd>
</dl>

<p class="author1">These types are equivalent to the following in our array-based <code class="calibre14">Option</code> <span class="calibre">implementation</span>:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1"><code class="calibre14">Option&lt;T&gt;</code> is <code class="calibre14">[T] | []</code>.</p>
</li>
<li class="calibre11">
<p class="author1"><code class="calibre14">Some&lt;T&gt;</code> is <code class="calibre14">[T]</code>.</p>
</li>
<li class="calibre11">
<p class="author1"><code class="calibre14">None</code> is <code class="calibre14">[]</code>.</p>
</li>
</ul>

<p class="author1">What can you do with an <code class="calibre14">Option</code>? For our bare-bones implementation, we’ll define just <a data-primary="Option type" data-secondary="flatMap and getOrElse methods" data-type="indexterm" id="calibre_link-1326" class="calibre4"></a>two operations:</p>
<dl class="preface">
<dt class="calibre18"><code class="calibre14">flatMap</code></dt>
<dd class="calibre19">
<p class="author1">A way to chain operations on a possibly empty <code class="calibre14">Option</code></p>
</dd>
<dt class="calibre18"><code class="calibre14">getOrElse</code></dt>
<dd class="calibre19">
<p class="author1">A way to retrieve a value from an <code class="calibre14">Option</code></p>
</dd>
</dl>

<p class="author1">We’ll start by defining these operations on our <code class="calibre14">Option</code> interface, meaning that <code class="calibre14">Some&lt;T&gt;</code> and <code class="calibre14">None</code> will need to provide concrete implementations for them:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<code class="kd">interface</code><code class="calibre14"> </code><code class="nx">Option</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><strong class="calibre49"><code class="nx1">flatMap</code><code class="o1">&lt;</code><code class="nx1">U</code><code class="o1">&gt;</code><code class="p1">(</code><code class="nx1">f</code><code class="o1">:</code><code class="calibre50"> </code><code class="p1">(</code><code class="nx1">value</code><code class="calibre50">: </code><code class="kt1">T</code><code class="p1">)</code><code class="calibre50"> </code><code class="o1">=</code><code class="o1">&gt;</code><code class="calibre50"> </code><code class="nx1">Option</code><code class="o1">&lt;</code><code class="nx1">U</code><code class="o1">&gt;</code><code class="p1">)</code><code class="o1">:</code><code class="calibre50"> </code><code class="nx1">Option</code><code class="o1">&lt;</code><code class="nx1">U</code><code class="o1">&gt;</code><code class="calibre50">
  </code><code class="nx1">getOrElse</code><code class="p1">(</code><code class="nx1">value</code><code class="calibre50">: </code><code class="kt1">T</code><code class="p1">)</code><code class="o1">:</code><code class="calibre50"> </code><code class="nx1">T</code></strong><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code><code class="kd">class</code><code class="calibre14"> </code><code class="nx">Some</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="kd">extends</code><code class="calibre14"> </code><code class="nx">Option</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="kd">constructor</code><code class="p">(</code><code class="kd">private</code><code class="calibre14"> </code><code class="nx">value</code><code class="calibre14">: </code><code class="kt">T</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="p">}</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code><code class="kd">class</code><code class="calibre14"> </code><code class="nx">None</code><code class="calibre14"> </code><code class="kd">extends</code><code class="calibre14"> </code><code class="nx">Option</code><code class="o">&lt;</code><code class="nx">never</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="p">{</code><code class="p">}</code><code class="calibre14">
</code></pre>

<p class="author1">That is:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1"><code class="calibre14">flatMap</code> takes a function <code class="calibre14">f</code> that takes a value of type <code class="calibre14">T</code> (the type of the value the <code class="calibre14">Option</code> contains) and returns an <code class="calibre14">Option</code> of <code class="calibre14">U</code>. <code class="calibre14">flatMap</code> calls <code class="calibre14">f</code> with the <code class="calibre14">Option</code>’s value, and returns a new <code class="calibre14">Option&lt;U&gt;</code>.</p>
</li>
<li class="calibre11">
<p class="author1"><code class="calibre14">getOrElse</code> takes a default value of the same type <code class="calibre14">T</code> as the value that the <code class="calibre14">Option</code> contains, and returns either that default value (if the <code class="calibre14">Option</code> is an empty <code class="calibre14">None</code>) or the <code class="calibre14">Option</code>’s value (if the <code class="calibre14">Option</code> is a <code class="calibre14">Some&lt;T&gt;</code>).</p>
</li>
</ul>

<p class="author1">Guided by the types, <a data-primary="Option type" data-secondary="implementing flatMap and getOrElse on Some&lt;T&gt; and None" data-type="indexterm" id="calibre_link-1328" class="calibre4"></a>let’s implement these methods for <code class="calibre14">Some&lt;T&gt;</code> and <code class="calibre14">None</code>:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<code class="kd">interface</code><code class="calibre14"> </code><code class="nx">Option</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="nx">flatMap</code><code class="o">&lt;</code><code class="nx">U</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">f</code><code class="o">:</code><code class="calibre14"> </code><code class="p">(</code><code class="nx">value</code><code class="calibre14">: </code><code class="kt">T</code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="nx">Option</code><code class="o">&lt;</code><code class="nx">U</code><code class="o">&gt;</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">Option</code><code class="o">&lt;</code><code class="nx">U</code><code class="o">&gt;</code><code class="calibre14">
  </code><code class="nx">getOrElse</code><code class="p">(</code><code class="nx">value</code><code class="calibre14">: </code><code class="kt">T</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">T</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code><code class="kd">class</code><code class="calibre14"> </code><code class="nx">Some</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="kd">implements</code><code class="calibre14"> </code><code class="nx">Option</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="kd">constructor</code><code class="p">(</code><code class="kd">private</code><code class="calibre14"> </code><code class="nx">value</code><code class="calibre14">: </code><code class="kt">T</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="p">}</code><code class="calibre14">
  </code><strong class="calibre49"><code class="nx1">flatMap</code><code class="o1">&lt;</code><code class="nx1">U</code><code class="o1">&gt;</code><code class="p1">(</code><code class="nx1">f</code><code class="o1">:</code><code class="calibre50"> </code><code class="p1">(</code><code class="nx1">value</code><code class="calibre50">: </code><code class="kt1">T</code><code class="p1">)</code><code class="calibre50"> </code><code class="o1">=</code><code class="o1">&gt;</code><code class="calibre50"> </code><code class="nx1">Option</code><code class="o1">&lt;</code><code class="nx1">U</code><code class="o1">&gt;</code><code class="p1">)</code><code class="o1">:</code><code class="calibre50"> </code><code class="nx1">Option</code><code class="o1">&lt;</code><code class="nx1">U</code><code class="o1">&gt;</code><code class="calibre50"> </code><code class="p1">{</code></strong><code class="calibre14"> </code><a data-type="co" href="#calibre_link-354" id="calibre_link-358" class="calibre4"><img src="images/000000.png" class="calibre40" /></a><code class="calibre14">
    </code><strong class="calibre49"><code class="k">return</code><code class="calibre50"> </code><code class="nx1">f</code><code class="p1">(</code><code class="k">this</code><code class="p1">.</code><code class="nx1">value</code><code class="p1">)</code><code class="calibre50">
  </code><code class="p1">}</code><code class="calibre50">
  </code><code class="nx1">getOrElse</code><code class="p1">(</code><code class="p1">)</code><code class="o1">:</code><code class="calibre50"> </code><code class="nx1">T</code><code class="calibre50"> </code><code class="p1">{</code></strong><code class="calibre14"> </code><a data-type="co" href="#calibre_link-355" id="calibre_link-359" class="calibre4"><img src="images/000001.png" class="calibre40" /></a><code class="calibre14">
    </code><strong class="calibre49"><code class="k">return</code><code class="calibre50"> </code><code class="k">this</code><code class="p1">.</code><code class="nx1">value</code><code class="calibre50">
  </code><code class="p1">}</code></strong><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code><code class="kd">class</code><code class="calibre14"> </code><code class="nx">None</code><code class="calibre14"> </code><code class="kd">implements</code><code class="calibre14"> </code><code class="nx">Option</code><code class="o">&lt;</code><code class="nx">never</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><strong class="calibre49"><code class="nx1">flatMap</code><code class="o1">&lt;</code><code class="nx1">U</code><code class="o1">&gt;</code><code class="p1">(</code><code class="p1">)</code><code class="o1">:</code><code class="calibre50"> </code><code class="nx1">Option</code><code class="o1">&lt;</code><code class="nx1">U</code><code class="o1">&gt;</code><code class="calibre50"> </code><code class="p1">{</code></strong><code class="calibre14"> </code><a data-type="co" href="#calibre_link-356" id="calibre_link-360" class="calibre4"><img src="images/000002.png" class="calibre40" /></a><code class="calibre14">
    </code><strong class="calibre49"><code class="k">return</code><code class="calibre50"> </code><code class="k">this</code><code class="calibre50">
  </code><code class="p1">}</code><code class="calibre50">
  </code><code class="nx1">getOrElse</code><code class="o1">&lt;</code><code class="nx1">U</code><code class="o1">&gt;</code><code class="p1">(</code><code class="nx1">value</code><code class="calibre50">: </code><code class="kt1">U</code><code class="p1">)</code><code class="o1">:</code><code class="calibre50"> </code><code class="nx1">U</code><code class="calibre50"> </code><code class="p1">{</code></strong><code class="calibre14"> </code><a data-type="co" href="#calibre_link-357" id="calibre_link-361" class="calibre4"><img src="images/000003.png" class="calibre40" /></a><code class="calibre14">
    </code><strong class="calibre49"><code class="k">return</code><code class="calibre50"> </code><code class="nx1">value</code><code class="calibre50">
  </code><code class="p1">}</code></strong><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code></pre>

<dl class="preface">
<dt class="calibre18"><a data-type="co" href="#calibre_link-358" id="calibre_link-354" class="calibre4"><img src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">When we call <code class="calibre14">flatMap</code> on a <code class="calibre14">Some&lt;T&gt;</code>, we pass in a function <code class="calibre14">f</code>, which <code class="calibre14">flatMap</code> calls with the <code class="calibre14">Some&lt;T&gt;</code>’s value to yield a new <code class="calibre14">Option</code> of a new type.</p></dd>
<dt class="calibre18"><a data-type="co" href="#calibre_link-359" id="calibre_link-355" class="calibre4"><img src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">Calling <code class="calibre14">getOrElse</code> on a <code class="calibre14">Some&lt;T&gt;</code> just returns the <code class="calibre14">Some&lt;T&gt;</code>’s value.</p></dd>
<dt class="calibre18"><a data-type="co" href="#calibre_link-360" id="calibre_link-356" class="calibre4"><img src="images/000002.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">Since a <code class="calibre14">None</code> represents a failed computation, calling <code class="calibre14">flatMap</code> on it always returns a <code class="calibre14">None</code>: once a computation fails, we can’t recover from that failure (at least not with our particular <code class="calibre14">Option</code> implementation).</p></dd>
<dt class="calibre18"><a data-type="co" href="#calibre_link-361" id="calibre_link-357" class="calibre4"><img src="images/000003.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">Calling <code class="calibre14">getOrElse</code> on a <code class="calibre14">None</code> always returns the value we passed into <code class="calibre14">getOrElse</code>.</p></dd>
</dl>

<p class="author1">We can actually go a step beyond this naive implementation, and specify our types better. If all you know is that you have an <code class="calibre14">Option</code> and a function from <code class="calibre14">T</code> to <code class="calibre14">Option&lt;U&gt;</code>, then an <code class="calibre14">Option&lt;T&gt;</code> always <code class="calibre14">flatMap</code>s to an <code class="calibre14">Option&lt;U&gt;</code>. But when you know you have a <code class="calibre14">Some&lt;T&gt;</code> or a <code class="calibre14">None</code>, you can be more specific.</p>

<p class="author1"><a data-type="xref" href="#calibre_link-362" class="calibre4">Table&nbsp;7-1</a> shows the result types we want when calling <code class="calibre14">flatMap</code> on the two types of <code class="calibre14">Option</code>s.</p>
<table id="calibre_link-362" class="stafflist_table">
<caption class="calibre35"><span class="calibre">Table 7-1. </span>Result of calling .flatMap(f) on Some&lt;T&gt; and None</caption>
<thead class="calibre36">
<tr class="calibre7">
<th class="calibre37"></th>
<th class="calibre37">From <code class="calibre14">Some&lt;T&gt;</code></th>
<th class="calibre37">From <code class="calibre14">None</code></th>
</tr>
</thead>
<tbody class="calibre6">
<tr class="calibre7">
<td class="calibre8"><p class="author1">To <code class="calibre14">Some&lt;U&gt;</code></p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">Some&lt;U&gt;</code></p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">None</code></p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1">To <code class="calibre14">None</code></p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">None</code></p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">None</code></p></td>
</tr>
</tbody>
</table>

<p class="author1">That is, we know that mapping over a <code class="calibre14">None</code> always results in a <code class="calibre14">None</code>, and mapping over a <code class="calibre14">Some&lt;T&gt;</code> results in either a <code class="calibre14">Some&lt;T&gt;</code> or a <code class="calibre14">None</code>, depending on what calling <code class="calibre14">f</code> returns.<a data-primary="Option type" data-secondary="using overloaded signatures to give flatMap more specific types" data-type="indexterm" id="calibre_link-1330" class="calibre4"></a> We’ll exploit this and use overloaded signatures to give <code class="calibre14">flatMap</code> more specific types:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<code class="kd">interface</code><code class="calibre14"> </code><code class="nx">Option</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><strong class="calibre49"><code class="nx1">flatMap</code><code class="o1">&lt;</code><code class="nx1">U</code><code class="o1">&gt;</code><code class="p1">(</code><code class="nx1">f</code><code class="o1">:</code><code class="calibre50"> </code><code class="p1">(</code><code class="nx1">value</code><code class="calibre50">: </code><code class="kt1">T</code><code class="p1">)</code><code class="calibre50"> </code><code class="o1">=</code><code class="o1">&gt;</code><code class="calibre50"> </code><code class="nx1">None</code><code class="p1">)</code><code class="o1">:</code><code class="calibre50"> </code><code class="nx1">None</code></strong><code class="calibre14">
  </code><code class="nx">flatMap</code><code class="o">&lt;</code><code class="nx">U</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">f</code><code class="o">:</code><code class="calibre14"> </code><code class="p">(</code><code class="nx">value</code><code class="calibre14">: </code><code class="kt">T</code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="nx">Option</code><code class="o">&lt;</code><code class="nx">U</code><code class="o">&gt;</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">Option</code><code class="o">&lt;</code><code class="nx">U</code><code class="o">&gt;</code><code class="calibre14">
  </code><code class="nx">getOrElse</code><code class="p">(</code><code class="nx">value</code><code class="calibre14">: </code><code class="kt">T</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">T</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code><code class="kd">class</code><code class="calibre14"> </code><code class="nx">Some</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="kd">implements</code><code class="calibre14"> </code><code class="nx">Option</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="kd">constructor</code><code class="p">(</code><code class="kd">private</code><code class="calibre14"> </code><code class="nx">value</code><code class="calibre14">: </code><code class="kt">T</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="p">}</code><code class="calibre14">
  </code><strong class="calibre49"><code class="nx1">flatMap</code><code class="o1">&lt;</code><code class="nx1">U</code><code class="o1">&gt;</code><code class="p1">(</code><code class="nx1">f</code><code class="o1">:</code><code class="calibre50"> </code><code class="p1">(</code><code class="nx1">value</code><code class="calibre50">: </code><code class="kt1">T</code><code class="p1">)</code><code class="calibre50"> </code><code class="o1">=</code><code class="o1">&gt;</code><code class="calibre50"> </code><code class="nx1">None</code><code class="p1">)</code><code class="o1">:</code><code class="calibre50"> </code><code class="nx1">None</code><code class="calibre50">
  </code><code class="nx1">flatMap</code><code class="o1">&lt;</code><code class="nx1">U</code><code class="o1">&gt;</code><code class="p1">(</code><code class="nx1">f</code><code class="o1">:</code><code class="calibre50"> </code><code class="p1">(</code><code class="nx1">value</code><code class="calibre50">: </code><code class="kt1">T</code><code class="p1">)</code><code class="calibre50"> </code><code class="o1">=</code><code class="o1">&gt;</code><code class="calibre50"> </code><code class="nx1">Some</code><code class="o1">&lt;</code><code class="nx1">U</code><code class="o1">&gt;</code><code class="p1">)</code><code class="o1">:</code><code class="calibre50"> </code><code class="nx1">Some</code><code class="o1">&lt;</code><code class="nx1">U</code><code class="o1">&gt;</code></strong><code class="calibre14">
  </code><code class="nx">flatMap</code><code class="o">&lt;</code><code class="nx">U</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">f</code><code class="o">:</code><code class="calibre14"> </code><code class="p">(</code><code class="nx">value</code><code class="calibre14">: </code><code class="kt">T</code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="nx">Option</code><code class="o">&lt;</code><code class="nx">U</code><code class="o">&gt;</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">Option</code><code class="o">&lt;</code><code class="nx">U</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
    </code><code class="kd">return</code><code class="calibre14"> </code><code class="nx">f</code><code class="p">(</code><code class="kd">this</code><code class="p">.</code><code class="nx">value</code><code class="p">)</code><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">
  </code><code class="nx">getOrElse</code><code class="p">(</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">T</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
    </code><code class="kd">return</code><code class="calibre14"> </code><code class="kd">this</code><code class="p">.</code><code class="nx">value</code><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code><code class="kd">class</code><code class="calibre14"> </code><code class="nx">None</code><code class="calibre14"> </code><code class="kd">implements</code><code class="calibre14"> </code><code class="nx">Option</code><code class="o">&lt;</code><code class="nx">never</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><strong class="calibre49"><code class="nx1">flatMap</code><code class="p1">(</code><code class="p1">)</code><code class="o1">:</code><code class="calibre50"> </code><code class="nx1">None</code></strong><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
    </code><code class="kd">return</code><code class="calibre14"> </code><code class="kd">this</code><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">
  </code><code class="nx">getOrElse</code><code class="o">&lt;</code><code class="nx">U</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">value</code><code class="calibre14">: </code><code class="kt">U</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">U</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
    </code><code class="kd">return</code><code class="calibre14"> </code><code class="nx">value</code><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code></pre>

<p class="author1">We’re almost done. All that’s left to do is implement the <code class="calibre14">Option</code> function, which we’ll use to create new <code class="calibre14">Option</code>s.<a data-primary="Option type" data-secondary="implementing Option function" data-type="indexterm" id="calibre_link-1329" class="calibre4"></a> We already implemented the <code class="calibre14">Option</code> <em class="calibre5">type</em> as an interface; now we’re going to implement a function with the same name (remember that TypeScript has two separate namespaces for types and for values) as a way to create a new <code class="calibre14">Option</code>, similar to what we did in <a data-type="xref" href="#calibre_link-171" class="calibre4">“Companion Object Pattern”</a>. If a user passes in <code class="calibre14">null</code> or <code class="calibre14">undefined</code>, we’ll give them back a <code class="calibre14">None</code>; otherwise, we’ll return a <code class="calibre14">Some</code>. Once again, we’ll overload the signature to do that:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code><code class="calibre14"> </code><code class="nx">Option</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">value</code><code class="calibre14">: </code><code class="kt">null</code><code class="calibre14"> </code><code class="o">|</code><code class="calibre14"> </code><code class="kd">undefined</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">None</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-363" id="calibre_link-366"><img alt="1" src="images/000000.png" class="calibre40" /></a><code class="calibre14">
</code><code class="kd">function</code><code class="calibre14"> </code><code class="nx">Option</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">value</code><code class="calibre14">: </code><code class="kt">T</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">Some</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-364" id="calibre_link-367"><img alt="2" src="images/000001.png" class="calibre40" /></a><code class="calibre14">
</code><code class="kd">function</code><code class="calibre14"> </code><code class="nx">Option</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">value</code><code class="calibre14">: </code><code class="kt">T</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">Option</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-365" id="calibre_link-368"><img alt="3" src="images/000002.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="kd">if</code><code class="calibre14"> </code><code class="p">(</code><code class="nx">value</code><code class="calibre14"> </code><code class="o">==</code><code class="calibre14"> </code><code class="kd">null</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
    </code><code class="kd">return</code><code class="calibre14"> </code><code class="kd">new</code><code class="calibre14"> </code><code class="nx">None</code><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">
  </code><code class="kd">return</code><code class="calibre14"> </code><code class="kd">new</code><code class="calibre14"> </code><code class="nx">Some</code><code class="p">(</code><code class="nx">value</code><code class="p">)</code><code class="calibre14">
</code><code class="p">}</code></pre>
<dl class="preface">
<dt class="calibre18"><a class="calibre4" href="#calibre_link-366" id="calibre_link-363"><img alt="1" src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">If the consumer calls <code class="calibre14">Option</code> with <code class="calibre14">null</code> or <code class="calibre14">undefined</code>, we return a <code class="calibre14">None</code>.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-367" id="calibre_link-364"><img alt="2" src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">Otherwise, we return a <code class="calibre14">Some&lt;T&gt;</code>, where <code class="calibre14">T</code> is the type of value the user passed in.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-368" id="calibre_link-365"><img alt="3" src="images/000002.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">Finally, we manually calculate an upper bound for the two overloaded signatures. The upper bound of <code class="calibre14">null | undefined</code> and <code class="calibre14">T</code> is <code class="calibre14">T | null | undefined</code>, which simplifies to <code class="calibre14">T</code>. The upper bound of <code class="calibre14">None</code> and <code class="calibre14">Some&lt;T&gt;</code> is <code class="calibre14">None | Some&lt;T&gt;</code>, which we already have a name for: <code class="calibre14">Option&lt;T&gt;</code>.</p></dd>
</dl>

<p class="author1">That’s it. We’ve derived a fully working, minimal <code class="calibre14">Option</code> type that lets us safely perform operations over maybe-<code class="calibre14">null</code> values. We use it like this:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">result</code> <code class="o">=</code> <code class="nx">Option</code><code class="p">(</code><code class="mi">6</code><code class="p">)</code>          <code class="c">// Some&lt;number&gt;</code>
  <code class="p">.</code><code class="nx">flatMap</code><code class="p">(</code><code class="nx">n</code> <code class="o">=&gt;</code> <code class="nx">Option</code><code class="p">(</code><code class="nx">n</code> <code class="o">*</code> <code class="mi">3</code><code class="p">))</code>  <code class="c">// Some&lt;number&gt;</code>
  <code class="p">.</code><code class="nx">flatMap</code><code class="p">(</code><code class="nx">n</code> <code class="o">=&gt;</code> <code class="kd">new</code> <code class="nx">None</code><code class="p">)</code>       <code class="c">// None</code>
  <code class="p">.</code><code class="nx">getOrElse</code><code class="p">(</code><code class="mi">7</code><code class="p">)</code>                 <code class="c">// 7</code></pre>

<p class="author1">Getting back to our birthday prompt example, our code now works as we’d expect:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">ask</code><code class="p">()</code>                                              <code class="c">// Option&lt;string&gt;</code>
  <code class="p">.</code><code class="nx">flatMap</code><code class="p">(</code><code class="nx">parse</code><code class="p">)</code>                                  <code class="c">// Option&lt;Date&gt;</code>
  <code class="p">.</code><code class="nx">flatMap</code><code class="p">(</code><code class="nx">date</code> <code class="o">=&gt;</code> <code class="kd">new</code> <code class="nx">Some</code><code class="p">(</code><code class="nx">date</code><code class="p">.</code><code class="nx">toISOString</code><code class="p">()))</code>   <code class="c">// Option&lt;string&gt;</code>
  <code class="p">.</code><code class="nx">flatMap</code><code class="p">(</code><code class="nx">date</code> <code class="o">=&gt;</code> <code class="kd">new</code> <code class="nx">Some</code><code class="p">(</code><code class="s">'Date is '</code> <code class="o">+</code> <code class="nx">date</code><code class="p">))</code>    <code class="c">// Option&lt;string&gt;</code>
  <code class="p">.</code><code class="nx">getOrElse</code><code class="p">(</code><code class="s">'Error parsing date for some reason'</code><code class="p">)</code> <code class="c">// string</code></pre>

<p class="author1"><code class="calibre14">Option</code>s are a powerful way to work with series of operations that may or may not succeed. They give you excellent type safety, and signal to consumers via the type system that a given operation might fail.</p>

<p class="author1">However, <code class="calibre14">Option</code>s aren’t without their downsides. They signal failure with a <code class="calibre14">None</code>, so you don’t get more details about what failed and why. They also don’t interoperate with code that doesn’t use <code class="calibre14">Option</code>s (you’ll have to explicitly wrap those APIs to return <code class="calibre14">Option</code>s).</p>

<p class="author1">Still, what you did there was pretty neat. The overloads you added let you do something that you can’t express in most languages, even those that rely on the <code class="calibre14">Option</code> type for working with nullable values. By restricting <code class="calibre14">Option</code> to just <code class="calibre14">Some</code> or <code class="calibre14">None</code> where possible via overloaded call signatures, you made your code a whole lot safer, and a whole lot of Haskell programmers very jealous. Now go grab yourself a cold one&mdash;you deserve it.<a data-primary="errors" data-secondary="handling" data-startref="ix_errhanOpt" data-tertiary="using Option type" data-type="indexterm" id="calibre_link-886" class="calibre4"></a><a data-primary="Option type" data-startref="ix_Opti" data-type="indexterm" id="calibre_link-1325" class="calibre4"></a></p>
</div></section>













<section data-pdf-bookmark="Summary" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1885">
<h1 class="calibre13">Summary</h1>

<p class="author1">In this chapter we covered the different ways to signal and recover from errors in TypeScript: returning <code class="calibre14">null</code>, throwing exceptions, returning exceptions, and the <code class="calibre14">Option</code> type. You now have an arsenal of approaches for safely working with things that might fail. Which approach you choose is up to you, and depends on:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">Whether you want to simply signal that something failed (<code class="calibre14">null</code>, <code class="calibre14">Option</code>), or give more information about why it failed (throwing and returning exceptions).</p>
</li>
<li class="calibre11">
<p class="author1">Whether you want to force consumers to explicitly handle every possible exception (returning exceptions), or write less error-handling boilerplate (throwing exceptions).</p>
</li>
<li class="calibre11">
<p class="author1">Whether you need a way to compose errors (<code class="calibre14">Option</code>), or simply handle them when they come up (<code class="calibre14">null</code>, exceptions).</p>
</li>
</ul>
</div></section>













<section data-pdf-bookmark="Exercises" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1886">
<h1 class="calibre13">Exercises</h1>
<ol class="calibre31">
<li class="calibre32">
<p class="author1">Design a way to handle errors for the following API, using one of the patterns from this chapter. In this API, every operation might fail&mdash;feel free to update the API’s method signatures to allow for failures (or don’t, if you prefer). Think about how you might perform a sequence of actions while handling errors that come up (e.g., getting the logged-in user’s ID, then getting their list of friends, then getting each friend’s name):<a data-primary="errors" data-secondary="handling" data-startref="ix_errhan" data-type="indexterm" id="calibre_link-878" class="calibre4"></a></p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">class</code> <code class="nx">API</code> <code class="p">{</code>
  <code class="nx">getLoggedInUserID</code><code class="p">()</code><code class="o">:</code> <code class="nx">UserID</code>
  <code class="nx">getFriendIDs</code><code class="p">(</code><code class="nx">userID</code>: <code class="kt">UserID</code><code class="p">)</code><code class="o">:</code> <code class="nx">UserID</code><code class="p">[]</code>
  <code class="nx">getUserName</code><code class="p">(</code><code class="nx">userID</code>: <code class="kt">UserID</code><code class="p">)</code><code class="o">:</code> <code class="kt">string</code>
<code class="p">}</code></pre>
</li>

</ol>
</div></section>







<div data-type="footnotes" class="calibre26"><p data-type="footnote" id="calibre_link-344" class="calibre27"><sup class="calibre28"><a href="#calibre_link-369" class="calibre16">1</a></sup> If you haven’t worked with Java before, a <code class="calibre14">throws</code> clause indicates which types of runtime exceptions a method might throw, so a consumer has to handle those exceptions.</p><p data-type="footnote" id="calibre_link-345" class="calibre27"><sup class="calibre28"><a href="#calibre_link-370" class="calibre16">2</a></sup> Also called the <code class="calibre14">Maybe</code> type.</p><p data-type="footnote" id="calibre_link-346" class="calibre27"><sup class="calibre28"><a href="#calibre_link-371" class="calibre16">3</a></sup> Google “try type” or “either type” for more information on those types.</p></div></div></section></div>

<div data-type="book" class="calibre1" id="calibre_link-372"><section data-pdf-bookmark="Chapter 8. Asynchronous Programming, Concurrency, and Parallelism" data-type="chapter" type="chapter" class="preface"><div class="preface" id="calibre_link-1887">
<h1 class="calibre12"><span class="calibre">Chapter 8. </span>Asynchronous Programming, <span class="calibre">Concurrency, and Parallelism</span></h1>


<p class="author1">So far in this book, we’ve dealt mostly with synchronous programs&mdash;programs that take some input, do some stuff, and run to completion in a single pass.<a data-primary="asynchronous programming" data-type="indexterm" id="calibre_link-667" class="calibre4"></a> But the really interesting programs&mdash;the building blocks of real-world applications that make network requests, interact with databases and filesystems, respond to user interaction, offload CPU-intensive work to separate threads&mdash;all make use of asynchronous APIs like callbacks, promises, and streams.</p>

<p class="author1">These asynchronous tasks are where JavaScript really shines and sets itself apart from other mainstream multithreaded languages like Java and C++. Popular JavaScript engines like V8 and SpiderMonkey do with one thread what traditionally required many threads, by being clever and multiplexing tasks over a single thread while other tasks are idling. This <em class="calibre5">event loop</em> is the standard threading model for JavaScript engines, and the one that we’ll assume you’re using. From an end user’s perspective, it usually doesn’t matter whether your engine uses an event looped model or a multithreaded one, but it does affect the explanations I’ll be giving for how things work and why we design things the way we do.</p>

<p class="author1">This event-looped concurrency model is how JavaScript avoids all the common footguns endemic to multithreaded programming, along with the overhead of synchronized data types, mutexes, semaphores, and all the other bits of multithreading jargon. And when you do run JavaScript over multiple threads, it’s rare to use shared memory; the typical pattern is to use message passing and to serialize data when sending it between threads. It’s a design reminiscent of Erlang, actor systems, and other purely functional concurrency models, and is what makes multithreaded programming in JavaScript foolproof.</p>

<p class="author1">That said, asynchronous programming does make programs harder to reason about, because you can no longer mentally trace through a program line by line; you have to know when to pause and move execution elsewhere, and when to resume again.</p>

<p class="author1">TypeScript gives us the tools to reason about asynchronous programs: types let us trace through asynchronous work, and built-in support for <code class="calibre14">async</code>/<code class="calibre14">await</code> let us apply <a data-primary="async and await syntax" data-type="indexterm" id="calibre_link-665" class="calibre4"></a>familiar synchronous thinking to asynchronous programs. We can also use TypeScript to specify strict message-passing protocols for multithreaded programs (it’s a lot simpler than it sounds). If all else fails, TypeScript can give you a back rub when your coworker’s asynchronous code gets too complicated and you have to stay late debugging it (behind a compiler flag, of course).</p>

<p class="author1">But before we get to working with asynchronous programs, let’s talk a bit more about how asynchronicity actually works in modern JavaScript engines&mdash;how is it that we can suspend and resume execution on what seems to be a single thread?</p>






<section data-pdf-bookmark="JavaScript’s Event Loop" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1888">
<h1 class="calibre13">JavaScript’s Event Loop</h1>

<p class="author1">Let’s start with an example.<a data-primary="JavaScript" data-secondary="event loop" data-type="indexterm" id="calibre_link-1149" class="calibre4"></a><a data-primary="asynchronous programming" data-secondary="JavaScript&apos;s event loop" data-type="indexterm" id="calibre_link-676" class="calibre4"></a><a data-primary="event loop" data-type="indexterm" id="calibre_link-977" class="calibre4"></a> We’ll set a couple of timers, one that fires after one millisecond, and the other after two:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">setTimeout</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="nx">console</code><code class="p">.</code><code class="nx">info</code><code class="p">(</code><code class="s">'A'</code><code class="p">),</code> <code class="mi">1</code><code class="p">)</code>
<code class="nx">setTimeout</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="nx">console</code><code class="p">.</code><code class="nx">info</code><code class="p">(</code><code class="s">'B'</code><code class="p">),</code> <code class="mi">2</code><code class="p">)</code>
<code class="nx">console</code><code class="p">.</code><code class="nx">info</code><code class="p">(</code><code class="s">'C'</code><code class="p">)</code></pre>

<p class="author1">Now, what will get logged to the console? Is it <code class="calibre14">A</code>, <code class="calibre14">B</code>, <code class="calibre14">C</code>?</p>

<p class="author1">If you’re a JavaScript programmer, you know intuitively the answer is no&mdash;the actual firing order is <code class="calibre14">C</code>, <code class="calibre14">A</code>, then <code class="calibre14">B</code>. If you haven’t worked with JavaScript or TypeScript before, this behavior might seem mysterious and unintuitive. In reality, it’s pretty straightforward; it just doesn’t follow the same concurrency model as a <code class="calibre14">sleep</code> would in C, or scheduling work in another thread would in Java.</p>

<p class="author1">At a high level, the JavaScript VM simulates concurrency like this (see <a data-type="xref" href="#calibre_link-373" class="calibre4">Figure&nbsp;8-1</a>):</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">The main JavaScript thread calls into native asynchronous APIs like <span class="calibre"><code class="calibre14">XMLHTTPRequest</code></span> (for AJAX requests), <code class="calibre14">setTimeout</code> (for sleeping), <code class="calibre14">readFile</code> (for reading a file from disk), and so on. These APIs are provided by the JavaScript platform&mdash;you can’t create them yourself.<sup class="calibre15"><a data-type="noteref" href="#calibre_link-374" id="calibre_link-428" class="calibre16">1</a></sup></p>
</li>
<li class="calibre11">
<p class="author1">Once you call into a native asynchronous API, control returns to the main thread and execution continues as if the API was never called.</p>
</li>
<li class="calibre11">
<p class="author1">Once the asynchronous operation is done, the platform puts a <em class="calibre5">task</em> in its <em class="calibre5">event queue</em>.<a data-primary="tasks" data-type="indexterm" id="calibre_link-1470" class="calibre4"></a><a data-primary="event queue" data-type="indexterm" id="calibre_link-979" class="calibre4"></a> Each thread has its own queue, used for relaying the results of asynchronous operations back to the main thread. A task includes some metainformation about the call, and a reference to a callback function from the main thread.</p>
</li>
<li class="calibre11">
<p class="author1">Whenever the main thread’s call stack is emptied, the platform will check its event queue for pending tasks. If there’s a task waiting, the platform runs it; that triggers a function call, and control returns to that main thread function. When the call stack resulting from that function call is once again empty, the platform again checks the event queue for tasks that are ready to go. This loop repeats until both the call stack and the event queue are empty, and all asynchronous native API calls have completed.</p>
</li>
</ul>

<figure class="calibre33"><div class="figure" id="calibre_link-373">
<img alt="prts 0801" src="images/000022.png" class="calibre40" />
<h6 class="calibre34"><span class="calibre">Figure 8-1. </span>JavaScript’s event loop: what happens when you call an asynchronous API</h6>
</div></figure>

<p class="author1">Armed with this information, it’s time to go back to our <code class="calibre14">setTimeout</code> example. Here’s what happens:</p>
<ol class="calibre31">
<li class="calibre32">
<p class="author1">We call <code class="calibre14">setTimeout</code>, which calls a native timeout API with a reference to the callback we passed in and the argument <code class="calibre14">1</code>.</p>
</li>
<li class="calibre32">
<p class="author1">We call <code class="calibre14">setTimeout</code> again, which calls the native timeout API again with a reference to the second callback we passed in and the argument <code class="calibre14">2</code>.</p>
</li>
<li class="calibre32">
<p class="author1">We log <code class="calibre14">C</code> to the console.</p>
</li>
<li class="calibre32">
<p class="author1">In the background, after at least one millisecond, our JavaScript platform adds a task to its event queue indicating that the timeout for the first <code class="calibre14">setTimeout</code> has elapsed, and that its callback is now ready to be called.</p>
</li>
<li class="calibre32">
<p class="author1">After another millisecond, the platform adds a second task to the event queue for the second <code class="calibre14">setTimeout</code>’s callback.</p>
</li>
<li class="calibre32">
<p class="author1">Since the call stack is empty, after step 3 is done the platform looks at its event queue to see if there are any tasks in it. If steps 4 and/or 5 are done, then it will find some tasks. For each task, it will call the corresponding callback function.</p>
</li>
<li class="calibre32">
<p class="author1">Once both timers have elapsed and the event queue and  call stack are empty, the program exits.</p>
</li>

</ol>

<p class="author1">That’s why we logged <code class="calibre14">C</code>, <code class="calibre14">A</code>, <code class="calibre14">B</code>, and not <code class="calibre14">A</code>, <code class="calibre14">B</code>, <code class="calibre14">C</code>. With this baseline out of the way, we can start talking about how to type asynchronous code safely.<a data-primary="JavaScript" data-secondary="event loop" data-startref="ix_JSeevlp" data-type="indexterm" id="calibre_link-1150" class="calibre4"></a><a data-primary="event loop" data-startref="ix_evlp" data-type="indexterm" id="calibre_link-978" class="calibre4"></a><a data-primary="asynchronous programming" data-secondary="JavaScript&apos;s event loop" data-startref="ix_asyncevlp" data-type="indexterm" id="calibre_link-677" class="calibre4"></a></p>
</div></section>













<section data-pdf-bookmark="Working with Callbacks" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1889">
<h1 class="calibre13">Working with Callbacks</h1>

<p class="author1">The basic unit of the asynchronous JavaScript program is the <em class="calibre5">callback</em>. A callback is a plain old function that you pass as an argument to another function.<a data-primary="NodeJS" data-secondary="callback-based fs.readFile API" data-type="indexterm" id="calibre_link-1264" class="calibre4"></a><a data-primary="asynchronous programming" data-secondary="callbacks" data-type="indexterm" id="calibre_link-674" class="calibre4"></a><a data-primary="callbacks" data-type="indexterm" id="calibre_link-720" class="calibre4"></a> As in a synchronous program, that other function invokes your function when it’s done doing whatever it does (making a network request, etc.). Callbacks invoked by asynchronous code are just functions, and there’s no giveaway in their type signatures that they are invoked asynchronously.</p>

<p class="author1">For NodeJS native APIs like <code class="calibre14">fs.readFile</code> (used to asynchronously read the contents of a file from disk) and <code class="calibre14">dns.resolveCname</code> (used to asynchronously resolve <code class="calibre14">CNAME</code> records), the convention for callbacks is that the first parameter is an error or <code class="calibre14">null</code>, and the second parameter is a result or <code class="calibre14">null</code>.</p>

<p class="author1">Here’s what <code class="calibre14">readFile</code>’s type signature looks like:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">readFile</code><code class="p">(</code>
  <code class="nx">path</code>: <code class="kt">string</code><code class="p">,</code>
  <code class="nx">options</code><code class="o">:</code> <code class="p">{</code><code class="nx">encoding</code>: <code class="kt">string</code><code class="p">,</code> <code class="nx">flag?</code>: <code class="kt">string</code><code class="p">},</code>
  <code class="nx">callback</code><code class="o">:</code> <code class="p">(</code><code class="nx">err</code>: <code class="kt">Error</code> <code class="o">|</code> <code class="kd">null</code><code class="p">,</code> <code class="nx">data</code>: <code class="kt">string</code> <code class="o">|</code> <code class="kd">null</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="kd">void</code>
<code class="p">)</code><code class="o">:</code> <code class="kd">void</code></pre>

<p class="author1">Notice that there’s nothing special about either <code class="calibre14">readFile</code>’s type or <code class="calibre14">callback</code>’s type: both are regular JavaScript functions. Looking at the signature, there’s no indication that <code class="calibre14">readFile</code> is asynchronous and that control  will be passed to the next line right after <code class="calibre14">readFile</code> is called (not waiting for its result).</p>
<div data-type="note" type="note" class="calibre21"><h6 class="calibre22">Note</h6>
<p class="author1">To run the following example yourself, be sure to first install type declarations for NodeJS:</p>

<pre data-code-language="sh" data-type="programlisting" class="calibre43">npm install @types/node --save-dev</pre>

<p class="author1">To learn more about third-party type declarations, jump ahead to <a data-type="xref" href="#calibre_link-340" class="calibre4">“JavaScript That Has Type Declarations on DefinitelyTyped”</a>.</p>
</div>

<p class="author1">For example, let’s write a NodeJS program that reads and writes to your Apache access log:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">import</code> <code class="o">*</code> <code class="kd">as</code> <code class="nx">fs</code> <code class="nx">from</code> <code class="s">'fs'</code>

<code class="c">// Read data from an Apache server's access log</code>
<code class="nx">fs</code><code class="p">.</code><code class="nx">readFile</code><code class="p">(</code>
  <code class="s">'/var/log/apache2/access_log'</code><code class="p">,</code>
  <code class="p">{</code><code class="nx">encoding</code><code class="o">:</code> <code class="s">'utf8'</code><code class="p">},</code>
  <code class="p">(</code><code class="nx">error</code><code class="p">,</code> <code class="nx">data</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
    <code class="kd">if</code> <code class="p">(</code><code class="nx">error</code><code class="p">)</code> <code class="p">{</code>
      <code class="nx">console</code><code class="p">.</code><code class="nx">error</code><code class="p">(</code><code class="s">'error reading!'</code><code class="p">,</code> <code class="nx">error</code><code class="p">)</code>
      <code class="kd">return</code>
    <code class="p">}</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">info</code><code class="p">(</code><code class="s">'success reading!'</code><code class="p">,</code> <code class="nx">data</code><code class="p">)</code>
  <code class="p">}</code>
<code class="p">)</code>

<code class="c">// Concurrently, write data to the same access log</code>
<code class="nx">fs</code><code class="p">.</code><code class="nx">appendFile</code><code class="p">(</code>
  <code class="s">'/var/log/apache2/access_log'</code><code class="p">,</code>
  <code class="s">'New access log entry'</code><code class="p">,</code>
  <code class="nx">error</code> <code class="o">=&gt;</code> <code class="p">{</code>
    <code class="kd">if</code> <code class="p">(</code><code class="nx">error</code><code class="p">)</code> <code class="p">{</code>
      <code class="nx">console</code><code class="p">.</code><code class="nx">error</code><code class="p">(</code><code class="s">'error writing!'</code><code class="p">,</code> <code class="nx">error</code><code class="p">)</code>
    <code class="p">}</code>
  <code class="p">})</code></pre>

<p class="author1">Unless you’re a TypeScript or JavaScript engineer and are familiar with how NodeJS’s built-in APIs work, and know that they’re asynchronous and you can’t rely on the order in which API calls appear in your code to dictate in which order filesystem operations actually happen, you wouldn’t know that we just introduced a subtle bug where the first <code class="calibre14">readFile</code> call may or may not return the access log with our new line appended, depending on how busy the filesystem is at the time this code runs.</p>

<p class="author1">You might know that <code class="calibre14">readFile</code> is asynchronous from experience, or because you saw it in NodeJS’s documentation, or because you know that NodeJS generally sticks to the convention that if a function’s last argument is a function that takes two arguments&mdash;an <code class="calibre14">Error | null</code> and a <code class="calibre14">T | null</code>, in that order&mdash;then the function is usually asynchronous, or because you ran across the hall to your neighbor for a cup of sugar and ended up staying for a while to chit-chat, then you somehow got on the topic of asynchronous programming in NodeJS and they told you about that time they had a similar issue a couple of months ago and how they fixed it.</p>

<p class="author1">Whatever it was, the types certainly didn’t help you get there.</p>

<p class="author1">Besides the fact that you <a data-primary="sequencing operations" data-secondary="in callbacks" data-type="indexterm" id="calibre_link-1433" class="calibre4"></a>can’t use types to help guide your intuition about the nature of a function’s synchronicity, callbacks are also difficult to sequence&mdash;which can lead to what some <a data-primary="callbacks" data-secondary="callback pyramids" data-type="indexterm" id="calibre_link-723" class="calibre4"></a>people call “callback pyramids”:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">async1</code><code class="p">((</code><code class="nx">err1</code><code class="p">,</code> <code class="nx">res1</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
  <code class="kd">if</code> <code class="p">(</code><code class="nx">res1</code><code class="p">)</code> <code class="p">{</code>
    <code class="nx">async2</code><code class="p">(</code><code class="nx">res1</code><code class="p">,</code> <code class="p">(</code><code class="nx">err2</code><code class="p">,</code> <code class="nx">res2</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
      <code class="kd">if</code> <code class="p">(</code><code class="nx">res2</code><code class="p">)</code> <code class="p">{</code>
        <code class="nx">async3</code><code class="p">(</code><code class="nx">res2</code><code class="p">,</code> <code class="p">(</code><code class="nx">err3</code><code class="p">,</code> <code class="nx">res3</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
          <code class="c">// ...</code>
        <code class="p">})</code>
      <code class="p">}</code>
    <code class="p">})</code>
  <code class="p">}</code>
<code class="p">})</code></pre>

<p class="author1">When sequencing operations, you usually want to continue down the chain when an operation succeeds, bailing out as soon as you hit an error.<a data-primary="errors" data-secondary="in callbacks" data-type="indexterm" id="calibre_link-887" class="calibre4"></a> With callbacks, you have to do this manually; when you start accounting for synchronous errors too (e.g., the NodeJS convention is to <code class="calibre14">throw</code> when you give it a badly typed argument, rather than calling your provided callback with an <code class="calibre14">Error</code> object), properly sequencing callbacks can get error-prone.</p>

<p class="author1">And sequencing is just one kind of operation you might want to run over asynchronous tasks&mdash;you might also want to run functions in parallel to know when they’re all done, race them to get the result of the first one that finishes, and so on.</p>

<p class="author1">This is a limitation of plain old callbacks. Without more sophisticated abstractions for operating on asynchronous tasks, working with multiple callbacks that depend on each other in some way can get messy fast.<a data-primary="NodeJS" data-secondary="callback-based fs.readFile API" data-startref="ix_NoJScllbk" data-type="indexterm" id="calibre_link-1265" class="calibre4"></a></p>

<p class="author1">To recap:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">Use callbacks to do simple asynchronous tasks.</p>
</li>
<li class="calibre11">
<p class="author1">While callbacks are great for modeling simple tasks, they quickly get hairy as you try to do things with <em class="calibre5">lots</em> of asynchronous tasks.<a data-primary="asynchronous programming" data-secondary="callbacks" data-startref="ix_asynccllbk" data-type="indexterm" id="calibre_link-675" class="calibre4"></a><a data-primary="callbacks" data-startref="ix_cllbk" data-type="indexterm" id="calibre_link-721" class="calibre4"></a></p>
</li>
</ul>
</div></section>













<section data-pdf-bookmark="Regaining Sanity with Promises" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1890">
<h1 class="calibre13">Regaining Sanity with Promises</h1>

<p class="author1">Luckily, we’re not the first programmers to run into these limitations. In this section we’ll develop the concept of <em class="calibre5">promises</em>,<a data-primary="promises" data-type="indexterm" id="calibre_link-1376" class="calibre4"></a><a data-primary="asynchronous programming" data-secondary="promises" data-type="indexterm" id="calibre_link-678" class="calibre4"></a> which are a way to abstract over asynchronous work so that we can compose it, sequence it, and so on. Even if you’ve worked with promises or futures before, this will be a helpful exercise to understand how they work.</p>
<div data-type="note" type="note" class="calibre21"><h6 class="calibre22">Note</h6>
<p class="author1">Most modern JavaScript platforms include built-in support for promises. In this section we’ll develop our own partial <code class="calibre14">Promise</code> implementation as an exercise, but in practice, you should use a built-in or off-the-shelf implementation instead. Check whether or not your favorite platform supports promises <a href="http://bit.ly/2uMxkk5" class="calibre4">here</a>, or jump ahead to <a data-type="xref" href="#calibre_link-375" class="calibre4">“lib”</a> to learn more about polyfilling promises on platforms they’re not natively supported on.</p>
</div>

<p class="author1">We’ll start with<a data-primary="promises" data-secondary="Promise implementation" data-type="indexterm" id="calibre_link-1378" class="calibre4"></a> an example of how we want to use <code class="calibre14">Promise</code> to first append to a file, then read back the result:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">appendAndReadPromise</code><code class="p">(</code><code class="nx">path</code>: <code class="kt">string</code><code class="p">,</code> <code class="nx">data</code>: <code class="kt">string</code><code class="p">)</code><code class="o">:</code> <code class="nx">Promise</code><code class="o">&lt;</code><code class="kt">string</code><code class="o">&gt;</code> <code class="p">{</code>
  <code class="kd">return</code> <code class="nx">appendPromise</code><code class="p">(</code><code class="nx">path</code><code class="p">,</code> <code class="nx">data</code><code class="p">)</code>
    <code class="p">.</code><code class="nx">then</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="nx">readPromise</code><code class="p">(</code><code class="nx">path</code><code class="p">))</code>
    <code class="p">.</code><code class="kd">catch</code><code class="p">(</code><code class="nx">error</code> <code class="o">=&gt;</code> <code class="nx">console</code><code class="p">.</code><code class="nx">error</code><code class="p">(</code><code class="nx">error</code><code class="p">))</code>
<code class="p">}</code></pre>

<p class="author1">Notice how there’s no callback pyramid here&mdash;we’ve effectively linearized what we want to do<a data-primary="callbacks" data-secondary="appendAndRead function example" data-type="indexterm" id="calibre_link-722" class="calibre4"></a> into a single, easy-to-understand chain of asynchronous tasks. When one succeeds, the next one runs; if it fails, we skip to the <code class="calibre14">catch</code> clause. With a callback-based API, this might have looked more like:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">appendAndRead</code><code class="p">(</code>
  <code class="nx">path</code>: <code class="kt">string</code><code class="p">,</code>
  <code class="nx">data</code>: <code class="kt">string</code>
  <code class="nx">cb</code><code class="o">:</code> <code class="p">(</code><code class="nx">error</code>: <code class="kt">Error</code> <code class="o">|</code> <code class="kd">null</code><code class="p">,</code> <code class="nx">result</code>: <code class="kt">string</code> <code class="o">|</code> <code class="kd">null</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="kd">void</code>
<code class="p">)</code> <code class="p">{</code>
  <code class="nx">appendFile</code><code class="p">(</code><code class="nx">path</code><code class="p">,</code> <code class="nx">data</code><code class="p">,</code> <code class="nx">error</code> <code class="o">=&gt;</code> <code class="p">{</code>
    <code class="kd">if</code> <code class="p">(</code><code class="nx">error</code><code class="p">)</code> <code class="p">{</code>
      <code class="kd">return</code> <code class="nx">cb</code><code class="p">(</code><code class="nx">error</code><code class="p">,</code> <code class="kd">null</code><code class="p">)</code>
    <code class="p">}</code>
    <code class="nx">readFile</code><code class="p">(</code><code class="nx">path</code><code class="p">,</code> <code class="p">(</code><code class="nx">error</code><code class="p">,</code> <code class="nx">result</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
      <code class="kd">if</code> <code class="p">(</code><code class="nx">error</code><code class="p">)</code> <code class="p">{</code>
        <code class="kd">return</code> <code class="nx">cb</code><code class="p">(</code><code class="nx">error</code><code class="p">,</code> <code class="kd">null</code><code class="p">)</code>
      <code class="p">}</code>
      <code class="nx">cb</code><code class="p">(</code><code class="kd">null</code><code class="p">,</code> <code class="nx">result</code><code class="p">)</code>
    <code class="p">})</code>
  <code class="p">})</code>
<code class="p">}</code></pre>

<p class="author1">Let’s design a <code class="calibre14">Promise</code> API that lets us do this.</p>

<p class="author1"><code class="calibre14">Promise</code> starts from humble beginnings:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">class</code> <code class="nx">Promise</code> <code class="p">{</code>
<code class="p">}</code></pre>

<p class="author1">A <code class="calibre14">new Promise</code> takes a function<a data-primary="executors" data-type="indexterm" id="calibre_link-989" class="calibre4"></a> we call an <em class="calibre5">executor</em>, which the <code class="calibre14">Promise</code> implementation will call with two arguments, a <code class="calibre14">resolve</code> function and a <code class="calibre14">reject</code> function:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">Executor</code> <code class="o">=</code> <code class="p">(</code>
  <code class="nx">resolve</code>: <code class="kt">Function</code><code class="p">,</code>
  <code class="nx">reject</code>: <code class="kt">Function</code>
<code class="p">)</code> <code class="o">=&gt;</code> <code class="kd">void</code>

<code class="kd">class</code> <code class="nx">Promise</code> <code class="p">{</code>
  <code class="kd">constructor</code><code class="p">(</code><code class="nx">f</code>: <code class="kt">Executor</code><code class="p">)</code> <code class="p">{}</code>
<code class="p">}</code></pre>

<p class="author1">How do <code class="calibre14">resolve</code> and <code class="calibre14">reject</code> work? Let’s demonstrate it by thinking about how we would manually wrap a callback-based NodeJS API like <code class="calibre14">fs.readFile</code> in a <code class="calibre14">Promise</code>-based API.<a data-primary="promises" data-secondary="wrapping callback-based NodeJS API fs.readFile  in Promise-based API" data-type="indexterm" id="calibre_link-1384" class="calibre4"></a><a data-primary="NodeJS" data-secondary="wrapping callback-based fs.readFileAPI  in Promise-based API" data-type="indexterm" id="calibre_link-1274" class="calibre4"></a> We use NodeJS’s built-in <code class="calibre14">fs.readFile</code> API like this:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">import</code> <code class="p">{</code><code class="nx">readFile</code><code class="p">}</code> <code class="nx">from</code> <code class="s">'fs'</code>

<code class="nx">readFile</code><code class="p">(</code><code class="nx">path</code><code class="p">,</code> <code class="p">(</code><code class="nx">error</code><code class="p">,</code> <code class="nx">result</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
  <code class="c">// ...</code>
<code class="p">})</code></pre>

<p class="author1">Wrapping that API in our <code class="calibre14">Promise</code> implementation, it now looks like this:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">import</code> <code class="p">{</code><code class="nx">readFile</code><code class="p">}</code> <code class="nx">from</code> <code class="s">'fs'</code>

<code class="kd">function</code> <code class="nx">readFilePromise</code><code class="p">(</code><code class="nx">path</code>: <code class="kt">string</code><code class="p">)</code><code class="o">:</code> <code class="nx">Promise</code><code class="o">&lt;</code><code class="kt">string</code><code class="o">&gt;</code> <code class="p">{</code>
  <code class="kd">return</code> <code class="kd">new</code> <code class="nx">Promise</code><code class="p">((</code><code class="nx">resolve</code><code class="p">,</code> <code class="nx">reject</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
    <code class="nx">readFile</code><code class="p">(</code><code class="nx">path</code><code class="p">,</code> <code class="p">(</code><code class="nx">error</code><code class="p">,</code> <code class="nx">result</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
      <code class="kd">if</code> <code class="p">(</code><code class="nx">error</code><code class="p">)</code> <code class="p">{</code>
        <code class="nx">reject</code><code class="p">(</code><code class="nx">error</code><code class="p">)</code>
      <code class="p">}</code> <code class="kd">else</code> <code class="p">{</code>
        <code class="nx">resolve</code><code class="p">(</code><code class="nx">result</code><code class="p">)</code>
      <code class="p">}</code>
    <code class="p">})</code>
  <code class="p">})</code>
<code class="p">}</code></pre>

<p class="author1">So, the type of <code class="calibre14">resolve</code>’s parameter depends on which specific API we’re using (in this case, its parameter’s type would be whatever <code class="calibre14">result</code>’s type is), and the type of <code class="calibre14">reject</code>’s parameter is always some type of <code class="calibre14">Error</code>.<a data-primary="errors" data-secondary="in Promise implementation" data-type="indexterm" id="calibre_link-889" class="calibre4"></a> Back to our implementation, let’s update our code by replacing our unsafe <code class="calibre14">Function</code> types with more specific types:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<code class="nx">type</code><code class="calibre14"> </code><code class="nx">Executor</code><strong class="calibre49"><code class="o1">&lt;</code><code class="nx1">T</code><code class="p1">,</code><code class="calibre50"> </code><code class="nx1">E</code><code class="calibre50"> </code><code class="k">extends</code><code class="calibre50"> </code><code class="nb1">Error</code><code class="o1">&gt;</code></strong><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">(</code><code class="calibre14">
  </code><code class="nx">resolve</code><code class="o">:</code><code class="calibre14"> </code><strong class="calibre49"><code class="p1">(</code><code class="nx1">result</code><code class="calibre50">: </code><code class="kt1">T</code><code class="p1">)</code><code class="calibre50"> </code><code class="o1">=</code><code class="o1">&gt;</code><code class="calibre50"> </code><code class="k">void</code></strong><code class="p">,</code><code class="calibre14">
  </code><code class="nx">reject</code><code class="o">:</code><code class="calibre14"> </code><strong class="calibre49"><code class="p1">(</code><code class="nx1">error</code><code class="calibre50">: </code><code class="kt1">E</code><code class="p1">)</code><code class="calibre50"> </code><code class="o1">=</code><code class="o1">&gt;</code><code class="calibre50"> </code><code class="k">void</code></strong><code class="calibre14">
</code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="kd">void</code><code class="calibre14">
</code><em class="calibre41"><code class="c2">// ...</code></em><code class="c">
</code></pre>

<p class="author1">Because we want to be able to get a sense for what type a <code class="calibre14">Promise</code> will resolve to just by looking at the <code class="calibre14">Promise</code> (for example, <code class="calibre14">Promise&lt;number&gt;</code> represents an <a data-primary="generic types" data-secondary="Promise" data-type="indexterm" id="calibre_link-1065" class="calibre4"></a><a data-primary="promises" data-secondary="Promise implementation" data-tertiary="generic type" data-type="indexterm" id="calibre_link-1379" class="calibre4"></a>asynchronous task that results in a <code class="calibre14">number</code>), we’ll make <code class="calibre14">Promise</code> generic, and pass its type parameters down to the <code class="calibre14">Executor</code> type in its constructor:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// ...</code>
<code class="kd">class</code> <code class="nx">Promise</code><code class="o">&lt;</code><code class="nx">T</code><code class="p">,</code> <code class="nx">E</code> <code class="kd">extends</code> <code class="nb">Error</code><code class="o">&gt;</code> <code class="p">{</code>
  <code class="kd">constructor</code><code class="p">(</code><code class="nx">f</code>: <code class="kt">Executor</code><code class="o">&lt;</code><code class="nx">T</code><code class="p">,</code> <code class="nx">E</code><code class="o">&gt;</code><code class="p">)</code> <code class="p">{}</code>
<code class="p">}</code></pre>

<p class="author1">So far, so good. We defined <code class="calibre14">Promise</code>’s constructor API and understand what the types at play are.<a data-primary="promises" data-secondary="Promise implementation" data-tertiary="sequencing Promises with then and catch" data-type="indexterm" id="calibre_link-1381" class="calibre4"></a><a data-primary="sequencing operations" data-secondary="in Promises" data-type="indexterm" id="calibre_link-1434" class="calibre4"></a> Now, let’s think about chaining&mdash;what are the operations we want to expose to run a sequence of <code class="calibre14">Promise</code>s, propagate their results, and catch their exceptions? If you look back to the initial code example at the start of this section, that’s what <code class="calibre14">then</code> and <code class="calibre14">catch</code> are for. Let’s add them to our <code class="calibre14">Promise</code> type:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<em class="calibre41"><code class="c2">// ...</code></em><code class="c">
</code><code class="kd">class</code><code class="calibre14"> </code><code class="nx">Promise</code><code class="o">&lt;</code><code class="nx">T</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">E</code><code class="calibre14"> </code><code class="kd">extends</code><code class="calibre14"> </code><code class="nb">Error</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="kd">constructor</code><code class="p">(</code><code class="nx">f</code><code class="calibre14">: </code><code class="kt">Executor</code><code class="o">&lt;</code><code class="nx">T</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">E</code><code class="o">&gt;</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="p">}</code><code class="calibre14">
  </code><strong class="calibre49"><code class="nx1">then</code><code class="o1">&lt;</code><code class="nx1">U</code><code class="p1">,</code><code class="calibre50"> </code><code class="nx1">F</code><code class="calibre50"> </code><code class="k">extends</code><code class="calibre50"> </code><code class="nb1">Error</code><code class="o1">&gt;</code><code class="p1">(</code><code class="nx1">g</code><code class="o1">:</code><code class="calibre50"> </code><code class="p1">(</code><code class="nx1">result</code><code class="calibre50">: </code><code class="kt1">T</code><code class="p1">)</code><code class="calibre50"> </code><code class="o1">=</code><code class="o1">&gt;</code><code class="calibre50"> </code><code class="nx1">Promise</code><code class="o1">&lt;</code><code class="nx1">U</code><code class="p1">,</code><code class="calibre50"> </code><code class="nx1">F</code><code class="o1">&gt;</code><code class="p1">)</code><code class="o1">:</code><code class="calibre50"> </code><code class="nx1">Promise</code><code class="o1">&lt;</code><code class="nx1">U</code><code class="p1">,</code><code class="calibre50"> </code><code class="nx1">F</code><code class="o1">&gt;</code><code class="calibre50">
  </code><code class="k">catch</code><code class="o1">&lt;</code><code class="nx1">U</code><code class="p1">,</code><code class="calibre50"> </code><code class="nx1">F</code><code class="calibre50"> </code><code class="k">extends</code><code class="calibre50"> </code><code class="nb1">Error</code><code class="o1">&gt;</code><code class="p1">(</code><code class="nx1">g</code><code class="o1">:</code><code class="calibre50"> </code><code class="p1">(</code><code class="nx1">error</code><code class="calibre50">: </code><code class="kt1">E</code><code class="p1">)</code><code class="calibre50"> </code><code class="o1">=</code><code class="o1">&gt;</code><code class="calibre50"> </code><code class="nx1">Promise</code><code class="o1">&lt;</code><code class="nx1">U</code><code class="p1">,</code><code class="calibre50"> </code><code class="nx1">F</code><code class="o1">&gt;</code><code class="p1">)</code><code class="o1">:</code><code class="calibre50"> </code><code class="nx1">Promise</code><code class="o1">&lt;</code><code class="nx1">U</code><code class="p1">,</code><code class="calibre50"> </code><code class="nx1">F</code><code class="o1">&gt;</code></strong><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code></pre>

<p class="author1"><code class="calibre14">then</code> and <code class="calibre14">catch</code> are two ways to sequence <code class="calibre14">Promise</code>s: <code class="calibre14">then</code> maps a successful result of a <code class="calibre14">Promise</code> to a new <code class="calibre14">Promise</code>,<sup class="calibre15"><a data-type="noteref" href="#calibre_link-376" id="calibre_link-429" class="calibre16">2</a></sup> and <code class="calibre14">catch</code> recovers from a rejection by mapping an error to a new <code class="calibre14">Promise</code>.</p>

<p class="author1">Using <code class="calibre14">then</code> looks<a data-primary="then clause" data-type="indexterm" id="calibre_link-1472" class="calibre4"></a> like this:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">a</code><code class="o">:</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="nx">Promise</code><code class="o">&lt;</code><code class="kt">string</code><code class="p">,</code> <code class="nx">TypeError</code><code class="o">&gt;</code> <code class="o">=</code> <code class="c">// ...</code>
<code class="kd">let</code> <code class="nx">b</code><code class="o">:</code> <code class="p">(</code><code class="nx">s</code>: <code class="kt">string</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="nx">Promise</code><code class="o">&lt;</code><code class="kt">number</code><code class="p">,</code> <code class="nx">never</code><code class="o">&gt;</code> <code class="o">=</code> <code class="c">// ...</code>
<code class="kd">let</code> <code class="nx">c</code><code class="o">:</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="nx">Promise</code><code class="o">&lt;</code><code class="kd">boolean</code><code class="p">,</code> <code class="nx">RangeError</code><code class="o">&gt;</code> <code class="o">=</code> <code class="c">// ...</code>

<code class="nx">a</code><code class="p">()</code>
  <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">b</code><code class="p">)</code>
  <code class="p">.</code><code class="kd">catch</code><code class="p">(</code><code class="nx">e</code> <code class="o">=&gt;</code> <code class="nx">c</code><code class="p">())</code> <code class="c">// b won't error, so this is if a errors</code>
  <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">result</code> <code class="o">=&gt;</code> <code class="nx">console</code><code class="p">.</code><code class="nx">info</code><code class="p">(</code><code class="s">'Done'</code><code class="p">,</code> <code class="nx">result</code><code class="p">))</code>
  <code class="p">.</code><code class="kd">catch</code><code class="p">(</code><code class="nx">e</code> <code class="o">=&gt;</code> <code class="nx">console</code><code class="p">.</code><code class="nx">error</code><code class="p">(</code><code class="s">'Error'</code><code class="p">,</code> <code class="nx">e</code><code class="p">))</code></pre>

<p class="author1">Because the type of <code class="calibre14">b</code>’s second type argument is <code class="calibre14">never</code> (meaning <code class="calibre14">b</code> will never throw an error), the <a data-primary="catch clause" data-type="indexterm" id="calibre_link-724" class="calibre4"></a>first <code class="calibre14">catch</code> clause will only get called if <code class="calibre14">a</code> errors. But notice that when we use a <code class="calibre14">Promise</code>, we don’t have to care about the fact that <code class="calibre14">a</code> might throw but <code class="calibre14">b</code> won’t&mdash;if <code class="calibre14">a</code> succeeds then we map the <code class="calibre14">Promise</code> to <code class="calibre14">b</code>, and otherwise we jump to the first <code class="calibre14">catch</code> clause and map the <code class="calibre14">Promise</code> to <code class="calibre14">c</code>. If <code class="calibre14">c</code> succeeds then we log <code class="calibre14">Done</code>, and if it rejects then we <code class="calibre14">catch</code> again.<a data-primary="try/catch statements" data-type="indexterm" id="calibre_link-1495" class="calibre4"></a> This mimics how regular old <code class="calibre14">try</code>/<code class="calibre14">catch</code> statements work, and does for asynchronous tasks what <code class="calibre14">try</code>/<code class="calibre14">catch</code> does for synchronous ones (see <a data-type="xref" href="#calibre_link-377" class="calibre4">Figure&nbsp;8-2</a>).</p>

<figure class="calibre33"><div class="figure" id="calibre_link-377">
<img alt="prts 0802" src="images/000023.png" class="calibre40" />
<h6 class="calibre34"><span class="calibre">Figure 8-2. </span>The Promise state machine</h6>
</div></figure>

<p class="author1">We also have to handle the case of <code class="calibre14">Promise</code>s that throw actual exceptions (as in, <code class="calibre14">throw Error('foo')</code>).<a data-primary="exceptions" data-secondary="throwing" data-tertiary="in Promises" data-type="indexterm" id="calibre_link-987" class="calibre4"></a><a data-primary="errors" data-secondary="handling" data-tertiary="in Promises" data-type="indexterm" id="calibre_link-879" class="calibre4"></a> When we implement <code class="calibre14">then</code> and <code class="calibre14">catch</code>, we’ll do this by wrapping code in <code class="calibre14">try</code>/<code class="calibre14">catch</code>es and rejecting in the <code class="calibre14">catch</code> clause. This does have a few implications, though. It means that:</p>
<ol class="calibre31">
<li class="calibre32">
<p class="author1">Every <code class="calibre14">Promise</code> has the potential to reject, and we can’t statically check for this (because TypeScript doesn’t support indicating in a function’s signature which exceptions the function might throw).<a data-primary="promises" data-secondary="Promise implementation" data-tertiary="rejecting Promises with an error" data-type="indexterm" id="calibre_link-1380" class="calibre4"></a></p>
</li>
<li class="calibre32">
<p class="author1">A <code class="calibre14">Promise</code> won’t always be rejected with an <code class="calibre14">Error</code>. Because TypeScript has no choice but to inherit JavaScript’s behavior, and in JavaScript when you <code class="calibre14">throw</code> you can throw anything&mdash;a string, a function, an array, a <code class="calibre14">Promise</code>, and not necessarily an <code class="calibre14">Error</code>&mdash;we can’t assume that a rejection will be a subtype of <code class="calibre14">Error</code>. It’s unfortunate, but this is a sacrifice we’ll make in the name of not having to force consumers to <code class="calibre14">try/catch</code> every promise chain (which might be spread across multiple files or modules!).</p>
</li>

</ol>

<p class="author1">Taking that into account, let’s loosen our <code class="calibre14">Promise</code> type a bit by not typing errors:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">Executor</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code> <code class="o">=</code> <code class="p">(</code>
  <code class="nx">resolve</code><code class="o">:</code> <code class="p">(</code><code class="nx">result</code>: <code class="kt">T</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="kd">void</code><code class="p">,</code>
  <code class="nx">reject</code><code class="o">:</code> <code class="p">(</code><code class="nx">error</code>: <code class="kt">unknown</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="kd">void</code>
<code class="p">)</code> <code class="o">=&gt;</code> <code class="kd">void</code>

<code class="kd">class</code> <code class="nx">Promise</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code> <code class="p">{</code>
  <code class="kd">constructor</code><code class="p">(</code><code class="nx">f</code>: <code class="kt">Executor</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="p">)</code> <code class="p">{}</code>
  <code class="nx">then</code><code class="o">&lt;</code><code class="nx">U</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">g</code><code class="o">:</code> <code class="p">(</code><code class="nx">result</code>: <code class="kt">T</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="nx">Promise</code><code class="o">&lt;</code><code class="nx">U</code><code class="o">&gt;</code><code class="p">)</code><code class="o">:</code> <code class="nx">Promise</code><code class="o">&lt;</code><code class="nx">U</code><code class="o">&gt;</code> <code class="p">{</code>
    <code class="c">// ...</code>
  <code class="p">}</code>
  <code class="kd">catch</code><code class="o">&lt;</code><code class="nx">U</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">g</code><code class="o">:</code> <code class="p">(</code><code class="nx">error</code>: <code class="kt">unknown</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="nx">Promise</code><code class="o">&lt;</code><code class="nx">U</code><code class="o">&gt;</code><code class="p">)</code><code class="o">:</code> <code class="nx">Promise</code><code class="o">&lt;</code><code class="nx">U</code><code class="o">&gt;</code> <code class="p">{</code>
    <code class="c">// ...</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p class="author1">We now have a fully baked <code class="calibre14">Promise</code> interface.</p>

<p class="author1">I’ll leave it as an exercise for you to hook it all together with implementations for <code class="calibre14">then</code> and <code class="calibre14">catch</code>. The implementation for <code class="calibre14">Promise</code> is notoriously tricky to write correctly&mdash;if you’re ambitious and have a couple of hours free, head over to the <a href="http://bit.ly/2JT3KUh" class="calibre4">ES2015 specification</a> for a walkthrough of how <code class="calibre14">Promise</code>’s state machine should work under the hood.<a data-primary="promises" data-startref="ix_prom" data-type="indexterm" id="calibre_link-1377" class="calibre4"></a><a data-primary="asynchronous programming" data-secondary="promises" data-startref="ix_asyncprom" data-type="indexterm" id="calibre_link-679" class="calibre4"></a></p>
</div></section>













<section data-pdf-bookmark="async and await" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1891">
<h1 class="calibre13">async and await</h1>

<p class="author1">Promises are a really powerful abstraction for working with asynchronous code. They’re such a popular pattern that they even have their own JavaScript (and therefore, TypeScript) syntax: <code class="calibre14">async</code> and <code class="calibre14">await</code>.<a data-primary="asynchronous programming" data-secondary="async and await" data-type="indexterm" id="calibre_link-669" class="calibre4"></a><a data-primary="async and await syntax" data-type="indexterm" id="calibre_link-666" class="calibre4"></a><a data-primary="promises" data-secondary="using async and await with" data-type="indexterm" id="calibre_link-1383" class="calibre4"></a> This syntax lets you interact with asynchronous operations the same way you do with synchronous ones.</p>
<div data-type="tip" class="calibre21"><h6 class="calibre22">Tip</h6>
<p class="author1">Think of <code class="calibre14">await</code> as language-level syntax sugar for <code class="calibre14">.then</code>. When you <code class="calibre14">await</code> a <code class="calibre14">Promise</code>, you have to do so in an <code class="calibre14">async</code> block. And instead of <code class="calibre14">.catch</code>, you can wrap your <code class="calibre14">await</code> in a regular <code class="calibre14">try</code>/<code class="calibre14">catch</code> block.<a data-primary="then  clause" data-secondary="using async and await instead of" data-type="indexterm" id="calibre_link-1473" class="calibre4"></a></p>
</div>

<p class="author1">Let’s say you have<a data-primary="finally clause" data-type="indexterm" id="calibre_link-1004" class="calibre4"></a> the following promise (we didn’t cover <code class="calibre14">finally</code> in the previous section, but it behaves the way you think it would, firing after both <code class="calibre14">then</code> and <code class="calibre14">catch</code> have a<a data-primary="catch clause" data-type="indexterm" id="calibre_link-725" class="calibre4"></a> chance to fire):</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">getUser() {</code>
  <code class="nx">getUserID</code><code class="p">(</code><code class="mi">18</code><code class="p">)</code>
    <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">user</code> <code class="o">=&gt;</code> <code class="nx">getLocation</code><code class="p">(</code><code class="nx">user</code><code class="p">))</code>
    <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">location</code> <code class="o">=&gt;</code> <code class="nx">console</code><code class="p">.</code><code class="nx">info</code><code class="p">(</code><code class="s">'got location'</code><code class="p">,</code> <code class="nx">location</code><code class="p">))</code>
    <code class="p">.</code><code class="kd">catch</code><code class="p">(</code><code class="nx">error</code> <code class="o">=&gt;</code> <code class="nx">console</code><code class="p">.</code><code class="nx">error</code><code class="p">(</code><code class="nx">error</code><code class="p">))</code>
    <code class="p">.</code><code class="kd">finally</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="nx">console</code><code class="p">.</code><code class="nx">info</code><code class="p">(</code><code class="s">'done getting location'</code><code class="p">))</code>
<code class="p">}</code></pre>

<p class="author1">To convert this code to <code class="calibre14">async</code> and <code class="calibre14">await</code>, first put it in an <code class="calibre14">async</code> function, then <code class="calibre14">await</code> the promise’s result:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<strong class="calibre49"><code class="nx1">async</code></strong><code class="calibre14"> </code><code class="kd">function</code><code class="calibre14"> </code><code class="nx">getUser() {</code><code class="calibre14">
  </code><code class="kd">try</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
    </code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">user</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><strong class="calibre49"><code class="nx1">await</code></strong><code class="calibre14"> </code><code class="nx">getUserID</code><code class="p">(</code><code class="mi">18</code><code class="p">)</code><code class="calibre14">
    </code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">location</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><strong class="calibre49"><code class="nx1">await</code></strong><code class="calibre14"> </code><code class="nx">getLocation</code><code class="p">(</code><code class="nx">user</code><code class="p">)</code><code class="calibre14">
    </code><code class="nx">console</code><code class="p">.</code><code class="nx">info</code><code class="p">(</code><code class="s">'got location'</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">user</code><code class="p">)</code><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14"> </code><code class="kd">catch</code><code class="p">(</code><code class="nx">error</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
    </code><code class="nx">console</code><code class="p">.</code><code class="nx">error</code><code class="p">(</code><code class="nx">error</code><code class="p">)</code><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14"> </code><code class="kd">finally</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
    </code><code class="nx">console</code><code class="p">.</code><code class="nx">info</code><code class="p">(</code><code class="s">'done getting location'</code><code class="p">)</code><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code></pre>

<p class="author1">Since <code class="calibre14">async</code> and <code class="calibre14">await</code> are JavaScript features, we won’t go into them in depth here&mdash;suffice it to say that TypeScript has full support for them, and they are completely typesafe. Use them whenever you work with promises, to make it easier to reason about chained operations and avoid lots of <code class="calibre14">then</code>s. To learn more about <code class="calibre14">async</code> and <code class="calibre14">await</code>, head over to their documentation on <a href="https://mzl.la/2TJLFYt" class="calibre4">MDN</a>.</p>
</div></section>













<section data-pdf-bookmark="Async Streams" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1892">
<h1 class="calibre13">Async Streams</h1>

<p class="author1">While promises are fantastic for modeling, sequencing, and composing future values, what if you have multiple values,<a data-primary="asynchronous programming" data-secondary="async streams" data-type="indexterm" id="calibre_link-670" class="calibre4"></a> which will become available at multiple points in the future? This is less exotic than it sounds&mdash;think bits of a file being read from the filesystem, pixels of a video streaming over the internet from the Netflix server to your laptop, a bunch of keystrokes as you fill out a form, some friends coming over to your house for a dinner party, or votes being deposited into a ballot box throughout the course of Super Tuesday. While these things may sound pretty different on the surface, you can look at them all as asynchronous streams; they are all lists of things where each thing comes in at some point in the future.<a data-primary="event emitters" data-type="indexterm" id="calibre_link-973" class="calibre4"></a></p>

<p class="author1">There are a few ways to model this, <a data-primary="NodeJS" data-secondary="EventEmitter" data-type="indexterm" id="calibre_link-1266" class="calibre4"></a><a data-primary="reactive programming libraries" data-type="indexterm" id="calibre_link-1405" class="calibre4"></a><a data-primary="RxJS library" data-type="indexterm" id="calibre_link-1427" class="calibre4"></a>the most common being with an event emitter (like NodeJS’s <code class="calibre14">EventEmitter</code>) or with a reactive programming library like <a href="https://www.npmjs.com/package/@reactivex/rxjs" class="calibre4">RxJS</a>.<sup class="calibre15"><a data-type="noteref" href="#calibre_link-378" id="calibre_link-431" class="calibre16">3</a></sup> The difference between the two is like the difference between callbacks and promises: events are quick and lightweight, while reactive programming libraries are more powerful, and give you the ability to compose and sequence streams of events.</p>

<p class="author1">We’ll go over event emitters in the following section. To learn more about reactive programming, head over to the documentation for your favorite reactive programming library&mdash;for example, <a href="https://www.npmjs.com/package/@reactivex/rxjs" class="calibre4">RxJS</a>, <a href="https://github.com/mostjs/core" class="calibre4">MostJS</a>, or  <a href="https://www.npmjs.com/package/xstream" class="calibre4">xstream</a>.</p>








<section data-pdf-bookmark="Event Emitters" data-type="sect2" class="preface"><div class="preface" id="calibre_link-385">
<h2 class="calibre17">Event Emitters</h2>

<p class="author1">At a high level, event emitters offer APIs<a data-primary="asynchronous programming" data-secondary="async streams" data-tertiary="event emitters" data-type="indexterm" id="calibre_link-672" class="calibre4"></a><a data-primary="channels, emitting events on" data-type="indexterm" id="calibre_link-726" class="calibre4"></a> that support emitting events on a channel and listening for events on that channel:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">interface</code> <code class="nx">Emitter</code> <code class="p">{</code>

  <code class="c">// Send an event</code>
  <code class="nx">emit</code><code class="p">(</code><code class="nx">channel</code>: <code class="kt">string</code><code class="p">,</code> <code class="nx">value</code>: <code class="kt">unknown</code><code class="p">)</code><code class="o">:</code> <code class="kd">void</code>

  <code class="c">// Do something when an event is sent</code>
  <code class="nx">on</code><code class="p">(</code><code class="nx">channel</code>: <code class="kt">string</code><code class="p">,</code> <code class="nx">f</code><code class="o">:</code> <code class="p">(</code><code class="nx">value</code>: <code class="kt">unknown</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="kd">void</code><code class="p">)</code><code class="o">:</code> <code class="kd">void</code>

<code class="p">}</code></pre>

<p class="author1">Event emitters are a popular design pattern in JavaScript. You might have encountered them when using DOM events, JQuery events, or NodeJS’s <code class="calibre14">EventEmitter</code> <span class="calibre">module</span>.</p>

<p class="author1">In most languages, event emitters like this one are unsafe. That’s because the type of <code class="calibre14">value</code> depends on the specific <code class="calibre14">channel</code>, and in most languages you can’t use types to represent that relationship. Unless your language supports both overloaded function signatures and literal types, you’re going to have trouble saying “this is the type of event emitted on this channel.” Macros that generate methods to emit events and listen on each channel are a common workaround to this problem, but in TypeScript,  you can express this naturally and safely using the type system.</p>

<p class="author1">For example, say we’re using the <a href="https://github.com/NodeRedis/node_redis" class="calibre4">NodeRedis client</a>, a Node API for the popular Redis in-memory datastore.<a data-primary="Node API for Redis" data-type="indexterm" id="calibre_link-1262" class="calibre4"></a><a data-primary="Redis library, using" data-type="indexterm" id="calibre_link-1410" class="calibre4"></a> It works like this:</p>
<pre class="calibre30" data-code-language="ts" data-type="programlisting">
<code class="kd">import</code> <code class="nx">Redis</code> <code class="nx">from</code> <code class="s">'redis'</code>

<code class="c">// Create a new instance of a Redis client</code>
<code class="kd">let</code> <code class="nx">client</code> <code class="o">=</code> <code class="nx">redis</code><code class="p">.</code><code class="nx">createClient</code><code class="p">()</code>

<code class="c">// Listen for a few events emitted by the client</code>
<code class="nx">client</code><code class="p">.</code><code class="nx">on</code><code class="p">(</code><code class="s">'ready'</code><code class="p">,</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="nx">console</code><code class="p">.</code><code class="nx">info</code><code class="p">(</code><code class="s">'Client is ready'</code><code class="p">))</code>
<code class="nx">client</code><code class="p">.</code><code class="nx">on</code><code class="p">(</code><code class="s">'error'</code><code class="p">,</code> <code class="nx">e</code> <code class="o">=&gt;</code> <code class="nx">console</code><code class="p">.</code><code class="nx">error</code><code class="p">(</code><code class="s">'An error occurred!'</code><code class="p">,</code> <code class="nx">e</code><code class="p">))</code>
<code class="nx">client</code><code class="p">.</code><code class="nx">on</code><code class="p">(</code><code class="s">'reconnecting'</code><code class="p">,</code> <code class="nx">params</code> <code class="o">=&gt;</code> <code class="nx">console</code><code class="p">.</code><code class="nx">info</code><code class="p">(</code><code class="s">'Reconnecting...'</code><code class="p">,</code> <code class="nx">params</code><code class="p">))</code>
</pre>

<p class="author1">As programmers using the Redis library, we want to know what types of arguments to expect in our callbacks when we use the <code class="calibre14">on</code> API. But because the type of each argument depends on the channel that Redis emits on, a single type won’t cut it. If we were the authors of this library, the simplest way to achieve safety would be with an overloaded type:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">RedisClient</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">on</code><code class="p">(</code><code class="nx">event</code><code class="o">:</code> <code class="s">'ready'</code><code class="p">,</code> <code class="nx">f</code><code class="o">:</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="kd">void</code><code class="p">)</code><code class="o">:</code> <code class="kd">void</code>
  <code class="nx">on</code><code class="p">(</code><code class="nx">event</code><code class="o">:</code> <code class="s">'error'</code><code class="p">,</code> <code class="nx">f</code><code class="o">:</code> <code class="p">(</code><code class="nx">e</code>: <code class="kt">Error</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="kd">void</code><code class="p">)</code><code class="o">:</code> <code class="kd">void</code>
  <code class="nx">on</code><code class="p">(</code><code class="nx">event</code><code class="o">:</code> <code class="s">'reconnecting'</code><code class="p">,</code>
     <code class="nx">f</code><code class="o">:</code> <code class="p">(</code><code class="nx">params</code><code class="o">:</code> <code class="p">{</code><code class="nx">attempt</code>: <code class="kt">number</code><code class="p">,</code> <code class="nx">delay</code>: <code class="kt">number</code><code class="p">})</code> <code class="o">=&gt;</code> <code class="kd">void</code><code class="p">)</code><code class="o">:</code> <code class="kd">void</code>
<code class="p">}</code></pre>

<p class="author1">This works pretty well, but it’s a bit wordy.<a data-primary="mapped types" data-secondary="using to build typesafe event emitters" data-type="indexterm" id="calibre_link-1201" class="calibre4"></a> Let’s express it in terms of a mapped type (see <a data-type="xref" href="#calibre_link-257" class="calibre4">“Mapped Types”</a>), pulling out the event definitions into their own type, <code class="calibre14">Events</code>:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code><code class="calibre14"> </code><code class="nx">Events</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-379" id="calibre_link-381"><img alt="1" src="images/000000.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="nx">ready</code><code class="calibre14">: </code><code class="kt">void</code><code class="calibre14">
  </code><code class="nx">error</code><code class="calibre14">: </code><code class="kt">Error</code><code class="calibre14">
  </code><code class="nx">reconnecting</code><code class="o">:</code><code class="calibre14"> </code><code class="p">{</code><code class="nx">attempt</code><code class="calibre14">: </code><code class="kt">number</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">delay</code><code class="calibre14">: </code><code class="kt">number</code><code class="p">}</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">

</code><code class="nx">type</code><code class="calibre14"> </code><code class="nx">RedisClient</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-380" id="calibre_link-382"><img alt="2" src="images/000001.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="nx">on</code><code class="o">&lt;</code><code class="nx">E</code><code class="calibre14"> </code><code class="kd">extends</code><code class="calibre14"> </code><code class="nx">keyof</code><code class="calibre14"> </code><code class="nx">Events</code><code class="o">&gt;</code><code class="p">(</code><code class="calibre14">
    </code><code class="nx">event</code><code class="calibre14">: </code><code class="kt">E</code><code class="p">,</code><code class="calibre14">
    </code><code class="nx">f</code><code class="o">:</code><code class="calibre14"> </code><code class="p">(</code><code class="nx">arg</code><code class="calibre14">: </code><code class="kt">Events</code><code class="p">[</code><code class="nx">E</code><code class="p">]</code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="kd">void</code><code class="calibre14">
  </code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="kd">void</code><code class="calibre14">
</code><code class="p">}</code></pre>
<dl class="preface">
<dt class="calibre18"><a class="calibre4" href="#calibre_link-381" id="calibre_link-379"><img alt="1" src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We start by defining a single object type that enumerates every event the Redis client might emit, along with the arguments for that event.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-382" id="calibre_link-380"><img alt="2" src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We map over our <code class="calibre14">Events</code> type, telling TypeScript that <code class="calibre14">on</code> can be called with any of the events we defined.</p></dd>
</dl>

<p class="author1">We can then use this type to make the Node&ndash;Redis library safer, by typing both of its methods&mdash;<code class="calibre14">emit</code> and <code class="calibre14">on</code>&mdash;as safely as possible:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// ...</code>
<code class="nx">type</code> <code class="nx">RedisClient</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">on</code><code class="o">&lt;</code><code class="nx">E</code> <code class="kd">extends</code> <code class="nx">keyof</code> <code class="nx">Events</code><code class="o">&gt;</code><code class="p">(</code>
    <code class="nx">event</code>: <code class="kt">E</code><code class="p">,</code>
    <code class="nx">f</code><code class="o">:</code> <code class="p">(</code><code class="nx">arg</code>: <code class="kt">Events</code><code class="p">[</code><code class="nx">E</code><code class="p">])</code> <code class="o">=&gt;</code> <code class="kd">void</code>
  <code class="p">)</code><code class="o">:</code> <code class="kd">void</code>
  <code class="nx">emit</code><code class="o">&lt;</code><code class="nx">E</code> <code class="kd">extends</code> <code class="nx">keyof</code> <code class="nx">Events</code><code class="o">&gt;</code><code class="p">(</code>
    <code class="nx">event</code>: <code class="kt">E</code><code class="p">,</code>
    <code class="nx">arg</code>: <code class="kt">Events</code><code class="p">[</code><code class="nx">E</code><code class="p">]</code>
  <code class="p">)</code><code class="o">:</code> <code class="kd">void</code>
<code class="p">}</code></pre>

<p class="author1">This pattern of pulling out event names and arguments into a shape and mapping over that shape to generate listeners and emitters<a data-primary="listeners, creating" data-type="indexterm" id="calibre_link-1196" class="calibre4"></a> is common in real-world TypeScript code. It’s also terse, and very safe. When an emitter is typed this way you can’t misspell a key, mistype an argument, or forget to pass in an argument. It also serves as documentation for engineers using your code, as their code editors will suggest to them the possible events they might listen on and the types of parameters in those events’ callbacks.</p>
<aside data-type="sidebar" type="sidebar" class="keyterm"><div class="sidebar" id="calibre_link-1893">
<h5 class="calibre29">Emitters in the Wild</h5>
<p class="author1">Using mapped types to build typesafe event emitters is a popular pattern. For example, it’s how DOM events are <a data-primary="DOM (Document Object Model)" data-secondary="events, typed in TypeScript standard library" data-type="indexterm" id="calibre_link-852" class="calibre4"></a>typed in TypeScript’s standard library. <code class="calibre14">WindowEventMap</code> is a mapping <a data-primary="WindowEventMap interface" data-type="indexterm" id="calibre_link-1762" class="calibre4"></a>from event name to event type, which the <code class="calibre14">.addEventListener</code> and <span class="calibre"><code class="calibre14">.removeEventListener</code></span> APIs map over to produce better, more specific event types than the default <code class="calibre14">Event</code> type:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// lib.dom.ts</code>
<code class="kd">interface</code> <code class="nx">WindowEventMap</code> <code class="kd">extends</code> <code class="nx">GlobalEventHandlersEventMap</code> <code class="p">{</code>
  <code class="c">// ...</code>
  <code class="nx">contextmenu</code>: <code class="kt">PointerEvent</code>
  <code class="nx">dblclick</code>: <code class="kt">MouseEvent</code>
  <code class="nx">devicelight</code>: <code class="kt">DeviceLightEvent</code>
  <code class="nx">devicemotion</code>: <code class="kt">DeviceMotionEvent</code>
  <code class="nx">deviceorientation</code>: <code class="kt">DeviceOrientationEvent</code>
  <code class="nx">drag</code>: <code class="kt">DragEvent</code>
  <code class="c">// ...</code>
<code class="p">}</code>

<code class="kd">interface</code> <code class="nx">Window</code> <code class="kd">extends</code> <code class="nx">EventTarget</code><code class="p">,</code> <code class="nx">WindowTimers</code><code class="p">,</code> <code class="nx">WindowSessionStorage</code><code class="p">,</code>
  <code class="nx">WindowLocalStorage</code><code class="p">,</code> <code class="nx">WindowConsole</code><code class="p">,</code> <code class="nx">GlobalEventHandlers</code><code class="p">,</code> <code class="nx">IDBEnvironment</code><code class="p">,</code>
  <code class="nx">WindowBase64</code><code class="p">,</code> <code class="nx">GlobalFetch</code> <code class="p">{</code>
  <code class="c">// ...</code>
  <code class="nx">addEventListener</code><code class="o">&lt;</code><code class="nx">K</code> <code class="kd">extends</code> <code class="nx">keyof</code> <code class="nx">WindowEventMap</code><code class="o">&gt;</code><code class="p">(</code>
    <code class="nx">type</code>: <code class="kt">K</code><code class="p">,</code>
    <code class="nx">listener</code><code class="o">:</code> <code class="p">(</code><code class="kd">this</code><code class="o">:</code> <code class="nx">Window</code><code class="p">,</code> <code class="nx">ev</code>: <code class="kt">WindowEventMap</code><code class="p">[</code><code class="nx">K</code><code class="p">])</code> <code class="o">=&gt;</code> <code class="nx">any</code><code class="p">,</code>
    <code class="nx">options?</code>: <code class="kt">boolean</code> <code class="o">|</code> <code class="nx">AddEventListenerOptions</code>
  <code class="p">)</code><code class="o">:</code> <code class="kd">void</code>
  <code class="nx">removeEventListener</code><code class="o">&lt;</code><code class="nx">K</code> <code class="kd">extends</code> <code class="nx">keyof</code> <code class="nx">WindowEventMap</code><code class="o">&gt;</code><code class="p">(</code>
    <code class="nx">type</code>: <code class="kt">K</code><code class="p">,</code>
    <code class="nx">listener</code><code class="o">:</code> <code class="p">(</code><code class="kd">this</code><code class="o">:</code> <code class="nx">Window</code><code class="p">,</code> <code class="nx">ev</code>: <code class="kt">WindowEventMap</code><code class="p">[</code><code class="nx">K</code><code class="p">])</code> <code class="o">=&gt;</code> <code class="nx">any</code><code class="p">,</code>
    <code class="nx">options?</code>: <code class="kt">boolean</code> <code class="o">|</code> <code class="nx">EventListenerOptions</code>
  <code class="p">)</code><code class="o">:</code> <code class="kd">void</code>
<code class="p">}</code></pre>
</div></aside>
</div></section>





</div></section>













<section data-pdf-bookmark="Typesafe Multithreading" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1894">
<h1 class="calibre13">Typesafe Multithreading</h1>

<p class="author1">So far, we’ve been talking about asynchronous programs that you might run on a single CPU thread,<a data-primary="asynchronous programming" data-secondary="async streams" data-startref="ix_asyncstrmevem" data-tertiary="event emitters" data-type="indexterm" id="calibre_link-673" class="calibre4"></a><a data-primary="event emitters" data-type="indexterm" id="calibre_link-974" class="calibre4"></a><a data-primary="asynchronous programming" data-secondary="asynchronous streams" data-startref="ix_asyncstrm" data-type="indexterm" id="calibre_link-671" class="calibre4"></a><a data-primary="asynchronous programming" data-startref="ix_async" data-type="indexterm" id="calibre_link-668" class="calibre4"></a> a class of programs that most JavaScript and TypeScript programs you’ll write will likely fall into. <a data-primary="multithreading" data-type="indexterm" id="calibre_link-1238" class="calibre4"></a>But sometimes, when doing CPU-intensive tasks, you might opt for true parallelism: the ability to split out work across multiple threads, in order to do it faster or to keep your main thread idle and responsive.<a data-primary="parallelism" data-seealso="multithreading" data-type="indexterm" id="calibre_link-1338" class="calibre4"></a> In this section, we’ll explore a few patterns for writing safe, parallel programs in the browser and on the server.</p>








<section data-pdf-bookmark="In the Browser: With Web Workers" data-type="sect2" class="preface"><div class="preface" id="calibre_link-427">
<h2 class="calibre17">In the Browser: With Web Workers</h2>

<p class="author1">Web Workers are a widely supported way to do multithreading in the browser.<a data-primary="multithreading" data-secondary="in the browser with Web Workers" data-type="indexterm" id="calibre_link-1240" class="calibre4"></a><a data-primary="browsers" data-secondary="typesafe multithreading with Web Workers" data-type="indexterm" id="calibre_link-704" class="calibre4"></a><a data-primary="Web Workers, typesafe multithreading with" data-type="indexterm" id="calibre_link-1756" class="calibre4"></a> You spin up some workers&mdash;special restricted background threads&mdash;from the main JavaScript thread, and use them to do things that would have otherwise blocked the main thread and made the UI unresponsive (i.e., CPU-bound tasks). Web Workers are a way to run code in the browser in a truly parallel way; while asynchronous APIs like <code class="calibre14">Promise</code> and <code class="calibre14">setTimeout</code> run code concurrently, Workers give you the ability to run code in parallel, on another CPU thread. Web Workers can send network requests, write to the filesystem, and so on, with a few minor restrictions.</p>

<p class="author1">Because Web Workers are a browser-provided API, its designers put a lot of emphasis on safety&mdash;not type safety like we know and<a data-primary="memory safety" data-type="indexterm" id="calibre_link-1203" class="calibre4"></a> love, but <em class="calibre5">memory safety</em>. Anyone that’s written C, C++, Objective C, or multithreaded Java or Scala knows the pitfalls of concurrently manipulating shared memory. When you have multiple threads reading from and writing to the same piece of memory, it’s really easy to run into all sorts of concurrency issues like nondeterminism, deadlocks, and so on.</p>

<p class="author1">Because browser code must be particularly safe, and minimize the chances of crashing the browser and causing a poor user experience, the primary way to communicate between the main thread and Web Workers, and between Web Workers and other Web Workers, is with <em class="calibre5">message passing</em>.<a data-primary="message passing (Web Workers)" data-type="indexterm" id="calibre_link-1204" class="calibre4"></a></p>
<div data-type="note" type="note" class="calibre21"><h6 class="calibre22">Note</h6>
<p class="author1">To follow along with the examples in this section, be sure to tell TSC that you’re planning to run this<a data-primary="dom library for TSC" data-type="indexterm" id="calibre_link-854" class="calibre4"></a><a data-primary="TSC compiler" data-secondary="enabling dom lib for" data-type="indexterm" id="calibre_link-1505" class="calibre4"></a> code in a browser by enabling the <code class="calibre14">dom</code> lib in your <em class="calibre5">tsconfig.json</em>:</p>
<pre class="calibre43" data-code-language="json" data-type="programlisting">
<code class="p">{</code>
  <code class="nt">"compilerOptions"</code><code class="p">:</code> <code class="p">{</code>
    <code class="nt">"lib"</code><code class="p">:</code> <code class="p">[</code><code class="s">"dom"</code><code class="p">,</code> <code class="s">"es2015"</code><code class="p">]</code>
  <code class="p">}</code>
<code class="p">}</code>
</pre>

<p class="author1">And for the code that you’re<a data-primary="TSC compiler" data-secondary="enabling webworker lib for" data-type="indexterm" id="calibre_link-1507" class="calibre4"></a> running in a Web Worker, use the <code class="calibre14">webworker</code> lib:</p>
<pre class="calibre43" data-code-language="json" data-type="programlisting">
<code class="p">{</code>
  <code class="nt">"compilerOptions"</code><code class="p">:</code> <code class="p">{</code>
    <code class="nt">"lib"</code><code class="p">:</code> <code class="p">[</code><code class="s">"webworker"</code><code class="p">,</code> <code class="s">"es2015"</code><code class="p">]</code>
  <code class="p">}</code>
<code class="p">}</code>
</pre>

<p class="author1">If you’re using a single <em class="calibre5">tsconfig.json</em> for both your Web Worker script and your main thread, enable both at once.</p>
</div>

<p class="author1">The message passing API works like this.<a data-primary="message passing (Web Workers)" data-secondary="message passing API" data-type="indexterm" id="calibre_link-1205" class="calibre4"></a><a data-primary="Web Workers, typesafe multithreading with" data-secondary="message passing API" data-type="indexterm" id="calibre_link-1759" class="calibre4"></a> You first spawn a web worker from a thread:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// MainThread.ts</code>
<code class="kd">let</code> <code class="nx">worker</code> <code class="o">=</code> <code class="kd">new</code> <code class="nx">Worker</code><code class="p">(</code><code class="s">'WorkerScript.js'</code><code class="p">)</code></pre>

<p class="author1">Then, you pass messages to that worker:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<em class="calibre41"><code class="c2">// MainThread.ts</code></em><code class="c">
</code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">worker</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="kd">new</code><code class="calibre14"> </code><code class="nx">Worker</code><code class="p">(</code><code class="s">'WorkerScript.js'</code><code class="p">)</code><code class="calibre14">

</code><strong class="calibre49"><code class="nx1">worker</code><code class="p1">.</code><code class="nx1">postMessage</code><code class="p1">(</code><code class="s1">'some data'</code><code class="p1">)</code></strong><code class="calibre14">
</code></pre>

<p class="author1">You can pass almost any kind of data to another thread with the <code class="calibre14">postMessage</code> API.<sup class="calibre15"><a data-type="noteref" href="#calibre_link-383" id="calibre_link-432" class="calibre16">4</a></sup></p>

<p class="author1">The main thread will clone the data you pass before handing it off to the worker thread.<sup class="calibre15"><a data-type="noteref" href="#calibre_link-384" id="calibre_link-433" class="calibre16">5</a></sup> On <a data-primary="Web Workers, typesafe multithreading with" data-secondary="onmessage API" data-type="indexterm" id="calibre_link-1760" class="calibre4"></a><a data-primary="message passing (Web Workers)" data-secondary="onmessage API" data-type="indexterm" id="calibre_link-1206" class="calibre4"></a>the Web Worker side, you listen to incoming events with the globally available <code class="calibre14">onmessage</code> API:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// WorkerScript.ts</code>
<code class="nx">onmessage</code> <code class="o">=</code> <code class="nx">e</code> <code class="o">=&gt;</code> <code class="p">{</code>
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">e</code><code class="p">.</code><code class="nx">data</code><code class="p">)</code> <code class="c">// Logs out 'some data'</code>
<code class="p">}</code></pre>

<p class="author1">To communicate in the opposite direction&mdash;from the worker back to the main thread&mdash;you use the globally available <code class="calibre14">postMessage</code> to send a message to the main thread, and the <code class="calibre14">.onmessage</code> method in the main thread to listen for incoming messages.<a data-primary="listeners, creating" data-secondary="onmessage API in Web Workers" data-type="indexterm" id="calibre_link-1197" class="calibre4"></a> To put it all together:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// MainThread.ts</code>
<code class="kd">let</code> <code class="nx">worker</code> <code class="o">=</code> <code class="kd">new</code> <code class="nx">Worker</code><code class="p">(</code><code class="s">'WorkerScript.js'</code><code class="p">)</code>
<code class="nx">worker</code><code class="p">.</code><code class="nx">onmessage</code> <code class="o">=</code> <code class="nx">e</code> <code class="o">=&gt;</code> <code class="p">{</code>
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">e</code><code class="p">.</code><code class="nx">data</code><code class="p">)</code> <code class="c">// Logs out 'Ack: "some data"'</code>
<code class="p">}</code>
<code class="nx">worker</code><code class="p">.</code><code class="nx">postMessage</code><code class="p">(</code><code class="s">'some data'</code><code class="p">)</code>

<code class="c">// WorkerScript.ts</code>
<code class="nx">onmessage</code> <code class="o">=</code> <code class="nx">e</code> <code class="o">=&gt;</code> <code class="p">{</code>
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">e</code><code class="p">.</code><code class="nx">data</code><code class="p">)</code> <code class="c">// Logs out 'some data'</code>
  <code class="nx">postMessage</code><code class="p">(</code><code class="nx">Ack</code><code class="o">:</code> <code class="s">"${e.data}"</code><code class="p">)</code>
<code class="p">}</code></pre>

<p class="author1">This API is a lot like the event emitter API we looked at in <a data-type="xref" href="#calibre_link-385" class="calibre4">“Event Emitters”</a>. It’s a simple way to pass messages around, but without types, we don’t know that we’ve correctly handled all the possible types of messages that might be sent.<a data-primary="event emitters" data-secondary="using in multithreading with Web Workers" data-type="indexterm" id="calibre_link-975" class="calibre4"></a></p>

<p class="author1">Since this API is really just an event emitter, we can apply the same techniques as for regular event emitters to type it. For example, let’s build a simple messaging layer for a chat client, which we’ll run in a worker thread. The messaging layer will push updates to the main thread, and we won’t worry about things like error handling, permissions, and so on. We’ll start by defining some incoming and outgoing message types (the main thread sends <code class="calibre14">Commands</code> to the worker thread, and the worker thread send <code class="calibre14">Events</code> back to the main thread):</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// MainThread.ts</code>
<code class="nx">type</code> <code class="nx">Message</code> <code class="o">=</code> <code class="kt">string</code>
<code class="nx">type</code> <code class="nx">ThreadID</code> <code class="o">=</code> <code class="kt">number</code>
<code class="nx">type</code> <code class="nx">UserID</code> <code class="o">=</code> <code class="kt">number</code>
<code class="nx">type</code> <code class="nx">Participants</code> <code class="o">=</code> <code class="nx">UserID</code><code class="p">[]</code>

<code class="nx">type</code> <code class="nx">Commands</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">sendMessageToThread</code><code class="o">:</code> <code class="p">[</code><code class="nx">ThreadID</code><code class="p">,</code> <code class="nx">Message</code><code class="p">]</code>
  <code class="nx">createThread</code><code class="o">:</code> <code class="p">[</code><code class="nx">Participants</code><code class="p">]</code>
  <code class="nx">addUserToThread</code><code class="o">:</code> <code class="p">[</code><code class="nx">ThreadID</code><code class="p">,</code> <code class="nx">UserID</code><code class="p">]</code>
  <code class="nx">removeUserFromThread</code><code class="o">:</code> <code class="p">[</code><code class="nx">ThreadID</code><code class="p">,</code> <code class="nx">UserID</code><code class="p">]</code>
<code class="p">}</code>

<code class="nx">type</code> <code class="nx">Events</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">receivedMessage</code><code class="o">:</code> <code class="p">[</code><code class="nx">ThreadID</code><code class="p">,</code> <code class="nx">UserID</code><code class="p">,</code> <code class="nx">Message</code><code class="p">]</code>
  <code class="nx">createdThread</code><code class="o">:</code> <code class="p">[</code><code class="nx">ThreadID</code><code class="p">,</code> <code class="nx">Participants</code><code class="p">]</code>
  <code class="nx">addedUserToThread</code><code class="o">:</code> <code class="p">[</code><code class="nx">ThreadID</code><code class="p">,</code> <code class="nx">UserID</code><code class="p">]</code>
  <code class="nx">removedUserFromThread</code><code class="o">:</code> <code class="p">[</code><code class="nx">ThreadID</code><code class="p">,</code> <code class="nx">UserID</code><code class="p">]</code>
<code class="p">}</code></pre>

<p class="author1">How could we apply these types to the Web Worker messaging API? The simplest way might be to define a union of all possible message types, then switch on the <code class="calibre14">Message</code> type.<a data-primary="| (pipe symbol), for union types" data-type="indexterm" id="calibre_link-599" class="calibre4"></a> But this can get pretty tedious. For our <code class="calibre14">Command</code> type, it might look something like this:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// WorkerScript.ts
</code><code class="nx">type</code><code class="calibre14"> </code><code class="nx">Command</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-386" id="calibre_link-391"><img alt="1" src="images/000000.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="o">|</code><code class="calibre14"> </code><code class="p">{</code><code class="nx">type</code><code class="o">:</code><code class="calibre14"> </code><code class="s">'sendMessageToThread'</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">data</code><code class="o">:</code><code class="calibre14"> </code><code class="p">[</code><code class="nx">ThreadID</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">Message</code><code class="p">]</code><code class="p">}</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-387" id="calibre_link-392"><img alt="2" src="images/000001.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="o">|</code><code class="calibre14"> </code><code class="p">{</code><code class="nx">type</code><code class="o">:</code><code class="calibre14"> </code><code class="s">'createThread'</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">data</code><code class="o">:</code><code class="calibre14"> </code><code class="p">[</code><code class="nx">Participants</code><code class="p">]</code><code class="p">}</code><code class="calibre14">
  </code><code class="o">|</code><code class="calibre14"> </code><code class="p">{</code><code class="nx">type</code><code class="o">:</code><code class="calibre14"> </code><code class="s">'addUserToThread'</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">data</code><code class="o">:</code><code class="calibre14"> </code><code class="p">[</code><code class="nx">ThreadID</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">UserID</code><code class="p">]</code><code class="p">}</code><code class="calibre14">
  </code><code class="o">|</code><code class="calibre14"> </code><code class="p">{</code><code class="nx">type</code><code class="o">:</code><code class="calibre14"> </code><code class="s">'removeUserFromThread'</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">data</code><code class="o">:</code><code class="calibre14"> </code><code class="p">[</code><code class="nx">ThreadID</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">UserID</code><code class="p">]</code><code class="p">}</code><code class="calibre14">

</code><code class="nx">onmessage</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="nx">e</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-388" id="calibre_link-393"><img alt="3" src="images/000002.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="nx">processCommandFromMainThread</code><code class="p">(</code><code class="nx">e</code><code class="p">.</code><code class="nx">data</code><code class="p">)</code><code class="calibre14">

</code><code class="kd">function</code><code class="calibre14"> </code><code class="nx">processCommandFromMainThread</code><code class="p">(</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-389" id="calibre_link-394"><img alt="4" src="images/000003.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="nx">command</code><code class="calibre14">: </code><code class="kt">Command</code><code class="calibre14">
</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="kd">switch</code><code class="calibre14"> </code><code class="p">(</code><code class="nx">command</code><code class="p">.</code><code class="nx">type</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-390" id="calibre_link-395"><img alt="5" src="images/000004.png" class="calibre40" /></a><code class="calibre14">
    </code><code class="kd">case</code><code class="calibre14"> </code><code class="s">'sendMessageToThread'</code><code class="o">:</code><code class="calibre14">
      </code><code class="kd">let</code><code class="calibre14"> </code><code class="p">[</code><code class="nx">threadID</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">message</code><code class="p">]</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="nx">command</code><code class="p">.</code><code class="nx">data</code><code class="calibre14">
      </code><code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">message</code><code class="p">)</code><code class="calibre14">
    </code><code class="c">// ...
</code><code class="calibre14">  </code><code class="p">}</code><code class="calibre14">
</code><code class="p">}</code></pre>
<dl class="preface">
<dt class="calibre18"><a class="calibre4" href="#calibre_link-391" id="calibre_link-386"><img alt="1" src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We define a union of all possible commands that the main thread might send to a worker thread, along with the arguments for each command.<a data-primary="union types" data-secondary="defining for communication among threads" data-type="indexterm" id="calibre_link-1718" class="calibre4"></a></p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-392" id="calibre_link-387"><img alt="2" src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">This is just a regular union type. When defining long union types, leading with pipes (<code class="calibre14">|</code>) can make those types easier to read.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-393" id="calibre_link-388"><img alt="3" src="images/000002.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We take messages sent over the untyped <code class="calibre14">onmessage</code> API, and delegate handling them to our typed <code class="calibre14">processCommandFromMainThread</code> API.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-394" id="calibre_link-389"><img alt="4" src="images/000003.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45"><code class="calibre14">processCommandFromMainThread</code> takes care of handling all incoming messages from the main thread. It’s a safe, typed wrapper for the untyped <code class="calibre14">onmessage</code> API.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-395" id="calibre_link-390"><img alt="5" src="images/000004.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">Since the <code class="calibre14">Command</code> type is a discriminated union type (see [[discriminated unions]]), we use a <code class="calibre14">switch</code> to exhaustively handle every possible type of message the main thread might send our way.</p></dd>
</dl>

<p class="author1">Let’s abstract Web Workers’ snowflake API behind a familiar <code class="calibre14">EventEmitter</code>-based API. That way we can cut down on the verbosity of our incoming and outgoing message types.<a data-primary="Web Workers, typesafe multithreading with" data-secondary="abstracting snowflake API behind EvenEmitter-based API" data-type="indexterm" id="calibre_link-1758" class="calibre4"></a></p>

<p class="author1">We’ll start by constructing <a data-primary="NodeJS" data-secondary="EventEmitter" data-type="indexterm" id="calibre_link-1267" class="calibre4"></a>a typesafe wrapper for NodeJS’s <code class="calibre14">EventEmitter</code> API (which is available for the browser under the <a href="https://www.npmjs.com/package/events" class="calibre4"><code class="calibre14">events</code> package</a> on NPM):</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">import</code><code class="calibre14"> </code><code class="nx">EventEmitter</code><code class="calibre14"> </code><code class="nx">from</code><code class="calibre14"> </code><code class="s">'events'</code><code class="calibre14">

</code><code class="kd">class</code><code class="calibre14"> </code><code class="nx">SafeEmitter</code><code class="o">&lt;</code><code class="calibre14">
  </code><code class="nx">Events</code><code class="calibre14"> </code><code class="kd">extends</code><code class="calibre14"> </code><code class="nx">Record</code><code class="o">&lt;</code><code class="nx">PropertyKey</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">unknown</code><code class="p">[</code><code class="p">]</code><code class="o">&gt;</code><code class="calibre14">  </code><a class="calibre4" href="#calibre_link-396" id="calibre_link-400"><img alt="1" src="images/000000.png" class="calibre40" /></a><code class="calibre14">
</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="kd">private</code><code class="calibre14"> </code><code class="nx">emitter</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="kd">new</code><code class="calibre14"> </code><code class="nx">EventEmitter</code><code class="calibre14">  </code><a class="calibre4" href="#calibre_link-397" id="calibre_link-401"><img alt="2" src="images/000001.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="nx">emit</code><code class="o">&lt;</code><code class="nx">K</code><code class="calibre14"> </code><code class="kd">extends</code><code class="calibre14"> </code><code class="nx">keyof</code><code class="calibre14"> </code><code class="nx">Events</code><code class="o">&gt;</code><code class="p">(</code><code class="calibre14">  </code><a class="calibre4" href="#calibre_link-398" id="calibre_link-402"><img alt="3" src="images/000002.png" class="calibre40" /></a><code class="calibre14">
    </code><code class="nx">channel</code><code class="calibre14">: </code><code class="kt">K</code><code class="p">,</code><code class="calibre14">
    </code><code class="p">.</code><code class="p">.</code><code class="p">.</code><code class="nx">data</code><code class="calibre14">: </code><code class="kt">Events</code><code class="p">[</code><code class="nx">K</code><code class="p">]</code><code class="calibre14">
  </code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
    </code><code class="kd">return</code><code class="calibre14"> </code><code class="kd">this</code><code class="p">.</code><code class="nx">emitter</code><code class="p">.</code><code class="nx">emit</code><code class="p">(</code><code class="nx">channel</code><code class="p">,</code><code class="calibre14"> </code><code class="p">.</code><code class="p">.</code><code class="p">.</code><code class="nx">data</code><code class="p">)</code><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">
  </code><code class="nx">on</code><code class="o">&lt;</code><code class="nx">K</code><code class="calibre14"> </code><code class="kd">extends</code><code class="calibre14"> </code><code class="nx">keyof</code><code class="calibre14"> </code><code class="nx">Events</code><code class="o">&gt;</code><code class="p">(</code><code class="calibre14">  </code><a class="calibre4" href="#calibre_link-399" id="calibre_link-403"><img alt="4" src="images/000003.png" class="calibre40" /></a><code class="calibre14">
    </code><code class="nx">channel</code><code class="calibre14">: </code><code class="kt">K</code><code class="p">,</code><code class="calibre14">
    </code><code class="nx">listener</code><code class="o">:</code><code class="calibre14"> </code><code class="p">(</code><code class="p">.</code><code class="p">.</code><code class="p">.</code><code class="nx">data</code><code class="calibre14">: </code><code class="kt">Events</code><code class="p">[</code><code class="nx">K</code><code class="p">]</code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="kd">void</code><code class="calibre14">
  </code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
    </code><code class="kd">return</code><code class="calibre14"> </code><code class="kd">this</code><code class="p">.</code><code class="nx">emitter</code><code class="p">.</code><code class="nx">on</code><code class="p">(</code><code class="nx">channel</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">listener</code><code class="p">)</code><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">
</code><code class="p">}</code></pre>
<dl class="preface">
<dt class="calibre18"><a class="calibre4" href="#calibre_link-400" id="calibre_link-396"><img alt="1" src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45"><code class="calibre14">SafeEmitter</code> declares a generic type <code class="calibre14">Events</code>, a <code class="calibre14">Record</code> mapping from <code class="calibre14">PropertyKey</code> (TypeScript’s built-in type for valid object keys: <code class="calibre14">string</code>, <code class="calibre14">number</code>, or <code class="calibre14">Symbol</code>) to a list of parameters.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-401" id="calibre_link-397"><img alt="2" src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We declare <code class="calibre14">emitter</code> as a private member on <code class="calibre14">SafeEmitter</code>. We do this instead of extending <code class="calibre14">SafeEmitter</code> because our signatures for <code class="calibre14">emit</code> and <code class="calibre14">on</code> are more restrictive than their overloaded counterparts in <code class="calibre14">EventEmitter</code>, and since functions are contravariant in their parameters (remember, for a function <code class="calibre14">a</code> to be assignable to another function <code class="calibre14">b</code> its parameters have to be supertypes of their counterparts in <code class="calibre14">b</code>) TypeScript won’t let us declare these overloads.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-402" id="calibre_link-398"><img alt="3" src="images/000002.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45"><code class="calibre14">emit</code> takes a <code class="calibre14">channel</code> plus arguments corresponding to the list of parameters we defined in the <code class="calibre14">Events</code> type.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-403" id="calibre_link-399"><img alt="4" src="images/000003.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">Similarly, <code class="calibre14">on</code> takes a <code class="calibre14">channel</code> and a <code class="calibre14">listener</code>. <code class="calibre14">listener</code> takes a variable number of arguments corresponding to the list of parameters we defined in the <code class="calibre14">Events</code> type.</p></dd>
</dl>

<p class="author1">We can use <code class="calibre14">SafeEmitter</code> to dramatically cut down on the boilerplate it takes to safely implement a listening layer. On the worker side, we delegate all <code class="calibre14">onmessage</code> calls to our emitter and expose a convenient and safe listener API to consumers:</p>
<pre class="calibre30" data-code-language="ts" data-type="programlisting">
<code class="c">// WorkerScript.ts</code>
<code class="nx">type</code> <code class="nx">Commands</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">sendMessageToThread</code><code class="o">:</code> <code class="p">[</code><code class="nx">ThreadID</code><code class="p">,</code> <code class="nx">Message</code><code class="p">]</code>
  <code class="nx">createThread</code><code class="o">:</code> <code class="p">[</code><code class="nx">Participants</code><code class="p">]</code>
  <code class="nx">addUserToThread</code><code class="o">:</code> <code class="p">[</code><code class="nx">ThreadID</code><code class="p">,</code> <code class="nx">UserID</code><code class="p">]</code>
  <code class="nx">removeUserFromThread</code><code class="o">:</code> <code class="p">[</code><code class="nx">ThreadID</code><code class="p">,</code> <code class="nx">UserID</code><code class="p">]</code>
<code class="p">}</code>

<code class="nx">type</code> <code class="nx">Events</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">receivedMessage</code><code class="o">:</code> <code class="p">[</code><code class="nx">ThreadID</code><code class="p">,</code> <code class="nx">UserID</code><code class="p">,</code> <code class="nx">Message</code><code class="p">]</code>
  <code class="nx">createdThread</code><code class="o">:</code> <code class="p">[</code><code class="nx">ThreadID</code><code class="p">,</code> <code class="nx">Participants</code><code class="p">]</code>
  <code class="nx">addedUserToThread</code><code class="o">:</code> <code class="p">[</code><code class="nx">ThreadID</code><code class="p">,</code> <code class="nx">UserID</code><code class="p">]</code>
  <code class="nx">removedUserFromThread</code><code class="o">:</code> <code class="p">[</code><code class="nx">ThreadID</code><code class="p">,</code> <code class="nx">UserID</code><code class="p">]</code>
<code class="p">}</code>

<code class="c">// Listen for events coming from the main thread</code>
<code class="kd">let</code> <code class="nx">commandEmitter</code> <code class="o">=</code> <code class="kd">new</code> <code class="nx">SafeEmitter</code>	<code class="o">&lt;</code><code class="nx">Commands</code><code class="o">&gt;</code><code class="p">()</code>

<code class="c">// Emit events back to the main thread</code>
<code class="kd">let</code> <code class="nx">eventEmitter</code> <code class="o">=</code> <code class="kd">new</code> <code class="nx">SafeEmitter</code>	<code class="o">&lt;</code><code class="nx">Events</code><code class="o">&gt;</code><code class="p">()</code>

<code class="c">// Wrap incoming commands from the main thread</code>
<code class="c">// using our typesafe event emitter</code>
<code class="nx">onmessage</code> <code class="o">=</code> <code class="nx">command</code> <code class="o">=&gt;</code>
  <code class="nx">commandEmitter</code><code class="p">.</code><code class="nx">emit</code><code class="p">(</code>
    <code class="nx">command</code><code class="p">.</code><code class="nx">data</code><code class="p">.</code><code class="nx">type</code><code class="p">,</code>
    <code class="p">...</code><code class="nx">command</code><code class="p">.</code><code class="nx">data</code><code class="p">.</code><code class="nx">data</code>
  <code class="p">)</code>

<code class="c">// Listen for events issued by the worker, and send them to the main thread</code>
<code class="nx">eventEmitter</code><code class="p">.</code><code class="nx">on</code><code class="p">(</code><code class="s">'receivedMessage'</code><code class="p">,</code> <code class="nx">data</code> <code class="o">=&gt;</code>
  <code class="nx">postMessage</code><code class="p">({</code><code class="nx">type</code><code class="o">:</code> <code class="s">'receivedMessage'</code><code class="p">,</code> <code class="nx">data</code><code class="p">})</code>
<code class="p">)</code>
<code class="nx">eventEmitter</code><code class="p">.</code><code class="nx">on</code><code class="p">(</code><code class="s">'createdThread'</code><code class="p">,</code> <code class="nx">data</code> <code class="o">=&gt;</code>
  <code class="nx">postMessage</code><code class="p">({</code><code class="nx">type</code><code class="o">:</code> <code class="s">'createdThread'</code><code class="p">,</code> <code class="nx">data</code><code class="p">})</code>
<code class="p">)</code>
<code class="c">// etc.</code>

<code class="c">// Respond to a sendMessageToThread command from the main thread</code>
<code class="nx">commandEmitter</code><code class="p">.</code><code class="nx">on</code><code class="p">(</code><code class="s">'sendMessageToThread'</code><code class="p">,</code> <code class="p">(</code><code class="nx">threadID</code><code class="p">,</code> <code class="nx">message</code><code class="p">)</code> <code class="o">=&gt;</code>
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">OK</code><code class="p">,</code> <code class="nx">I</code> <code class="nx">will</code> <code class="nx">send</code> <code class="nx">a</code> <code class="nx">message</code> <code class="nx">to</code> <code class="nx">threadID</code> <code class="nx">$</code><code class="p">{</code><code class="nx">threadID</code><code class="p">})</code>
<code class="p">)</code>

<code class="c">// Send an event back to the main thread</code>
<code class="nx">eventEmitter</code><code class="p">.</code><code class="nx">emit</code><code class="p">(</code><code class="s">'createdThread'</code><code class="p">,</code> <code class="mi">123</code><code class="p">,</code> <code class="p">[</code><code class="mi">456</code><code class="p">,</code> <code class="mi">789</code><code class="p">])</code>
</pre>

<p class="author1">On the flip side, we can also use an <code class="calibre14">EventEmitter</code>-based API to send commands back from the main thread to the worker thread. Note that if you use this pattern in your own code, you might consider using a more full-featured emitter (like Paolo Fragomeni’s excellent <a href="https://www.npmjs.com/package/eventemitter2" class="calibre4"><code class="calibre14">EventEmitter2</code></a>) that supports wildcard listeners, so you don’t have to manually add a listener for each type of event:</p>
<pre class="calibre30" data-code-language="ts" data-type="programlisting">
<code class="c">// MainThread.ts</code>
<code class="nx">type</code> <code class="nx">Commands</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">sendMessageToThread</code><code class="o">:</code> <code class="p">[</code><code class="nx">ThreadID</code><code class="p">,</code> <code class="nx">Message</code><code class="p">]</code>
  <code class="nx">createThread</code><code class="o">:</code> <code class="p">[</code><code class="nx">Participants</code><code class="p">]</code>
  <code class="nx">addUserToThread</code><code class="o">:</code> <code class="p">[</code><code class="nx">ThreadID</code><code class="p">,</code> <code class="nx">UserID</code><code class="p">]</code>
  <code class="nx">removeUserFromThread</code><code class="o">:</code> <code class="p">[</code><code class="nx">ThreadID</code><code class="p">,</code> <code class="nx">UserID</code><code class="p">]</code>
<code class="p">}</code>

<code class="nx">type</code> <code class="nx">Events</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">receivedMessage</code><code class="o">:</code> <code class="p">[</code><code class="nx">ThreadID</code><code class="p">,</code> <code class="nx">UserID</code><code class="p">,</code> <code class="nx">Message</code><code class="p">]</code>
  <code class="nx">createdThread</code><code class="o">:</code> <code class="p">[</code><code class="nx">ThreadID</code><code class="p">,</code> <code class="nx">Participants</code><code class="p">]</code>
  <code class="nx">addedUserToThread</code><code class="o">:</code> <code class="p">[</code><code class="nx">ThreadID</code><code class="p">,</code> <code class="nx">UserID</code><code class="p">]</code>
  <code class="nx">removedUserFromThread</code><code class="o">:</code> <code class="p">[</code><code class="nx">ThreadID</code><code class="p">,</code> <code class="nx">UserID</code><code class="p">]</code>
<code class="p">}</code>

<code class="kd">let</code> <code class="nx">commandEmitter</code> <code class="o">=</code> <code class="kd">new</code> <code class="nx">SafeEmitter</code>	<code class="o">&lt;</code><code class="nx">Commands</code><code class="o">&gt;</code><code class="p">()</code>
<code class="kd">let</code> <code class="nx">eventEmitter</code> <code class="o">=</code> <code class="kd">new</code> <code class="nx">SafeEmitter</code>	<code class="o">&lt;</code><code class="nx">Events</code><code class="o">&gt;</code><code class="p">()</code>

<code class="kd">let</code> <code class="nx">worker</code> <code class="o">=</code> <code class="kd">new</code> <code class="nx">Worker</code><code class="p">(</code><code class="s">'WorkerScript.js'</code><code class="p">)</code>

<code class="c">// Listen for events coming from our worker,</code>
<code class="c">// and re-emit them using our typesafe event emitter</code>
<code class="nx">worker</code><code class="p">.</code><code class="nx">onmessage</code> <code class="o">=</code> <code class="nx">event</code> <code class="o">=&gt;</code>
  <code class="nx">eventEmitter</code><code class="p">.</code><code class="nx">emit</code><code class="p">(</code>
    <code class="nx">event</code><code class="p">.</code><code class="nx">data</code><code class="p">.</code><code class="nx">type</code><code class="p">,</code>
    <code class="p">...</code><code class="nx">event</code><code class="p">.</code><code class="nx">data</code><code class="p">.</code><code class="nx">data</code>
  <code class="p">)</code>

<code class="c">// Listen for commands issues by this thread, and send them to our worker</code>
<code class="nx">commandEmitter</code><code class="p">.</code><code class="nx">on</code><code class="p">(</code><code class="s">'sendMessageToThread'</code><code class="p">,</code> <code class="nx">data</code> <code class="o">=&gt;</code>
  <code class="nx">worker</code><code class="p">.</code><code class="nx">postMessage</code><code class="p">({</code><code class="nx">type</code><code class="o">:</code> <code class="s">'sendMessageToThread'</code><code class="p">,</code> <code class="nx">data</code><code class="p">})</code>
<code class="p">)</code>
<code class="nx">commandEmitter</code><code class="p">.</code><code class="nx">on</code><code class="p">(</code><code class="s">'createThread'</code><code class="p">,</code> <code class="nx">data</code> <code class="o">=&gt;</code>
  <code class="nx">worker</code><code class="p">.</code><code class="nx">postMessage</code><code class="p">({</code><code class="nx">type</code><code class="o">:</code> <code class="s">'createThread'</code><code class="p">,</code> <code class="nx">data</code><code class="p">})</code>
<code class="p">)</code>
<code class="c">// etc.</code>

<code class="c">// Do something when the worker tells us a new thread was created</code>
<code class="nx">eventEmitter</code><code class="p">.</code><code class="nx">on</code><code class="p">(</code><code class="s">'createdThread'</code><code class="p">,</code> <code class="p">(</code><code class="nx">threadID</code><code class="p">,</code> <code class="nx">participants</code><code class="p">)</code> <code class="o">=&gt;</code>
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s">'Created a new chat thread!'</code><code class="p">,</code> <code class="nx">threadID</code><code class="p">,</code> <code class="nx">participants</code><code class="p">)</code>
<code class="p">)</code>

<code class="c">// Send a command to our worker</code>
<code class="nx">commandEmitter</code><code class="p">.</code><code class="nx">emit</code><code class="p">(</code><code class="s">'createThread'</code><code class="p">,</code> <code class="p">[</code><code class="mi">123</code><code class="p">,</code> <code class="mi">456</code><code class="p">])</code>
</pre>

<p class="author1">That’s it! We’ve created a simple typesafe wrapper for the familiar event emitter abstraction that we can use in a variety of settings, from cursor events in a browser to communication across threads, making passing messages between threads safe. This is a common pattern in TypeScript: even if something is unsafe, you can usually wrap it in a typesafe API.<a data-primary="event emitters" data-secondary="using in multithreading with Web Workers" data-startref="ix_evemmlti" data-type="indexterm" id="calibre_link-976" class="calibre4"></a></p>










<section data-pdf-bookmark="Typesafe protocols" data-type="sect3" class="preface"><div class="preface" id="calibre_link-415">
<h3 class="calibre39">Typesafe protocols</h3>

<p class="author1">So far, we’ve looked at passing messages back and forth between two threads. What would it take to extend the technique to say that a particular command always receives a specific event as a response?<a data-primary="protocols" data-secondary="typesafe" data-type="indexterm" id="calibre_link-1393" class="calibre4"></a><a data-primary="Web Workers, typesafe multithreading with" data-secondary="typesafe protocols" data-type="indexterm" id="calibre_link-1761" class="calibre4"></a><a data-primary="browsers" data-secondary="typesafe multithreading with Web Workers" data-tertiary="typesafe protocols" data-type="indexterm" id="calibre_link-706" class="calibre4"></a></p>

<p class="author1">Let’s build a simple call-response protocol, which we can use to move function evaluation across threads. We can’t easily pass functions between threads, but we can define functions in a worker thread and send arguments to them, then send results back. For example, let’s say we’re building a matrix math engine that supports three operations: finding the determinant of a matrix, computing the dot product of two matrices, and inverting a matrix.</p>

<p class="author1">You know the drill&mdash;let’s start<a data-primary="MatrixProtocol" data-type="indexterm" id="calibre_link-1202" class="calibre4"></a> by sketching out the types for these three operations:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">Matrix</code> <code class="o">=</code> <code class="kt">number</code><code class="p">[][]</code>

<code class="nx">type</code> <code class="nx">MatrixProtocol</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">determinant</code><code class="o">:</code> <code class="p">{</code>
    <code class="kd">in</code><code class="o">:</code> <code class="p">[</code><code class="nx">Matrix</code><code class="p">]</code>
    <code class="nx">out</code>: <code class="kt">number</code>
  <code class="p">}</code>
  <code class="s">'dot-product'</code><code class="o">:</code> <code class="p">{</code>
    <code class="kd">in</code><code class="o">:</code> <code class="p">[</code><code class="nx">Matrix</code><code class="p">,</code> <code class="nx">Matrix</code><code class="p">]</code>
    <code class="nx">out</code>: <code class="kt">Matrix</code>
  <code class="p">}</code>
  <code class="nx">invert</code><code class="o">:</code> <code class="p">{</code>
    <code class="kd">in</code><code class="o">:</code> <code class="p">[</code><code class="nx">Matrix</code><code class="p">]</code>
    <code class="nx">out</code>: <code class="kt">Matrix</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p class="author1">We define matrices in our main thread, and run all computations in workers. Once again, the idea is to wrap an unsafe operation (sending and receiving untyped messages from a worker) with a safe one, exposing a well-defined, typed API for consumers to use. In this naive implementation, we start by defining a simple request-response protocol <code class="calibre14">Protocol</code>, which lists out the operations a worker can perform along with their expected input and output types.<sup class="calibre15"><a data-type="noteref" href="#calibre_link-404" id="calibre_link-434" class="calibre16">6</a></sup> We then define a generic <span class="calibre"><code class="calibre14">createProtocol</code></span> function that takes a <code class="calibre14">Protocol</code> and a file path to a Worker, and returns a function that takes a <code class="calibre14">command</code> in that protocol and returns a final function that we can call to actually evaluate that <code class="calibre14">command</code> for a specific set of arguments. OK, here we go:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code><code class="calibre14"> </code><code class="nx">Protocol</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-405" id="calibre_link-410"><img alt="1" src="images/000000.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="p">[</code><code class="nx">command</code><code class="calibre14">: </code><code class="kt">string</code><code class="p">]</code><code class="o">:</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
    </code><code class="kd">in</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">unknown</code><code class="p">[</code><code class="p">]</code><code class="calibre14">
    </code><code class="nx">out</code><code class="calibre14">: </code><code class="kt">unknown</code><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">

</code><code class="kd">function</code><code class="calibre14"> </code><code class="nx">createProtocol</code><code class="o">&lt;</code><code class="nx">P</code><code class="calibre14"> </code><code class="kd">extends</code><code class="calibre14"> </code><code class="nx">Protocol</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">script</code><code class="calibre14">: </code><code class="kt">string</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-406" id="calibre_link-411"><img alt="2" src="images/000001.png" class="calibre40" /></a><code class="calibre14">
 </code><code class="kd">return</code><code class="calibre14"> </code><code class="o">&lt;</code><code class="nx">K</code><code class="calibre14"> </code><code class="kd">extends</code><code class="calibre14"> </code><code class="nx">keyof</code><code class="calibre14"> </code><code class="nx">P</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">command</code><code class="calibre14">: </code><code class="kt">K</code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-407" id="calibre_link-412"><img alt="3" src="images/000002.png" class="calibre40" /></a><code class="calibre14">
   </code><code class="p">(</code><code class="p">.</code><code class="p">.</code><code class="p">.</code><code class="nx">args</code><code class="calibre14">: </code><code class="kt">P</code><code class="p">[</code><code class="nx">K</code><code class="p">]</code><code class="p">[</code><code class="s">'in'</code><code class="p">]</code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-408" id="calibre_link-413"><img alt="4" src="images/000003.png" class="calibre40" /></a><code class="calibre14">
    </code><code class="kd">new</code><code class="calibre14"> </code><code class="nx">Promise</code><code class="o">&lt;</code><code class="nx">P</code><code class="p">[</code><code class="nx">K</code><code class="p">]</code><code class="p">[</code><code class="s">'out'</code><code class="p">]</code><code class="o">&gt;</code><code class="p">(</code><code class="p">(</code><code class="nx">resolve</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">reject</code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-409" id="calibre_link-414"><img alt="5" src="images/000004.png" class="calibre40" /></a><code class="calibre14">
      </code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">worker</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="kd">new</code><code class="calibre14"> </code><code class="nx">Worker</code><code class="p">(</code><code class="nx">script</code><code class="p">)</code><code class="calibre14">
      </code><code class="nx">worker</code><code class="p">.</code><code class="nx">onerror</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="nx">reject</code><code class="calibre14">
      </code><code class="nx">worker</code><code class="p">.</code><code class="nx">onmessage</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="nx">event</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="nx">resolve</code><code class="p">(</code><code class="nx">event</code><code class="p">.</code><code class="nx">data</code><code class="p">.</code><code class="nx">data</code><code class="p">)</code><code class="calibre14">
      </code><code class="nx">worker</code><code class="p">.</code><code class="nx">postMessage</code><code class="p">(</code><code class="p">{</code><code class="nx">command</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">args</code><code class="p">}</code><code class="p">)</code><code class="calibre14">
    </code><code class="p">}</code><code class="p">)</code><code class="calibre14">
</code><code class="p">}</code></pre>
<dl class="preface">
<dt class="calibre18"><a class="calibre4" href="#calibre_link-410" id="calibre_link-405"><img alt="1" src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We start by defining a general-purpose <code class="calibre14">Protocol</code> type that is not specific to our <code class="calibre14">MatrixProtocol</code>.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-411" id="calibre_link-406"><img alt="2" src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">When we call <code class="calibre14">createProtocol</code>, we pass in a file path to a worker <code class="calibre14">script</code>, along with a specific <code class="calibre14">Protocol</code>.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-412" id="calibre_link-407"><img alt="3" src="images/000002.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45"><code class="calibre14">createProtocol</code> returns an anonymous function that we can then invoke with a <code class="calibre14">command</code>, which is a key in the <code class="calibre14">Protocol</code> we bound in <a class="calibre4" href="#calibre_link-411"><img alt="2" src="images/000001.png" class="calibre40" /></a>.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-413" id="calibre_link-408"><img alt="4" src="images/000003.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We then call that function with whatever the specific <code class="calibre14">in</code> type is for the command we passed in in <a class="calibre4" href="#calibre_link-412"><img alt="3" src="images/000002.png" class="calibre40" /></a>.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-414" id="calibre_link-409"><img alt="5" src="images/000004.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">This gives us back a <code class="calibre14">Promise</code> for the specific <code class="calibre14">out</code> type for that command, as defined in our particular protocol. Note that we have to explicitly bind a type parameter to <code class="calibre14">Promise</code>, otherwise it defaults to <code class="calibre14">{}</code>.</p></dd>
</dl>

<p class="author1">Now let’s apply our <code class="calibre14">MatrixProtocol</code> type plus the path to our Web Worker script to <code class="calibre14">createProtocol</code> (we won’t get into the nitty-gritty of how to compute a determinant, and I’ll assume that you’ve implemented it in <em class="calibre5">MatrixWorkerScript.ts</em>). We’ll get back a function that we can use to run a specific command in that protocol:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">runWithMatrixProtocol</code> <code class="o">=</code> <code class="nx">createProtocol</code><code class="o">&lt;</code><code class="nx">MatrixProtocol</code><code class="o">&gt;</code><code class="p">(</code>
  <code class="s">'MatrixWorkerScript.js'</code>
<code class="p">)</code>
<code class="kd">let</code> <code class="nx">parallelDeterminant</code> <code class="o">=</code> <code class="nx">runWithMatrixProtocol</code><code class="p">(</code><code class="s">'determinant'</code><code class="p">)</code>

<code class="nx">parallelDeterminant</code><code class="p">([[</code><code class="mi">1</code><code class="p">,</code> <code class="mi">2</code><code class="p">],</code> <code class="p">[</code><code class="mi">3</code><code class="p">,</code> <code class="mi">4</code><code class="p">]])</code>
  <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">determinant</code> <code class="o">=&gt;</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">determinant</code><code class="p">)</code> <code class="c">// -2</code>
  <code class="p">)</code></pre>

<p class="author1">Cool, huh? We’ve taken something totally unsafe&mdash;untyped message passing between threads&mdash;and abstracted over it with a fully typesafe request-response protocol. All the commands you can run using that protocol live in one place (<code class="calibre14">MatrixProtocol</code>), and our core logic (<code class="calibre14">createProtocol</code>) lives separately from our concrete protocol implementation (<code class="calibre14">runWithMatrixProtocol</code>).</p>

<p class="author1">Anytime you need to communicate between two processes&mdash;whether on the same machine or between multiple computers on a network&mdash;typesafe protocols are a great tool to make that communication safe. While this section helped develop some intuition for what problems protocols solve, for a real-world application you’ll likely want to reach for an existing tool like Swagger, gRPC, Thrift, or GraphQL&mdash;for<a data-primary="Web Workers, typesafe multithreading with" data-startref="ix_WebWrk" data-type="indexterm" id="calibre_link-1757" class="calibre4"></a><a data-primary="browsers" data-secondary="typesafe multithreading with Web Workers" data-startref="ix_brwsmltithr" data-type="indexterm" id="calibre_link-705" class="calibre4"></a><a data-primary="multithreading" data-secondary="in the browser with Web Workers" data-startref="ix_mltithrbrWW" data-type="indexterm" id="calibre_link-1241" class="calibre4"></a> an overview, head over to <a data-type="xref" href="#calibre_link-7" class="calibre4">“Typesafe APIs”</a>.</p>
</div></section>



</div></section>













<section data-pdf-bookmark="In NodeJS: With Child Processes" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1895">
<h2 class="calibre17">In NodeJS: With Child Processes</h2>
<div data-type="note" type="note" class="calibre21"><h6 class="calibre22">Note</h6>
<p class="author1">To follow along with the examples in this section, be sure to install type declarations <a data-primary="multithreading" data-secondary="typesafe multithreading in NodeJS with child processes" data-type="indexterm" id="calibre_link-1242" class="calibre4"></a><a data-primary="NodeJS" data-secondary="typesafe multihreading with child processes" data-type="indexterm" id="calibre_link-1272" class="calibre4"></a>for NodeJS from NPM:</p>

<pre data-code-language="sh" data-type="programlisting" class="calibre43">npm install @types/node --save-dev</pre>

<p class="author1">To learn more about using type declarations, jump ahead to <a data-type="xref" href="#calibre_link-340" class="calibre4">“JavaScript That Has Type Declarations on DefinitelyTyped”</a>.</p>
</div>

<p class="author1">Typesafe parallelism in NodeJS works the same way as it does for Web Worker threads in the browser (see <a data-type="xref" href="#calibre_link-415" class="calibre4">“Typesafe protocols”</a>). While the message-passing layer itself is unsafe, it’s easy to build a typesafe API over it. NodeJS’s child process API looks like this:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// MainThread.ts
</code><code class="kd">import</code><code class="calibre14"> </code><code class="p">{</code><code class="nx">fork</code><code class="p">}</code><code class="calibre14"> </code><code class="nx">from</code><code class="calibre14"> </code><code class="s">'child_process'</code><code class="calibre14">

</code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">child</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="nx">fork</code><code class="p">(</code><code class="s">'./ChildThread.js'</code><code class="p">)</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-416" id="calibre_link-419"><img alt="1" src="images/000000.png" class="calibre40" /></a><code class="calibre14">

</code><code class="nx">child</code><code class="p">.</code><code class="nx">on</code><code class="p">(</code><code class="s">'message'</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">data</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-417" id="calibre_link-420"><img alt="2" src="images/000001.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="nx">console</code><code class="p">.</code><code class="nx">info</code><code class="p">(</code><code class="s">'Child process sent a message'</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">data</code><code class="p">)</code><code class="calibre14">
</code><code class="p">)</code><code class="calibre14">

</code><code class="nx">child</code><code class="p">.</code><code class="nx">send</code><code class="p">(</code><code class="p">{</code><code class="nx">type</code><code class="o">:</code><code class="calibre14"> </code><code class="s">'syn'</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">data</code><code class="o">:</code><code class="calibre14"> </code><code class="p">[</code><code class="mi">3</code><code class="p">]</code><code class="p">}</code><code class="p">)</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-418" id="calibre_link-421"><img alt="3" src="images/000002.png" class="calibre40" /></a></pre>
<dl class="preface">
<dt class="calibre18"><a class="calibre4" href="#calibre_link-419" id="calibre_link-416"><img alt="1" src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We use NodeJS’s <code class="calibre14">fork</code> API to spawn a new child process.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-420" id="calibre_link-417"><img alt="2" src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We listen to incoming messages from a child process using the <code class="calibre14">on</code> API. There are a few messages that a NodeJS child process might send to its parent; here, we just care about the <code class="calibre14">'message'</code> message.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-421" id="calibre_link-418"><img alt="3" src="images/000002.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We use the <code class="calibre14">send</code> API to send messages to a child process.</p></dd>
</dl>

<p class="author1">In our child thread, we listen to messages coming in from the main thread using the <code class="calibre14">process.on</code> API and send messages back with <code class="calibre14">process.send</code>:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// ChildThread.ts
</code><code class="nx">process</code><code class="p">.</code><code class="nx">on</code><code class="p">(</code><code class="s">'message'</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">data</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-422" id="calibre_link-424"><img alt="1" src="images/000000.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="nx">console</code><code class="p">.</code><code class="nx">info</code><code class="p">(</code><code class="s">'Parent process sent a message'</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">data</code><code class="p">)</code><code class="calibre14">
</code><code class="p">)</code><code class="calibre14">

</code><code class="nx">process</code><code class="p">.</code><code class="nx">send</code><code class="p">(</code><code class="p">{</code><code class="nx">type</code><code class="o">:</code><code class="calibre14"> </code><code class="s">'ack'</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">data</code><code class="o">:</code><code class="calibre14"> </code><code class="p">[</code><code class="mi">3</code><code class="p">]</code><code class="p">}</code><code class="p">)</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-423" id="calibre_link-425"><img alt="2" src="images/000001.png" class="calibre40" /></a></pre>
<dl class="preface">
<dt class="calibre18"><a class="calibre4" href="#calibre_link-424" id="calibre_link-422"><img alt="1" src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We use the <code class="calibre14">on</code> API on the globally defined <code class="calibre14">process</code> to listen for incoming messages from a parent thread.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-425" id="calibre_link-423"><img alt="2" src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We use the <code class="calibre14">send</code> API on <code class="calibre14">process</code> to send messages to the parent process.</p></dd>
</dl>

<p class="author1">Because the mechanics are so similar to Web Workers, I’ll leave it as an exercise to implement a typesafe protocol to abstract over interprocess communication in NodeJS.<a data-primary="multithreading" data-secondary="typesafe multithreading in NodeJS with child processes" data-startref="ix_mltithrNJS" data-type="indexterm" id="calibre_link-1243" class="calibre4"></a><a data-primary="NodeJS" data-secondary="typesafe multihreading with child processes" data-startref="ix_NoJSmltthr" data-type="indexterm" id="calibre_link-1273" class="calibre4"></a><a data-primary="multithreading" data-startref="ix_mltithr" data-type="indexterm" id="calibre_link-1239" class="calibre4"></a></p>
</div></section>





</div></section>













<section data-pdf-bookmark="Summary" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1896">
<h1 class="calibre13">Summary</h1>

<p class="author1">In this chapter we started with the basics of JavaScript’s event loop, and continued on to a discussion of the building blocks of asynchronous code in JavaScript and how to safely express them in TypeScript: callbacks, promises, <code class="calibre14">async</code>/<code class="calibre14">await</code>, and event emitters. We then covered multithreading, exploring passing messages between threads (in the browser and on the server) and building full protocols for communicating between threads.</p>

<p class="author1">As with <a data-type="xref" href="#calibre_link-426" class="calibre4">Chapter&nbsp;7</a>, which technique you use is up to you:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">For simple asynchronous tasks, callbacks are as straightforward as it gets.</p>
</li>
<li class="calibre11">
<p class="author1">For more complex tasks that need to be sequenced and parallelized, promises and <code class="calibre14">async</code>/<code class="calibre14">await</code> are your friend.</p>
</li>
<li class="calibre11">
<p class="author1">When a promise doesn’t cut it (e.g., if you’re firing an event multiple times), reach for event emitters or a reactive streams library like RxJS.</p>
</li>
<li class="calibre11">
<p class="author1">To extend these techniques to multiple threads, use event emitters, typesafe protocols, or typesafe APIs (see <a data-type="xref" href="#calibre_link-7" class="calibre4">“Typesafe APIs”</a>).</p>
</li>
</ul>
</div></section>













<section data-pdf-bookmark="Exercises" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1897">
<h1 class="calibre13">Exercises</h1>
<ol class="calibre31">
<li class="calibre32">
<p class="author1">Implement a general-purpose <code class="calibre14">promisify</code> function, which takes any function that takes exactly one argument and a callback and wraps it in a function that returns a promise. When you’re done, you should be able to use <code class="calibre14">promisify</code> like this (install type declarations for NodeJS first, with <code class="calibre14">npm install @types/node --save-dev</code>):</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">import</code> <code class="p">{</code><code class="nx">readFile</code><code class="p">}</code> <code class="nx">from</code> <code class="s">'fs'</code>

<code class="kd">let</code> <code class="nx">readFilePromise</code> <code class="o">=</code> <code class="nx">promisify</code><code class="p">(</code><code class="nx">readFile</code><code class="p">)</code>
<code class="nx">readFilePromise</code><code class="p">(</code><code class="s">'./myfile.ts'</code><code class="p">)</code>
  <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">result</code> <code class="o">=&gt;</code> <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s">'success reading file'</code><code class="p">,</code> <code class="nx">result</code><code class="p">.</code><code class="nx">toString</code><code class="p">()))</code>
  <code class="p">.</code><code class="kd">catch</code><code class="p">(</code><code class="nx">error</code> <code class="o">=&gt;</code> <code class="nx">console</code><code class="p">.</code><code class="nx">error</code><code class="p">(</code><code class="s">'error reading file'</code><code class="p">,</code> <code class="nx">error</code><code class="p">))</code></pre>
</li>
<li class="calibre32">
<p class="author1">In the section on <a data-type="xref" href="#calibre_link-415" class="calibre4">“Typesafe protocols”</a> we derived one half of a protocol for typesafe matrix math. Given this half of the protocol that runs in the main thread, implement the other half that runs in a Web Worker thread.</p>
</li>
<li class="calibre32">
<p class="author1">Use a mapped type (as in <a data-type="xref" href="#calibre_link-427" class="calibre4">“In the Browser: With Web Workers”</a>) to implement a typesafe message-passing protocol for NodeJS’s <code class="calibre14">child_process</code>.</p>
</li>

</ol>
</div></section>







<div data-type="footnotes" class="calibre26"><p data-type="footnote" id="calibre_link-374" class="calibre27"><sup class="calibre28"><a href="#calibre_link-428" class="calibre16">1</a></sup> Well, you can if you fork your browser platform, or build a C++ NodeJS extension.</p><p data-type="footnote" id="calibre_link-376" class="calibre27"><sup class="calibre28"><a href="#calibre_link-429" class="calibre16">2</a></sup> Eagle-eyed readers will notice how similar this API is to the <code class="calibre14">flatMap</code> API we developed in <a data-type="xref" href="#calibre_link-430" class="calibre48">“The Option Type”</a>. That similarity is no accident! Both <code class="calibre14">Promise</code> and <code class="calibre14">Option</code> are inspired by the Monad design pattern popularized by the functional programming language Haskell.</p><p data-type="footnote" id="calibre_link-378" class="calibre27"><sup class="calibre28"><a href="#calibre_link-431" class="calibre16">3</a></sup> <code class="calibre14">Observables</code> are the basic building block of reactive programming’s approach to doing things to values over time. There’s an in-progress proposal to standardize <code class="calibre14">Observables</code> in the <a href="https://tc39.github.io/proposal-observable/" class="calibre4"><code class="calibre14">Observable</code> proposal</a>. Look forward to a deeper dive into <code class="calibre14">Observables</code> in a future edition of this book, once the proposal<a data-primary="Observables" data-type="indexterm" id="calibre_link-1323" class="calibre4"></a> is more broadly adopted by JavaScript engines.</p><p data-type="footnote" id="calibre_link-383" class="calibre27"><sup class="calibre28"><a href="#calibre_link-432" class="calibre16">4</a></sup> Except for functions, errors, DOM nodes, property descriptors, getters and setters, and prototype methods and properties. For more information, head over to the <a href="http://w3c.github.io/html/infrastructure.html#safe-passing-of-structured-data" class="calibre4">HTML5 specification</a>.</p><p data-type="footnote" id="calibre_link-384" class="calibre27"><sup class="calibre28"><a href="#calibre_link-433" class="calibre16">5</a></sup> You can also use the <code class="calibre14">Transferable</code> API to pass certain types of data (like <code class="calibre14">ArrayBuffer</code>) between threads by reference. In this section we won’t be using <code class="calibre14">Transferable</code> to explicitly transfer object ownership across threads, but that’s an implementation detail. If you use <code class="calibre14">Transferable</code> for your use case, the approach is identical from a type safety point of view.</p><p data-type="footnote" id="calibre_link-404" class="calibre27"><sup class="calibre28"><a href="#calibre_link-434" class="calibre16">6</a></sup> This implementation is naive because it spawns a new worker every time we issue a command; in the real world, you probably want to have a pooling mechanism that keeps a warm pool of workers around, and recycles freed workers.</p></div></div></section></div>

<div data-type="book" class="calibre1" id="calibre_link-435"><section data-pdf-bookmark="Chapter 9. Frontend and Backend Frameworks" data-type="chapter" type="chapter" class="preface"><div class="preface" id="calibre_link-1898">
<h1 class="calibre12"><span class="calibre">Chapter 9. </span>Frontend and Backend Frameworks</h1>


<p class="author1">While you could build every part of your application yourself from the ground up&mdash;the networking and database layers on the server, a user interface framework and state management solution on the frontend&mdash;you probably shouldn’t.<a data-primary="frameworks" data-type="indexterm" id="calibre_link-1009" class="calibre4"></a> It’s hard to get the details right, and luckily for us, lots of these hard problems on the frontend and backend have already been solved by other engineers. By taking advantage of existing tools, libraries, and frameworks to build things both on the frontend and the backend, we can iterate quickly and on stable ground when building our own <span class="calibre">applications</span>.</p>

<p class="author1">In this chapter, we’ll go through some of the most popular tools and frameworks that solve common problems on both the client and the server. We’ll talk about what you might use each framework for, and how to safely integrate it into your TypeScript application.<a data-primary="frameworks" data-secondary="frontend" data-type="indexterm" id="calibre_link-1012" class="calibre4"></a></p>






<section data-pdf-bookmark="Frontend Frameworks" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1899">
<h1 class="calibre13">Frontend Frameworks</h1>

<p class="author1">TypeScript is a natural fit for the world of frontend applications. With its rich support for JSX and its ability to safely model mutability, TypeScript lends structure and safety to your application and makes it easier to write correct, maintainable code in the fast-paced environment that is frontend development.</p>

<p class="author1">Of course, all of the built-in DOM APIs are typesafe.<a data-primary="frameworks" data-secondary="frontend" data-tertiary="enabling DOM APIs in tsconfig.json" data-type="indexterm" id="calibre_link-1016" class="calibre4"></a><a data-primary="TSC compiler" data-secondary="enabling DOM APIs" data-type="indexterm" id="calibre_link-1504" class="calibre4"></a><a data-primary="DOM (Document Object Model)" data-secondary="enabling DOM APIs in TSC compiler" data-type="indexterm" id="calibre_link-851" class="calibre4"></a> To use them from TypeScript, just include their type declarations in your project’s <em class="calibre5">tsconfig.json</em>:</p>

<pre data-code-language="json" data-type="programlisting" class="calibre30"><code class="p">{</code>
  <code class="nt">"compilerOptions"</code><code class="p">:</code> <code class="p">{</code>
    <code class="nt">"lib"</code><code class="p">:</code> <code class="p">[</code><code class="s">"dom"</code><code class="p">,</code> <code class="s">"es2015"</code><code class="p">]</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p class="author1">That will tell TypeScript to include <em class="calibre5">lib.dom.d.ts</em>&mdash;its built-in browser and DOM type declarations&mdash;when typechecking your code.</p>
<div data-type="note" type="note" class="calibre21"><h6 class="calibre22">Note</h6>
<p class="author1">The <code class="calibre14">lib</code> <em class="calibre5">tsconfig.json</em> option just tells TypeScript to include a set of specific type declarations when processing the code in your project; it won’t emit any extra code,<a data-primary="tsconfig.json" data-secondary="lib option" data-type="indexterm" id="calibre_link-1534" class="calibre4"></a><a data-primary="lib tsconfig.json option" data-type="indexterm" id="calibre_link-1194" class="calibre4"></a> or generate any JavaScript that will exist at runtime. It won’t, for example, make the DOM magically work in a NodeJS environment (your code will compile, but it will fail at runtime)&mdash;it’s on you to make sure that your type declarations match up to what your JavaScript environment actually supports at runtime. Jump ahead to <a data-type="xref" href="#calibre_link-436" class="calibre4">“Building Your TypeScript Project”</a> to learn more.</p>
</div>

<p class="author1">With DOM type declarations enabled, you’ll<a data-primary="types" data-secondary="DOM type declarations, enabling" data-type="indexterm" id="calibre_link-1621" class="calibre4"></a> be able to safely consume DOM and browser APIs to do things like:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// Read properties from the global window object</code>
<code class="kd">let</code> <code class="nx">model</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">url</code>: <code class="kt">window.location.href</code>
<code class="p">}</code>

<code class="c">// Create an &lt;input /&gt; element</code>
<code class="kd">let</code> <code class="nx">input</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">createElement</code><code class="p">(</code><code class="s">'input'</code><code class="p">)</code>

<code class="c">// Give it some CSS classes</code>
<code class="nx">input</code><code class="p">.</code><code class="nx">classList</code><code class="p">.</code><code class="nx">add</code><code class="p">(</code><code class="s">'Input'</code><code class="p">,</code> <code class="s">'URLInput'</code><code class="p">)</code>

<code class="c">// When the user types, update the model</code>
<code class="nx">input</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s">'change'</code><code class="p">,</code> <code class="p">()</code> <code class="o">=&gt;</code>
  <code class="nx">model</code><code class="p">.</code><code class="nx">url</code> <code class="o">=</code> <code class="nx">input</code><code class="p">.</code><code class="nx">value</code><code class="p">.</code><code class="nx">toUpperCase</code><code class="p">()</code>
<code class="p">)</code>

<code class="c">// Inject the &lt;input /&gt; into the DOM</code>
<code class="nb">document</code><code class="p">.</code><code class="nx">body</code><code class="p">.</code><code class="nx">appendChild</code><code class="p">(</code><code class="nx">input</code><code class="p">)</code></pre>

<p class="author1">Of course, all of that code is typechecked and comes with the normal goodies like in-editor autocompletion.<a data-primary="editors" data-secondary="autocompletion in" data-type="indexterm" id="calibre_link-861" class="calibre4"></a> For example, consider something <a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2339" data-type="indexterm" id="calibre_link-915" class="calibre4"></a>like this:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nb">document</code><code class="p">.</code><code class="nx">querySelector</code><code class="p">(</code><code class="s">'.Element'</code><code class="p">).</code><code class="nx">value</code> <code class="c">// Error TS2339: Property 'value' does</code>
                                         <code class="c">// not exist on type 'Element'.</code></pre>

<p class="author1">TypeScript will throw an error because the return type of <code class="calibre14">querySelector</code> is nullable.</p>

<p class="author1">While for simple frontend applications these low-level DOM APIs are enough and will give you what you need to do safe, type-guided programming for the browser, most real-world frontend applications use a framework to abstract away how DOM rendering and rerendering, data binding, and events work. The following sections will give some pointers on how to effectively use TypeScript with a few of the most popular browser frameworks.</p>








<section data-pdf-bookmark="React" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1900">
<h2 class="calibre17">React</h2>

<p class="author1">React is among the most popular frontend frameworks today, and is a great choice when it comes to type safety.<a data-primary="frameworks" data-secondary="frontend" data-tertiary="React" data-type="indexterm" id="calibre_link-1017" class="calibre4"></a><a data-primary="React" data-type="indexterm" id="calibre_link-1399" class="calibre4"></a></p>

<p class="author1">The reason React is so safe is because React components&mdash;the basic building blocks of React applications&mdash;are both defined and consumed in TypeScript.<a data-primary="components" data-secondary="React" data-type="indexterm" id="calibre_link-779" class="calibre4"></a> This property is hard to find among frontend frameworks, and means that both component definitions and consumers are typechecked. You can use types to say things like “this component takes a user ID and a color” or “this component can only have list items as children.” These constraints are then enforced by TypeScript, verifying that your components do what they say they do.</p>

<p class="author1">This safety around component definitions and consumers&mdash;the <em class="calibre5">view layer</em> of a frontend application&mdash;is killer.<a data-primary="view layer of frontend applications (React)" data-type="indexterm" id="calibre_link-1750" class="calibre4"></a> The view is traditionally the place where typos, missed attributes, mistyped parameters, and improperly nested elements cause programmers to collectively spend thousands of hours tearing their hair out and indignantly refreshing their browsers. The day you start typing your views with TypeScript and React is the day you double your and your team’s productivity on the frontend.</p>










<section data-pdf-bookmark="A JSX primer" data-type="sect3" class="preface"><div class="preface" id="calibre_link-1901">
<h3 class="calibre39">A JSX primer</h3>

<p class="author1">When using React, you define your views using a special DSL called <em class="calibre5">JavaScript XML</em> (JSX) that you embed straight into your JavaScript code.<a data-primary="React" data-secondary="JSX primer" data-type="indexterm" id="calibre_link-1402" class="calibre4"></a><a data-primary="JSX (JavaScript XML)" data-type="indexterm" id="calibre_link-1171" class="calibre4"></a><a data-primary="XML" data-secondary="JSX (JavaScript XML)" data-type="indexterm" id="calibre_link-1764" class="calibre4"></a> It sort of looks like HTML in your JavaScript. You then run your JavaScript through a JSX compiler that rewrites that funky JSX syntax into regular JavaScript function calls.</p>

<p class="author1">The process looks something like this. Say you’re building a menu app for your friend’s restaurant, and you list out a few items on the brunch menu with the following JSX:</p>

<pre data-code-language="html" data-type="programlisting" class="calibre30"><code class="nt">&lt;ul</code> <code class="na">class=</code><code class="s">'list'</code><code class="nt">&gt;</code>
  <code class="nt">&lt;li&gt;</code>Homemade granola with yogurt<code class="nt">&lt;/li&gt;</code>
  <code class="nt">&lt;li&gt;</code>Fantastic french toast with fruit<code class="nt">&lt;/li&gt;</code>
  <code class="nt">&lt;li&gt;</code>Tortilla Española with salad<code class="nt">&lt;/li&gt;</code>
<code class="nt">&lt;/ul&gt;</code></pre>

<p class="author1">After running that code through a JSX compiler like Babel’s <a href="http://bit.ly/2uENY4M" class="calibre4"><code class="calibre14">transform-react-jsx</code> plugin</a>, you’ll get the following output:</p>
<pre class="calibre30" data-code-language="js" data-type="programlisting">
<code class="nx">React</code><code class="p">.</code><code class="nx">createElement</code><code class="p">(</code>
  <code class="s">'ul'</code><code class="p">,</code>
  <code class="p">{</code><code class="s">'class'</code><code class="o">:</code> <code class="s">'list'</code><code class="p">},</code>
  <code class="nx">React</code><code class="p">.</code><code class="nx">createElement</code><code class="p">(</code>
    <code class="s">'li'</code><code class="p">,</code>
    <code class="kd">null</code><code class="p">,</code>
    <code class="s">'Homemade granola with yogurt'</code>
  <code class="p">),</code>
  <code class="nx">React</code><code class="p">.</code><code class="nx">createElement</code><code class="p">(</code>
    <code class="s">'li'</code><code class="p">,</code>
    <code class="kd">null</code><code class="p">,</code>
    <code class="s">'Fantastic French toast with fruit'</code>
  <code class="p">),</code>
  <code class="nx">React</code><code class="p">.</code><code class="nx">createElement</code><code class="p">(</code>
    <code class="s">'li'</code><code class="p">,</code>
    <code class="kd">null</code><code class="p">,</code>
    <code class="s">'Tortilla Española with salad'</code>
  <code class="p">)</code>
<code class="p">);</code>
</pre>
<div data-type="tip" class="calibre21"><h1 class="calibre42">TSC Flag: esModuleInterop</h1>
<p class="author1">Because JSX compiles to a call to <code class="calibre14">React.createElement</code>, be sure to import the React library into each file where you use JSX so that<a data-primary="esModuleInterop TSC flag" data-type="indexterm" id="calibre_link-969" class="calibre4"></a><a data-primary="TSC compiler" data-secondary="esModuleInterop flag" data-type="indexterm" id="calibre_link-1508" class="calibre4"></a> you have a variable named <code class="calibre14">React</code> in scope:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre43"><code class="kd">import</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s">'react'</code></pre>

<p class="author1">Don’t worry&mdash;if you forget, TypeScript will warn you:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre43"><code class="o">&lt;</code><code class="nx">ul</code> <code class="o">/&gt;</code> <code class="c">// Error TS2304: Cannot find name 'React'.</code></pre>

<p class="author1">Also note <a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2304" data-type="indexterm" id="calibre_link-896" class="calibre4"></a>that I’ve set <code class="calibre14">{"esModuleInterop": true}</code> in my <em class="calibre5">tsconfig.json</em> to support importing <code class="calibre14">React</code> without a wildcard (<code class="calibre14">*</code>) import. If you’re following along, either enable <code class="calibre14">esModuleInterop</code> in your own <em class="calibre5">tsconfig.json</em>, or use a wildcard import instead:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre43"><code class="kd">import</code> <code class="o">*</code> <code class="kd">as</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s">'react'</code></pre>
</div>

<p class="author1">The nice thing about JSX is you can write what looks a lot like normal HTML, then compile it automatically to a JavaScript engine&ndash;friendly format. As an engineer you only use a familiar, high-level, declarative DSL, and you don’t have to deal with the implementation details.</p>

<p class="author1">You don’t need JSX to work with React (you can write that compiled code directly and it’ll work fine), and you can use JSX without React (the specific function call that JSX tags compile to&mdash;<code class="calibre14">React.createElement</code> in the previous example&mdash;is configurable), but the combination of React with JSX is magical, and makes writing views really fun, and really, really safe.</p>
</div></section>













<section data-pdf-bookmark="TSX = JSX + TypeScript" data-type="sect3" class="preface"><div class="preface" id="calibre_link-313">
<h3 class="calibre39">TSX = JSX + TypeScript</h3>

<p class="author1">Files that contain JSX use the file extension <em class="calibre5">.jsx</em>. And TypeScript files that contain JSX use the <em class="calibre5">.tsx</em> extension.<a data-primary="XML" data-secondary="TSX (JSX and TypeScript)" data-type="indexterm" id="calibre_link-1766" class="calibre4"></a><a data-primary="JSX (JavaScript XML)" data-secondary="TSX and" data-type="indexterm" id="calibre_link-1173" class="calibre4"></a><a data-primary="TSC compiler" data-secondary="jsx flag" data-type="indexterm" id="calibre_link-1514" class="calibre4"></a><a data-primary="React" data-secondary="TSX or JSX support in TypeScript" data-type="indexterm" id="calibre_link-1403" class="calibre4"></a> TSX is to JSX what TypeScript is to JavaScript&mdash;a compile-time safety and assistance layer to help you be more productive and produce code with fewer mistakes. To enable TSX support for your project, add the following line to your <em class="calibre5">tsconfig.json</em>:</p>
<pre class="calibre30" data-code-language="json" data-type="programlisting">
<code class="p">{</code>
  <code class="nt">"compilerOptions"</code><code class="p">:</code> <code class="p">{</code>
    <code class="nt">"jsx"</code><code class="p">:</code> <code class="s">"react"</code>
  <code class="p">}</code>
<code class="p">}</code>
</pre>

<p class="author1">The <code class="calibre14">jsx</code> directive has three modes<a data-primary="jsx directive" data-type="indexterm" id="calibre_link-1176" class="calibre4"></a> at the time of writing:</p>
<dl class="preface">
<dt class="calibre18"><code class="calibre14">react</code></dt>
<dd class="calibre19">
<p class="author1">Compile JSX to a <em class="calibre5">.js</em> file using the JSX pragma (by default, <code class="calibre14">React.createElement</code>).</p>
</dd>
<dt class="calibre18"><code class="calibre14">react-native</code></dt>
<dd class="calibre19">
<p class="author1">Preserve JSX without compiling it, but do emit a file with a <em class="calibre5">.js</em> extension.</p>
</dd>
<dt class="calibre18"><code class="calibre14">preserve</code></dt>
<dd class="calibre19">
<p class="author1">Typecheck JSX but don’t compile it away, and emit a file with a <em class="calibre5">.jsx</em> extension.</p>
</dd>
</dl>

<p class="author1">Under the hood, TypeScript exposes a few hooks for typing TSX in a pluggable way. These are special types on the <code class="calibre14">global.JSX</code> namespace that TypeScript looks at as the source of<a data-primary="global.JSX namespace" data-type="indexterm" id="calibre_link-1083" class="calibre4"></a> truth for TSX types throughout your program. If you’re just using React, you don’t need to go that low-level; but if you’re building your own TypeScript library that uses TSX (and doesn’t use React)&mdash;or if you’re curious how the React type declarations do it&mdash;head over to <a data-type="xref" href="#calibre_link-437" class="calibre4">Appendix&nbsp;G</a>.</p>
</div></section>













<section data-pdf-bookmark="Using TSX with React" data-type="sect3" class="preface"><div class="preface" id="calibre_link-1902">
<h3 class="calibre39">Using TSX with React</h3>

<p class="author1">React lets us declare two kinds of components: function components and class components.<a data-primary="XML" data-secondary="using TSX with React" data-type="indexterm" id="calibre_link-1767" class="calibre4"></a><a data-primary="JSX (JavaScript XML)" data-secondary="using TSX with React" data-type="indexterm" id="calibre_link-1174" class="calibre4"></a><a data-primary="TSX" data-secondary="using with React" data-type="indexterm" id="calibre_link-1544" class="calibre4"></a><a data-primary="React" data-secondary="using TSX with" data-type="indexterm" id="calibre_link-1404" class="calibre4"></a> Both kinds of components take some properties and render some TSX. From a consumer’s point of view, they are identical.<a data-primary="components" data-secondary="React" data-tertiary="function and class components" data-type="indexterm" id="calibre_link-780" class="calibre4"></a></p>

<p class="author1">Declaring and rendering a function component looks like this:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">import</code><code class="calibre14"> </code><code class="nx">React</code><code class="calibre14"> </code><code class="nx">from</code><code class="calibre14"> </code><code class="s">'react'</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-438" id="calibre_link-444"><img alt="1" src="images/000000.png" class="calibre40" /></a><code class="calibre14">

</code><code class="nx">type</code><code class="calibre14"> </code><code class="nx">Props</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-439" id="calibre_link-445"><img alt="2" src="images/000001.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="nx">isDisabled?</code><code class="calibre14">: </code><code class="kt">boolean</code><code class="calibre14">
  </code><code class="nx">size</code><code class="o">:</code><code class="calibre14"> </code><code class="s">'Big'</code><code class="calibre14"> </code><code class="o">|</code><code class="calibre14"> </code><code class="s">'Small'</code><code class="calibre14">
  </code><code class="nx">text</code><code class="calibre14">: </code><code class="kt">string</code><code class="calibre14">
  </code><code class="nx">onClick</code><code class="p">(</code><code class="nx">event</code><code class="calibre14">: </code><code class="kt">React.MouseEvent</code><code class="o">&lt;</code><code class="nx">HTMLButtonElement</code><code class="o">&gt;</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="kd">void</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-440" id="calibre_link-446"><img alt="3" src="images/000002.png" class="calibre40" /></a><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">

</code><code class="kd">export</code><code class="calibre14"> </code><code class="kd">function</code><code class="calibre14"> </code><code class="nx">FancyButton</code><code class="p">(</code><code class="nx">props</code><code class="calibre14">: </code><code class="kt">Props</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-441" id="calibre_link-447"><img alt="4" src="images/000003.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="kd">const</code><code class="calibre14"> </code><code class="p">[</code><code class="nx">toggled</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">setToggled</code><code class="p">]</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="nx">React</code><code class="p">.</code><code class="nx">useState</code><code class="p">(</code><code class="kd">false</code><code class="p">)</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-442" id="calibre_link-448"><img alt="5" src="images/000004.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="kd">return</code><code class="calibre14"> </code><code class="o">&lt;</code><code class="nx">button</code><code class="calibre14">
    </code><code class="nx">className</code><code class="o">=</code><code class="p">{</code><code class="s">'Size-'</code><code class="calibre14"> </code><code class="o">+</code><code class="calibre14"> </code><code class="nx">props</code><code class="p">.</code><code class="nx">size</code><code class="p">}</code><code class="calibre14">
    </code><code class="nx">disabled</code><code class="o">=</code><code class="p">{</code><code class="nx">props</code><code class="p">.</code><code class="nx">isDisabled</code><code class="calibre14"> </code><code class="o">||</code><code class="calibre14"> </code><code class="kd">false</code><code class="p">}</code><code class="calibre14">
    </code><code class="nx">onClick</code><code class="o">=</code><code class="p">{</code><code class="nx">event</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
      </code><code class="nx">setToggled</code><code class="p">(</code><code class="o">!</code><code class="nx">toggled</code><code class="p">)</code><code class="calibre14">
      </code><code class="nx">props</code><code class="p">.</code><code class="nx">onClick</code><code class="p">(</code><code class="nx">event</code><code class="p">)</code><code class="calibre14">
    </code><code class="p">}</code><code class="p">}</code><code class="calibre14">
  </code><code class="o">&gt;</code><code class="p">{</code><code class="nx">props</code><code class="p">.</code><code class="nx">text</code><code class="p">}</code><code class="o">&lt;</code><code class="err">/</code><code class="err">b</code><code class="err">u</code><code class="err">t</code><code class="err">t</code><code class="err">o</code><code class="err">n</code><code class="err">&gt;</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">

</code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">button</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="o">&lt;</code><code class="nx">FancyButton</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-443" id="calibre_link-449"><img alt="6" src="images/000005.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="nx">size</code><code class="o">=</code><code class="s">'Big'</code><code class="calibre14">
  </code><code class="nx">text</code><code class="o">=</code><code class="s">'Sign Up Now'</code><code class="calibre14">
  </code><code class="nx">onClick</code><code class="o">=</code><code class="p">{</code><code class="p">(</code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s">'Clicked!'</code><code class="p">)</code><code class="p">}</code><code class="calibre14">
</code><code class="err">/</code><code class="err">&gt;</code></pre>
<dl class="preface">
<dt class="calibre18"><a class="calibre4" href="#calibre_link-444" id="calibre_link-438"><img alt="1" src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We have to bring the <code class="calibre14">React</code> variable into the current scope in order to use TSX with React. Since TSX is compiled to <code class="calibre14">React.createElement</code> function calls, that means we need to import <code class="calibre14">React</code> so that it’s defined at runtime.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-445" id="calibre_link-439"><img alt="2" src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We start by declaring the specific set of props we can pass to our <code class="calibre14">FancyButton</code> component. <code class="calibre14">Props</code> is always an object type, and is named <code class="calibre14">Props</code> by convention. For our <code class="calibre14">FancyButton</code> component, <code class="calibre14">isDisabled</code> is optional, while the rest of our props are required.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-446" id="calibre_link-440"><img alt="3" src="images/000002.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">React has its own set of wrapper types for DOM events. When using React events, be sure to use React’s event types rather than regular DOM event types.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-447" id="calibre_link-441"><img alt="4" src="images/000003.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">A function component is just a regular function that has up to one parameter (the <code class="calibre14">props</code> object) and returns a React-renderable type. React is permissive and can render a wide range of types: TSX, strings, numbers, booleans, <code class="calibre14">null</code>, and <code class="calibre14">undefined</code>.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-448" id="calibre_link-442"><img alt="5" src="images/000004.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We use React’s <code class="calibre14">useState</code> hook to declare local state for a function component. <code class="calibre14">useState</code> is one of a handful of hooks available in React, which you can combine to create your own custom hooks. Note that because we passed the initial value <code class="calibre14">false</code> to <code class="calibre14">useState</code>, TypeScript was able to infer that the piece of state is a <code class="calibre14">boolean</code>; if we’d instead used a type that TypeScript wasn’t able to infer&mdash;for example, an array&mdash;we would have bound the type explicitly (e.g., with useState&lt;number[]&gt;;([])).</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-449" id="calibre_link-443"><img alt="6" src="images/000005.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We use TSX syntax to create an instance of <code class="calibre14">FancyButton</code>. The <code class="calibre14">&lt;FancyButton /&gt;</code> syntax is almost identical to calling <code class="calibre14">FancyButton</code>, but it lets React manage the lifecycle of <code class="calibre14">FancyButton</code> for us.</p></dd>
</dl>

<p class="author1">That’s it. TypeScript enforces that:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">JSX is well formed. Tags are closed and properly nested, and tag names aren’t misspelled.</p>
</li>
<li class="calibre11">
<p class="author1">When we instantiate a <code class="calibre14">&lt;FancyButton /&gt;</code> we pass all required&mdash;plus any optional&mdash;props to <code class="calibre14">FancyButton</code> (<code class="calibre14">size</code>, <code class="calibre14">text</code>, and <code class="calibre14">onClick</code>), and that the props are all correctly typed.</p>
</li>
<li class="calibre11">
<p class="author1">We don’t pass any extraneous props to <code class="calibre14">FancyButton</code>, just the ones that are required.</p>
</li>
</ul>

<p class="author1">A class component is similar:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">import</code><code class="calibre14"> </code><code class="nx">React</code><code class="calibre14"> </code><code class="nx">from</code><code class="calibre14"> </code><code class="s">'react'</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-450" id="calibre_link-459"><img alt="1" src="images/000000.png" class="calibre40" /></a><code class="calibre14">
</code><code class="kd">import</code><code class="calibre14"> </code><code class="p">{</code><code class="nx">FancyButton</code><code class="p">}</code><code class="calibre14"> </code><code class="nx">from</code><code class="calibre14"> </code><code class="s">'./FancyButton'</code><code class="calibre14">

</code><code class="nx">type</code><code class="calibre14"> </code><code class="nx">Props</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-451" id="calibre_link-460"><img alt="2" src="images/000001.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="nx">firstName</code><code class="calibre14">: </code><code class="kt">string</code><code class="calibre14">
  </code><code class="nx">userId</code><code class="calibre14">: </code><code class="kt">string</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">

</code><code class="nx">type</code><code class="calibre14"> </code><code class="nx">State</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-452" id="calibre_link-461"><img alt="3" src="images/000002.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="nx">isLoading</code><code class="calibre14">: </code><code class="kt">boolean</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">

</code><code class="kd">class</code><code class="calibre14"> </code><code class="nx">SignupForm</code><code class="calibre14"> </code><code class="kd">extends</code><code class="calibre14"> </code><code class="nx">React</code><code class="p">.</code><code class="nx">Component</code><code class="o">&lt;</code><code class="nx">Props</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">State</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-453" id="calibre_link-462"><img alt="4" src="images/000003.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="nx">state</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-454" id="calibre_link-463"><img alt="5" src="images/000004.png" class="calibre40" /></a><code class="calibre14">
    </code><code class="nx">isLoading</code><code class="calibre14">: </code><code class="kt">false</code><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">
  </code><code class="nx">render() {</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-455" id="calibre_link-464"><img alt="6" src="images/000005.png" class="calibre40" /></a><code class="calibre14">
    </code><code class="kd">return</code><code class="calibre14"> </code><code class="o">&lt;</code><code class="o">&gt;</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-456" id="calibre_link-465"><img alt="7" src="images/000006.png" class="calibre40" /></a><code class="calibre14">
      </code><code class="o">&lt;</code><code class="nx">h2</code><code class="o">&gt;</code><code class="nx">Sign</code><code class="calibre14"> </code><code class="nx">up</code><code class="calibre14"> </code><code class="kd">for</code><code class="calibre14"> </code><code class="nx">a</code><code class="calibre14"> </code><code class="mi">7</code><code class="o">-</code><code class="nx">day</code><code class="calibre14"> </code><code class="nx">supply</code><code class="calibre14"> </code><code class="nx">of</code><code class="calibre14"> </code><code class="nx">our</code><code class="calibre14"> </code><code class="nx">tasty</code><code class="calibre14">
          </code><code class="nx">toothpaste</code><code class="calibre14"> </code><code class="nx">now</code><code class="p">,</code><code class="calibre14"> </code><code class="p">{</code><code class="kd">this</code><code class="p">.</code><code class="nx">props</code><code class="p">.</code><code class="nx">firstName</code><code class="p">}</code><code class="p">.</code><code class="o">&lt;</code><code class="err">/</code><code class="err">h</code><code class="err">2</code><code class="err">&gt;</code><code class="calibre14">
</code><code class="calibre14">      </code><code class="o">&lt;</code><code class="nx">FancyButton</code><code class="calibre14">
        </code><code class="nx">isDisabled</code><code class="o">=</code><code class="p">{</code><code class="kd">this</code><code class="p">.</code><code class="nx">state</code><code class="p">.</code><code class="nx">isLoading</code><code class="p">}</code><code class="calibre14">
        </code><code class="nx">size</code><code class="o">=</code><code class="s">'Big'</code><code class="calibre14">
        </code><code class="nx">text</code><code class="o">=</code><code class="s">'Sign Up Now'</code><code class="calibre14">
        </code><code class="nx">onClick</code><code class="o">=</code><code class="p">{</code><code class="kd">this</code><code class="p">.</code><code class="nx">signUp</code><code class="p">}</code><code class="calibre14">
      </code><code class="o">/</code><code class="o">&gt;</code><code class="calibre14">
    </code><code class="o">&lt;</code><code class="err">/</code><code class="err">&gt;</code><code class="calibre14">
</code><code class="calibre14">  </code><code class="p">}</code><code class="calibre14">
  </code><code class="kd">private</code><code class="calibre14"> </code><code class="nx">signUp</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="nx">async</code><code class="calibre14"> </code><code class="p">(</code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-457" id="calibre_link-466"><img alt="8" src="images/000007.png" class="calibre40" /></a><code class="calibre14">
    </code><code class="kd">this</code><code class="p">.</code><code class="nx">setState</code><code class="p">(</code><code class="p">{</code><code class="nx">isLoading</code><code class="calibre14">: </code><code class="kt">true</code><code class="p">}</code><code class="p">)</code><code class="calibre14">
    </code><code class="kd">try</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
      </code><code class="nx">await</code><code class="calibre14"> </code><code class="nx">fetch</code><code class="p">(</code><code class="s">'/api/signup?userId='</code><code class="calibre14"> </code><code class="o">+</code><code class="calibre14"> </code><code class="kd">this</code><code class="p">.</code><code class="nx">props</code><code class="p">.</code><code class="nx">userId</code><code class="p">)</code><code class="calibre14">
    </code><code class="p">}</code><code class="calibre14"> </code><code class="kd">finally</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
      </code><code class="kd">this</code><code class="p">.</code><code class="nx">setState</code><code class="p">(</code><code class="p">{</code><code class="nx">isLoading</code><code class="calibre14">: </code><code class="kt">false</code><code class="p">}</code><code class="p">)</code><code class="calibre14">
    </code><code class="p">}</code><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">

</code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">form</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="o">&lt;</code><code class="nx">SignupForm</code><code class="calibre14"> </code><code class="nx">firstName</code><code class="o">=</code><code class="s">'Albert'</code><code class="calibre14"> </code><code class="nx">userId</code><code class="o">=</code><code class="s">'13ab9g3'</code><code class="calibre14"> </code><code class="o">/</code><code class="o">&gt;</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-458" id="calibre_link-467"><img alt="9" src="images/000008.png" class="calibre40" /></a></pre>
<dl class="preface">
<dt class="calibre18"><a class="calibre4" href="#calibre_link-459" id="calibre_link-450"><img alt="1" src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">Like before, we import <code class="calibre14">React</code> to bring it into scope.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-460" id="calibre_link-451"><img alt="2" src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">Like before, we declare a <code class="calibre14">Props</code> type to define what data we need to pass in when creating an instance of <code class="calibre14">&lt;SignupForm /&gt;</code>.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-461" id="calibre_link-452"><img alt="3" src="images/000002.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We declare a <code class="calibre14">State</code> type to model our component’s local state.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-462" id="calibre_link-453"><img alt="4" src="images/000003.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">To declare a class component, we extend the <code class="calibre14">React.Component</code> base class.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-463" id="calibre_link-454"><img alt="5" src="images/000004.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We use a property initializer to declare default values for local state.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-464" id="calibre_link-455"><img alt="6" src="images/000005.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">Like with function components, a class component’s <code class="calibre14">render</code> method returns something renderable by React: TSX, a string, a number, a boolean, <code class="calibre14">null</code>, or <span class="calibre">undefined</span>.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-465" id="calibre_link-456"><img alt="7" src="images/000006.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">TSX supports fragments using the special <code class="calibre14">&lt;&gt;...&lt;/&gt;</code> syntax. A fragment is a nameless TSX element that wraps other TSX, and is a way to avoid rendering extra DOM elements in places where you need to return a single TSX element. For example, a React component’s <code class="calibre14">render</code> method needs to return a single TSX element; to do that, we could have wrapped our code with a <code class="calibre14">&lt;div&gt;</code> or any other element, but that would have incurred unnecessary overhead during rendering.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-466" id="calibre_link-457"><img alt="8" src="images/000007.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We define <code class="calibre14">signUp</code> using an arrow function, to make sure that <code class="calibre14">this</code> in the function doesn’t get re-bound.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-467" id="calibre_link-458"><img alt="9" src="images/000008.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">Finally, we instantiate our <code class="calibre14">SignupForm</code>. Like when instantiating function components, we could have directly <code class="calibre14">new</code>-ed it with <code class="calibre14">new SignupForm({firstName: 'Albert', userId: '13ab9g3'})</code> instead, but that would mean that React couldn’t manage the <code class="calibre14">SignupForm</code> instance’s lifecycle for us.</p></dd>
</dl>

<p class="author1">Notice how we mix and match value-based (<code class="calibre14">FancyButton</code>, <code class="calibre14">SignupForm</code>) and intrinsic (<code class="calibre14">section</code>, <code class="calibre14">h2</code>) components in this example. We put TypeScript to work to verify things like:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">That all required state fields were defined either in the <code class="calibre14">state</code> initializer, or in the constructor</p>
</li>
<li class="calibre11">
<p class="author1">That whatever we access on <code class="calibre14">props</code> and <code class="calibre14">state</code> actually exists, and is of the type we think it is</p>
</li>
<li class="calibre11">
<p class="author1">That we don’t write to <code class="calibre14">this.state</code> directly, because in React, state updates have to go through the <code class="calibre14">setState</code> API</p>
</li>
<li class="calibre11">
<p class="author1">That calling <code class="calibre14">render</code> really returns some JSX</p>
</li>
</ul>

<p class="author1">With TypeScript you can make your React code safer, and become a better, happier person as a result.</p>
<div data-type="note" type="note" class="calibre21"><h6 class="calibre22">Note</h6>
<p class="author1">We didn’t use React’s <code class="calibre14">PropTypes</code> feature, which is a way to declare and check props’ types at runtime. Since TypeScript is already checking types for us at compile time, we don’t need to do it again.<a data-primary="XML" data-secondary="using TSX with React" data-startref="ix_XMLTSX" data-type="indexterm" id="calibre_link-1768" class="calibre4"></a><a data-primary="JSX (JavaScript XML)" data-secondary="using TSX with React" data-startref="ix_JSXTSX" data-type="indexterm" id="calibre_link-1175" class="calibre4"></a><a data-primary="TSX" data-secondary="using with React" data-startref="ix_TSX" data-type="indexterm" id="calibre_link-1545" class="calibre4"></a><a data-primary="frameworks" data-secondary="frontend" data-startref="ix_frwkfrRea" data-tertiary="React" data-type="indexterm" id="calibre_link-1018" class="calibre4"></a><a data-primary="React" data-startref="ix_React" data-type="indexterm" id="calibre_link-1400" class="calibre4"></a></p>
</div>
</div></section>



</div></section>













<section data-pdf-bookmark="Angular 6/7" data-type="sect2" class="preface"><div class="preface" id="calibre_link-8">
<h2 class="calibre17">Angular 6/7</h2>

<p class="byline">Contributed by Shyam Seshadri</p>

<p class="author1">Angular is a more fully featured frontend framework <a data-primary="Angular 6/7" data-type="indexterm" id="calibre_link-618" class="calibre4"></a><a data-primary="frameworks" data-secondary="frontend" data-tertiary="Angular 6/7" data-type="indexterm" id="calibre_link-1014" class="calibre4"></a>than React, and comes with support not just for rendering views but also for sending and managing network requests, routing, and dependency injection. It’s built from the ground up to work with TypeScript (in fact, the framework itself is written in TypeScript!).</p>

<p class="author1">Central to the way <a data-primary="Ahead-of-Time (AoT) compiler (Angular)" data-type="indexterm" id="calibre_link-606" class="calibre4"></a>Angular works is the Ahead-of-Time (AoT) compiler built into Angular CLI, Angular’s command-line utility,<a data-primary="CLI (command-line interface) in Angular" data-type="indexterm" id="calibre_link-754" class="calibre4"></a> that grabs the type information you gave it with your TypeScript annotations and uses that information to compile your code down to regular JavaScript. Instead of calling TypeScript directly, Angular applies a whole bunch of optimizations and transformations to your code before ultimately delegating to TypeScript and compiling it down to JavaScript.</p>

<p class="author1">Let’s see how Angular uses TypeScript and its AoT compiler to make writing frontend applications safe.</p>










<section data-pdf-bookmark="Scaffolding" data-type="sect3" class="preface"><div class="preface" id="calibre_link-1903">
<h3 class="calibre39">Scaffolding</h3>

<p class="author1">To initialize a new Angular project, start by <a data-primary="Angular 6/7" data-secondary="installing CLI" data-type="indexterm" id="calibre_link-622" class="calibre4"></a><a data-primary="CLI (command-line interface) in Angular" data-secondary="installing" data-type="indexterm" id="calibre_link-755" class="calibre4"></a>globally installing Angular CLI using NPM:</p>

<pre data-code-language="sh" data-type="programlisting" class="calibre30">npm install @angular/cli --global</pre>

<p class="author1">Then, use Angular CLI to initialize a new Angular application:</p>

<pre data-code-language="sh" data-type="programlisting" class="calibre30">ng new my-angular-app</pre>

<p class="author1">Follow the prompts, and Angular CLI will set up a bare-bones Angular application for you.<a data-primary="Angular 6/7" data-secondary="initializing a project" data-type="indexterm" id="calibre_link-621" class="calibre4"></a></p>

<p class="author1">In this book we won’t go into depth on how an Angular application is structured, or how to configure and run it. For detailed information, head over to the <a href="https://angular.io/docs" class="calibre4">official Angular documentation</a>.</p>
</div></section>













<section data-pdf-bookmark="Components" data-type="sect3" class="preface"><div class="preface" id="calibre_link-1904">
<h3 class="calibre39">Components</h3>

<p class="author1">Let’s build an Angular component.<a data-primary="components" data-secondary="Angular" data-type="indexterm" id="calibre_link-778" class="calibre4"></a><a data-primary="Angular 6/7" data-secondary="components" data-type="indexterm" id="calibre_link-620" class="calibre4"></a> Angular components are like React components, and include a way to describe a component’s DOM structure, styling, and controller. With Angular, you generate component boilerplate with Angular CLI, then fill in the details by hand. An Angular component consists of a few different files:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">A template, which describes the DOM a component renders</p>
</li>
<li class="calibre11">
<p class="author1">A set of CSS styles</p>
</li>
<li class="calibre11">
<p class="author1">A component class, which is a TypeScript class that dictates your components’ business logic</p>
</li>
</ul>

<p class="author1">Let’s start with the component class:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">import</code> <code class="p">{</code><code class="nx">Component</code><code class="p">,</code> <code class="nx">OnInit</code><code class="p">}</code> <code class="nx">from</code> <code class="s">'@angular/core'</code>

<code class="err">@</code><code class="nx">Component</code><code class="p">({</code>
  <code class="nx">selector</code><code class="o">:</code> <code class="s">'simple-message'</code><code class="p">,</code>
  <code class="nx">styleUrls</code><code class="o">:</code> <code class="p">[</code><code class="s">'./simple-message.component.css'</code><code class="p">],</code>
  <code class="nx">templateUrl</code><code class="o">:</code> <code class="s">'./simple-message.component.html'</code>
<code class="p">})</code>
<code class="kd">export</code> <code class="kd">class</code> <code class="nx">SimpleMessageComponent</code> <code class="kd">implements</code> <code class="nx">OnInit</code> <code class="p">{</code>
  <code class="nx">message</code>: <code class="kt">string</code>
  <code class="nx">ngOnInit() {</code>
    <code class="kd">this</code><code class="p">.</code><code class="nx">message</code> <code class="o">=</code> <code class="s">'No messages, yet'</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p class="author1">For the most part, this is a pretty standard TypeScript class, with just a few differences that bring out how Angular leverages TypeScript. Namely:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">Angular’s <a data-primary="lifecycle hooks (Angular)" data-type="indexterm" id="calibre_link-1195" class="calibre4"></a>lifecycle hooks are available as TypeScript interfaces&mdash;just declare which ones you <code class="calibre14">implement</code> (<code class="calibre14">ngOnChanges</code>, <code class="calibre14">ngOnInit</code>, etc.).<a data-primary="interfaces" data-secondary="Angular lifecycle hooks" data-type="indexterm" id="calibre_link-1116" class="calibre4"></a> TypeScript then enforces that you implement methods that comply with the lifecycle hooks you want. In this example we implemented the <code class="calibre14">OnInit</code> interface, which requires that we implement the <code class="calibre14">ngOnInit</code> method.</p>
</li>
<li class="calibre11">
<p class="author1">Angular<a data-primary="decorators" data-secondary="use by Angular" data-type="indexterm" id="calibre_link-831" class="calibre4"></a> makes heavy use of TypeScript decorators (see <a data-type="xref" href="#calibre_link-468" class="calibre4">“Decorators”</a>) to declare metadata related to your Angular components, services, and modules. <a data-primary="HTML templates (Angular)" data-type="indexterm" id="calibre_link-1088" class="calibre4"></a>In this example, we used a <code class="calibre14">selector</code> to declare how people can consume our component, and we used <code class="calibre14">templateUrls</code> and <code class="calibre14">styleUrl</code> to link an HTML template and CSS stylesheet to our component.</p>
</li>
</ul>
<div data-type="tip" class="calibre21"><h1 class="calibre42">TSC Flag: fullTemplateTypeCheck</h1>
<p class="author1">To enable typechecking for your<a data-primary="typechecking" data-secondary="for Angular templates" data-type="indexterm" id="calibre_link-1596" class="calibre4"></a> Angular templates (you should!),<a data-primary="TSC compiler" data-secondary="fullTemplateTypeCheck flag" data-type="indexterm" id="calibre_link-1511" class="calibre4"></a><a data-primary="fullTemplateTypeCheck TSC flag" data-type="indexterm" id="calibre_link-1022" class="calibre4"></a> be sure to enable <code class="calibre14">fullTemplateTypeCheck</code> in your <em class="calibre5">tsconfig.json</em>:</p>

<pre data-code-language="json" data-type="programlisting" class="calibre43"><code class="p">{</code>
  <code class="nt">"angularCompilerOptions"</code><code class="p">:</code> <code class="p">{</code>
    <code class="nt">"fullTemplateTypeCheck"</code><code class="p">:</code> <code class="kd">true</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p class="author1">Note that <code class="calibre14">angularCompilerOptions</code> isn’t specifying options for TSC.<a data-primary="angularCompilerOptions" data-type="indexterm" id="calibre_link-624" class="calibre4"></a><a data-primary="compilers" data-secondary="angularCompilerOptions" data-type="indexterm" id="calibre_link-774" class="calibre4"></a> Rather, it defines compiler flags specific to Angular’s AoT compiler.</p>
</div>
</div></section>













<section data-pdf-bookmark="Services" data-type="sect3" class="preface"><div class="preface" id="calibre_link-1905">
<h3 class="calibre39">Services</h3>

<p class="author1">Angular comes with a built-in dependency injector (DI), which is a way for the framework to take care of instantiating services and passing them in as arguments to components and services that depend on them.<a data-primary="dependency injector (Angular)" data-type="indexterm" id="calibre_link-837" class="calibre4"></a><a data-primary="services (Angular)" data-type="indexterm" id="calibre_link-1435" class="calibre4"></a><a data-primary="Angular 6/7" data-secondary="services" data-type="indexterm" id="calibre_link-623" class="calibre4"></a> This can make it easier to instantiate and test services and components.</p>

<p class="author1">Let’s update <code class="calibre14">SimpleMessageComponent</code> to inject a dependency, <code class="calibre14">MessageService</code>, responsible for fetching messages from the server:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<code class="kd">import</code><code class="calibre14"> </code><code class="p">{</code><code class="nx">Component</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">OnInit</code><code class="p">}</code><code class="calibre14"> </code><code class="nx">from</code><code class="calibre14"> </code><code class="s">'@angular/core'</code><code class="calibre14">
</code><strong class="calibre49"><code class="k">import</code><code class="calibre50"> </code><code class="p1">{</code><code class="nx1">MessageService</code><code class="p1">}</code><code class="calibre50"> </code><code class="nx1">from</code><code class="calibre50"> </code><code class="s1">'../services/message.service'</code></strong><code class="calibre14">

</code><code class="err">@</code><code class="nx">Component</code><code class="p">(</code><code class="p">{</code><code class="calibre14">
  </code><code class="nx">selector</code><code class="o">:</code><code class="calibre14"> </code><code class="s">'simple-message'</code><code class="p">,</code><code class="calibre14">
  </code><code class="nx">templateUrl</code><code class="o">:</code><code class="calibre14"> </code><code class="s">'./simple-message.component.html'</code><code class="p">,</code><code class="calibre14">
  </code><code class="nx">styleUrls</code><code class="o">:</code><code class="calibre14"> </code><code class="p">[</code><code class="s">'./simple-message.component.css'</code><code class="p">]</code><code class="calibre14">
</code><code class="p">}</code><code class="p">)</code><code class="calibre14">
</code><code class="kd">export</code><code class="calibre14"> </code><code class="kd">class</code><code class="calibre14"> </code><code class="nx">SimpleMessageComponent</code><code class="calibre14"> </code><code class="kd">implements</code><code class="calibre14"> </code><code class="nx">OnInit</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="nx">message</code><code class="calibre14">: </code><code class="kt">string</code><code class="calibre14">
  </code><strong class="calibre49"><code class="k">constructor</code><code class="p1">(</code><code class="calibre50">
    </code><code class="k">private</code><code class="calibre50"> </code><code class="nx1">messageService</code><code class="calibre50">: </code><code class="kt1">MessageService</code><code class="calibre50">
  </code><code class="p1">)</code><code class="calibre50"> </code><code class="p1">{</code><code class="p1">}</code></strong><code class="calibre14">
  </code><code class="nx">ngOnInit() {</code><code class="calibre14">
    </code><strong class="calibre49"><code class="k">this</code><code class="p1">.</code><code class="nx1">messageService</code><code class="p1">.</code><code class="nx1">getMessage</code><code class="p1">(</code><code class="p1">)</code><code class="p1">.</code><code class="nx1">subscribe</code><code class="p1">(</code><code class="nx1">response</code><code class="calibre50"> </code><code class="o1">=</code><code class="o1">&gt;</code><code class="calibre50">
      </code><code class="k">this</code><code class="p1">.</code><code class="nx1">message</code><code class="calibre50"> </code><code class="o1">=</code><code class="calibre50"> </code><code class="nx1">response</code><code class="p1">.</code><code class="nx1">message</code><code class="calibre50">
    </code><code class="p1">)</code></strong><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code></pre>

<p class="author1">Angular’s AoT compiler looks at the parameters that your component’s <code class="calibre14">constructor</code> takes, plucks out their types (e.g., <code class="calibre14">MessageService</code>), and searches the relevant <a data-primary="Ahead-of-Time (AoT) compiler (Angular)" data-type="indexterm" id="calibre_link-607" class="calibre4"></a><a data-primary="compilers" data-secondary="AoT Angular compiler" data-type="indexterm" id="calibre_link-775" class="calibre4"></a>dependency injector’s dependency map for a dependency of that specific type. It then instantiates that dependency (<code class="calibre14">new</code>-ing it) if it hasn’t been instantiated yet, and passes it into the <code class="calibre14">SimpleMessageComponent</code> instance’s constructor. All of this DI stuff is pretty complicated, but it can be convenient as your application grows and you have multiple dependencies you might use depending on how the app is configured (e.g., <code class="calibre14">ProductionAPIService</code> versus <code class="calibre14">DevelopmentAPIService</code>) or when testing it (<code class="calibre14">MockAPIService</code>).</p>

<p class="author1">Now let’s take a quick look at how to define a service:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">import</code> <code class="p">{</code><code class="nx">Injectable</code><code class="p">}</code> <code class="nx">from</code> <code class="s">'@angular/core'</code>
<code class="kd">import</code> <code class="p">{</code><code class="nx">HttpClient</code><code class="p">}</code> <code class="nx">from</code> <code class="s">'@angular/common/http'</code>

<code class="err">@</code><code class="nx">Injectable</code><code class="p">({</code>
  <code class="nx">providedIn</code><code class="o">:</code> <code class="s">'root'</code>
<code class="p">})</code>
<code class="kd">export</code> <code class="kd">class</code> <code class="nx">MessageService</code> <code class="p">{</code>
  <code class="kd">constructor</code><code class="p">(</code><code class="kd">private</code> <code class="nx">http</code>: <code class="kt">HttpClient</code><code class="p">)</code> <code class="p">{}</code>
  <code class="nx">getMessage() {</code>
    <code class="kd">return</code> <code class="kd">this</code><code class="p">.</code><code class="nx">http</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s">'/api/message'</code><code class="p">)</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p class="author1">Whenever we create a service in Angular, we again use TypeScript decorators to register it as something that is <code class="calibre14">Injectable</code>, and we define whether it is provided at the root level of the application or in a submodule. Here, we registered the service <code class="calibre14">Mess<span class="calibre">ageService</span></code>, allowing us to inject it anywhere in our application. In the constructor of any component or service, we can just ask for a <code class="calibre14">MessageService</code> and Angular will magically take care of passing it in.</p>

<p class="author1">With how to safely use these two popular frontend frameworks out of the way, let’s move on to typing the interface between your frontend and your backend.<a data-primary="frameworks" data-secondary="frontend" data-startref="ix_frmwkfrAng" data-tertiary="Angular 6/7" data-type="indexterm" id="calibre_link-1015" class="calibre4"></a><a data-primary="Angular 6/7" data-startref="ix_Angu" data-type="indexterm" id="calibre_link-619" class="calibre4"></a><a data-primary="frameworks" data-secondary="frontend" data-startref="ix_frmwkfr" data-type="indexterm" id="calibre_link-1013" class="calibre4"></a></p>
</div></section>



</div></section>





</div></section>













<section data-pdf-bookmark="Typesafe APIs" data-type="sect1" class="preface"><div class="preface" id="calibre_link-7">
<h1 class="calibre13">Typesafe APIs</h1>

<p class="byline">Contributed by Nick Nance</p>

<p class="author1">Regardless of which frontend and backend frameworks you decide to use, you’ll want a way to safely communicate across machines&mdash;from client to server, server to client, server to server, and client to client.<a data-primary="client/server communications" data-type="indexterm" id="calibre_link-756" class="calibre4"></a><a data-primary="frameworks" data-secondary="typesafe APIs for" data-type="indexterm" id="calibre_link-1019" class="calibre4"></a><a data-primary="APIs" data-secondary="typesafe, for use with frameworks and TypeScript" data-type="indexterm" id="calibre_link-634" class="calibre4"></a></p>

<p class="author1">There are a few competing tools and standards in this space. But before we explore what they are and how they work, let’s think about how we might build our own solution, and what benefits and drawbacks it might have (we are engineers, after all).</p>

<p class="author1">The problem we want to solve is this: though our clients and servers might be 100% typesafe&mdash;bastions of safety&mdash;at some point they’ll need to talk to each other over untyped network protocols like HTTP, TCP, or some other socket-based protocols. How might we make this communication typesafe?<a data-primary="protocols" data-secondary="client/server communications over" data-type="indexterm" id="calibre_link-1392" class="calibre4"></a></p>

<p class="author1">A good starting point could be a typesafe protocol like the one we developed in <a data-type="xref" href="#calibre_link-415" class="calibre4">“Typesafe protocols”</a>. It might <a data-primary="protocols" data-secondary="typesafe" data-type="indexterm" id="calibre_link-1394" class="calibre4"></a>look something like this:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">Request</code> <code class="o">=</code>
  <code class="o">|</code> <code class="p">{</code><code class="nx">entity</code><code class="o">:</code> <code class="s">'user'</code><code class="p">,</code> <code class="nx">data</code>: <code class="kt">User</code><code class="p">}</code>
  <code class="o">|</code> <code class="p">{</code><code class="nx">entity</code><code class="o">:</code> <code class="s">'location'</code><code class="p">,</code> <code class="nx">data</code>: <code class="kt">Location</code><code class="p">}</code>

<code class="c">// client.ts</code>
<code class="nx">async</code> <code class="kd">function</code> <code class="nx">get</code><code class="o">&lt;</code><code class="nx">R</code> <code class="kd">extends</code> <code class="nx">Request</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">entity</code>: <code class="kt">R</code><code class="p">[</code><code class="s">'entity'</code><code class="p">])</code><code class="o">:</code> <code class="nx">Promise</code><code class="o">&lt;</code><code class="nx">R</code><code class="p">[</code><code class="s">'data'</code><code class="p">]</code><code class="o">&gt;</code> <code class="p">{</code>
  <code class="kd">let</code> <code class="nx">res</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">fetch</code><code class="p">(</code><code class="sr">/api/</code><code class="nx">$</code><code class="p">{</code><code class="nx">entity</code><code class="p">})</code>
  <code class="kd">let</code> <code class="nx">json</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">res</code><code class="p">.</code><code class="nx">json</code><code class="p">()</code>
  <code class="kd">if</code> <code class="p">(</code><code class="o">!</code><code class="nx">json</code><code class="p">)</code> <code class="p">{</code>
    <code class="kd">throw</code> <code class="nx">ReferenceError</code><code class="p">(</code><code class="s">'Empty response'</code><code class="p">)</code>
  <code class="p">}</code>
  <code class="kd">return</code> <code class="nx">json</code>
<code class="p">}</code>

<code class="c">// app.ts</code>
<code class="nx">async</code> <code class="kd">function</code> <code class="nx">startApp() {</code>
  <code class="kd">let</code> <code class="nx">user</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">get</code><code class="p">(</code><code class="s">'user'</code><code class="p">)</code>  <code class="c">// User</code>
<code class="p">}</code></pre>

<p class="author1">You could build corresponding <code class="calibre14">post</code> and <code class="calibre14">put</code> functions to write back to your REST API, and add a type for each entity your server supports. On the backend, you’d then implement a corresponding set of handlers for each type of entity, reading from your database to return to the client whatever entity it asked for.</p>

<p class="author1">But what happens if your server isn’t written in TypeScript, or if you aren’t able to share your <code class="calibre14">Request</code> type between the client and server (leading to the two getting out of sync over time), or if you don’t use REST (maybe you use GraphQL instead)? Or what if you have other clients to support, like Swift clients on iOS or Java clients on Android?</p>

<p class="author1">That’s where typed, code-generated APIs come in. They come in a lot of flavors, each with libraries available in a bunch of languages (including TypeScript)&mdash;for example:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1"><a href="https://github.com/swagger-api/swagger-codegen" class="calibre4">Swagger</a> for RESTful APIs</p>
</li>
<li class="calibre11">
<p class="author1"><a href="https://www.npmjs.com/package/apollo" class="calibre4">Apollo</a> and <a href="https://facebook.github.io/relay/" class="calibre4">Relay</a> for GraphQL</p>
</li>
<li class="calibre11">
<p class="author1"><a href="https://grpc.io/" class="calibre4">gRPC</a> and <a href="https://thrift.apache.org/" class="calibre4">Apache Thrift</a> for RPC</p>
</li>
</ul>

<p class="author1">These tools rely on a common source of truth for both server and clients&mdash;data models for Swagger, GraphQL schemas for Apollo, Protocol Buffers for gRPC&mdash;which are then compiled into language-specific bindings for whatever language you might be using (in our case, that’s TypeScript).</p>

<p class="author1">This code generation is what prevents your client and server (or multiple clients) from getting out of sync with each other; since every platform shares a common schema, you won’t run into the case where you updated your iOS app to support a field, but forgot to press Merge on your pull request to add server support for it.</p>

<p class="author1">Diving into the details of each framework is out of scope for this book. Pick one for your project, and head over to its documentation to learn more.<a data-primary="client/server communications" data-startref="ix_clsrv" data-type="indexterm" id="calibre_link-757" class="calibre4"></a><a data-primary="frameworks" data-secondary="typesafe APIs for" data-startref="ix_frmwkAPI" data-type="indexterm" id="calibre_link-1020" class="calibre4"></a><a data-primary="APIs" data-secondary="typesafe, for use with frameworks and TypeScript" data-startref="ix_APIsfrmwk" data-type="indexterm" id="calibre_link-635" class="calibre4"></a></p>
</div></section>













<section data-pdf-bookmark="Backend Frameworks" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1906">
<h1 class="calibre13">Backend Frameworks</h1>

<p class="author1">When you build an application that interacts with a database, you might start with raw SQL or API calls, <a data-primary="databases, application interacting with" data-type="indexterm" id="calibre_link-816" class="calibre4"></a><a data-primary="SQL calls" data-type="indexterm" id="calibre_link-1442" class="calibre4"></a><a data-primary="APIs" data-secondary="application interacting with databases" data-type="indexterm" id="calibre_link-633" class="calibre4"></a><a data-primary="frameworks" data-secondary="backend" data-type="indexterm" id="calibre_link-1011" class="calibre4"></a><a data-primary="backend frameworks" data-type="indexterm" id="calibre_link-682" class="calibre4"></a>which are inherently untyped:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// PostgreSQL, using node-postgres</code>
<code class="kd">let</code> <code class="nx">client</code> <code class="o">=</code> <code class="kd">new</code> <code class="nx">Client</code>
<code class="kd">let</code> <code class="nx">res</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">client</code><code class="p">.</code><code class="nx">query</code><code class="p">(</code>
  <code class="s">'SELECT name FROM users where id = $1'</code><code class="p">,</code>
  <code class="p">[</code><code class="mi">739311</code><code class="p">]</code>
<code class="p">)</code> <code class="c">// any</code>

<code class="c">// MongoDB, using node-mongodb-native</code>
<code class="nx">db</code><code class="p">.</code><code class="nx">collection</code><code class="p">(</code><code class="s">'users'</code><code class="p">)</code>
  <code class="p">.</code><code class="nx">find</code><code class="p">({</code><code class="nx">id</code>: <code class="kt">739311</code><code class="p">})</code>
  <code class="p">.</code><code class="nx">toArray</code><code class="p">((</code><code class="nx">err</code><code class="p">,</code> <code class="nx">user</code><code class="p">)</code> <code class="o">=&gt;</code>
    <code class="c">// user is any</code>
  <code class="p">)</code></pre>

<p class="author1">With a bit of manual typing you can make these APIs safer and get rid of most of your <code class="calibre14">any</code>s:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">db</code><code class="p">.</code><code class="nx">collection</code><code class="p">(</code><code class="s">'users'</code><code class="p">)</code>
  <code class="p">.</code><code class="nx">find</code><code class="p">({</code><code class="nx">id</code>: <code class="kt">739311</code><code class="p">})</code>
  <code class="p">.</code><code class="nx">toArray</code><code class="p">((</code><code class="nx">err</code><code class="p">,</code> <code class="nx">user</code>: <code class="kt">User</code><code class="p">)</code> <code class="o">=&gt;</code>
    <code class="c">// user is any</code>
  <code class="p">)</code></pre>

<p class="author1">However, raw SQL APIs are still fairly low-level, and it’s still easy to use the wrong type, or forget a type and accidentally end up with <code class="calibre14">any</code>s.</p>

<p class="author1">That’s where <em class="calibre5">object-relational mappers</em> (ORMs) come in.<a data-primary="object-relational mappers (ORMs)" data-type="indexterm" id="calibre_link-1302" class="calibre4"></a><a data-primary="ORMs (object-relational mappers)" data-type="indexterm" id="calibre_link-1331" class="calibre4"></a> ORMs generate code from your database schema, giving you high-level APIs to express queries, updates, deletions, and so on. In statically typed languages, these APIs are typesafe, so you don’t have to worry about typing things correctly and manually binding generic type parameters.</p>

<p class="author1">When accessing your database from TypeScript, consider using an ORM. At the time of writing, Umed Khudoiberdiev’s excellent <a href="https://www.npmjs.com/package/typeorm" class="calibre4">TypeORM</a> is the most complete ORM for TypeScript, and supports MySQL, PostgreSQL, Microsoft SQL Server, Oracle, and even MongoDB. Using TypeORM, your query to get a user’s first name might look like this:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">user</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">UserRepository</code>
  <code class="p">.</code><code class="nx">findOne</code><code class="p">({</code><code class="nx">id</code>: <code class="kt">739311</code><code class="p">})</code> <code class="c">// User | undefined</code></pre>

<p class="author1">Notice the high-level API, which is both safe (in that it prevents things like SQL injection attacks) and typesafe by default (in that we know what type <code class="calibre14">findOne</code> returns without having to manually annotate it). Always use an ORM when working with databases&mdash;it’s more convenient, and it will save you from getting woken up at four in the morning because the <code class="calibre14">saleAmount</code> field is <code class="calibre14">null</code> because you updated it to <span class="calibre"><code class="calibre14">orderAmount</code></span> the night before and your coworker decided to run your database migration for you in anticipation of your pull request landing while you were out, but then around midnight your pull request failed even though the migration succeeded, and your sales team in New York woke up to realize that all your clients’ orders were for exactly <code class="calibre14">null</code> dollars (this happened to… a friend).</p>
</div></section>













<section data-pdf-bookmark="Summary" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1907">
<h1 class="calibre13">Summary</h1>

<p class="author1">In this chapter we’ve covered a lot: directly manipulating the DOM; using React and Angular; adding type safety to your APIs with tools like Swagger, gRPC, and GraphQL; and using TypeORM to safely interact with your database.</p>

<p class="author1">JavaScript frameworks change at a rapid pace, and by the time you read this, the specific APIs and frameworks described here may be on their way to becoming museum exhibits. Use your newfound intuition for <em class="calibre5">what problems typesafe frameworks solve</em> to identify places where you can take advantage of someone else’s work to make your code safer, more abstract, and more modular. The big idea to take away from this chapter isn’t what the best framework to use in the year 2019 is, but what sorts of problems can be better solved with frameworks.</p>

<p class="author1">With the combination of typesafe UI code, a typed API layer, and a typesafe backend, you can eliminate entire classes of bugs from your application, and sleep better at night as a result.<a data-primary="frameworks" data-startref="ix_frmwk" data-type="indexterm" id="calibre_link-1010" class="calibre4"></a></p>
</div></section>







</div></section></div>

<div data-type="book" class="calibre1" id="calibre_link-469"><section data-pdf-bookmark="Chapter 10. Namespaces.Modules" data-type="chapter" type="chapter" class="preface"><div class="preface" id="calibre_link-332">
<h1 class="calibre12"><span class="calibre">Chapter 10. </span>Namespaces.Modules</h1>


<p class="author1">When you write a program, you can express encapsulation at several levels. At the lowest level, <a data-primary="modules" data-type="indexterm" id="calibre_link-1217" class="calibre4"></a>functions encapsulate behaviors, and data structures like objects and lists encapsulate data. You might then group functions and data into classes, or keep them separate as namespaced utilities with a separate database or store for your data. A single class or a set of utilities per file is typical. Going up, you might group a few classes or utilities into a package, which you publish to NPM.</p>

<p class="author1">When we talk about modules, it’s important to make a distinction between how the compiler (TSC) resolves modules, how your build system (Webpack, Gulp, etc.) resolves modules, and how modules are actually loaded into your application at runtime (<code class="calibre14">&lt;script /&gt;</code> tags, SystemJS, etc.). In the JavaScript world there is usually a separate program that does each of these jobs, which can make modules hard to reason about. The CommonJS and ES2015 module standards make it easier to interoperate the three programs, and powerful bundlers like Webpack help abstract away the three kinds of resolution happening under the hood.</p>

<p class="author1">In this chapter we’ll focus on the first of these three kinds of programs: how TypeScript resolves and compiles modules. We’ll leave a discussion of how the build system and runtime loaders work with modules to <a data-type="xref" href="#calibre_link-27" class="calibre4">Chapter&nbsp;12</a> and talk here about:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">The different ways to namespace and modularize your code</p>
</li>
<li class="calibre11">
<p class="author1">The different ways to import and export code</p>
</li>
<li class="calibre11">
<p class="author1">Scaling these approaches as your codebase grows</p>
</li>
<li class="calibre11">
<p class="author1">Module mode versus script mode</p>
</li>
<li class="calibre11">
<p class="author1">What declaration merging is, and what you can do with it</p>
</li>
</ul>

<p class="author1">But first, a bit of background.</p>






<section data-pdf-bookmark="A Brief History of JavaScript Modules" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1908">
<h1 class="calibre13">A Brief History of JavaScript Modules</h1>

<p class="author1">Because TypeScript compiles to and interoperates with JavaScript, it has to support the various module standards that JavaScript programmers use.<a data-primary="JavaScript" data-secondary="modules, brief history of" data-type="indexterm" id="calibre_link-1163" class="calibre4"></a><a data-primary="modules" data-secondary="brief history of JavaScript modules" data-type="indexterm" id="calibre_link-1221" class="calibre4"></a></p>

<p class="author1">In the beginning (in 1995), JavaScript didn’t support any sort of module system. Without modules, everything was declared in a global namespace, which made it really hard to build and scale applications. You could quickly run out of variable names, and run into collisions between variable names; and without exposing explicit APIs for each module, it’s hard to know which parts of a module you’re supposed to use, and which parts are private implementation details.</p>

<p class="author1">To help solve these problems, people simulated modules with either objects or <em class="calibre5">Immediately Invoked Function Expressions</em> (IIFEs), which they assigned to the global <code class="calibre14">window</code>, making them available to other modules in their application (and in other applications hosted on the same web page).<a data-primary="immediately invoked function expressions (IIFEs)" data-type="indexterm" id="calibre_link-1089" class="calibre4"></a> It looked something like this:</p>

<pre data-code-language="js" data-type="programlisting" class="calibre30"><code class="nb">window</code><code class="p">.</code><code class="nx">emailListModule</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">renderList</code><code class="p">()</code> <code class="p">{}</code>
  <code class="c">// ...</code>
<code class="p">}</code>

<code class="nb">window</code><code class="p">.</code><code class="nx">emailComposerModule</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">renderComposer</code><code class="p">()</code> <code class="p">{}</code>
  <code class="c">// ...</code>
<code class="p">}</code>

<code class="nb">window</code><code class="p">.</code><code class="nx">appModule</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">renderApp</code><code class="p">()</code> <code class="p">{</code>
    <code class="nb">window</code><code class="p">.</code><code class="nx">emailListModule</code><code class="p">.</code><code class="nx">renderList</code><code class="p">()</code>
    <code class="nb">window</code><code class="p">.</code><code class="nx">emailComposerModule</code><code class="p">.</code><code class="nx">renderComposer</code><code class="p">()</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p class="author1">Because loading and running JavaScript blocks the browser’s UI, as a web application grows and includes more and more lines of code, the user’s browser gets slower and slower.<a data-primary="browsers" data-secondary="loading and running JavaScript" data-type="indexterm" id="calibre_link-698" class="calibre4"></a> For this reason, clever programmers started dynamically loading JavaScript after the page loaded, rather than loading it all in one shot. Nearly 10 years after JavaScript was first released, Dojo (Alex Russell, 2004), YUI (Thomas Sha, 2005), and LABjs (Kyle Simpson, 2009) shipped module loaders&mdash;ways to lazily (and often asynchronously) load JavaScript code after the initial page load has happened.<a data-primary="lazy and asynchronous loading modules" data-type="indexterm" id="calibre_link-1183" class="calibre4"></a><a data-primary="asynchronously loading modules" data-type="indexterm" id="calibre_link-680" class="calibre4"></a> Lazy and asynchronous module loading meant three things:</p>
<ol class="calibre31">
<li class="calibre32">
<p class="author1">Modules needed to be well encapsulated. Otherwise, a page might be broken while dependencies are streaming in.</p>
</li>
<li class="calibre32">
<p class="author1">Dependencies between modules needed to be explicit. Otherwise, we don’t know which modules need to be loaded and in what order.</p>
</li>
<li class="calibre32">
<p class="author1">Every module needed a unique identifier within the app. Otherwise, there’s no reliable way to specify what modules need to be loaded.</p>
</li>

</ol>

<p class="author1">Loading a module<a data-primary="LABjs, loading module with" data-type="indexterm" id="calibre_link-1181" class="calibre4"></a> with LABjs looked like this:</p>

<pre data-code-language="js" data-type="programlisting" class="calibre30"><code class="nx">$LAB</code>
  <code class="p">.</code><code class="nx">script</code><code class="p">(</code><code class="s">'/emailBaseModule.js'</code><code class="p">).</code><code class="nx">wait</code><code class="p">()</code>
  <code class="p">.</code><code class="nx">script</code><code class="p">(</code><code class="s">'/emailListModule.js'</code><code class="p">)</code>
  <code class="p">.</code><code class="nx">script</code><code class="p">(</code><code class="s">'/emailComposerModule.js'</code><code class="p">)</code></pre>

<p class="author1">Around the same time, NodeJS (Ryan Dahl, 2009) was being developed, and its creators took a lesson from JavaScript’s growing pains and from other languages and decided to build a module system right into the platform.<a data-primary="NodeJS" data-secondary="modules" data-type="indexterm" id="calibre_link-1269" class="calibre4"></a> Like any good module system, it needed to satisfy the same three criteria as LABjs and YUI’s loaders.<a data-primary="CommonJS module standard" data-type="indexterm" id="calibre_link-766" class="calibre4"></a> NodeJS did that with the CommonJS module standard, which looked like this:</p>

<pre data-code-language="js" data-type="programlisting" class="calibre30"><code class="c">// emailBaseModule.js</code>
<code class="kd">var</code> <code class="nx">emailList</code> <code class="o">=</code> <code class="nx">require</code><code class="p">(</code><code class="s">'emailListModule'</code><code class="p">)</code>
<code class="kd">var</code> <code class="nx">emailComposer</code> <code class="o">=</code> <code class="nx">require</code><code class="p">(</code><code class="s">'emailComposerModule'</code><code class="p">)</code>

<code class="nx">module</code><code class="p">.</code><code class="nx">exports</code><code class="p">.</code><code class="nx">renderBase</code> <code class="o">=</code> <code class="kd">function</code><code class="p">()</code> <code class="p">{</code>
  <code class="c">// ...</code>
<code class="p">}</code></pre>

<p class="author1">In the meantime, <a data-primary="AMD module standard" data-type="indexterm" id="calibre_link-615" class="calibre4"></a>on the web the AMD module standard (James Burke, 2008)&mdash;pushed by Dojo and RequireJS&mdash;was taking off. It supported an equivalent set of functionality, and came with its own build system for bundling up JavaScript code:</p>

<pre data-code-language="js" data-type="programlisting" class="calibre30"><code class="nx">define</code><code class="p">(</code><code class="s">'emailBaseModule'</code><code class="p">,</code>
  <code class="p">[</code><code class="s">'require'</code><code class="p">,</code> <code class="s">'exports'</code><code class="p">,</code> <code class="s">'emailListModule'</code><code class="p">,</code> <code class="s">'emailComposerModule'</code><code class="p">],</code>
  <code class="kd">function</code><code class="p">(</code><code class="nx">require</code><code class="p">,</code> <code class="nx">exports</code><code class="p">,</code> <code class="nx">emailListModule</code><code class="p">,</code> <code class="nx">emailComposerModule</code><code class="p">)</code> <code class="p">{</code>
    <code class="nx">exports</code><code class="p">.</code><code class="nx">renderBase</code> <code class="o">=</code> <code class="kd">function</code><code class="p">()</code> <code class="p">{</code>
      <code class="c">// ...</code>
    <code class="p">}</code>
  <code class="p">}</code>
<code class="p">)</code></pre>

<p class="author1">A few years <a data-primary="Browserify" data-type="indexterm" id="calibre_link-697" class="calibre4"></a>after that, Browserify came out (James Halliday, 2011), giving frontend engineers the ability to use CommonJS on the frontend, too.<a data-primary="imports" data-secondary="CommonJS" data-type="indexterm" id="calibre_link-1095" class="calibre4"></a><a data-primary="exports" data-secondary="CommonJS" data-type="indexterm" id="calibre_link-992" class="calibre4"></a> CommonJS became the de facto standard for module bundling and import/export syntax.</p>

<p class="author1">There were a few problems with the CommonJS way of doing things.<a data-primary="CommonJS module standard" data-secondary="problems with" data-type="indexterm" id="calibre_link-768" class="calibre4"></a><a data-primary="require calls" data-type="indexterm" id="calibre_link-1417" class="calibre4"></a> Among them, <code class="calibre14">require</code> calls are necessarily synchronous, and the CommonJS module resolution algorithm is not ideal for use on the web. On top of that, code that uses it isn’t statically analyzable in some cases (as a TypeScript programmer, this should perk your ears up),<a data-primary="module.exports" data-type="indexterm" id="calibre_link-1215" class="calibre4"></a> because <code class="calibre14">module.exports</code> can appear anywhere (even in dead code branches that are never actually reached) and <code class="calibre14">require</code> calls can appear anywhere and contain arbitrary strings and expressions, making it impossible to statically link a JavaScript program, and verify that all referenced files really exist and export what they say they export.<a data-primary="exports" data-secondary="module.exports" data-type="indexterm" id="calibre_link-996" class="calibre4"></a></p>

<p class="author1">Against this backdrop, ES2015&mdash;the sixth <a data-primary="ES2015" data-type="indexterm" id="calibre_link-960" class="calibre4"></a>edition of the ECMAScript language&mdash;introduced a new standard for imports and exports that had a clean syntax and was statically analyzable.<a data-primary="exports" data-secondary="ES2015 standard for" data-type="indexterm" id="calibre_link-993" class="calibre4"></a><a data-primary="imports" data-secondary="ES2015 standard for" data-type="indexterm" id="calibre_link-1097" class="calibre4"></a> It looks like this:</p>

<pre data-code-language="js" data-type="programlisting" class="calibre30"><code class="c">// emailBaseModule.js</code>
<code class="kd">import</code> <code class="nx">emailList</code> <code class="nx">from</code> <code class="s">'emailListModule'</code>
<code class="kd">import</code> <code class="nx">emailComposer</code> <code class="nx">from</code> <code class="s">'emailComposerModule'</code>

<code class="kd">export</code> <code class="kd">function</code> <code class="nx">renderBase</code><code class="p">()</code> <code class="p">{</code>
  <code class="c">// ...</code>
<code class="p">}</code></pre>

<p class="author1">This is the standard we use in JavaScript and TypeScript code today. However, at the time of writing the standard isn’t yet natively supported in every JavaScript runtime, so we have to compile it down to a format that is supported (CommonJS for NodeJS environments, globals or a module-loadable format for browser environments).<a data-primary="browsers" data-secondary="module-loadable format for" data-type="indexterm" id="calibre_link-699" class="calibre4"></a></p>

<p class="author1">TypeScript gives us a few ways to consume and export code in a module: with global declarations,<a data-primary="TypeScript" data-secondary="modules, consuming and exporting" data-type="indexterm" id="calibre_link-1696" class="calibre4"></a> with standard ES2015 <code class="calibre14">import</code>s and <code class="calibre14">export</code>s, and with backward-compatible <code class="calibre14">import</code>s from CommonJS modules. On top of that, TSC’s build system lets us compile modules for a variety of environments: globals, ES2015, CommonJS, AMD, SystemJS, or UMD (a mix of CommonJS, AMD, and globals&mdash;whichever happens to be available in the consumer’s environment).<a data-primary="globals (browser)" data-type="indexterm" id="calibre_link-1084" class="calibre4"></a><a data-primary="JavaScript" data-secondary="modules, brief history of" data-startref="ix_JSmod" data-type="indexterm" id="calibre_link-1164" class="calibre4"></a><a data-primary="modules" data-secondary="brief history of JavaScript modules" data-startref="ix_modsJShist" data-type="indexterm" id="calibre_link-1222" class="calibre4"></a></p>
</div></section>













<section data-pdf-bookmark="import, export" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1909">
<h1 class="calibre13">import, export</h1>

<p class="author1">Unless you’re being chased by wolves, you should use ES2015 <code class="calibre14">import</code>s and <code class="calibre14">export</code>s in your TypeScript code, rather than using CommonJS, global, or namespaced modules. <a data-primary="modules" data-secondary="import, export" data-type="indexterm" id="calibre_link-1223" class="calibre4"></a>They look like this&mdash;the same as plain old JavaScript:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// a.ts</code>
<code class="kd">export</code> <code class="kd">function</code> <code class="nx">foo() {</code><code class="p">}</code>
<code class="kd">export</code> <code class="kd">function</code> <code class="nx">bar() {</code><code class="p">}</code>

<code class="c">// b.ts</code>
<code class="kd">import</code> <code class="p">{</code><code class="nx">foo</code><code class="p">,</code> <code class="nx">bar</code><code class="p">}</code> <code class="nx">from</code> <code class="s">'./a'</code>
<code class="nx">foo</code><code class="p">()</code>
<code class="kd">export</code> <code class="kd">let</code> <code class="nx">result</code> <code class="o">=</code> <code class="nx">bar</code><code class="p">()</code></pre>

<p class="author1">The ES2015 module standard supports default exports:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// c.ts</code>
<code class="kd">export</code> <code class="kd">default</code> <code class="kd">function</code> <code class="nx">meow</code><code class="p">(</code><code class="nx">loudness</code>: <code class="kt">number</code><code class="p">)</code> <code class="p">{}</code>

<code class="c">// d.ts</code>
<code class="kd">import</code> <code class="nx">meow</code> <code class="nx">from</code> <code class="s">'./c'</code> <code class="c">// Note the lack of {curlies}</code>
<code class="nx">meow</code><code class="p">(</code><code class="mi">11</code><code class="p">)</code></pre>

<p class="author1">It also supports importing everything from a module using a wildcard import (<code class="calibre14">*</code>):</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// e.ts</code>
<code class="kd">import</code> <code class="o">*</code> <code class="kd">as</code> <code class="nx">a</code> <code class="nx">from</code> <code class="s">'./a'</code>
<code class="nx">a</code><code class="p">.</code><code class="nx">foo</code><code class="p">()</code>
<code class="nx">a</code><code class="p">.</code><code class="nx">bar</code><code class="p">()</code></pre>

<p class="author1">And reexporting some (or all) exports from a module:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// f.ts</code>
<code class="kd">export</code> <code class="o">*</code> <code class="nx">from</code> <code class="s">'./a'</code>
<code class="kd">export</code> <code class="p">{</code><code class="nx">result</code><code class="p">}</code> <code class="nx">from</code> <code class="s">'./b'</code>
<code class="kd">export</code> <code class="nx">meow</code> <code class="nx">from</code> <code class="s">'./c'</code></pre>

<p class="author1">Because we’re writing TypeScript, not JavaScript, we can of course export types and interfaces as well as values. And because types and values live in separate namespaces, it’s perfectly fine to export two things&mdash;one at the value level and one at the type level&mdash;that share the same name. Like for any other code, TypeScript will infer whether you meant the type or the value when you actually use it:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// g.ts</code>
<code class="kd">export</code> <code class="kd">let</code> <code class="nx">X</code> <code class="o">=</code> <code class="mi">3</code>
<code class="kd">export</code> <code class="nx">type</code> <code class="nx">X</code> <code class="o">=</code> <code class="p">{</code><code class="nx">y</code>: <code class="kt">string</code><code class="p">}</code>

<code class="c">// h.ts</code>
<code class="kd">import</code> <code class="p">{</code><code class="nx">X</code><code class="p">}</code> <code class="nx">from</code> <code class="s">'./g'</code>

<code class="kd">let</code> <code class="nx">a</code> <code class="o">=</code> <code class="nx">X</code> <code class="o">+</code> <code class="mi">1</code>         <code class="c">// X refers to the value X</code>
<code class="kd">let</code> <code class="nx">b</code>: <code class="kt">X</code> <code class="o">=</code> <code class="p">{</code><code class="nx">y</code><code class="o">:</code> <code class="s">'z'</code><code class="p">}</code>   <code class="c">// X refers to the type X</code></pre>

<p class="author1">Module paths are filenames on the filesystem.<a data-primary="filesystem, module paths as filenames on" data-type="indexterm" id="calibre_link-1002" class="calibre4"></a><a data-primary="paths (module)" data-type="indexterm" id="calibre_link-1348" class="calibre4"></a> This couples modules with the way they’re laid out in the filesystem, but is an important feature for module loaders that need to be aware of that layout so they can resolve modules names to files.<a data-primary="imports" data-secondary="ES2015 standard for" data-startref="ix_impES" data-type="indexterm" id="calibre_link-1098" class="calibre4"></a><a data-primary="exports" data-secondary="ES2015 standard for" data-startref="ix_exES" data-type="indexterm" id="calibre_link-994" class="calibre4"></a><a data-primary="modules" data-secondary="import, export" data-startref="ix_modsimex" data-type="indexterm" id="calibre_link-1224" class="calibre4"></a></p>








<section data-pdf-bookmark="Dynamic Imports" data-type="sect2" class="preface"><div class="preface" id="calibre_link-511">
<h2 class="calibre17">Dynamic Imports</h2>

<p class="author1">As your application gets bigger, its time to initial render will get worse and worse. <a data-primary="modules" data-secondary="import, export" data-tertiary="dynamic imports" data-type="indexterm" id="calibre_link-1225" class="calibre4"></a><a data-primary="imports" data-secondary="dynamic" data-type="indexterm" id="calibre_link-1096" class="calibre4"></a>This is especially a problem for frontend applications where the network can be a bottleneck, but it also applies to backend applications that take more time to start up as you import more code at the top level&mdash;code that needs to be loaded from the filesystem, parsed, compiled, and evaluated, all while blocking other code from running.</p>

<p class="author1">On the frontend, one way to deal with this problem (besides writing less code!) is with <em class="calibre5">code splitting</em>: chunking <a data-primary="code splitting" data-type="indexterm" id="calibre_link-762" class="calibre4"></a>your code up into a bunch of generated JavaScript files, instead of shipping everything in a single large file. With splitting you get the benefit of loading multiple chunks in parallel, which eases the toll of large network requests (see <a data-type="xref" href="#calibre_link-470" class="calibre4">Figure&nbsp;10-1</a>).</p>

<figure class="calibre33"><div class="figure" id="calibre_link-470">
<img alt="prts 1001" src="images/000024.png" class="calibre40" />
<h6 class="calibre34"><span class="calibre">Figure 10-1. </span>Network waterfall for JavaScript loaded from facebook.com</h6>
</div></figure>

<p class="author1">A further optimization is to lazy-load chunks of code when they’re actually needed.<a data-primary="lazy and asynchronous loading modules" data-secondary="lazy loading chunks of code" data-type="indexterm" id="calibre_link-1184" class="calibre4"></a> Really large frontend applications&mdash;like those at Facebook and Google&mdash;use this type of optimization as a matter of course. Without it, clients might be loading gigabytes of JavaScript code on the initial page load, which could take minutes or hours (not to mention that people would probably stop using those services once they received their mobile bills).</p>

<p class="author1">Lazy loading is also useful for other reasons. For example, the popular <a href="https://momentjs.com" class="calibre4">Moment.js</a> date manipulation library comes with packages to support every date format used around the world,<a data-primary="Moment.js date manipulation library" data-type="indexterm" id="calibre_link-1237" class="calibre4"></a> split up by locale. Each packages weighs in at around 3 KB. Loading all of these locales for each user might be an unacceptable performance and bandwidth hit; instead, you might want to detect the user’s locale, then load just the relevant date package.</p>

<p class="author1">LABjs and its siblings introduced the concept of lazy-loading code when you actually need it,<a data-primary="LABjs, loading module with" data-secondary="lazy-loading code" data-type="indexterm" id="calibre_link-1182" class="calibre4"></a> and the concept was formalized in <em class="calibre5">dynamic imports</em>.<a data-primary="dynamic imports" data-type="indexterm" id="calibre_link-859" class="calibre4"></a> It looks like this:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">locale</code> <code class="o">=</code> <code class="nx">await</code> <code class="kd">import</code><code class="p">(</code><code class="s">'locale_us-en'</code><code class="p">)</code></pre>

<p class="author1">You can use <code class="calibre14">import</code> either as a statement to statically pull in code (as we’ve used it up to this point), or as a function that returns a <code class="calibre14">Promise</code> for your module (as we did in this example).<a data-primary="import statements" data-type="indexterm" id="calibre_link-1094" class="calibre4"></a><a data-primary="promises" data-secondary="returned by import function" data-type="indexterm" id="calibre_link-1382" class="calibre4"></a><a data-primary="import function" data-type="indexterm" id="calibre_link-1092" class="calibre4"></a></p>

<p class="author1">While you can pass an arbitrary expression that evaluates to a string to <code class="calibre14">import</code>, you lose type safety when you do. To safely use dynamic imports, be sure to either:</p>
<ol class="calibre31">
<li class="calibre32">
<p class="author1">Pass a string literal directly to <code class="calibre14">import</code>, without assigning the string to a variable first.</p>
</li>
<li class="calibre32">
<p class="author1">Pass an expression to <code class="calibre14">import</code> and manually annotate the module’s signature.</p>
</li>

</ol>

<p class="author1">If using the second option, a common pattern is to statically import the module, but use it only in a type position, so that TypeScript compiles away the static import (to learn more, see <a data-type="xref" href="#calibre_link-471" class="calibre4">“The types Directive”</a>). For example:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">import</code> <code class="p">{</code><code class="nx">locale</code><code class="p">}</code> <code class="nx">from</code> <code class="s">'./locales/locale-us'</code>

<code class="nx">async</code> <code class="kd">function</code> <code class="nx">main() {</code>
  <code class="kd">let</code> <code class="nx">userLocale</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">getUserLocale</code><code class="p">()</code>
  <code class="kd">let</code> <code class="nx">path</code> <code class="o">=</code> <code class="p">.</code><code class="o">/</code><code class="nx">locales</code><code class="o">/</code><code class="nx">locale</code><code class="o">-</code><code class="nx">$</code><code class="p">{</code><code class="nx">userLocale</code><code class="p">}</code>
  <code class="kd">let</code> <code class="nx">localeUS</code>: <code class="kt">typeof</code> <code class="nx">locale</code> <code class="o">=</code> <code class="nx">await</code> <code class="kd">import</code><code class="p">(</code><code class="nx">path</code><code class="p">)</code>
<code class="p">}</code></pre>

<p class="author1">We imported <code class="calibre14">locale</code> from <em class="calibre5">./locales/locale-us</em>, but we only used it for its type, which we retrieved with <code class="calibre14">typeof locale</code>. We needed to do that because TypeScript couldn’t statically look up the type of <code class="calibre14">import(path)</code>, because <code class="calibre14">path</code> is a computed variable and not a static string.<a data-primary="paths (module)" data-type="indexterm" id="calibre_link-1349" class="calibre4"></a> Because we never used <code class="calibre14">locale</code> as a value, and instead just scavenged it for its type, TypeScript compiled away the static import (in this example, TypeScript doesn’t generate any top-level exports at all), leaving us with both excellent type safety and a dynamically computed import.</p>
<div data-type="tip" class="calibre21"><h1 class="calibre42">TSC Setting: module</h1>
<p class="author1">TypeScript supports dynamic imports in <code class="calibre14">esnext</code> module mode only.<a data-primary="esnext module mode" data-type="indexterm" id="calibre_link-972" class="calibre4"></a> To use dynamic <a data-primary="tsconfig.json" data-secondary="module:esnext" data-type="indexterm" id="calibre_link-1535" class="calibre4"></a>imports, set <code class="calibre14">{"module": "esnext"}</code> in your <em class="calibre5">tsconfig.json</em>’s <code class="calibre14">compilerOptions</code>. Jump ahead to <a data-type="xref" href="#calibre_link-472" class="calibre4">“Running TypeScript on the Server”</a> and <a data-type="xref" href="#calibre_link-473" class="calibre4">“Running TypeScript in the Browser”</a> to learn more.</p>
</div>
</div></section>













<section data-pdf-bookmark="Using CommonJS and AMD Code" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1910">
<h2 class="calibre17">Using CommonJS and AMD Code</h2>

<p class="author1">When consuming a JavaScript module that uses the CommonJS or AMD standard, you can simply import names from it, <a data-primary="imports" data-secondary="using CommonJS and AMD code" data-type="indexterm" id="calibre_link-1102" class="calibre4"></a><a data-primary="exports" data-secondary="using CommonJS and AMD code" data-type="indexterm" id="calibre_link-998" class="calibre4"></a><a data-primary="modules" data-secondary="import, export" data-tertiary="using CommonJS and AMD code" data-type="indexterm" id="calibre_link-1227" class="calibre4"></a><a data-primary="CommonJS module standard" data-secondary="consuming JavaScript module that uses" data-type="indexterm" id="calibre_link-767" class="calibre4"></a><a data-primary="AMD module standard" data-secondary="consuming JavaScript module that uses" data-type="indexterm" id="calibre_link-616" class="calibre4"></a>just like for ES2015 modules:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">import</code> <code class="p">{</code><code class="nx">something</code><code class="p">}</code> <code class="nx">from</code> <code class="s">'./a/legacy/commonjs/module'</code></pre>

<p class="author1">By default, CommonJS default exports don’t interoperate with ES2015 default imports; to use a default export, you have to use a wildcard import:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">import</code> <code class="o">*</code> <code class="kd">as</code> <code class="nx">fs</code> <code class="nx">from</code> <code class="s">'fs'</code>
<code class="nx">fs</code><code class="p">.</code><code class="nx">readFile</code><code class="p">(</code><code class="s">'some/file.txt'</code><code class="p">)</code></pre>

<p class="author1">To interoperate more <a data-primary="esModuleInterop TSC flag" data-type="indexterm" id="calibre_link-970" class="calibre4"></a><a data-primary="TSC compiler" data-secondary="esModuleInterop flag" data-type="indexterm" id="calibre_link-1509" class="calibre4"></a>smoothly, set <code class="calibre14">{"esModuleInterop": true}</code> in your <em class="calibre5">tsconfig.json</em>’s <code class="calibre14">compilerOptions</code>. Now, you can leave out the wildcard:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<strong class="calibre49"><code class="k">import</code><code class="calibre50"> </code><code class="nx1">fs</code><code class="calibre50"> </code><code class="nx1">from</code><code class="calibre50"> </code><code class="s1">'fs'</code></strong><code class="calibre14">
</code><code class="nx">fs</code><code class="p">.</code><code class="nx">readFile</code><code class="p">(</code><code class="s">'some/file.txt'</code><code class="p">)</code><code class="calibre14">
</code></pre>
<div data-type="note" type="note" class="calibre21"><h6 class="calibre22">Note</h6>
<p class="author1">As I mentioned at the top of the chapter, even though this code compiles, that doesn’t mean it’ll work at runtime. Whichever module standard you use&mdash;<code class="calibre14">import</code>/<code class="calibre14">export</code>, CommonJS, AMD, UMD, <a data-primary="globals (browser)" data-type="indexterm" id="calibre_link-1085" class="calibre4"></a>or browser globals&mdash;your module bundler and module loader have to be aware of that format so they can package up and split your code correctly at compile time, and load your code correctly at runtime. Head over to <a data-type="xref" href="#calibre_link-27" class="calibre4">Chapter&nbsp;12</a> to learn more.</p>
</div>
</div></section>













<section data-pdf-bookmark="Module Mode Versus Script Mode" data-type="sect2" class="preface"><div class="preface" id="calibre_link-330">
<h2 class="calibre17">Module Mode Versus Script Mode</h2>

<p class="author1">TypeScript parses each of your TypeScript files in one of two modes: <em class="calibre5">module mode</em> or <em class="calibre5">script mode</em>. <a data-primary="modules" data-secondary="import, export" data-tertiary="module mode or script mode" data-type="indexterm" id="calibre_link-1226" class="calibre4"></a><a data-primary="module mode versus script mode" data-type="indexterm" id="calibre_link-1212" class="calibre4"></a><a data-primary="script mode versus module mode" data-type="indexterm" id="calibre_link-1430" class="calibre4"></a>It decides which mode to use based on a single heuristic: does your file have any <code class="calibre14">import</code>s or <code class="calibre14">export</code>s? If so, it uses module mode; otherwise, it uses script mode.<a data-primary="imports" data-secondary="module mode versus script mode" data-type="indexterm" id="calibre_link-1100" class="calibre4"></a><a data-primary="exports" data-secondary="module mode versus script mode" data-type="indexterm" id="calibre_link-995" class="calibre4"></a></p>

<p class="author1">Module mode is what we’ve used up to this point, and what you’ll use most of the time. In module mode, you use <code class="calibre14">import</code> and <code class="calibre14">import()</code> to require code from other files, and <code class="calibre14">export</code> to make code available to other files. If you use any third-party UMD modules (as a reminder, UMD modules try to use CommonJS, RequireJS, or browser globals, whichever the environment supports), you have to <code class="calibre14">import</code> them first, and can’t use their global exports directly.</p>

<p class="author1">In script mode, any top-level variables you declare will be available to other files in your project without an explicit import, and you can safely consume global exports from third-party UMD modules without explicitly importing them first. A couple of use cases for script mode are:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">To quickly prototype browser code that you plan to compile to no module system at all (<code class="calibre14">{"module": "none"}</code> in your <em class="calibre5">tsconfig.json</em>) and include as raw <code class="calibre14">&lt;script /&gt;</code> tags in your HTML file.</p>
</li>
<li class="calibre11">
<p class="author1">To create type declarations (see <a data-type="xref" href="#calibre_link-331" class="calibre4">“Type Declarations”</a>)</p>
</li>
</ul>

<p class="author1">You’ll almost always want to stick to module mode, which TypeScript will choose for you automatically as you write real-world code that <code class="calibre14">import</code>s other code and <code class="calibre14">export</code>s things for other files to use.<a data-primary="modules" data-startref="ix_mods" data-type="indexterm" id="calibre_link-1218" class="calibre4"></a></p>
</div></section>





</div></section>













<section data-pdf-bookmark="Namespaces" data-type="sect1" class="preface"><div class="preface" id="calibre_link-168">
<h1 class="calibre13">Namespaces</h1>

<p class="author1">TypeScript gives us another way to encapsulate code: the <code class="calibre14">namespace</code> keyword. Namespaces will feel familiar to a lot of Java, C#, C++, PHP, and Python programmers.<a data-primary="namespace keyword" data-type="indexterm" id="calibre_link-1245" class="calibre4"></a><a data-primary="namespaces" data-type="indexterm" id="calibre_link-1246" class="calibre4"></a></p>
<div data-type="tip" class="calibre21"><h6 class="calibre22">Tip</h6>
<p class="author1">If you’re coming from a language with namespaces, note that although namespaces are supported by TypeScript, they’re not the preferred way to encapsulate code; if you’re not sure whether to use namespaces or modules, choose modules.</p>
</div>

<p class="author1">Namespaces abstract away the nitty-gritty details of how files are laid out in the filesystem; you don’t have to know that your <code class="calibre14">.mine</code> function lives in the <code class="calibre14">schemes/scams/bitcoin/apps</code> folder, and instead you can access it with a short, convenient namespace like <code class="calibre14">Schemes.Scams.Bitcoin.Apps.mine</code>.<sup class="calibre15"><a data-type="noteref" href="#calibre_link-474" id="calibre_link-484" class="calibre16">1</a></sup></p>

<p class="author1">Say we have two files&mdash;a module to make HTTP GET requests, and a consumer that uses that module to make requests:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// Get.ts</code>
<code class="nx">namespace</code> <code class="nx">Network</code> <code class="p">{</code>
  <code class="kd">export</code> <code class="kd">function</code> <code class="nx">get</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">url</code>: <code class="kt">string</code><code class="p">)</code><code class="o">:</code> <code class="nx">Promise</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code> <code class="p">{</code>
    <code class="c">// ...</code>
  <code class="p">}</code>
<code class="p">}</code>

<code class="c">// App.ts</code>
<code class="nx">namespace</code> <code class="nx">App</code> <code class="p">{</code>
  <code class="nx">Network</code><code class="p">.</code><code class="nx">get</code><code class="o">&lt;</code><code class="nx">GitRepo</code><code class="o">&gt;</code><code class="p">(</code><code class="s">'https://api.github.com/repos/Microsoft/typescript'</code><code class="p">)</code>
<code class="p">}</code></pre>

<p class="author1">A namespace must have a name (like <code class="calibre14">Network</code>), and it can export functions, variables, types, interfaces, or other namespaces.<a data-primary="namespaces" data-secondary="exports" data-type="indexterm" id="calibre_link-1250" class="calibre4"></a><a data-primary="exports" data-secondary="namespace" data-type="indexterm" id="calibre_link-997" class="calibre4"></a> Any code in a <code class="calibre14">namespace</code> block that’s not explicitly exported is private to the block. Because namespaces can export namespaces, you can easily model nested namespaces. Let’s say our <code class="calibre14">Network</code> module is getting big, and we want to split it up into a few submodules. We can use namespaces to do that:</p>
<pre class="calibre30" data-code-language="ts" data-type="programlisting">
<code class="nx">namespace</code> <code class="nx">Network</code> <code class="p">{</code>
  <code class="kd">export</code> <code class="nx">namespace</code> <code class="nx">HTTP</code> <code class="p">{</code>
    <code class="kd">export</code> <code class="kd">function</code> <code class="nx">get</code>	<code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">url</code>: <code class="kt">string</code><code class="p">)</code><code class="o">:</code> <code class="nx">Promise</code>	<code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code> <code class="p">{</code>
      <code class="c">// ...</code>
    <code class="p">}</code>
  <code class="p">}</code>
  <code class="kd">export</code> <code class="nx">namespace</code> <code class="nx">TCP</code> <code class="p">{</code>
    <code class="nx">listenOn</code><code class="p">(</code><code class="nx">port</code>: <code class="kt">number</code><code class="p">)</code><code class="o">:</code> <code class="nx">Connection</code> <code class="p">{</code>
      <code class="c">//...</code>
    <code class="p">}</code>
    <code class="c">// ...</code>
  <code class="p">}</code>
  <code class="kd">export</code> <code class="nx">namespace</code> <code class="nx">UDP</code> <code class="p">{</code>
    <code class="c">// ...</code>
  <code class="p">}</code>
  <code class="kd">export</code> <code class="nx">namespace</code> <code class="nx">IP</code> <code class="p">{</code>
    <code class="c">// ...</code>
  <code class="p">}</code>
<code class="p">}</code>
</pre>

<p class="author1">Now, all<a data-primary="namespaces" data-secondary="subnamespaces" data-type="indexterm" id="calibre_link-1254" class="calibre4"></a> of our network-related utilities are in subnamespaces under <code class="calibre14">Network</code>. For example, we can now call <code class="calibre14">Network.HTTP.get</code> and <code class="calibre14">Network.TCP.listenOn</code> from any file. Like interfaces, namespaces can be augmented, making it convenient to split them across files. TypeScript will recursively merge identically named namespaces for us:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// HTTP.ts</code>
<code class="nx">namespace</code> <code class="nx">Network</code> <code class="p">{</code>
  <code class="kd">export</code> <code class="nx">namespace</code> <code class="nx">HTTP</code> <code class="p">{</code>
    <code class="kd">export</code> <code class="kd">function</code> <code class="nx">get</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">url</code>: <code class="kt">string</code><code class="p">)</code><code class="o">:</code> <code class="nx">Promise</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code> <code class="p">{</code>
      <code class="c">// ...</code>
    <code class="p">}</code>
  <code class="p">}</code>
<code class="p">}</code>

<code class="c">// UDP.ts</code>
<code class="nx">namespace</code> <code class="nx">Network</code> <code class="p">{</code>
  <code class="kd">export</code> <code class="nx">namespace</code> <code class="nx">UDP</code> <code class="p">{</code>
    <code class="kd">export</code> <code class="kd">function</code> <code class="nx">send</code><code class="p">(</code><code class="nx">url</code>: <code class="kt">string</code><code class="p">,</code> <code class="nx">packets</code>: <code class="kt">Buffer</code><code class="p">)</code><code class="o">:</code> <code class="nx">Promise</code><code class="o">&lt;</code><code class="kd">void</code><code class="o">&gt;</code> <code class="p">{</code>
      <code class="c">// ...</code>
    <code class="p">}</code>
  <code class="p">}</code>
<code class="p">}</code>

<code class="c">// MyApp.ts</code>
<code class="nx">Network</code><code class="p">.</code><code class="nx">HTTP</code><code class="p">.</code><code class="nx">get</code><code class="o">&lt;</code><code class="nx">Dog</code><code class="p">[]</code><code class="o">&gt;</code><code class="p">(</code><code class="s">'http://url.com/dogs'</code><code class="p">)</code>
<code class="nx">Network</code><code class="p">.</code><code class="nx">UDP</code><code class="p">.</code><code class="nx">send</code><code class="p">(</code><code class="s">'http://url.com/cats'</code><code class="p">,</code> <code class="kd">new</code> <code class="nx">Buffer</code><code class="p">(</code><code class="mi">123</code><code class="p">))</code></pre>

<p class="author1">If you end up with long namespace hierarchies, you can use <em class="calibre5">aliases</em> to shorten them for convenience. <a data-primary="type aliases" data-secondary="for namespaces" data-type="indexterm" id="calibre_link-1554" class="calibre4"></a><a data-primary="namespaces" data-secondary="long, using aliases to shorten" data-type="indexterm" id="calibre_link-1251" class="calibre4"></a>Note that despite the similar syntax, destructuring (like you do when importing ES2015 modules) is not supported for aliases:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// A.ts</code>
<code class="nx">namespace</code> <code class="nx">A</code> <code class="p">{</code>
  <code class="kd">export</code> <code class="nx">namespace</code> <code class="nx">B</code> <code class="p">{</code>
    <code class="kd">export</code> <code class="nx">namespace</code> <code class="nx">C</code> <code class="p">{</code>
      <code class="kd">export</code> <code class="kd">let</code> <code class="nx">d</code> <code class="o">=</code> <code class="mi">3</code>
    <code class="p">}</code>
  <code class="p">}</code>
<code class="p">}</code>

<code class="c">// MyApp.ts</code>
<code class="kd">import</code> <code class="nx">d</code> <code class="o">=</code> <code class="nx">A</code><code class="p">.</code><code class="nx">B</code><code class="p">.</code><code class="nx">C</code><code class="p">.</code><code class="nx">d</code>

<code class="kd">let</code> <code class="nx">e</code> <code class="o">=</code> <code class="nx">d</code> <code class="o">*</code> <code class="mi">3</code></pre>








<section data-pdf-bookmark="Collisions" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1911">
<h2 class="calibre17">Collisions</h2>

<p class="author1">Collisions between identically named exports<a data-primary="namespaces" data-secondary="collisions" data-type="indexterm" id="calibre_link-1248" class="calibre4"></a> are not allowed:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// HTTP.ts</code>
<code class="nx">namespace</code> <code class="nx">Network</code> <code class="p">{</code>
  <code class="kd">export</code> <code class="kd">function</code> <code class="nx">request</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">url</code>: <code class="kt">string</code><code class="p">)</code><code class="o">:</code> <code class="nx">T</code> <code class="p">{</code>
    <code class="c">// ...</code>
  <code class="p">}</code>
<code class="p">}</code>

<code class="c">// HTTP2.ts</code>
<code class="nx">namespace</code> <code class="nx">Network</code> <code class="p">{</code>
  <code class="c">// Error TS2393: Duplicate function implementation.</code>
  <code class="kd">export</code> <code class="kd">function</code> <code class="nx">request</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">url</code>: <code class="kt">string</code><code class="p">)</code><code class="o">:</code> <code class="nx">T</code> <code class="p">{</code>
    <code class="c">// ...</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p class="author1">The exception to the no-collisions rule is overloaded ambient function declarations, which<a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2393" data-type="indexterm" id="calibre_link-936" class="calibre4"></a><a data-primary="overloaded ambient function declarations" data-type="indexterm" id="calibre_link-1333" class="calibre4"></a><a data-primary="functions" data-secondary="overloaded ambient function declarations" data-type="indexterm" id="calibre_link-1048" class="calibre4"></a> you can use to refine function types:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// HTTP.ts</code>
<code class="nx">namespace</code> <code class="nx">Network</code> <code class="p">{</code>
  <code class="kd">export</code> <code class="kd">function</code> <code class="nx">request</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">url</code>: <code class="kt">string</code><code class="p">)</code><code class="o">:</code> <code class="nx">T</code>
<code class="p">}</code>

<code class="c">// HTTP2.ts</code>
<code class="nx">namespace</code> <code class="nx">Network</code> <code class="p">{</code>
  <code class="kd">export</code> <code class="kd">function</code> <code class="nx">request</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">url</code>: <code class="kt">string</code><code class="p">,</code> <code class="nx">priority</code>: <code class="kt">number</code><code class="p">)</code><code class="o">:</code> <code class="nx">T</code>
<code class="p">}</code>

<code class="c">// HTTPS.ts</code>
<code class="nx">namespace</code> <code class="nx">Network</code> <code class="p">{</code>
  <code class="kd">export</code> <code class="kd">function</code> <code class="nx">request</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">url</code>: <code class="kt">string</code><code class="p">,</code> <code class="nx">algo</code><code class="o">:</code> <code class="s">'SHA1'</code> <code class="o">|</code> <code class="s">'SHA256'</code><code class="p">)</code><code class="o">:</code> <code class="nx">T</code>
<code class="p">}</code></pre>
</div></section>













<section data-pdf-bookmark="Compiled Output" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1912">
<h2 class="calibre17">Compiled Output</h2>

<p class="author1">Unlike imports and exports, namespaces don’t respect your <em class="calibre5">tsconfig.json</em>’s <code class="calibre14">module</code> setting, and always compile to global variables.<a data-primary="namespaces" data-secondary="compiled output" data-type="indexterm" id="calibre_link-1249" class="calibre4"></a><a data-primary="module setting (tsconfig.json)" data-type="indexterm" id="calibre_link-1214" class="calibre4"></a><a data-primary="global namespace" data-type="indexterm" id="calibre_link-1082" class="calibre4"></a><a data-primary="TSC compiler" data-secondary="namespace output" data-type="indexterm" id="calibre_link-1518" class="calibre4"></a> Let’s peek behind the veil to see what the generated output looks like. Say we have the following module:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// Flowers.ts</code>
<code class="nx">namespace</code> <code class="nx">Flowers</code> <code class="p">{</code>
  <code class="kd">export</code> <code class="kd">function</code> <code class="nx">give</code><code class="p">(</code><code class="nx">count</code>: <code class="kt">number</code><code class="p">)</code> <code class="p">{</code>
    <code class="kd">return</code> <code class="nx">count</code> <code class="o">+</code> <code class="s">' flowers'</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p class="author1">Running it through <code class="calibre14">TSC</code>, the generated JavaScript output looks like this:</p>
<pre data-code-language="js" data-type="programlisting" class="calibre30">
<code class="kd">let</code><code class="calibre14"> </code><code class="nx">Flowers</code><code class="calibre14">
</code><code class="p">(</code><code class="kd">function</code><code class="calibre14"> </code><code class="p">(</code><code class="nx">Flowers</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-475" id="calibre_link-478"><img alt="1" src="images/000000.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="kd">function</code><code class="calibre14"> </code><code class="nx">give</code><code class="p">(</code><code class="nx">count</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
    </code><code class="kd">return</code><code class="calibre14"> </code><code class="nx">count</code><code class="calibre14"> </code><code class="o">+</code><code class="calibre14"> </code><code class="s">' flowers'</code><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">
  </code><code class="nx">Flowers</code><code class="p">.</code><code class="nx">give</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="nx">give</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-476" id="calibre_link-479"><img alt="2" src="images/000001.png" class="calibre40" /></a><code class="calibre14">
</code><code class="p">}</code><code class="p">)</code><code class="p">(</code><code class="nx">Flowers</code><code class="calibre14"> </code><code class="o">||</code><code class="calibre14"> </code><code class="p">(</code><code class="nx">Flowers</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="p">}</code><code class="p">)</code><code class="p">)</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-477" id="calibre_link-480"><img alt="3" src="images/000002.png" class="calibre40" /></a><code class="calibre14">
</code></pre>

<dl class="preface">
<dt class="calibre18"><a class="calibre4" href="#calibre_link-478" id="calibre_link-475"><img alt="1" src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45"><code class="calibre14">Flowers</code> is declared within an IIFE&mdash;a function that calls itself immediately&mdash;to create a closure and prevent variables that weren’t explicitly exported from leaking out of the <code class="calibre14">Flowers</code> module.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-479" id="calibre_link-476"><img alt="2" src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">TypeScript assigns the <code class="calibre14">give</code> function that we exported to the <code class="calibre14">Flowers</code> namespace.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-480" id="calibre_link-477"><img alt="3" src="images/000002.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">If the <code class="calibre14">Flowers</code> namespace is already globally defined, then TypeScript augments it (<code class="calibre14">Flowers</code>); otherwise, TypeScript creates and augments that newly created namespace (<code class="calibre14">Flowers = {}</code>).</p></dd>
</dl>
<aside data-type="sidebar" type="sidebar" class="keyterm"><div class="sidebar" id="calibre_link-1913">
<h5 class="calibre29">Prefer Modules over Namespaces When Possible</h5>
<p class="author1">Prefer regular modules (the <code class="calibre14">import</code> and <code class="calibre14">export</code> kind) over namespaces as a way to more closely stick to JavaScript standards and make your dependencies more explicit.<a data-primary="namespaces" data-secondary="preferring modules over" data-type="indexterm" id="calibre_link-1253" class="calibre4"></a><a data-primary="modules" data-secondary="preferring over namespaces" data-type="indexterm" id="calibre_link-1232" class="calibre4"></a></p>

<p class="author1">Explicit dependencies have lots of benefits for readability, enforcing module isolation (because namespaces are automatically merged, but modules are not), and static analysis, which matters for big frontend projects where stripping out dead code and splitting your compiled code into multiple files is crucial for <span class="calibre">performance</span>.</p>

<p class="author1">When running TypeScript programs in a NodeJS environment,<a data-primary="NodeJS" data-secondary="preferring modules over namespaces" data-type="indexterm" id="calibre_link-1270" class="calibre4"></a> modules are also the clear choice because of NodeJS’s built-in support for CommonJS.<a data-primary="browsers" data-secondary="preferring modules over namespaces" data-type="indexterm" id="calibre_link-701" class="calibre4"></a> In browser environments, some programmers prefer namespaces for simplicity, but for medium- to large-sized projects, try to stick to modules over namespaces.<a data-primary="namespaces" data-startref="ix_nmsp" data-type="indexterm" id="calibre_link-1247" class="calibre4"></a></p>
</div></aside>
</div></section>





</div></section>













<section data-pdf-bookmark="Declaration Merging" data-type="sect1" class="preface"><div class="preface" id="calibre_link-55">
<h1 class="calibre13">Declaration Merging</h1>

<p class="author1">So far we’ve touched on three types of merging<a data-primary="declaration merging" data-type="indexterm" id="calibre_link-820" class="calibre4"></a><a data-primary="values" data-secondary="merging values and types" data-type="indexterm" id="calibre_link-1730" class="calibre4"></a><a data-primary="types" data-secondary="merging types and values" data-type="indexterm" id="calibre_link-1636" class="calibre4"></a><a data-primary="namespaces" data-secondary="merging" data-type="indexterm" id="calibre_link-1252" class="calibre4"></a> that TypeScript does for us:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">Merging values and types, so that the same name can refer to either a value or a type depending how we use it (see <a data-type="xref" href="#calibre_link-171" class="calibre4">“Companion Object Pattern”</a>)</p>
</li>
<li class="calibre11">
<p class="author1">Merging multiple namespaces into one<a data-primary="interfaces" data-secondary="merging" data-type="indexterm" id="calibre_link-1123" class="calibre4"></a></p>
</li>
<li class="calibre11">
<p class="author1">Merging multiple interfaces into one (see <a data-type="xref" href="#calibre_link-329" class="calibre4">“Declaration Merging”</a>)</p>
</li>
</ul>

<p class="author1">As you might have intuited, these are three special cases of a much more general TypeScript behavior. TypeScript has a rich set of behavior for merging different kinds of names, unlocking all sorts of patterns that can otherwise be difficult to express (see <a data-type="xref" href="#calibre_link-481" class="calibre4">Table&nbsp;10-1</a>).</p>
<table id="calibre_link-481" class="stafflist_table">
<caption class="calibre35"><span class="calibre">Table 10-1. </span>Can the declaration be merged?</caption>
<tbody class="calibre6">
<tr class="calibre7">
<td class="calibre8"></td>
<td class="calibre8"></td>
<td class="calibre8"></td>
<td class="calibre8"></td>
<td class="calibre8"></td>
<th class="calibre53"></th>
<td class="calibre8">To</td>
<td class="calibre8"></td>
<td class="calibre8"></td>
<td class="calibre8"></td>
<td class="calibre8"></td>
</tr>
<tr class="calibre9">
<td class="calibre8"></td>
<td class="calibre8"></td>
<td class="calibre8"><p class="author1">Value</p></td>
<td class="calibre8"><p class="author1">Class</p></td>
<td class="calibre8"><p class="author1">Enum</p></td>
<td class="calibre8"><p class="author1">Function</p></td>
<td class="calibre8"><p class="author1">Types alias</p></td>
<td class="calibre8"><p class="author1">Interface</p></td>
<td class="calibre8"><p class="author1">Namespace</p></td>
<td class="calibre8"><p class="author1">Module</p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"></td>
<td class="calibre8"><p class="author1">Value</p></td>
<td class="calibre8"><p class="author1">No</p></td>
<td class="calibre8"><p class="author1">No</p></td>
<td class="calibre8"><p class="author1">No</p></td>
<td class="calibre8"><p class="author1">No</p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
<td class="calibre8"><p class="author1">No</p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"></td>
<td class="calibre8"><p class="author1">Class</p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1">No</p></td>
<td class="calibre8"><p class="author1">No</p></td>
<td class="calibre8"><p class="author1">No</p></td>
<td class="calibre8"><p class="author1">No</p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"></td>
<td class="calibre8"><p class="author1">Enum</p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
<td class="calibre8"><p class="author1">No</p></td>
<td class="calibre8"><p class="author1">No</p></td>
<td class="calibre8"><p class="author1">No</p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1">From</p></td>
<td class="calibre8"><p class="author1">Function</p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1">No</p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"></td>
<td class="calibre8"><p class="author1">Type alias</p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1">No</p></td>
<td class="calibre8"><p class="author1">No</p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
</tr>
<tr class="calibre9">

<td class="calibre8"></td>
<td class="calibre8"><p class="author1">Interface</p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"></td>
<td class="calibre8"><p class="author1">Namespace</p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"></td>
<td class="calibre8"><p class="author1">Module</p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
</tr>
</tbody>
</table>

<p class="author1">This means that if, for example, you declare a value and a type alias in the same scope, TypeScript will allow it, and infer which one you meant&mdash;the type or the value&mdash;from whether you use the name in a value or a type position.<a data-primary="companion object pattern" data-type="indexterm" id="calibre_link-770" class="calibre4"></a> This is what lets us implement the pattern described in <a data-type="xref" href="#calibre_link-171" class="calibre4">“Companion Object Pattern”</a>. It also means that you can use an interface and a namespace to implement companion objects&mdash;you’re not limited to just a value and a type alias. Or you can take advantage of module merging to augment a third-party module declaration (more on this in <a data-type="xref" href="#calibre_link-482" class="calibre4">“Extending a Module”</a>). Or you can add static methods to an enum by merging that enum with a namespace (try it!).</p>
<aside data-type="sidebar" type="sidebar" class="keyterm"><div class="sidebar" id="calibre_link-1914">
<h5 class="calibre29">The moduleResolution Flag</h5>
<p class="author1">Eagle-eyed readers may notice the <code class="calibre14">moduleResolution</code> flag available in their <em class="calibre5">tsconfig.json</em>. <a data-primary="moduleResolution TSC flag" data-type="indexterm" id="calibre_link-1216" class="calibre4"></a><a data-primary="TSC compiler" data-secondary="moduleResolution flag" data-type="indexterm" id="calibre_link-1517" class="calibre4"></a>This flag controls the algorithm TypeScript uses to resolve module names in your application. The flag supports two modes:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1"><code class="calibre14">node</code>: Always use this mode.<a data-primary="node mode (moduleResolution flag)" data-type="indexterm" id="calibre_link-1263" class="calibre4"></a> It resolves modules using the same algorithm that NodeJS uses.<a data-primary="paths (module)" data-type="indexterm" id="calibre_link-1350" class="calibre4"></a> Modules prefixed with a <code class="calibre14">.</code>, <code class="calibre14">/</code>, or <code class="calibre14">~</code> (like <code class="calibre14">./my/file</code>) are resolved from the local filesystem, either relative to the current file, or using an absolute path (relative to your <em class="calibre5">/</em> directory, or whatever your <em class="calibre5">tsconfig.json</em>’s <code class="calibre14">baseUrl</code> is set to), depending on the prefix you use. TypeScript loads module paths that don’t have a prefix from your <em class="calibre5">node modules</em> folder, the same as NodeJS. TypeScript builds on NodeJS’s resolution strategy in two ways:</p>
<ol class="calibre31">
<li class="calibre32">
<p class="author1">In addition to the <code class="calibre14">main</code> field in a package’s <em class="calibre5">package.json</em> that NodeJS looks at to find the default importable file in a directory, TypeScript also looks at the TypeScript-specific <code class="calibre14">types</code> property (more on that in <a data-type="xref" href="#calibre_link-483" class="calibre4">“Type Lookup for JavaScript”</a>).</p>
</li>
<li class="calibre32">
<p class="author1">When importing a file with an unspecified extension, TypeScript first looks for a file with that name and a <em class="calibre5">.ts</em> extension, followed by <em class="calibre5">.tsx</em>, <em class="calibre5">.d.ts</em>, and finally <em class="calibre5">.js</em>.</p>
</li>

</ol>
</li>
<li class="calibre11">
<p class="author1"><code class="calibre14">classic</code>: You should never use this mode.<a data-primary="classic mode (moduleResolution flag)" data-type="indexterm" id="calibre_link-753" class="calibre4"></a> In this mode, relative paths are resolved like in <code class="calibre14">node</code> mode, but for unprefixed names, TypeScript will look for a file with the given name in the current folder, then walk up the directory tree a folder at a time until it finds a matching file. This is really surprising behavior for anyone coming from the NodeJS or JavaScript world, and does not interoperate well with other build tools.<a data-primary="declaration merging" data-startref="ix_decmrg" data-type="indexterm" id="calibre_link-821" class="calibre4"></a></p>
</li>
</ul>
</div></aside>
</div></section>













<section data-pdf-bookmark="Summary" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1915">
<h1 class="calibre13">Summary</h1>

<p class="author1">In this chapter we covered TypeScript’s module system, starting with a brief history of JavaScript module systems, ES2015 modules and safely lazy-loading code with dynamic imports, interoperating with CommonJS and AMD modules, and module mode versus script mode. We then covered namespaces, namespace merging, and how TypeScript’s declaration merging works.</p>

<p class="author1">As you develop applications in TypeScript, try hard to stick to ES2015 modules. TypeScript doesn’t care which module system you use, but it will make it easier to integrate with build tooling (see <a data-type="xref" href="#calibre_link-27" class="calibre4">Chapter&nbsp;12</a> to learn more).</p>
</div></section>













<section data-pdf-bookmark="Exercise" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1916">
<h1 class="calibre13">Exercise</h1>
<ol class="calibre31">
<li class="calibre32">
<p class="author1">Play around with declaration merging, to:</p>
<ol class="calibre46">
<li class="calibre47">
<p class="author1">Reimplement companion objects (from <a data-type="xref" href="#calibre_link-171" class="calibre4">“Companion Object Pattern”</a>) using namespaces and interfaces, instead of values and types.</p>
</li>
<li class="calibre47">
<p class="author1">Add static methods to an enum.</p>
</li>

</ol>
</li>

</ol>
</div></section>







<div data-type="footnotes" class="calibre26"><p data-type="footnote" id="calibre_link-474" class="calibre27"><sup class="calibre28"><a href="#calibre_link-484" class="calibre16">1</a></sup> I really hope this joke ages well, and I don’t end up regretting not investing in Bitcoin.</p></div></div></section></div>

<div data-type="book" class="calibre1" id="calibre_link-485"><section data-pdf-bookmark="Chapter 11. Interoperating with JavaScript" data-type="chapter" type="chapter" class="preface"><div class="preface" id="calibre_link-1917">
<h1 class="calibre12"><span class="calibre">Chapter 11. </span>Interoperating with JavaScript</h1>


<p class="author1">We don’t live in a perfect world.<a data-primary="JavaScript" data-secondary="interoperating with" data-type="indexterm" id="calibre_link-1151" class="calibre4"></a> Your coffee can be too hot and burn your mouth a little when you drink it, your parents might call and leave you voicemails a little too often, that pothole by your driveway is still there no matter how many times you call the city, and your code might not be completely covered with static types.</p>

<p class="author1">Most of us are in this boat: though once in a while you’ll have the leeway to start a greenfield project in TypeScript, most of the time it will start as a little island of safety, embedded in a larger, less safe codebase. Maybe you have a well-isolated component that you want to try TypeScript on even though your company uses regular ES6 JavaScript everywhere else, or maybe you’re fed up with getting paged at 6 A.M. because you refactored some code and forgot to update a call site (it’s now 7 A.M., and you’re ninja-merging TSC into your codebase before your coworkers wake up). Either way, you will probably start with an island of TypeScript in a type-less sea.</p>

<p class="author1">So far in this book I’ve been teaching you to write TypeScript the right way. This chapter is about writing TypeScript the practical way, in real codebases that are in the process of migrating away from untyped languages, that use third-party JavaScript libraries, that at times sacrifice type safety for a quick hot patch to unbreak prod. This chapter is dedicated to working with JavaScript. We’ll explore:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">Using type declarations</p>
</li>
<li class="calibre11">
<p class="author1">Gradually migrating from JavaScript to TypeScript</p>
</li>
<li class="calibre11">
<p class="author1">Using third-party JavaScript and TypeScript</p>
</li>
</ul>






<section data-pdf-bookmark="Type Declarations" data-type="sect1" class="preface"><div class="preface" id="calibre_link-331">
<h1 class="calibre13">Type Declarations</h1>

<p class="author1">A <em class="calibre5">type declaration</em> is a file with the extension <em class="calibre5">.d.ts</em>. Along with JSDoc annotations (see <a data-type="xref" href="#calibre_link-486" class="calibre4">“Step 2b: Add JSDoc Annotations (Optional)”</a>), it’s a way to attach TypeScript types to JavaScript code that would otherwise be untyped.<a data-primary=".d.ts file extension (type declarations)" data-primary-sortas="d.ts" data-type="indexterm" id="calibre_link-815" class="calibre4"></a><a data-primary="JavaScript" data-secondary="interoperating with" data-tertiary="using type declarations" data-type="indexterm" id="calibre_link-1159" class="calibre4"></a><a data-primary="type declarations" data-type="indexterm" id="calibre_link-1557" class="calibre4"></a></p>

<p class="author1">Type declarations have a similar syntax to regular TypeScript, with a few differences:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">Type declarations can only contain types, and can’t contain values. That means no function, class, object, or variable implementations, and no default values for parameters.<a data-primary="type declarations" data-secondary="differences from regular TypeScript syntax" data-type="indexterm" id="calibre_link-1564" class="calibre4"></a><a data-primary="values" data-secondary="type declarations and" data-type="indexterm" id="calibre_link-1733" class="calibre4"></a></p>
</li>
<li class="calibre11">
<p class="author1">While type declarations can’t define values, they can declare that there <em class="calibre5">exists</em> a value defined somewhere in your JavaScript. We use the special <code class="calibre14">declare</code> keyword for this.<a data-primary="declare keyword" data-type="indexterm" id="calibre_link-824" class="calibre4"></a></p>
</li>
<li class="calibre11">
<p class="author1">Type declarations only declare types for things that are visible to consumers. We don’t include things like types that aren’t exported, or types for local variables inside of function bodies.</p>
</li>
</ul>

<p class="author1">Let’s jump into an example, and take a look at a piece of TypeScript (<em class="calibre5">.ts</em>) code and its equivalent type declaration (<em class="calibre5">.d.ts</em>). <a data-primary="type declarations" data-secondary="example with equivalent TypeScript code" data-type="indexterm" id="calibre_link-1566" class="calibre4"></a>This example is a fairly involved piece of code from the popular RxJS library; feel free to gloss over the details of what it’s doing, and instead pay attention to which language features it’s using (imports, classes, interfaces, class fields, function overloads, and so on):</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">import</code> <code class="p">{</code><code class="nx">Subscriber</code><code class="p">}</code> <code class="nx">from</code> <code class="s">'./Subscriber'</code>
<code class="kd">import</code> <code class="p">{</code><code class="nx">Subscription</code><code class="p">}</code> <code class="nx">from</code> <code class="s">'./Subscription'</code>
<code class="kd">import</code> <code class="p">{</code><code class="nx">PartialObserver</code><code class="p">,</code> <code class="nx">Subscribable</code><code class="p">,</code> <code class="nx">TeardownLogic</code><code class="p">}</code> <code class="nx">from</code> <code class="s">'./types'</code>

<code class="kd">export</code> <code class="kd">class</code> <code class="nx">Observable</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code> <code class="kd">implements</code> <code class="nx">Subscribable</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code> <code class="p">{</code>
  <code class="kd">public</code> <code class="nx">_isScalar</code>: <code class="kt">boolean</code> <code class="o">=</code> <code class="kd">false</code>
  <code class="kd">constructor</code><code class="p">(</code>
    <code class="nx">subscribe</code><code class="o">?:</code> <code class="p">(</code>
      <code class="kd">this</code><code class="o">:</code> <code class="nx">Observable</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="p">,</code>
      <code class="nx">subscriber</code>: <code class="kt">Subscriber</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code>
    <code class="p">)</code> <code class="o">=&gt;</code> <code class="nx">TeardownLogic</code>
  <code class="p">)</code> <code class="p">{</code>
    <code class="kd">if</code> <code class="p">(</code><code class="nx">subscribe</code><code class="p">)</code> <code class="p">{</code>
      <code class="kd">this</code><code class="p">.</code><code class="nx">_subscribe</code> <code class="o">=</code> <code class="nx">subscribe</code>
    <code class="p">}</code>
  <code class="p">}</code>
  <code class="kd">static</code> <code class="nx">create</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">subscribe</code><code class="o">?:</code> <code class="p">(</code><code class="nx">subscriber</code>: <code class="kt">Subscriber</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="nx">TeardownLogic</code><code class="p">)</code> <code class="p">{</code>
    <code class="kd">return</code> <code class="kd">new</code> <code class="nx">Observable</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">subscribe</code><code class="p">)</code>
  <code class="p">}</code>
  <code class="nx">subscribe</code><code class="p">(</code><code class="nx">observer?</code>: <code class="kt">PartialObserver</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="p">)</code><code class="o">:</code> <code class="nx">Subscription</code>
  <code class="nx">subscribe</code><code class="p">(</code>
    <code class="nx">next</code><code class="o">?:</code> <code class="p">(</code><code class="nx">value</code>: <code class="kt">T</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="kd">void</code><code class="p">,</code>
    <code class="nx">error</code><code class="o">?:</code> <code class="p">(</code><code class="nx">error</code>: <code class="kt">any</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="kd">void</code><code class="p">,</code>
    <code class="nx">complete</code><code class="o">?:</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="kd">void</code>
  <code class="p">)</code><code class="o">:</code> <code class="nx">Subscription</code>
  <code class="nx">subscribe</code><code class="p">(</code>
    <code class="nx">observerOrNext?</code>: <code class="kt">PartialObserver</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code> <code class="o">|</code> <code class="p">((</code><code class="nx">value</code>: <code class="kt">T</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="kd">void</code><code class="p">),</code>
    <code class="nx">error</code><code class="o">?:</code> <code class="p">(</code><code class="nx">error</code>: <code class="kt">any</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="kd">void</code><code class="p">,</code>
    <code class="nx">complete</code><code class="o">?:</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="kd">void</code>
  <code class="p">)</code><code class="o">:</code> <code class="nx">Subscription</code> <code class="p">{</code>
    <code class="c">// ...</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p class="author1">Running this code through <a data-primary="TSC compiler" data-secondary="declarations flag" data-type="indexterm" id="calibre_link-1502" class="calibre4"></a>TSC with the <code class="calibre14">declarations</code> flag enabled (<code class="calibre14">tsc -d Observable.ts</code>) yields the following <em class="calibre5">Observable.d.ts</em> type declaration:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">import</code><code class="calibre14"> </code><code class="p">{</code><code class="nx">Subscriber</code><code class="p">}</code><code class="calibre14"> </code><code class="nx">from</code><code class="calibre14"> </code><code class="s">'./Subscriber'</code><code class="calibre14">
</code><code class="kd">import</code><code class="calibre14"> </code><code class="p">{</code><code class="nx">Subscription</code><code class="p">}</code><code class="calibre14"> </code><code class="nx">from</code><code class="calibre14"> </code><code class="s">'./Subscription'</code><code class="calibre14">
</code><code class="kd">import</code><code class="calibre14"> </code><code class="p">{</code><code class="nx">PartialObserver</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">Subscribable</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">TeardownLogic</code><code class="p">}</code><code class="calibre14"> </code><code class="nx">from</code><code class="calibre14"> </code><code class="s">'./types'</code><code class="calibre14">

</code><code class="kd">export</code><code class="calibre14"> </code><code class="kd">declare</code><code class="calibre14"> </code><code class="kd">class</code><code class="calibre14"> </code><code class="nx">Observable</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="kd">implements</code><code class="calibre14"> </code><code class="nx">Subscribable</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-487" id="calibre_link-489"><img alt="1" src="images/000000.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="nx">_isScalar</code><code class="calibre14">: </code><code class="kt">boolean</code><code class="calibre14">
  </code><code class="kd">constructor</code><code class="p">(</code><code class="calibre14">
    </code><code class="nx">subscribe</code><code class="o">?</code><code class="o">:</code><code class="calibre14"> </code><code class="p">(</code><code class="calibre14">
      </code><code class="kd">this</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">Observable</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="p">,</code><code class="calibre14">
      </code><code class="nx">subscriber</code><code class="calibre14">: </code><code class="kt">Subscriber</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="calibre14">
    </code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="nx">TeardownLogic</code><code class="calibre14">
  </code><code class="p">)</code><code class="p">;</code><code class="calibre14">
  </code><code class="kd">static</code><code class="calibre14"> </code><code class="nx">create</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="p">(</code><code class="calibre14">
    </code><code class="nx">subscribe</code><code class="o">?</code><code class="o">:</code><code class="calibre14"> </code><code class="p">(</code><code class="nx">subscriber</code><code class="calibre14">: </code><code class="kt">Subscriber</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="nx">TeardownLogic</code><code class="calibre14">
  </code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">Observable</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="calibre14">
  </code><code class="nx">subscribe</code><code class="p">(</code><code class="nx">observer?</code><code class="calibre14">: </code><code class="kt">PartialObserver</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">Subscription</code><code class="calibre14">
  </code><code class="nx">subscribe</code><code class="p">(</code><code class="calibre14">
    </code><code class="nx">next</code><code class="o">?</code><code class="o">:</code><code class="calibre14"> </code><code class="p">(</code><code class="nx">value</code><code class="calibre14">: </code><code class="kt">T</code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="kd">void</code><code class="p">,</code><code class="calibre14">
    </code><code class="nx">error</code><code class="o">?</code><code class="o">:</code><code class="calibre14"> </code><code class="p">(</code><code class="nx">error</code><code class="calibre14">: </code><code class="kt">any</code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="kd">void</code><code class="p">,</code><code class="calibre14">
    </code><code class="nx">complete</code><code class="o">?</code><code class="o">:</code><code class="calibre14"> </code><code class="p">(</code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="kd">void</code><code class="calibre14">
  </code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">Subscription</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-488" id="calibre_link-490"><img alt="2" src="images/000001.png" class="calibre40" /></a><code class="calibre14">
</code><code class="p">}</code></pre>
<dl class="preface">
<dt class="calibre18"><a class="calibre4" href="#calibre_link-489" id="calibre_link-487"><img alt="1" src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">Notice the <code class="calibre14">declare</code> keyword before <code class="calibre14">class</code>. <a data-primary="declare keyword" data-type="indexterm" id="calibre_link-825" class="calibre4"></a>We can’t actually define a class in a type declaration, but we can <em class="calibre5">declare</em> that we defined a class in the <em class="calibre5">.d.ts</em> file’s corresponding JavaScript file.<a data-primary="classes" data-secondary="declaring, type declarations and" data-type="indexterm" id="calibre_link-737" class="calibre4"></a> Think of <code class="calibre14">declare</code> like an affirmation: “I swear that my JavaScript exports a class of this type.”</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-490" id="calibre_link-488"><img alt="2" src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">Because type declarations don’t contain implementations, we only keep the two overloads for <code class="calibre14">subscribe</code>, and not the signature for its implementation.</p></dd>
</dl>

<p class="author1">Notice how <em class="calibre5">Observable.d.ts</em> is just <em class="calibre5">Observable.ts</em>, minus the implementations. In other words, it’s just the types from <em class="calibre5">Observable.ts</em>.</p>

<p class="author1">This type declaration isn’t useful to other files in the RxJS library that use <em class="calibre5">Observable.ts</em>, since they have access to the <em class="calibre5">Observable.ts</em> source TypeScript file itself and can use it directly. It is useful, however, if you consume RxJS in your TypeScript <span class="calibre">application</span>.</p>

<p class="author1">Think about it: if the authors of RxJS wanted to package in typing information on NPM for their TypeScript-wielding users (RxJS can be used in both TypeScript and JavaScript applications), they would have two options: package <em class="calibre5">both</em> source TypeScript files (for TypeScript users) and compiled JavaScript files (for JavaScript users), or ship compiled JavaScript files along with type declarations for TypeScript users. The latter reduces the file size, and makes it unambiguous what the correct import to use is. It also helps keep compile times for your application fast, since your TSC instance doesn’t have to recompile RxJS every time you compile your own app (in fact, it’s the reason the optimization strategy we introduce in <a data-type="xref" href="#calibre_link-491" class="calibre4">“Project References”</a> works!).</p>

<p class="author1">Type declaration files have a few uses:</p>
<ol class="calibre31">
<li class="calibre32">
<p class="author1">When someone else uses your compiled TypeScript from their TypeScript application, their TSC instance will look for <em class="calibre5">.d.ts</em> files corresponding to your generated JavaScript files. <a data-primary="type declarations" data-secondary="uses of type declaration files" data-type="indexterm" id="calibre_link-1569" class="calibre4"></a>This tells TypeScript what the types are for your project.</p>
</li>
<li class="calibre32">
<p class="author1">Code editors with TypeScript support (like VSCode) will read these <em class="calibre5">.d.ts</em> files to give your users helpful type hints as they type, even if they don’t use TypeScript.</p>
</li>
<li class="calibre32">
<p class="author1">They speed up compile times significantly by avoiding unnecessarily re-compiling your TypeScript code.</p>
</li>

</ol>

<p class="author1">A type declaration is a way to tell TypeScript, “There exists this thing that’s defined in JavaScript, and I’m going to describe it to you.” When we talk about type declarations, we often call them <em class="calibre5">ambient</em> in order to differentiate them from regular declarations that contain values; for example,<a data-primary="variables" data-secondary="ambient versus regular declarations" data-type="indexterm" id="calibre_link-1738" class="calibre4"></a> an <em class="calibre5">ambient variable declaration</em> uses the <code class="calibre14">declare</code> keyword to declare that a variable is defined somewhere in JavaScript, while a regular nonambient variable declaration is a normal <code class="calibre14">let</code> or <code class="calibre14">const</code> declaration that declares a variable without using the <code class="calibre14">declare</code> keyword.</p>

<p class="author1">You can use type declarations for a few things:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">To tell TypeScript about a global variable that’s defined in JavaScript somewhere. For example, if you polyfilled the <code class="calibre14">Promise</code> global or defined <code class="calibre14">process.env</code> in a browser environment, you might use an <em class="calibre5">ambient variable declaration</em> to give TypeScript a heads-up.</p>
</li>
<li class="calibre11">
<p class="author1">To define a type that’s globally available everywhere in your project, so to use it you don’t have to import it first (we call this an ambient type declaration).</p>
</li>
<li class="calibre11">
<p class="author1">To tell TypeScript about a third-party module that you installed with NPM (an <em class="calibre5">ambient module declaration</em>).<a data-primary="modules" data-secondary="telling TypeScript about a third-party module installed with NPM" data-type="indexterm" id="calibre_link-1233" class="calibre4"></a></p>
</li>
</ul>

<p class="author1">A type declaration, regardless of what you’re using it for, has to live in a script-mode <em class="calibre5">.ts</em> or <em class="calibre5">.d.ts</em> file (recall our earlier discussion of script mode in <a data-type="xref" href="#calibre_link-330" class="calibre4">“Module Mode Versus Script Mode”</a>). <a data-primary="script mode versus module mode" data-secondary="script mode for type declarations" data-type="indexterm" id="calibre_link-1431" class="calibre4"></a>By convention, we give our file a <em class="calibre5">.d.ts</em> extension if it has a corresponding <em class="calibre5">.js</em> file; otherwise, we use a <em class="calibre5">.ts</em> extension. It doesn’t matter what you call the file&mdash;for example, I like to stick to a single top-level <em class="calibre5">types.ts</em> until it gets unwieldy&mdash;and a single type declaration file can contain as many type declarations as you want.</p>

<p class="author1">Finally, while top-level values in a type declaration file need the <code class="calibre14">declare</code> keyword (<code class="calibre14">declare let</code>, <code class="calibre14">declare function</code>, <code class="calibre14">declare class</code>, and so on), top-level types and interfaces do not.<a data-primary="types" data-secondary="top-level, in type declaration files" data-type="indexterm" id="calibre_link-1668" class="calibre4"></a><a data-primary="interfaces" data-secondary="top-level, in type declaration files" data-type="indexterm" id="calibre_link-1125" class="calibre4"></a><a data-primary="values" data-secondary="top-level, in type declaration files" data-type="indexterm" id="calibre_link-1732" class="calibre4"></a></p>

<p class="author1">With those ground rules out of the way, let’s briefly look at some examples of each kind of type declaration.</p>








<section data-pdf-bookmark="Ambient Variable Declarations" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1918">
<h2 class="calibre17">Ambient Variable Declarations</h2>

<p class="author1">An ambient variable declaration is a way to tell TypeScript about a global variable that can be used in any <em class="calibre5">.ts</em> or <em class="calibre5">.d.ts</em> file in your project without explicitly importing it first.<a data-primary="variables" data-secondary="ambient variable declarations" data-type="indexterm" id="calibre_link-1737" class="calibre4"></a><a data-primary="ambient variable declarations" data-type="indexterm" id="calibre_link-614" class="calibre4"></a><a data-primary="type declarations" data-secondary="ambient variable declarations" data-type="indexterm" id="calibre_link-1562" class="calibre4"></a></p>

<p class="author1">Let’s say you’re running a NodeJS program in your browser, and the program checks <code class="calibre14">process.env.NODE_ENV</code> (which is either <code class="calibre14">"development"</code> or <code class="calibre14">"production"</code>) at some point. When you run the program, you get an ugly runtime error:</p>

<pre data-type="programlisting" class="calibre30">Uncaught ReferenceError: process is not defined.</pre>

<p class="author1">You sleuth around Stack Overflow a bit, and realize that the quickest hack to get your program running is to polyfill <code class="calibre14">process.env.NODE_ENV</code> yourself and hardcode it. <a data-primary="polyfills" data-secondary="for process.env.NODE_ENV" data-type="indexterm" id="calibre_link-1352" class="calibre4"></a>So you create a new file, <em class="calibre5">polyfills.ts</em>, and define a global <code class="calibre14">process.env</code>:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">process</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">env</code><code class="o">:</code> <code class="p">{</code>
    <code class="nx">NODE_ENV</code><code class="o">:</code> <code class="s">'production'</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p class="author1">Of course, TypeScript then comes to the rescue, throwing a red squiggly at you to try to save you from t<a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2304" data-type="indexterm" id="calibre_link-897" class="calibre4"></a>he mistake you’re clearly making by augmenting the <code class="calibre14">window</code> global:</p>

<pre data-type="programlisting" class="calibre30">Error TS2304: Cannot find name 'process'.</pre>

<p class="author1">But in this case, TypeScript is being overprotective. You really do want to augment <code class="calibre14">window</code>, and you want to do it safely.</p>

<p class="author1">So what do you do? You pop open <em class="calibre5">polyfills.ts</em> in Vim (you see where this is going) and type:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<strong class="calibre49"><code class="k">declare</code><code class="calibre50"> </code><code class="k">let</code><code class="calibre50"> </code><code class="nx1">process</code><code class="o1">:</code><code class="calibre50"> </code><code class="p1">{</code><code class="calibre50">
  </code><code class="nx1">env</code><code class="o1">:</code><code class="calibre50"> </code><code class="p1">{</code><code class="calibre50">
    </code><code class="nx1">NODE_ENV</code><code class="o1">:</code><code class="calibre50"> </code><code class="s1">'development'</code><code class="calibre50"> </code><code class="o1">|</code><code class="calibre50"> </code><code class="s1">'production'</code><code class="calibre50">
  </code><code class="p1">}</code><code class="calibre50">
</code><code class="p1">}</code></strong><code class="calibre14">

</code><code class="nx">process</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="nx">env</code><code class="o">:</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
    </code><code class="nx">NODE_ENV</code><code class="o">:</code><code class="calibre14"> </code><code class="s">'production'</code><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code></pre>

<p class="author1">You’re declaring to TypeScript that there’s a global object <code class="calibre14">process</code> that has a single property <code class="calibre14">env</code>, that has a property <code class="calibre14">NODE_ENV</code>. Once you tell TypeScript about that, the red squiggly disappears and you can safely define your <code class="calibre14">process</code> global.</p>
<div data-type="tip" class="calibre21"><h1 class="calibre42">TSC Setting: lib</h1>
<p class="author1">TypeScript comes with a set of type declarations for describing the JavaScript standard library that includes<a data-primary="lib setting (TSC)" data-type="indexterm" id="calibre_link-1191" class="calibre4"></a><a data-primary="TSC compiler" data-secondary="lib setting" data-type="indexterm" id="calibre_link-1516" class="calibre4"></a> built-in JavaScript types, like <code class="calibre14">Array</code> and <code class="calibre14">Promise</code>, and methods on built-in types, like <code class="calibre14">''.toUpperCase</code>. It also includes global objects like <code class="calibre14">window</code> and <code class="calibre14">document</code> (in a browser environment), and <code class="calibre14">onmessage</code> (in a Web Worker environment).</p>

<p class="author1">You can pull in TypeScript’s built-in type declarations using your <em class="calibre5">tsconfig.json</em>’s <code class="calibre14">lib</code> field. Jump ahead to <a data-type="xref" href="#calibre_link-375" class="calibre4">“lib”</a> for a deep dive into how to dial in your project’s <code class="calibre14">lib</code> setting.</p>
</div>
</div></section>













<section data-pdf-bookmark="Ambient Type Declarations" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1919">
<h2 class="calibre17">Ambient Type Declarations</h2>

<p class="author1">Ambient type declarations follow the same rules as ambient variable declarations: the declaration has to live in a script-mode <em class="calibre5">.ts</em> or <em class="calibre5">.d.ts</em> file, and it’ll be available globally to the other files in your project without an explicit import.<a data-primary="ambient type declarations" data-type="indexterm" id="calibre_link-612" class="calibre4"></a><a data-primary="type declarations" data-secondary="ambient type declarations" data-type="indexterm" id="calibre_link-1561" class="calibre4"></a> For example, let’s declare a global utility type <code class="calibre14">ToArray&lt;T&gt;</code> that lifts <code class="calibre14">T</code> to an array, if it isn’t an array already. We can define this type in any script-mode file in our project&mdash;for this example, let’s define it in a top-level <em class="calibre5">types.ts</em> file:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">ToArray</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code> <code class="o">=</code> <code class="nx">T</code> <code class="kd">extends</code> <code class="nx">unknown</code><code class="p">[]</code> <code class="o">?</code> <code class="nx">T</code> : <code class="kt">T</code><code class="p">[]</code></pre>

<p class="author1">We can now use this type from any project file, without an explicit import:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">function</code> <code class="nx">toArray</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">a</code>: <code class="kt">T</code><code class="p">)</code><code class="o">:</code> <code class="nx">ToArray</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code> <code class="p">{</code>
  <code class="c">// ...</code>
<code class="p">}</code></pre>

<p class="author1">Consider using ambient type declarations to model data types that are used throughout your application. For example, you might use them to make the <code class="calibre14">UserID</code> type we developed in <a data-type="xref" href="#calibre_link-492" class="calibre4">“Simulating Nominal Types”</a> globally available:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="nx">type</code> <code class="nx">UserID</code> <code class="o">=</code> <code class="kt">string</code> <code class="o">&amp;</code> <code class="p">{</code><code class="nx">readonly</code> <code class="nx">brand</code>: <code class="kt">unique</code> <code class="nx">symbol</code><code class="p">}</code></pre>

<p class="author1">Now, you can use <code class="calibre14">UserID</code> anywhere in your application without having to explicitly import it first.</p>
</div></section>













<section data-pdf-bookmark="Ambient Module Declarations" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1920">
<h2 class="calibre17">Ambient Module Declarations</h2>

<p class="author1">When you consume a JavaScript module and want <a data-primary="ambient module declarations" data-type="indexterm" id="calibre_link-609" class="calibre4"></a><a data-primary="type declarations" data-secondary="ambient module declarations" data-type="indexterm" id="calibre_link-1560" class="calibre4"></a><a data-primary="modules" data-secondary="ambient module declarations" data-type="indexterm" id="calibre_link-1219" class="calibre4"></a>to quickly declare some types for it so you can use it safely&mdash;without having to contribute the type declarations back to the JavaScript module’s GitHub repository or DefinitelyTyped first&mdash;ambient module declarations are the tool to use.</p>

<p class="author1">An ambient module declaration is a regular type declaration,<a data-primary="declare module syntax" data-type="indexterm" id="calibre_link-826" class="calibre4"></a> surrounded by a special <code class="calibre14">declare module</code> syntax:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">declare</code> <code class="nx">module</code> <code class="s">'module-name'</code> <code class="p">{</code>
  <code class="kd">export</code> <code class="nx">type</code> <code class="nx">MyType</code> <code class="o">=</code> <code class="kt">number</code>
  <code class="kd">export</code> <code class="nx">type</code> <code class="nx">MyDefaultType</code> <code class="o">=</code> <code class="p">{</code><code class="nx">a</code>: <code class="kt">string</code><code class="p">}</code>
  <code class="kd">export</code> <code class="kd">let</code> <code class="nx">myExport</code>: <code class="kt">MyType</code>
  <code class="kd">let</code> <code class="nx">myDefaultExport</code>: <code class="kt">MyDefaultType</code>
  <code class="kd">export</code> <code class="kd">default</code> <code class="nx">myDefaultExport</code>
<code class="p">}</code></pre>

<p class="author1">A module name (<code class="calibre14">'module-name'</code> in this example) corresponds to an exact <code class="calibre14">import</code> path.<a data-primary="imports" data-secondary="module name for exact import path" data-type="indexterm" id="calibre_link-1101" class="calibre4"></a> When you import that path, your ambient module declaration tells TypeScript what’s available:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">import</code> <code class="nx">ModuleName</code> <code class="nx">from</code> <code class="s">'module-name'</code>
<code class="nx">ModuleName</code><code class="p">.</code><code class="nx">a</code>  <code class="c">// string</code></pre>

<p class="author1">If you have a nested module, make sure you include the whole <code class="calibre14">import</code> path in its declaration:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">declare</code> <code class="nx">module</code> <code class="s">'@most/core'</code> <code class="p">{</code>
  <code class="c">// Type declaration</code>
<code class="p">}</code></pre>

<p class="author1">If you just want to quickly tell TypeScript “I’m importing this module&mdash;I’ll type it later, just assume it’s an <code class="calibre14">any</code> for now,” keep the header but omit the actual declaration:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// Declare a module that can be imported, where each of its imports are any</code>
<code class="kd">declare</code> <code class="nx">module</code> <code class="s">'unsafe-module-name'</code></pre>

<p class="author1">Now if you consume this module, it’s less safe:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">import</code> <code class="p">{</code><code class="nx">x</code><code class="p">}</code> <code class="nx">from</code> <code class="s">'unsafe-module-name'</code>
<code class="nx">x</code>  <code class="c">// any</code></pre>

<p class="author1">Module declarations support wildcard imports,<a data-primary="ambient module declarations" data-secondary="wildcard" data-type="indexterm" id="calibre_link-611" class="calibre4"></a> so you can give a type to any <code class="calibre14">import</code> path that matches the given pattern. Use a wildcard (<code class="calibre14">*</code>) to match an <code class="calibre14">import</code> path:<sup class="calibre15"><a data-type="noteref" href="#calibre_link-493" id="calibre_link-501" class="calibre16">1</a></sup></p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// Type JSON files imported with Webpack's json-loader</code>
<code class="kd">declare</code> <code class="nx">module</code> <code class="s">'json!*'</code> <code class="p">{</code>
  <code class="kd">let</code> <code class="nx">value</code>: <code class="kt">object</code>
  <code class="kd">export</code> <code class="kd">default</code> <code class="nx">value</code>
<code class="p">}</code>

<code class="c">// Type CSS files imported with Webpack's style-loader</code>
<code class="kd">declare</code> <code class="nx">module</code> <code class="s">'*.css'</code> <code class="p">{</code>
  <code class="kd">let</code> <code class="nx">css</code>: <code class="kt">CSSRuleList</code>
  <code class="kd">export</code> <code class="kd">default</code> <code class="nx">css</code>
<code class="p">}</code></pre>

<p class="author1">Now, you can load JSON and CSS files:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">import</code> <code class="nx">a</code> <code class="nx">from</code> <code class="s">'json!myFile'</code>
<code class="nx">a</code>  <code class="c">// object</code>

<code class="kd">import</code> <code class="nx">b</code> <code class="nx">from</code> <code class="s">'./widget.css'</code>
<code class="nx">b</code>  <code class="c">// CSSRuleList</code></pre>
<div data-type="note" type="note" class="calibre21"><h6 class="calibre22">Note</h6>
<p class="author1">For the last two examples to work, you’ll need to configure your build system to load <em class="calibre5">.json</em> and <em class="calibre5">.css</em> files.<a data-primary="JSON (JavaScript Object Notation)" data-secondary="loading .json files" data-type="indexterm" id="calibre_link-1170" class="calibre4"></a><a data-primary="CSS files, loading" data-type="indexterm" id="calibre_link-814" class="calibre4"></a> You can declare to TypeScript that these path patterns are safe to import, but TypeScript won’t be able to build them by itself.</p>
</div>

<p class="author1">Jump ahead to <a data-type="xref" href="#calibre_link-494" class="calibre4">“JavaScript That Doesn’t Have Type Declarations on DefinitelyTyped”</a> for an example of how to use ambient module declarations to declare types for untyped third-party JavaScript.<a data-primary="type declarations" data-startref="ix_typdec" data-type="indexterm" id="calibre_link-1558" class="calibre4"></a><a data-primary="JavaScript" data-secondary="interoperating with" data-startref="ix_JSintertypdec" data-tertiary="using type declarations" data-type="indexterm" id="calibre_link-1160" class="calibre4"></a></p>
</div></section>





</div></section>













<section data-pdf-bookmark="Gradually Migrating from JavaScript to TypeScript" data-type="sect1" class="preface"><div class="preface" id="calibre_link-19">
<h1 class="calibre13">Gradually Migrating from JavaScript to TypeScript</h1>

<p class="author1">TypeScript was designed with JavaScript interoperability in mind, not as an afterthought.<a data-primary="TypeScript" data-secondary="gradually migrating JavaScript code to" data-type="indexterm" id="calibre_link-1689" class="calibre4"></a><a data-primary="JavaScript" data-secondary="interoperating with" data-tertiary="gradually migrating code to TypeScript" data-type="indexterm" id="calibre_link-1153" class="calibre4"></a> So while it’s not painless, migrating to TypeScript is a good experience, letting you convert your codebase over a file at a time, opting into stricter levels of safety as you migrate, showing your boss and your coworkers just how impactful statically typing your code can be, one commit at a time.</p>

<p class="author1">At a high level, here’s where you want to end up: your codebase should be completely written in TypeScript with strict type coverage, and third-party JavaScript libraries you depend on should come with high-quality, strict types of their own. Any bugs that could be caught at compile time are, and TypeScript’s rich autocompletion halves the time it takes to write each line of code. You might have to take a few baby steps to get there:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">Add TSC to your project.</p>
</li>
<li class="calibre11">
<p class="author1">Start typechecking your existing JavaScript code.</p>
</li>
<li class="calibre11">
<p class="author1">Migrate your JavaScript code to TypeScript, a file at a time.</p>
</li>
<li class="calibre11">
<p class="author1">Install type declarations for your dependencies, either stubbing out types for dependencies that don’t have types or writing type declarations for untyped dependencies and contributing them back to DefinitelyTyped.<sup class="calibre15"><a data-type="noteref" href="#calibre_link-495" id="calibre_link-502" class="calibre16">2</a></sup></p>
</li>
<li class="calibre11">
<p class="author1">Flip on <code class="calibre14">strict</code> mode for your codebase.</p>
</li>
</ul>

<p class="author1">This process can take a while, but you will see safety and productivity gains right away, and uncover more gains as you keep going. Let’s walk through the steps one at a time.</p>








<section data-pdf-bookmark="Step 1: Add TSC" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1921">
<h2 class="calibre17">Step 1: Add TSC</h2>

<p class="author1">When working on a codebase that combines TypeScript and JavaScript, start by letting TSC compile JavaScript files alongside your TypeScript.<a data-primary="allowJs TSC flag" data-type="indexterm" id="calibre_link-608" class="calibre4"></a><a data-primary="TypeScript" data-secondary="gradually migrating JavaScript code to" data-tertiary="adding TSC to JavaScript projects" data-type="indexterm" id="calibre_link-1692" class="calibre4"></a><a data-primary="TSC compiler" data-secondary="compiling JavaScript code" data-type="indexterm" id="calibre_link-1500" class="calibre4"></a> In your <em class="calibre5">tsconfig.json</em>:</p>

<pre data-code-language="json" data-type="programlisting" class="calibre30"><code class="p">{</code>
  <code class="nt">"compilerOptions"</code><code class="p">:</code> <code class="p">{</code>
  <code class="nt">"allowJs"</code><code class="p">:</code> <code class="kd">true</code>
<code class="p">}</code></pre>

<p class="author1">With this one change, you can now use TSC to compile your JavaScript. Just add TSC to your build process, and either run every existing JavaScript file through TSC,<sup class="calibre15"><a data-type="noteref" href="#calibre_link-496" id="calibre_link-503" class="calibre16">3</a></sup> or continue running legacy JavaScript files through your existing build process and run new TypeScript files through TSC.</p>

<p class="author1">With <code class="calibre14">allowJs</code> set to <code class="calibre14">true</code>, TypeScript won’t typecheck your existing JavaScript code, but it will transpile it (to ES3, ES5, or whatever <code class="calibre14">target</code> is set to in your <em class="calibre5">tsconfig.json</em>) using the module system you asked for (in your <em class="calibre5">tsconfig.json</em>’s <code class="calibre14">module</code> field). <a data-primary="modules" data-secondary="module field in tsconfig.json" data-type="indexterm" id="calibre_link-1230" class="calibre4"></a>First step, done. Commit it, and give yourself a pat on the back&mdash;your codebase now uses TypeScript!</p>
</div></section>













<section data-pdf-bookmark="Step 2a: Enable Typechecking for JavaScript (Optional)" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1922">
<h2 class="calibre17">Step 2a: Enable Typechecking for JavaScript (Optional)</h2>

<p class="author1">Now that TSC is processing your JavaScript, why not typecheck it too?<a data-primary="typechecking" data-secondary="JavaScript code" data-type="indexterm" id="calibre_link-1597" class="calibre4"></a><a data-primary="TypeScript" data-secondary="gradually migrating JavaScript code to" data-tertiary="enabling typechecking for JavaScript" data-type="indexterm" id="calibre_link-1693" class="calibre4"></a><a data-primary="TSC compiler" data-secondary="checkJs flag" data-type="indexterm" id="calibre_link-1499" class="calibre4"></a><a data-primary="checkJs TSC flag" data-type="indexterm" id="calibre_link-727" class="calibre4"></a> While you might not have explicit type annotations in your JavaScript, remember how great TypeScript is at inferring types for you; it can infer types in your JavaScript the same way it does in your TypeScript code. Enable this in your <em class="calibre5">tsconfig.json</em>:</p>
<pre data-code-language="json" data-type="programlisting" class="calibre30">
<code class="p">{</code>
  <code class="nt">"compilerOptions"</code><code class="p">:</code> <code class="p">{</code>
  <code class="nt">"allowJs"</code><code class="p">:</code> <code class="kd">true</code><code class="p">,</code>
  <code class="nt">"checkJs"</code><code class="p">:</code> <code class="kd">true</code>
<code class="p">}</code>
</pre>

<p class="author1">Now, whenever TypeScript compiles a JavaScript file it’ll do its best to infer types and typecheck as it goes, like it does for regular TypeScript code.</p>

<p class="author1">If your codebase is big and flipping on <code class="calibre14">checkJs</code> reports too many type errors at once, turn it off, and instead enable checking for a JavaScript file at a time by adding the <code class="calibre14">// @ts-check</code> directive (a regular comment at the top of the file).<a data-primary="@ts-check comment" data-type="indexterm" id="calibre_link-589" class="calibre4"></a> Or, if a few big files are throwing the bulk of your errors and you don’t want to fix them just yet, keep <code class="calibre14">checkJs</code> on and add the <code class="calibre14">// @ts-nocheck</code> directive to just those files.<a data-primary="@ts-nocheck comment" data-type="indexterm" id="calibre_link-591" class="calibre4"></a></p>
<div data-type="note" type="note" class="calibre21"><h6 class="calibre22">Note</h6>
<p class="author1">Because TypeScript can’t <a data-primary="type inference" data-secondary="types in JavaScript code" data-type="indexterm" id="calibre_link-1572" class="calibre4"></a>infer everything (e.g., function parameter types), it will infer a lot of types in your JavaScript code as <code class="calibre14">any</code>.<a data-primary="any type" data-secondary="JavaScript types inferred as" data-type="indexterm" id="calibre_link-628" class="calibre4"></a><a data-primary="noImplicitAny flag in tsconfig.sh" data-type="indexterm" id="calibre_link-1277" class="calibre4"></a><a data-primary="TSC compiler" data-secondary="enabling noImplicitAny flag" data-type="indexterm" id="calibre_link-1506" class="calibre4"></a><a data-primary="strict mode (TSC)" data-type="indexterm" id="calibre_link-1446" class="calibre4"></a> If you have <code class="calibre14">strict</code> mode enabled in your <em class="calibre5">tsconfig.json</em> (you should!), you may want to temporarily allow implicit <code class="calibre14">any</code>s while you migrate. In your <em class="calibre5">tsconfig.json</em>, add:</p>
<pre data-code-language="json" data-type="programlisting" class="calibre43">
<code class="p">{</code>
  <code class="nt">"compilerOptions"</code><code class="p">:</code> <code class="p">{</code>
  <code class="nt">"allowJs"</code><code class="p">:</code> <code class="kd">true</code><code class="p">,</code>
  <code class="nt">"checkJs"</code><code class="p">:</code> <code class="kd">true</code><code class="p">,</code>
  <code class="nt">"noImplicitAny"</code><code class="p">:</code> <code class="kd">false</code>
<code class="p">}</code>
</pre>

<p class="author1">Don’t forget to turn <code class="calibre14">noImplicitAny</code> on again when you’ve migrated a critical mass of code to TypeScript! It will probably reveal a bunch of real errors that you missed (unless, of course, you’re Xenithar, disciple of Bathmorda the JavaScript witch, able to typecheck in your mind’s eye with the help of nothing but a cauldronful of mugwort).</p>
</div>

<p class="author1">When TypeScript runs over JavaScript code, it uses a more lenient inference algorithm than it does for TypeScript code.<a data-primary="parameters" data-secondary="optional function parameters in type inference on JavaScript" data-type="indexterm" id="calibre_link-1344" class="calibre4"></a><a data-primary="properties" data-secondary="type inference on JavaScript code" data-type="indexterm" id="calibre_link-1389" class="calibre4"></a> Specifically:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">All function parameters are optional.</p>
</li>
<li class="calibre11">
<p class="author1">The types of properties on functions and classes are inferred from usage (rather than having to be declared up front):</p>
</li>
</ul>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"> <code class="kd">class</code> <code class="nx">A</code> <code class="p">{</code>
   <code class="nx">x</code> <code class="o">=</code> <code class="mi">0</code> <code class="c">// number | string | string[], inferred from usage</code>
   <code class="nx">method() {</code>
     <code class="kd">this</code><code class="p">.</code><code class="nx">x</code> <code class="o">=</code> <code class="s">'foo'</code>
   <code class="p">}</code>
   <code class="nx">otherMethod() {</code>
     <code class="kd">this</code><code class="p">.</code><code class="nx">x</code> <code class="o">=</code> <code class="p">[</code><code class="s">'array'</code><code class="p">,</code> <code class="s">'of'</code><code class="p">,</code> <code class="s">'strings'</code><code class="p">]</code>
   <code class="p">}</code>
 <code class="p">}</code></pre>

<ul class="printings">
<li class="calibre11">
<p class="author1">After declaring an object, class, or function, you can assign extra properties to it. Under the hood, TypeScript does this by generating a corresponding namespace for each class and function declaration, and automatically adding an index signature to every object literal.</p>
</li>
</ul>
</div></section>













<section data-pdf-bookmark="Step 2b: Add JSDoc Annotations (Optional)" data-type="sect2" class="preface"><div class="preface" id="calibre_link-486">
<h2 class="calibre17">Step 2b: Add JSDoc Annotations (Optional)</h2>

<p class="author1">Maybe you’re in a hurry, and just need to add a single type annotation for a new function you added to an old JavaScript file.<a data-primary="TypeScript" data-secondary="gradually migrating JavaScript code to" data-tertiary="adding JSDoc annotations" data-type="indexterm" id="calibre_link-1691" class="calibre4"></a><a data-primary="JSDoc annotations" data-type="indexterm" id="calibre_link-1169" class="calibre4"></a> Until you get a chance to convert that file to TypeScript, you can use a JSDoc annotation to type your new function.</p>

<p class="author1">You’ve probably seen JSDoc before; it’s those funny-looking comments above some JavaScript and TypeScript code with <code class="calibre14">@</code>-annotations like <code class="calibre14">@param</code>, <code class="calibre14">@returns</code>, and so on. TypeScript understands JSDoc, and uses it as input to its typechecker the same way that it uses explicit type annotations in TypeScript code.</p>

<p class="author1">Let’s say you have a 3,000-line utilities file (yes, I know your “friend” wrote it). You add a new utility function to it:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">export</code> <code class="kd">function</code> <code class="nx">toPascalCase</code><code class="p">(</code><code class="nx">word</code><code class="p">)</code> <code class="p">{</code>
  <code class="kd">return</code> <code class="nx">word</code><code class="p">.</code><code class="nx">replace</code><code class="p">(</code>
    <code class="sr">/\w+/g</code><code class="p">,</code>
    <code class="p">([</code><code class="nx">a</code><code class="p">,</code> <code class="p">...</code><code class="nx">b</code><code class="p">])</code> <code class="o">=&gt;</code> <code class="nx">a</code><code class="p">.</code><code class="nx">toUpperCase</code><code class="p">()</code> <code class="o">+</code> <code class="nx">b</code><code class="p">.</code><code class="nx">join</code><code class="p">(</code><code class="s">''</code><code class="p">).</code><code class="nx">toLowerCase</code><code class="p">()</code>
  <code class="p">)</code>
<code class="p">}</code></pre>

<p class="author1">Without converting <em class="calibre5">utils.js</em> to TypeScript full sail&mdash;which would probably catch a bunch of bugs you’d then have to fix&mdash;you can annotate just your <code class="calibre14">toPascalCase</code> function, carving out a little island of safety in a sea of untyped JavaScript:</p>
<pre data-code-language="ts" data-type="programlisting" class="calibre30">
<em class="calibre41"><code class="c2">/**
 * @param word {string} An input string to convert
 * @returns {string} The string in PascalCase
 */</code></em><code class="calibre14">
</code><code class="kd">export</code><code class="calibre14"> </code><code class="kd">function</code><code class="calibre14"> </code><code class="nx">toPascalCase</code><code class="p">(</code><code class="nx">word</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="kd">return</code><code class="calibre14"> </code><code class="nx">word</code><code class="p">.</code><code class="nx">replace</code><code class="p">(</code><code class="calibre14">
    </code><code class="sr">/\w+/g</code><code class="p">,</code><code class="calibre14">
    </code><code class="p">(</code><code class="p">[</code><code class="nx">a</code><code class="p">,</code><code class="calibre14"> </code><code class="p">.</code><code class="p">.</code><code class="p">.</code><code class="nx">b</code><code class="p">]</code><code class="p">)</code><code class="calibre14"> </code><code class="o">=</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="nx">a</code><code class="p">.</code><code class="nx">toUpperCase</code><code class="p">(</code><code class="p">)</code><code class="calibre14"> </code><code class="o">+</code><code class="calibre14"> </code><code class="nx">b</code><code class="p">.</code><code class="nx">join</code><code class="p">(</code><code class="s">''</code><code class="p">)</code><code class="p">.</code><code class="nx">toLowerCase</code><code class="p">(</code><code class="p">)</code><code class="calibre14">
  </code><code class="p">)</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code></pre>

<p class="author1">Without that JSDoc annotation, TypeScript would have inferred <code class="calibre14">toPascalCase</code>’s type as <code class="calibre14">(word: any) =&gt; string</code>. Now, when TypeScript compiles your code it knows <code class="calibre14">toPascalCase</code>’s type is <code class="calibre14">(word: string) =&gt; string</code>. And you got some nice documentation out of it!</p>

<p class="author1">Head over to the <a href="http://bit.ly/2YCTWBf" class="calibre4">TypeScript Wiki</a> to learn more about supported JSDoc annotations.</p>
</div></section>













<section data-pdf-bookmark="Step 3: Rename Your Files to .ts" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1923">
<h2 class="calibre17">Step 3: Rename Your Files to .ts</h2>

<p class="author1">Once you’ve added TSC to your build process, and optionally started typechecking and annotating JavaScript where possible, it’s time to start switching over to TypeScript.<a data-primary="TypeScript" data-secondary="gradually migrating JavaScript code to" data-tertiary="renaming files to .ts" data-type="indexterm" id="calibre_link-1694" class="calibre4"></a></p>

<p class="author1">One file at a time, update your files’ extensions from <em class="calibre5">.js</em> (or <em class="calibre5">.coffee</em>, <em class="calibre5">.es6</em>, etc.) to <em class="calibre5">.ts</em>. As soon as you rename a file in your code editor, you’ll see your friends the red squigglies appear (the TypeError, not the kids’ TV show), uncovering type errors, missed cases, forgotten <code class="calibre14">null</code> checks, and misspelled variable names. There are two strategies for fixing these errors:</p>
<ol class="calibre31">
<li class="calibre32">
<p class="author1">Do it right. Take your time to type shapes, fields, and functions correctly, so you can catch errors in all the files that consume them. If you have <code class="calibre14">checkJs</code> enabled, turn on <code class="calibre14">noImplicitAny</code> in your <em class="calibre5">tsconfig.json</em> to uncover <code class="calibre14">any</code>s and type them, then turn it back off to make the output of typechecking your remaining JavaScript files less noisy.</p>
</li>
<li class="calibre32">
<p class="author1">Do it fast. Mass-rename your JavaScript files to the <em class="calibre5">.ts</em> extension, and keep your <em class="calibre5">tsconfig.json</em> settings lax (meaning <code class="calibre14">strict</code> set to <code class="calibre14">false</code>) to throw as few type errors as possible after renaming. Type complex types as <code class="calibre14">any</code> to appease the typechecker. Fix whatever type errors remain, and commit. Once this is done, flip on the <code class="calibre14">strict</code> mode flags (<code class="calibre14">noImplicitAny</code>, <code class="calibre14">noImplicitThis</code>, <code class="calibre14">strictNullChecks</code>, and so on) one by one, and fix the errors that pop up. (See <a data-type="xref" href="#calibre_link-497" class="calibre4">Appendix&nbsp;F</a> for a full list of these flags.)</p>
</li>

</ol>
<div data-type="tip" class="calibre21"><h6 class="calibre22">Tip</h6>
<p class="author1">If you choose to go the quick-and-dirty route, a useful trick is to define an ambient type declaration <code class="calibre14">TODO</code> as a type alias for <code class="calibre14">any</code>, and use that instead of <code class="calibre14">any</code> so that you can more easily find and track missing types.<a data-primary="ambient type declarations" data-secondary="defining TODO as type alias for any" data-type="indexterm" id="calibre_link-613" class="calibre4"></a><a data-primary="any type" data-secondary="TODO ambient type declaration as type alias for" data-type="indexterm" id="calibre_link-630" class="calibre4"></a> You can also call it something more specific, so it’s easier to find in a project-wide code search:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre43"><code class="c">// globals.ts</code>
<code class="nx">type</code> <code class="nx">TODO_FROM_JS_TO_TS_MIGRATION</code> <code class="o">=</code> <code class="nx">any</code>

<code class="c">// MyMigratedUtil.ts</code>
<code class="kd">export</code> <code class="kd">function</code> <code class="nx">mergeWidgets</code><code class="p">(</code>
  <code class="nx">widget1</code>: <code class="kt">TODO_FROM_JS_TO_TS_MIGRATION</code><code class="p">,</code>
  <code class="nx">widget2</code>: <code class="kt">TODO_FROM_JS_TO_TS_MIGRATION</code>
<code class="p">)</code><code class="o">:</code> <code class="kt">number</code> <code class="p">{</code>
  <code class="c">// ...</code>
<code class="p">}</code></pre>
</div>

<p class="author1">Both ways of doing it are fair game, and it’s up to you which you want to go with. Because TypeScript is a gradually typed language, it’s built from the ground up to interoperate with untyped JavaScript code as safely as possible. Regardless of whether you’re interoperating strictly typed TypeScript with untyped JavaScript or strictly typed TypeScript with loosely typed TypeScript, TypeScript will do its best to make sure that you’re doing it as  safely as possible, and that on the strictly typed island that you’ve so carefully built, everything is as safe as it can be.</p>
</div></section>













<section data-pdf-bookmark="Step 4: Make It strict" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1924">
<h2 class="calibre17">Step 4: Make It strict</h2>

<p class="author1">Once you’ve migrated a critical mass of your JavaScript over to TypeScript, you’ll want to make your code as safe as possible by opting into TSC’s more stringent flags<a data-primary="TSC compiler" data-secondary="using more stringent flags on migrated JavaScript code" data-type="indexterm" id="calibre_link-1531" class="calibre4"></a><a data-primary="TypeScript" data-secondary="gradually migrating JavaScript code to" data-tertiary="using strict TSC flags" data-type="indexterm" id="calibre_link-1695" class="calibre4"></a> one by one (see <a data-type="xref" href="#calibre_link-497" class="calibre4">Appendix&nbsp;F</a> for a full list of flags).</p>

<p class="author1">Finally, you can disable TSC’s JavaScript interoperability flags, enforcing that all of your code is written in strictly typed TypeScript:</p>
<pre data-code-language="json" data-type="programlisting" class="calibre30">
<code class="p">{</code>
  <code class="nt">"compilerOptions"</code><code class="p">:</code> <code class="p">{</code>
  <code class="nt">"allowJs"</code><code class="p">:</code> <code class="kd">false</code><code class="p">,</code>
  <code class="nt">"checkJs"</code><code class="p">:</code> <code class="kd">false</code>
<code class="p">}</code>
</pre>

<p class="author1">This will surface the final rounds of type-related errors. Fix these, and you’re left with a pristine, safe codebase that the most hardcore OCaml engineer would give you a pat on the back for (were you to ask nicely).</p>

<p class="author1">Following these steps will get you far when adding types to JavaScript you control, but what about JavaScript you don’t control, like code you installed from NPM? To get there, we’re first going to have to take a small detour…<a data-primary="JavaScript" data-secondary="interoperating with" data-startref="ix_JSintermig" data-tertiary="gradually migrating code to TypeScript" data-type="indexterm" id="calibre_link-1154" class="calibre4"></a><a data-primary="TypeScript" data-secondary="gradually migrating JavaScript code to" data-startref="ix_TSmigJS" data-type="indexterm" id="calibre_link-1690" class="calibre4"></a></p>
</div></section>





</div></section>













<section data-pdf-bookmark="Type Lookup for JavaScript" data-type="sect1" class="preface"><div class="preface" id="calibre_link-483">
<h1 class="calibre13">Type Lookup for JavaScript</h1>

<p class="author1">When you import a JavaScript file from a TypeScript file, TypeScript follows an algorithm that looks like this to look up type declarations<a data-primary="types" data-secondary="type lookup for JavaScript" data-type="indexterm" id="calibre_link-1671" class="calibre4"></a><a data-primary="JavaScript" data-secondary="interoperating with" data-tertiary="type lookup for JavaScript" data-type="indexterm" id="calibre_link-1155" class="calibre4"></a><a data-primary="modules" data-secondary="imported from JavaScript, type lookup for" data-type="indexterm" id="calibre_link-1228" class="calibre4"></a> for your JavaScript code (remember that “file” and “module” are interchangeable when we talk about TypeScript):<sup class="calibre15"><a data-type="noteref" href="#calibre_link-498" id="calibre_link-504" class="calibre16">4</a></sup></p>
<ol class="calibre31">
<li class="calibre32">
<p class="author1">Look for a sibling <em class="calibre5">.d.ts</em> file with the same name as your <em class="calibre5">.js</em> file. If it exists, use it as the type declaration for the <em class="calibre5">.js</em> file.</p>

<p class="author1">For example, say you have the following folder structure:</p>

<pre data-type="programlisting" class="calibre30">my-app/
├──src/
│ ├──index.ts
│ └──legacy/
│   ├──old-file.js
│   └──old-file.d.ts</pre>

<p class="author1">You then import <em class="calibre5">old-file</em> from <em class="calibre5">index.ts</em>:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// index.ts</code>
<code class="kd">import</code> <code class="s">'./legacy/old-file'</code></pre>

<p class="author1">TypeScript will use <em class="calibre5">src/legacy/old-file.d.ts</em> as the source of type declarations for <em class="calibre5"><span class="calibre">./legacy/old-file</span></em>.</p>
</li>
<li class="calibre32">
<p class="author1">Otherwise, if <code class="calibre14">allowJs</code> and <code class="calibre14">checkJs</code> are true, infer the <em class="calibre5">.js</em> file’s types (informed by any JSDoc annotations in the <em class="calibre5">.js</em> file).</p>
</li>
<li class="calibre32">
<p class="author1">Otherwise, treat the whole module as an <code class="calibre14">any</code>.</p>
</li>

</ol>

<p class="author1">When importing a third-party JavaScript module&mdash;that is, an NPM package that you installed to <em class="calibre5">node modules</em>&mdash;TypeScript uses a slightly different algorithm:</p>
<ol class="calibre31">
<li class="calibre32">
<p class="author1">Look for a local type declaration for the module. If it exists, use it.</p>

<p class="author1">For example, say your app’s folder structure looks like this:</p>

<pre data-type="programlisting" class="calibre30">my-app/
├──node_modules/
│ └──foo/
├──src/
│ ├──index.ts
│ └──types.d.ts</pre>

<p class="author1">And <em class="calibre5">types.d.ts</em> looks like this:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// types.d.ts</code>
<code class="kd">declare</code> <code class="nx">module</code> <code class="s">'foo'</code> <code class="p">{</code>
  <code class="kd">let</code> <code class="nx">bar</code><code class="o">:</code> <code class="p">{}</code>
  <code class="kd">export</code> <code class="kd">default</code> <code class="nx">bar</code>
<code class="p">}</code></pre>

<p class="author1">If you then import <code class="calibre14">foo</code>, TypeScript will use the ambient module declaration in <em class="calibre5">types.d.ts</em> as the source of types for <code class="calibre14">foo</code>:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// index.ts</code>
<code class="kd">import</code> <code class="nx">bar</code> <code class="nx">from</code> <code class="s">'foo'</code></pre>
</li>
<li class="calibre32">
<p class="author1">Otherwise, look at the module’s <em class="calibre5">package.json</em>. If it defines a field called <code class="calibre14">types</code> or <code class="calibre14">typings</code>, use the <em class="calibre5">.d.ts</em> file that field points to as the source of type declarations for the module.</p>
</li>
<li class="calibre32">
<p class="author1">Otherwise, traverse out a directory at a time, and look for a <em class="calibre5">node modules/@types</em> directory that has type declarations for the module.</p>

<p class="author1">For example, say you installed React:</p>

<pre data-code-language="sh" data-type="programlisting" class="calibre30">npm install react --save
npm install @types/react --save-dev</pre>

<pre data-type="programlisting" class="calibre30">my-app/
├──node_modules/
│ ├──@types/
│ │ └──react/
│ └──react/
├──src/
│ └──index.ts</pre>

<p class="author1">When you import React, TypeScript will find the <em class="calibre5">@types/react</em> folder and use that as the source of type declarations for React:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// index.ts</code>
<code class="kd">import</code> <code class="o">*</code> <code class="kd">as</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s">'react'</code></pre>
</li>
<li class="calibre32">
<p class="author1">Otherwise, proceed to steps 1&ndash;3 of the local type lookup algorithm.</p>
</li>

</ol>

<p class="author1">That was a lot of steps, but it’s remarkably intuitive once you get the hang of it.</p>
<div data-type="tip" class="calibre21"><h1 class="calibre42">TSC Settings: types and typeRoots</h1>
<p class="author1">By default, TypeScript looks in <em class="calibre5">node modules/@types</em> in your project’s folder and containing folders (<em class="calibre5">../node modules/@types</em> and so on) for third-party type declarations.<a data-primary="types and typeRoots settings (TSC)" data-type="indexterm" id="calibre_link-1673" class="calibre4"></a><a data-primary="TSC compiler" data-secondary="types and typeRoots settings" data-type="indexterm" id="calibre_link-1530" class="calibre4"></a> Most of the time, you want to leave this behavior as is.</p>

<p class="author1">To override this default behavior for global type declarations, configure <code class="calibre14">typeRoots</code> in your <em class="calibre5">tsconfig.json</em> with an array of folders to look in for type declarations. For example, you can tell TypeScript to look for type declarations in the <em class="calibre5">typings</em> folder as well as <em class="calibre5">node modules/@types</em>:</p>

<pre data-code-language="json" data-type="programlisting" class="calibre43"><code class="p">{</code>
  <code class="nt">"compilerOptions"</code><code class="p">:</code> <code class="p">{</code>
    <code class="nt">"typeRoots"</code> <code class="p">:</code> <code class="p">[</code><code class="s">"./typings"</code><code class="p">,</code> <code class="s">"./node modules/@types"</code><code class="p">]</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p class="author1">For even more granular control, use the <code class="calibre14">types</code> option in your <em class="calibre5">tsconfig.json</em> to specify which packages you want TypeScript to look up types for. For example, the following config ignores all third-party type declarations except the ones for React:</p>

<pre data-code-language="json" data-type="programlisting" class="calibre43"><code class="p">{</code>
  <code class="nt">"compilerOptions"</code><code class="p">:</code> <code class="p">{</code>
    <code class="nt">"types"</code> <code class="p">:</code> <code class="p">[</code><code class="s">"react"</code><code class="p">]</code>
  <code class="p">}</code>
<code class="p">}</code></pre>
</div>
</div></section>













<section data-pdf-bookmark="Using Third-Party JavaScript" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1925">
<h1 class="calibre13">Using Third-Party JavaScript</h1>
<div data-type="note" type="note" class="calibre21"><h6 class="calibre22">Note</h6>
<p class="author1">I’ll assume you’re using a package manager like NPM or Yarn to install third-party JavaScript. <a data-primary="modules" data-secondary="imported from JavaScript, type lookup for" data-startref="ix_modimpJS" data-type="indexterm" id="calibre_link-1229" class="calibre4"></a><a data-primary="types" data-secondary="type lookup for JavaScript" data-startref="ix_typelkJS" data-type="indexterm" id="calibre_link-1672" class="calibre4"></a><a data-primary="JavaScript" data-secondary="interoperating with" data-startref="ix_JSintertyplk" data-tertiary="type lookup for JavaScript" data-type="indexterm" id="calibre_link-1156" class="calibre4"></a>And if you’re one of those people that prefers to copy and paste code manually instead&mdash;shame on you.<a data-primary="third-party JavaScript, using" data-type="indexterm" id="calibre_link-1474" class="calibre4"></a><a data-primary="JavaScript" data-secondary="interoperating with" data-tertiary="using third-party JavaScript" data-type="indexterm" id="calibre_link-1157" class="calibre4"></a></p>
</div>

<p class="author1">When you <code class="calibre14">npm install</code> third-party JavaScript<a data-primary="NPM package manager" data-secondary="installing third-party JavaScript" data-type="indexterm" id="calibre_link-1285" class="calibre4"></a> code into your project, there are three possible scenarios:</p>
<ol class="calibre31">
<li class="calibre32">
<p class="author1">The code you installed comes with type declarations out of the box.</p>
</li>
<li class="calibre32">
<p class="author1">The code you installed doesn’t come with type declarations, but declarations are available on DefinitelyTyped.</p>
</li>
<li class="calibre32">
<p class="author1">The code you installed doesn’t come with type declarations, and declarations are not available on DefinitelyTyped.</p>
</li>

</ol>

<p class="author1">Let’s dig into each of these.</p>








<section data-pdf-bookmark="JavaScript That Comes with Type Declarations" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1926">
<h2 class="calibre17">JavaScript That Comes with Type Declarations</h2>

<p class="author1">You know that a package comes with type declarations out of the box if you <code class="calibre14">import</code> it with <code class="calibre14">{"noImplicitAny": true}</code> and TypeScript doesn’t throw a red squiggly at you.</p>

<p class="author1">If the code you’re installing is compiled from TypeScript, or its authors were kind enough to include type declarations in its NPM package, then you’re in luck. Just install the code and start using it with full type support.</p>

<p class="author1">Some examples of NPM packages that come with built-in type declarations are:</p>

<pre data-code-language="sh" data-type="programlisting" class="calibre30">npm install rxjs
npm install ava
npm install @angular/cli</pre>
<div data-type="warning" type="warning" class="calibre23"><h6 class="calibre24">Warning</h6>
<p class="author1">Unless the code you’re installing was actually compiled from TypeScript, you always run the risk that the type declarations it comes with don’t match up to the code those declarations describe. When type declarations come packaged with source code the risk of this happening is pretty low (especially for popular packages), but it’s something to be aware of.</p>
</div>
</div></section>













<section data-pdf-bookmark="JavaScript That Has Type Declarations on DefinitelyTyped" data-type="sect2" class="preface"><div class="preface" id="calibre_link-340">
<h2 class="calibre17">JavaScript That Has Type Declarations on DefinitelyTyped</h2>

<p class="author1">Even if the third-party code you’re importing doesn’t come with type declarations, declarations for it are probably available on <a href="https://github.com/DefinitelyTyped/DefinitelyTyped" class="calibre4">DefinitelyTyped</a>, TypeScript’s community-maintained, centralized repository for ambient module declarations for open source projects.<a data-primary="DefinitelyTyped" data-secondary="JavaScript with type declarations on" data-type="indexterm" id="calibre_link-835" class="calibre4"></a><a data-primary="type declarations" data-secondary="in JavaScript on DefinitelyTyped" data-type="indexterm" id="calibre_link-1567" class="calibre4"></a></p>

<p class="author1">To check if the package you installed has type declarations available on DefinitelyTyped, either search on <a href="https://microsoft.github.io/TypeSearch/" class="calibre4">TypeSearch</a> or just try <a data-primary="TypeSearch" data-type="indexterm" id="calibre_link-1710" class="calibre4"></a>installing the declarations. All DefinitelyTyped type declarations are published to NPM under the <code class="calibre14">@types</code> scope, so you can just <code class="calibre14">npm install</code> from that scope:</p>

<pre data-code-language="sh" data-type="programlisting" class="calibre30">npm install lodash --save            <code class="c1"># Install Lodash</code>
npm install @types/lodash --save-dev <code class="c1"># Install type declarations for Lodash</code></pre>

<p class="author1">Most of the time, you’ll want to use <code class="calibre14">npm install</code>’s <code class="calibre14">--save-dev</code> flag to add your installed type declarations to your <em class="calibre5">package.json</em>’s <code class="calibre14">devDependencies</code> field.</p>
<div data-type="note" type="note" class="calibre21"><h6 class="calibre22">Note</h6>
<p class="author1">Since type declarations on DefinitelyTyped are community-maintained, they run the risk of being incomplete, inaccurate, or stale. While most popular packages have well-maintained type declarations, if you find that the declarations you’re using can be improved, take the time to improve them and <a href="http://bit.ly/2U7QYWP" class="calibre4">contribute them back to DefinitelyTyped</a> so other TypeScript users can take advantage of your hard work.</p>
</div>
</div></section>













<section data-pdf-bookmark="JavaScript That Doesn’t Have Type Declarations on DefinitelyTyped" data-type="sect2" class="preface"><div class="preface" id="calibre_link-494">
<h2 class="calibre17">JavaScript That Doesn’t Have Type Declarations on DefinitelyTyped</h2>

<p class="author1">This is the least common case of the three.<a data-primary="DefinitelyTyped" data-secondary="JavaScript without type declarations on" data-type="indexterm" id="calibre_link-836" class="calibre4"></a><a data-primary="type declarations" data-secondary="JavaScript code without on DefinitelyTyped" data-type="indexterm" id="calibre_link-1568" class="calibre4"></a><a data-primary="modules" data-secondary="untyped, importing from third-party JavaScript" data-type="indexterm" id="calibre_link-1234" class="calibre4"></a> You have several options here, from the cheapest and least safe to the most time-intensive and safest:</p>
<ol class="calibre31">
<li class="calibre32">
<p class="author1"><em class="calibre5">Whitelist the specific import</em> by adding a <code class="calibre14">// @ts-ignore</code> directive above your untyped import.<a data-primary="imports" data-secondary="whitelisting an untyped import" data-type="indexterm" id="calibre_link-1103" class="calibre4"></a><a data-primary="@ts-ignore comment" data-type="indexterm" id="calibre_link-590" class="calibre4"></a> TypeScript will let you use the untyped module, but the module and all of its contents will be typed as <code class="calibre14">any</code>:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// @ts-ignore</code>
<code class="kd">import</code> <code class="nx">Unsafe</code> <code class="nx">from</code> <code class="s">'untyped-module'</code>

<code class="nx">Unsafe</code>  <code class="c">// any</code></pre>
</li>
<li class="calibre32">
<p class="author1"><em class="calibre5">Whitelist all usages of this module</em> by creating an empty type declaration file and stubbing out the module. For example, if you installed the rarely used package <code class="calibre14">nearby-ferret-alerter</code>, you could make a new type declaration (e.g., <em class="calibre5">types.d.ts</em>) and add to it the ambient type declaration:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// types.d.ts</code>
<code class="kd">declare</code> <code class="nx">module</code> <code class="s">'nearby-ferret-alerter'</code></pre>

<p class="author1">This tells TypeScript that there exists a module that you can import (<code class="calibre14">import alert from 'nearby-ferret-alerter'</code>), but it doesn’t tell TypeScript anything about the types contained in that module. This approach is a slightly better alternative to the first, in that now there’s a central <em class="calibre5">types.d.ts</em> file that enumerates all the untyped modules in your application, but it’s equally unsafe because <code class="calibre14">nearby-ferret-alerter</code> and all of its exports will still be typed as <code class="calibre14">any</code>.</p>
</li>
<li class="calibre32">
<p class="author1"><em class="calibre5">Create an ambient module declaration</em>. Like <a data-primary="ambient module declarations" data-secondary="creating for third-party JavaScript" data-type="indexterm" id="calibre_link-610" class="calibre4"></a>in the previous approach, create a file called <em class="calibre5">types.d.ts</em> and add an empty declaration (<code class="calibre14">declare module 'nearby-ferret-alerter'</code>). Now, fill in the type declaration. For example, the result might look like this:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// types.d.ts</code>
<code class="kd">declare</code> <code class="nx">module</code> <code class="s">'nearby-ferret-alerter'</code> <code class="p">{</code>
  <code class="kd">export</code> <code class="kd">default</code> <code class="kd">function</code> <code class="nx">alert</code><code class="p">(</code><code class="nx">loudness</code><code class="o">:</code> <code class="s">'soft'</code> <code class="o">|</code> <code class="s">'loud'</code><code class="p">)</code><code class="o">:</code> <code class="nx">Promise</code><code class="o">&lt;</code><code class="kd">void</code><code class="o">&gt;</code>
  <code class="kd">export</code> <code class="kd">function</code> <code class="nx">getFerretCount</code><code class="p">()</code><code class="o">:</code> <code class="nx">Promise</code><code class="o">&lt;</code><code class="kt">number</code><code class="o">&gt;</code>
<code class="p">}</code></pre>

<p class="author1">Now when you <code class="calibre14">import alert from 'nearby-ferret-alerter'</code>, TypeScript will know exactly what <code class="calibre14">alert</code>’s type is. It’s no longer an <code class="calibre14">any</code>, but <code class="calibre14">(loudness: 'quiet' | 'loud') =&gt; Promise&lt;void&gt;</code>.</p>
</li>
<li class="calibre32">
<p class="author1"><em class="calibre5">Create a type declaration and contribute it back to NPM</em>. If you got as far as the third option and now have a local type declaration <a data-primary="NPM package manager" data-secondary="sending type declaration to" data-type="indexterm" id="calibre_link-1288" class="calibre4"></a><a data-primary="type declarations" data-secondary="creating for third-party JavaScript and sending to NPM" data-type="indexterm" id="calibre_link-1563" class="calibre4"></a>for your module, consider contributing it back to NPM so the next person that needs type declarations for the awesome <code class="calibre14">nearby-ferret-alerter</code> package can use it too. To do this you can either submit a pull request to the <code class="calibre14">nearby-ferret-alerter</code> Git repository and contribute the type declarations directly, or, if the maintainers of that repository don’t want to be on the hook for maintaining TypeScript type declarations, contribute your declarations to DefinitelyTyped instead.</p>
</li>

</ol>

<p class="author1">Writing type declarations for third-party JavaScript is straightforward, but how it’s done depends on the type of module you’re typing. There are a few common patterns that come up when typing different kinds of JavaScript modules (from NodeJS modules to jQuery augmentations and Lodash mixins to React and Angular components). Head over to <a data-type="xref" href="#calibre_link-499" class="calibre4">Appendix&nbsp;D</a> for a list of recipes for typing third-party JavaScript modules.</p>
<div data-type="note" type="note" class="calibre21"><h6 class="calibre22">Note</h6>
<p class="author1">Automatically generating type declarations for untyped JavaScript is an active area of research. Check out <a href="https://www.npmjs.com/package/dts-gen" class="calibre4"><code class="calibre14">dts-gen</code></a>  for a way to automatically generate type declaration scaffolding for any third-party JavaScript <span class="calibre">modul</span>e.<a data-primary="third-party JavaScript, using" data-startref="ix_thirdJS" data-type="indexterm" id="calibre_link-1475" class="calibre4"></a><a data-primary="JavaScript" data-secondary="interoperating with" data-startref="ix_JSinter3rd" data-tertiary="using third-party JavaScript" data-type="indexterm" id="calibre_link-1158" class="calibre4"></a></p>
</div>
</div></section>





</div></section>













<section data-pdf-bookmark="Summary" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1927">
<h1 class="calibre13">Summary</h1>

<p class="author1">There are a few ways to use JavaScript<a data-primary="JavaScript" data-secondary="interoperating with" data-tertiary="ways to use JavaScript from TypeScript" data-type="indexterm" id="calibre_link-1161" class="calibre4"></a> from TypeScript. <a data-type="xref" href="#calibre_link-500" class="calibre4">Table&nbsp;11-1</a> summarizes the options.</p>
<table id="calibre_link-500" class="stafflist_table">
<caption class="calibre35"><span class="calibre">Table 11-1. </span>Ways to use JavaScript from TypeScript</caption>
<thead class="calibre36">
<tr class="calibre7">
<th class="calibre37">Approach</th>
<th class="calibre37">tsconfig.json flags</th>
<th class="calibre37">Type safety</th>
</tr>
</thead>
<tbody class="calibre6">
<tr class="calibre7">
<td class="calibre8"><p class="author1">Import untyped JavaScript</p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">{"allowJs": true}</code></p></td>
<td class="calibre8"><p class="author1">Poor</p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1">Import and check JavaScript</p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">{"allowJs": true, "checkJs": true}</code></p></td>
<td class="calibre8"><p class="author1">OK</p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1">Import and check JSDoc-annotated JavaScript</p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">{"allowJs": true, "checkJs": true, "strict": true}</code></p></td>
<td class="calibre8"><p class="author1">Excellent</p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1">Import JavaScript with type declarations</p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">{"allowJs": false, "strict": true}</code></p></td>
<td class="calibre8"><p class="author1">Excellent</p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1">Import TypeScript</p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">{"allowJs": false, "strict": true}</code></p></td>
<td class="calibre8"><p class="author1">Excellent</p></td>
</tr>
</tbody>
</table>

<p class="author1">In this chapter we covered various aspects of using JavaScript and TypeScript together, from the different kinds of type declarations and how to use them, to migrating your existing JavaScript project to TypeScript piece by piece, to using third-party JavaScript safely (and unsafely). Interoperating with JavaScript can be one of the trickiest aspects of TypeScript; with all the tools at your disposal, you’re now equipped to do it in your own project.<a data-primary="JavaScript" data-secondary="interoperating with" data-startref="ix_JSinter" data-type="indexterm" id="calibre_link-1152" class="calibre4"></a></p>
</div></section>







<div data-type="footnotes" class="calibre26"><p data-type="footnote" id="calibre_link-493" class="calibre27"><sup class="calibre28"><a href="#calibre_link-501" class="calibre16">1</a></sup> Wildcard matching with <code class="calibre14">*</code> follows the same rules as regular <a href="https://en.wikipedia.org/wiki/Glob_(programming)" class="calibre4">glob pattern matching.</a></p><p data-type="footnote" id="calibre_link-495" class="calibre27"><sup class="calibre28"><a href="#calibre_link-502" class="calibre16">2</a></sup> DefinitelyTyped is the open source repository for JavaScript type declarations. Read on to learn more.</p><p data-type="footnote" id="calibre_link-496" class="calibre27"><sup class="calibre28"><a href="#calibre_link-503" class="calibre16">3</a></sup> For really big projects it can be slow to run every single file through TSC. For a way to improve performance for large projects, see <a data-type="xref" href="#calibre_link-491" class="calibre48">“Project References”</a>.</p><p data-type="footnote" id="calibre_link-498" class="calibre27"><sup class="calibre28"><a href="#calibre_link-504" class="calibre16">4</a></sup> Strictly speaking, this is true for module-mode, but not script-mode, files. Read more in <a data-type="xref" href="#calibre_link-330" class="calibre48">“Module Mode Versus Script Mode”</a>.</p></div></div></section></div>

<div data-type="book" class="calibre1" id="calibre_link-505"><section data-pdf-bookmark="Chapter 12. Building and Running TypeScript" data-type="chapter" type="chapter" class="preface"><div class="preface" id="calibre_link-27">
<h1 class="calibre12"><span class="calibre">Chapter 12. </span>Building and Running TypeScript</h1>


<p class="author1">If you’ve deployed and run a JavaScript application in production, then you know how to run a TypeScript application too&mdash;once you compile it to JavaScript, the two aren’t so different. This chapter is about productionizing and building TypeScript applications, but there isn’t much here that’s unique to TypeScript apps&mdash;it mostly applies to JavaScript applications too. We’ll divide it up into four sections, covering:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">The things you have to do to build any TypeScript application</p>
</li>
<li class="calibre11">
<p class="author1">Building and running TypeScript applications on the server</p>
</li>
<li class="calibre11">
<p class="author1">Building and running TypeScript applications in the browser</p>
</li>
<li class="calibre11">
<p class="author1">Building for and publishing your TypeScript application to NPM</p>
</li>
</ul>






<section data-pdf-bookmark="Building Your TypeScript Project" data-type="sect1" class="preface"><div class="preface" id="calibre_link-436">
<h1 class="calibre13">Building Your TypeScript Project</h1>

<p class="author1">Building a TypeScript project is straightforward.<a data-primary="TypeScript" data-secondary="building a project" data-type="indexterm" id="calibre_link-1676" class="calibre4"></a> In this section, we’ll cover the core ideas you’ll need to understand in order to build your project for whatever environment you plan to run it in.</p>








<section data-pdf-bookmark="Project Layout" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1928">
<h2 class="calibre17">Project Layout</h2>

<p class="author1">I suggest keeping your source TypeScript code in a top-level <em class="calibre5">src/</em> folder, and compiling it to a top-level <em class="calibre5">dist/</em> folder.<a data-primary="TypeScript" data-secondary="building a project" data-tertiary="project layout" data-type="indexterm" id="calibre_link-1683" class="calibre4"></a><a data-primary="folder structure for TypeScript projects" data-type="indexterm" id="calibre_link-1008" class="calibre4"></a> This folder structure is a popular convention, and splitting your source code and generated code into two top-level folders can make your life easier down the line, when you’re integrating with other tooling. It also makes it easier to exclude generated artifacts from source control.</p>

<p class="author1">Try to stick to this convention when you can:</p>

<pre data-type="programlisting" class="calibre30">my-app/
├──dist/
│ ├──index.d.ts
│ ├──index.js
│ └──services/
│   ├──foo.d.ts
│   ├──foo.js
│   ├──bar.d.ts
│   └──bar.js
├──src/
│ ├──index.ts
│ └──services/
│   ├──foo.ts
│   └──bar.ts</pre>
</div></section>













<section data-pdf-bookmark="Artifacts" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1929">
<h2 class="calibre17">Artifacts</h2>

<p class="author1">When you compile a TypeScript<a data-primary="TypeScript" data-secondary="building a project" data-tertiary="artifacts generated by TSC" data-type="indexterm" id="calibre_link-1678" class="calibre4"></a><a data-primary="TSC compiler" data-secondary="artifacts generated by" data-type="indexterm" id="calibre_link-1498" class="calibre4"></a><a data-primary="JavaScript" data-secondary="TypeScript program compiled to" data-type="indexterm" id="calibre_link-1168" class="calibre4"></a> program to JavaScript, there are a few different artifacts that TSC can generate for you (<a data-type="xref" href="#calibre_link-506" class="calibre4">Table&nbsp;12-1</a>).</p>
<table id="calibre_link-506" class="stafflist_table">
<caption class="calibre35"><span class="calibre">Table 12-1. </span>Artifacts that TSC can generate for you</caption>
<thead class="calibre36">
<tr class="calibre7">
<th class="calibre37">Type</th>
<th class="calibre37">File extension</th>
<th class="calibre37">tsconfig.json flag</th>
<th class="calibre37">Emitted by default?</th>
</tr>
</thead>
<tbody class="calibre6">
<tr class="calibre7">
<td class="calibre8"><p class="author1"><strong class="calibre38">JavaScript</strong></p></td>
<td class="calibre8"><p class="author1"><em class="calibre5">.js</em></p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">{"emitDeclarationOnly": false}</code></p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1"><strong class="calibre38">Source maps</strong></p></td>
<td class="calibre8"><p class="author1"><em class="calibre5">.js.map</em></p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">{"sourceMap": true}</code></p></td>
<td class="calibre8"><p class="author1">No</p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1"><strong class="calibre38">Type declarations</strong></p></td>
<td class="calibre8"><p class="author1"><em class="calibre5">.d.ts</em></p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">{"declaration": true}</code></p></td>
<td class="calibre8"><p class="author1">No</p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1"><strong class="calibre38">Declaration maps</strong></p></td>
<td class="calibre8"><p class="author1"><em class="calibre5">.d.ts.map</em></p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">{"declarationMap": true}</code></p></td>
<td class="calibre8"><p class="author1">No</p></td>
</tr>
</tbody>
</table>

<p class="author1">The first type of artifact&mdash;JavaScript files&mdash;should be familiar. TSC compiles your TypeScript code to JavaScript that you can then run using a JavaScript platform like NodeJS or Chrome. If you run <code class="calibre14">tsc yourfile.ts</code>, TSC will typecheck <em class="calibre5">yourfile.ts</em> and compile it to JavaScript.</p>

<p class="author1">The second type of artifact&mdash;source maps&mdash;is special files<a data-primary="source maps" data-type="indexterm" id="calibre_link-1439" class="calibre4"></a> that link each piece of your generated JavaScript back to the specific line and column of the TypeScript file that it was generated from. This is helpful for debugging your code (Chrome DevtTools will show your TypeScript code, instead of the generated JavaScript), and for mapping lines and columns in JavaScript exception stack traces back to TypeScript (tools like those mentioned in <a data-type="xref" href="#calibre_link-507" class="calibre4">“Error Monitoring”</a> do this lookup automatically if you give them your source maps).</p>

<p class="author1">The third artifact&mdash;type declarations&mdash;lets other<a data-primary="type declarations" data-type="indexterm" id="calibre_link-1559" class="calibre4"></a> TypeScript projects take advantage of your generated types.</p>

<p class="author1">Finally, declaration maps are used to speed up compilation times for your TypeScript projects.<a data-primary="declaration maps" data-type="indexterm" id="calibre_link-818" class="calibre4"></a> You’ll read more about them in <a data-type="xref" href="#calibre_link-491" class="calibre4">“Project References”</a>. We’ll spend the rest of this chapter talking about how and why to generate these artifacts.</p>
</div></section>













<section data-pdf-bookmark="Dialing In Your Compile Target" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1930">
<h2 class="calibre17">Dialing In Your Compile Target</h2>

<p class="author1">JavaScript can be an unusual language to work with: not only does it have a quickly evolving<a data-primary="compile target for TypeScript projects" data-type="indexterm" id="calibre_link-771" class="calibre4"></a><a data-primary="JavaScript" data-secondary="compile target for TypeScript projects" data-type="indexterm" id="calibre_link-1144" class="calibre4"></a><a data-primary="TypeScript" data-secondary="building a project" data-tertiary="dialing in your compile target" data-type="indexterm" id="calibre_link-1679" class="calibre4"></a> specification with a yearly release cycle, but, as a programmer, you can’t always control which JavaScript version the platform you’re running your program on implements. On top of that, many JavaScript programs are <em class="calibre5">isomorphic</em>, meaning you can run them on either the server or the client.<a data-primary="isomorphic programs" data-type="indexterm" id="calibre_link-1134" class="calibre4"></a> For example:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">If you run your backend JavaScript program on a server that you control, then you can control exactly which JavaScript version it will run on.</p>
</li>
<li class="calibre11">
<p class="author1">If you then release your backend JavaScript program as an open source project, you don’t know which JavaScript version will be supported by your consumers’ JavaScript platforms. The best you can do in a NodeJS environment is declare a range of supported NodeJS versions, but in a browser environment you’re out of luck.</p>
</li>
<li class="calibre11">
<p class="author1">If you run your JavaScript in a browser, you have no idea which browser people will use to run it&mdash;the latest Chrome, Firefox, or Edge that supports most modern JavaScript features, a slightly outdated version of one of those browsers that’s missing some bleeding-edge functionality, an antiquated browser like Internet Explorer 8, or an embedded browser like the one that runs on the PlayStation 4 in your garage. The best you can do is define a minimum set of features that people’s browsers need to support to run your application, ship polyfills for as many of those features as you can, and try to detect when users are on really old browsers that your app won’t run on and show them a message saying that they need to upgrade.</p>
</li>
<li class="calibre11">
<p class="author1">If you release an isomorphic JavaScript library (e.g., a logging library that runs on both browser and server), then you have to support both a minimum NodeJS version and a swath of browser JavaScript engines and versions.</p>
</li>
</ul>

<p class="author1">Not every JavaScript environment supports every JavaScript feature out of the box, but you should still try to write code in the latest language version. There are two ways to do this:</p>
<ol class="calibre31">
<li class="calibre32">
<p class="author1"><em class="calibre5">Transpile</em> (i.e., automatically convert) applications from the latest version of JavaScript to the oldest JavaScript version that a platform you target supports<a data-primary="transpiling" data-type="indexterm" id="calibre_link-1483" class="calibre4"></a>. We do this for language features like <code class="calibre14">for..of</code> loops and <code class="calibre14">async</code>/<code class="calibre14">await</code>, which can be automatically converted to <code class="calibre14">for</code> loops and <code class="calibre14">.then</code> calls, respectively.</p>
</li>
<li class="calibre32">
<p class="author1"><em class="calibre5">Polyfill</em> (i.e., provide implementations for) any modern features that are missing in the JavaScript runtime you’re running on.<a data-primary="polyfills" data-type="indexterm" id="calibre_link-1351" class="calibre4"></a> We do this for features provided by the JavaScript standard library (like <code class="calibre14">Promise</code>, <code class="calibre14">Map</code>, and <code class="calibre14">Set</code>) and for prototype methods (like <code class="calibre14">Array.prototype.includes</code> and <code class="calibre14">Function.prototype.bind</code>).</p>
</li>

</ol>

<p class="author1">TSC has built-in support for transpiling your code to older JavaScript versions, but it will not automatically polyfill your code. <a data-primary="transpiling" data-secondary="TSC support for transpiling code to older JavaScript versions" data-type="indexterm" id="calibre_link-1485" class="calibre4"></a>This is worth reiterating: TSC will transpile most JavaScript features for older environments, but it will not provide implementations for missing features.</p>

<p class="author1">TSC gives you three settings<a data-primary="TSC compiler" data-secondary="setting to dial in environments to target" data-type="indexterm" id="calibre_link-1525" class="calibre4"></a> to dial in which environments you want to target:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1"><code class="calibre14">target</code> sets the JavaScript version you want to transpile to: <code class="calibre14">es5</code>, <code class="calibre14">es2015</code>, etc.<a data-primary="target setting (TSC)" data-type="indexterm" id="calibre_link-1469" class="calibre4"></a></p>
</li>
<li class="calibre11">
<p class="author1"><code class="calibre14">module</code> sets the module system you want to target: <code class="calibre14">es2015</code> modules, <code class="calibre14">commonjs</code> modules, <code class="calibre14">systemjs</code> modules, etc.<a data-primary="CommonJS module setting (TSC)" data-type="indexterm" id="calibre_link-765" class="calibre4"></a><a data-primary="module setting (TSC)" data-type="indexterm" id="calibre_link-1213" class="calibre4"></a></p>
</li>
<li class="calibre11">
<p class="author1"><code class="calibre14">lib</code> tells TypeScript which JavaScript features are available in the environments you’re targeting: <code class="calibre14">es5</code> features, <code class="calibre14">es2015</code> features, the <code class="calibre14">dom</code>, etc.<a data-primary="lib setting (TSC)" data-type="indexterm" id="calibre_link-1192" class="calibre4"></a> It doesn’t actually implement these features&mdash;that’s what polyfills are for&mdash;but it does tell TypeScript that the features are available (either natively or via a polyfill).</p>
</li>
</ul>

<p class="author1">The environment you plan to run your application in dictates which JavaScript version you should transpile to with <code class="calibre14">target</code> and what to set <code class="calibre14">lib</code> to. If you’re not sure, <code class="calibre14">es5</code> is usually a safe default for both. What you set <code class="calibre14">module</code> to depends on whether you’re targeting a NodeJS or browser environment, and what module loader you’re using if the latter.</p>
<div data-type="tip" class="calibre21"><h6 class="calibre22">Tip</h6>
<p class="author1">If you need to support an unusual set of platforms, look up which JavaScript features your target platforms support natively in Juriy Zaytsev’s (aka Kangax’s) <a href="http://kangax.github.io/compat-table/es5/" class="calibre4">compatibility tables</a>.</p>
</div>

<p class="author1">Let’s dig a little deeper into <code class="calibre14">target</code> and <code class="calibre14">lib</code>; we’ll leave <code class="calibre14">module</code> to the sections on <a data-type="xref" href="#calibre_link-472" class="calibre4">“Running TypeScript on the Server”</a> and <a data-type="xref" href="#calibre_link-473" class="calibre4">“Running TypeScript in the Browser”</a>.</p>










<section data-pdf-bookmark="target" data-type="sect3" class="preface"><div class="preface" id="calibre_link-1931">
<h3 class="calibre39">target</h3>

<p class="author1">TSC’s built-in transpiler supports converting most JavaScript features to older JavaScript versions,<a data-primary="compile target for TypeScript projects" data-secondary="target setting" data-type="indexterm" id="calibre_link-773" class="calibre4"></a><a data-primary="transpiling" data-secondary="JavaScript features TSC does/does not transpile for" data-type="indexterm" id="calibre_link-1484" class="calibre4"></a> meaning you can write your code in the latest TypeScript version and transpile it down to whatever JavaScript version you need to support. Since TypeScript supports the latest JavaScript features (like <code class="calibre14">async</code>/<code class="calibre14">await</code>, which is not yet supported by all major JavaScript platforms at the time of writing), you’ll almost always find yourself taking advantage of this built-in transpiler to convert your code to something that NodeJS and browsers understand today.</p>

<p class="author1">Let’s take a look at which specific JavaScript features TSC does and does not transpile for older JavaScript versions (<a data-type="xref" href="#calibre_link-508" class="calibre4">Table&nbsp;12-2</a> and <a data-type="xref" href="#calibre_link-509" class="calibre4">Table&nbsp;12-3</a>).<sup class="calibre15"><a data-type="noteref" href="#calibre_link-510" id="calibre_link-518" class="calibre16">1</a></sup></p>
<div data-type="note" type="note" class="calibre21"><h6 class="calibre22">Note</h6>
<p class="author1">In the past, there was a new revision of the JavaScript language released every few years,<a data-primary="JavaScript" data-secondary="compile target for TypeScript projects" data-tertiary="language versions and releases" data-type="indexterm" id="calibre_link-1146" class="calibre4"></a> with an incrementing language version (ES1, ES3, ES5, ES6). As of 2015, the JavaScript language now has a yearly release cycle, with each language version named after the year it’s released in (ES2015, ES2016, and so on). <a data-primary="ESNext features" data-type="indexterm" id="calibre_link-971" class="calibre4"></a>Some JavaScript features, however, get TypeScript support before they’re actually slated for a specific JavaScript version; we refer to these features as “ESNext” (as in, the next revision).</p>
</div>
<table id="calibre_link-508" class="stafflist_table">
<caption class="calibre35"><span class="calibre">Table 12-2. </span>TSC does transpile</caption>
<thead class="calibre36">
<tr class="calibre7">
<th class="calibre37">Version</th>
<th class="calibre37">Feature</th>
</tr>
</thead>
<tbody class="calibre6">
<tr class="calibre7">
<td class="calibre8"><p class="author1">ES2015</p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">const</code>, <code class="calibre14">let</code>, <code class="calibre14">for..of</code> loops, array/object spread (<code class="calibre14">...</code>), tagged template strings, classes, generators, arrow functions, function default parameters, function rest parameters, destructuring declarations/assignments/parameters</p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1">ES2016</p></td>
<td class="calibre8"><p class="author1">Exponentiation operator (<code class="calibre14">**</code>)</p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1">ES2017</p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">async</code> functions, <code class="calibre14">await</code>ing promises</p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1">ES2018</p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">async</code> iterators</p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1">ES2019</p></td>
<td class="calibre8"><p class="author1">Optional parameter in catch clause</p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1">ESNext</p></td>
<td class="calibre8"><p class="author1">Numeric separators (<code class="calibre14">123_456</code>)</p></td>
</tr>
</tbody>
</table>
<table id="calibre_link-509" class="stafflist_table">
<caption class="calibre35"><span class="calibre">Table 12-3. </span>TSC does not transpile</caption>
<thead class="calibre36">
<tr class="calibre7">
<th class="calibre37">Version</th>
<th class="calibre37">Feature</th>
</tr>
</thead>
<tbody class="calibre6">
<tr class="calibre7">
<td class="calibre8"><p class="author1">ES5</p></td>
<td class="calibre8"><p class="author1">Object getters/setters</p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1">ES2015</p></td>
<td class="calibre8"><p class="author1">Regex <code class="calibre14">y</code> and <code class="calibre14">u</code> flags</p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1">ES2018</p></td>
<td class="calibre8"><p class="author1">Regex <code class="calibre14">s</code> flag</p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1">ESNext</p></td>
<td class="calibre8"><p class="author1">BigInt (<code class="calibre14">123n</code>)</p></td>
</tr>
</tbody>
</table>

<p class="author1">To set the transpilation target, pop open your <em class="calibre5">tsconfig.json</em> and set the <code class="calibre14">target</code> field to:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1"><code class="calibre14">es3</code> for ECMAScript 3</p>
</li>
<li class="calibre11">
<p class="author1"><code class="calibre14">es5</code> for ECMAScript 5 (this is a good default if you’re not sure what to use)</p>
</li>
<li class="calibre11">
<p class="author1"><code class="calibre14">es6</code> or <code class="calibre14">es2015</code> for ECMAScript 2015</p>
</li>
<li class="calibre11">
<p class="author1"><code class="calibre14">es2016</code> for ECMAScript 2016</p>
</li>
<li class="calibre11">
<p class="author1"><code class="calibre14">es2017</code> for ECMAScript 2017</p>
</li>
<li class="calibre11">
<p class="author1"><code class="calibre14">es2018</code> for ECMAScript 2018</p>
</li>
<li class="calibre11">
<p class="author1"><code class="calibre14">esnext</code> for whatever the most recent ECMAScript revision is</p>
</li>
</ul>

<p class="author1">For example, to compile to ES5:</p>

<pre data-code-language="json" data-type="programlisting" class="calibre30"><code class="p">{</code>
  <code class="nt">"compilerOptions"</code><code class="p">:</code> <code class="p">{</code>
    <code class="nt">"target"</code><code class="p">:</code> <code class="s">"es5"</code>
  <code class="p">}</code>
<code class="p">}</code></pre>
</div></section>













<section data-pdf-bookmark="lib" data-type="sect3" class="preface"><div class="preface" id="calibre_link-375">
<h3 class="calibre39">lib</h3>

<p class="author1">As I mentioned, there’s one hitch with transpiling your code to older JavaScript versions: while most language <a data-primary="lib setting (TSC)" data-type="indexterm" id="calibre_link-1193" class="calibre4"></a>features can be safely transpiled (<code class="calibre14">let</code> to <code class="calibre14">var</code>, <code class="calibre14">class</code> to <code class="calibre14">function</code>), you still need to <em class="calibre5">polyfill</em> functionality yourself if your target environment doesn’t support a newer library feature.<a data-primary="polyfills" data-secondary="for target environment not supporting newer library feature" data-type="indexterm" id="calibre_link-1353" class="calibre4"></a> Some examples are utilities like <code class="calibre14">Promise</code> and <code class="calibre14">Reflect</code>, and data structures like <code class="calibre14">Map</code>, <code class="calibre14">Set</code>, and <code class="calibre14">Symbol</code>. When targeting a bleeding-edge environment like the latest Chrome, Firefox, or Edge, you usually won’t need any polyfills; but if you’re targeting browsers a few versions back&mdash;or most NodeJS environments&mdash;you will need to polyfill missing features.</p>

<p class="author1">Thankfully, you won’t need to write polyfills yourself. Instead, you can install them from a popular polyfill library like <a href="https://www.npmjs.com/package/core-js" class="calibre4"><code class="calibre14">core-js</code></a>, or add polyfills to your code automatically by running your typechecked TypeScript code through Babel with <a href="https://babeljs.io/docs/en/babel-polyfill" class="calibre4"><code class="calibre14">@babel/polyfill</code></a>.<a data-primary="core-js library" data-type="indexterm" id="calibre_link-810" class="calibre4"></a><a data-primary="Babel, running typechecked TypeScript code through" data-type="indexterm" id="calibre_link-681" class="calibre4"></a></p>
<div data-type="tip" class="calibre21"><h6 class="calibre22">Tip</h6>
<p class="author1">If you plan to run your application in a browser, be careful not to bloat the size of your JavaScript <a data-primary="browsers" data-secondary="running JavaScript in, polyfills and" data-type="indexterm" id="calibre_link-702" class="calibre4"></a>bundle by including every single polyfill regardless of whether or not the browser you’re running your code in actually needs it&mdash;your target platform probably already supports some of the features you’re polyfilling. Instead, use a service like <a href="https://polyfill.io/v2/docs/" class="calibre4">Polyfill.io</a> to load just those polyfills that your user’s browser needs.</p>
</div>

<p class="author1">Once you’ve added polyfills to your code, it’s time to tell TSC that your environment is guaranteed to support the features you polyfilled&mdash;enter your <em class="calibre5">tsconfig.json</em>’s <code class="calibre14">lib</code> field. For example, you could use this configuration if you’ve polyfilled all ES2015<a data-primary="arrays" data-secondary="Array.prototype.includes (ES2016)" data-type="indexterm" id="calibre_link-645" class="calibre4"></a> features plus ES2016’s <code class="calibre14">Array.prototype.includes</code>:</p>

<pre data-code-language="json" data-type="programlisting" class="calibre30"><code class="p">{</code>
  <code class="nt">"compilerOptions"</code><code class="p">:</code> <code class="p">{</code>
    <code class="nt">"lib"</code><code class="p">:</code> <code class="p">[</code><code class="s">"es2015"</code><code class="p">,</code> <code class="s">"es2016.array.includes"</code><code class="p">]</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p class="author1">If you’re running your code in the browser, <a data-primary="DOM (Document Object Model)" data-secondary="DOM type declarations, enabling" data-type="indexterm" id="calibre_link-850" class="calibre4"></a><a data-primary="type declarations" data-secondary="DOM type declarations, enabling" data-type="indexterm" id="calibre_link-1565" class="calibre4"></a>also enable DOM type declarations for things like <code class="calibre14">window</code>, <code class="calibre14">document</code>, and all the other APIs you get when running your JavaScript in the browser:</p>
<pre data-code-language="js" data-type="programlisting" class="calibre30">
<code class="p">{</code><code class="calibre14">
  </code><code class="s">"compilerOptions"</code><code class="o">:</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="s">"lib"</code><code class="o">:</code><code class="calibre14"> </code><code class="p">[</code><code class="s">"es2015"</code><code class="p">,</code><code class="calibre14"> </code><code class="s">"es2016.array.include"</code><code class="p">,</code><code class="calibre14"> </code><strong class="calibre49"><code class="s1">"dom"</code></strong><code class="p">]</code><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">
</code><code class="p">}</code><code class="calibre14">
</code></pre>

<p class="author1">For a full list of<a data-primary="TypeScript" data-secondary="building a project" data-startref="ix_TSbldcmptrg" data-tertiary="dialing in your compile target" data-type="indexterm" id="calibre_link-1680" class="calibre4"></a><a data-primary="JavaScript" data-secondary="compile target for TypeScript projects" data-startref="ix_JScmptrgt" data-type="indexterm" id="calibre_link-1145" class="calibre4"></a><a data-primary="compile target for TypeScript projects" data-startref="ix_cmptrgt" data-type="indexterm" id="calibre_link-772" class="calibre4"></a> supported libs run <code class="calibre14">tsc --help</code>.</p>
</div></section>



</div></section>













<section data-pdf-bookmark="Enabling Source Maps" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1932">
<h2 class="calibre17">Enabling Source Maps</h2>

<p class="author1">Source maps are a way to link your transpiled code back to the source code it was generated from.<a data-primary="TypeScript" data-secondary="building a project" data-tertiary="enabling source maps" data-type="indexterm" id="calibre_link-1681" class="calibre4"></a><a data-primary="source maps" data-secondary="enabling" data-type="indexterm" id="calibre_link-1440" class="calibre4"></a> Most developer tools (like Chrome DevTools), error reporting and logging frameworks, and build tools know about source maps. Since a typical build pipeline can produce code that’s very different from the code you started with (for example, your pipeline might compile TypeScript to ES5 JavaScript, tree-shake it with Rollup, preevaluate it with Prepack, then minify it with Uglify), using source maps throughout your build pipeline can make it a lot easier to debug the resulting JavaScript.</p>

<p class="author1">It’s generally a good idea to use source maps in development, and ship source maps to production in both browser and server environments. There’s one caveat, though: if you rely on some level of security through obscurity for your browser code, don’t ship source maps to browsers in production.</p>
</div></section>













<section data-pdf-bookmark="Project References" data-type="sect2" class="preface"><div class="preface" id="calibre_link-491">
<h2 class="calibre17">Project References</h2>

<p class="author1">As your application grows, it will take longer and longer for TSC to typecheck and compile your code.<a data-primary="TypeScript" data-secondary="building a project" data-tertiary="project references" data-type="indexterm" id="calibre_link-1684" class="calibre4"></a> This time grows roughly linearly with the size of your codebase. When developing locally, slow incremental compile times can seriously slow down your development, and make working with TypeScript painful.</p>

<p class="author1">To address this,<a data-primary="project references" data-type="indexterm" id="calibre_link-1373" class="calibre4"></a><a data-primary="TSC compiler" data-secondary="project references" data-type="indexterm" id="calibre_link-1522" class="calibre4"></a> TSC comes with a feature called <em class="calibre5">project references</em> that speeds up compilation times dramatically, including incremental compile times. For any project with a few hundred files or more, project references are a must-have.</p>

<p class="author1">Use them like this:</p>
<ol class="calibre31">
<li class="calibre32">
<p class="author1">Split your TypeScript project into multiple projects. A project is simply a folder that contains a <em class="calibre5">tsconfig.json</em> and some TypeScript code. Try to split your code in such a way that code that tends to be updated together lives in the same folder.</p>
</li>
<li class="calibre32">
<p class="author1">In each project folder, create a <em class="calibre5">tsconfig.json</em> that includes at least:</p>

<pre data-code-language="json" data-type="programlisting" class="calibre30"><code class="p">{</code>
  <code class="nt">"compilerOptions"</code><code class="p">:</code> <code class="p">{</code>
    <code class="nt">"composite"</code><code class="p">:</code> <code class="kd">true</code><code class="p">,</code>
    <code class="nt">"declaration"</code><code class="p">:</code> <code class="kd">true</code><code class="p">,</code>
    <code class="nt">"declarationMap"</code><code class="p">:</code> <code class="kd">true</code><code class="p">,</code>
    <code class="nt">"rootDir"</code><code class="p">:</code> <code class="s">"."</code>
  <code class="p">},</code>
  <code class="nt">"include"</code><code class="p">:</code> <code class="p">[</code>
    <code class="s">"./**/*.ts"</code>
  <code class="p">],</code>
  <code class="nt">"references"</code><code class="p">:</code> <code class="p">[</code>
    <code class="p">{</code>
      <code class="nt">"path"</code><code class="p">:</code> <code class="s">"../myReferencedProject"</code><code class="p">,</code>
      <code class="nt">"prepend"</code><code class="p">:</code> <code class="kd">true</code>
    <code class="p">}</code>
  <code class="p">],</code>
<code class="p">}</code></pre>

<p class="author1">The keys here are:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1"><code class="calibre14">composite</code>, which tells TSC that this folder is a subproject of a larger TypeScript project.<a data-primary="composite (compiler option)" data-type="indexterm" id="calibre_link-781" class="calibre4"></a></p>
</li>
<li class="calibre11">
<p class="author1"><code class="calibre14">declaration</code>, which tells TSC to emit <em class="calibre5">.d.ts</em> declaration files for this project.<a data-primary="declaration (compiler option)" data-type="indexterm" id="calibre_link-817" class="calibre4"></a> The way project references work, projects have access to each other’s declaration files and emitted JavaScript, but not their source TypeScript files. This creates a boundary beyond which TSC won’t try to retypecheck or recompile your code: if you update a line of code in your subproject <em class="calibre5">A</em>, TSC doesn’t have to retypecheck your other subproject <em class="calibre5">B</em>; all TSC needs to check for a type error is <em class="calibre5">B</em>’s type declarations. This is the core behavior that makes project references so efficient at rebuilding big projects.</p>
</li>
<li class="calibre11">
<p class="author1"><code class="calibre14">declarationMap</code>, which tells TSC to build source maps for generated type declarations.<a data-primary="declarationMap (compiler option)" data-type="indexterm" id="calibre_link-823" class="calibre4"></a></p>
</li>
<li class="calibre11">
<p class="author1"><code class="calibre14">references</code>, which is an array of subprojects that your subproject depends on. <a data-primary="references (compiler option)" data-type="indexterm" id="calibre_link-1412" class="calibre4"></a>Each reference’s <code class="calibre14">path</code> should point either to a folder that contains a <em class="calibre5">tsconfig.json</em>, or directly to a TSC configuration file (if your configuration file isn’t named <em class="calibre5">tsconfig.json</em>). <code class="calibre14">prepend</code> will concatenate the JavaScript and source maps generated by the subproject you’re referencing to the JavaScript and source maps generated by your subproject. Note that <code class="calibre14">prepend</code> is only useful when you’re using <code class="calibre14">outFile</code>&mdash;if you don’t use <code class="calibre14">outFile</code>, you can ditch the <code class="calibre14">prepend</code>.</p>
</li>
<li class="calibre11">
<p class="author1"><code class="calibre14">rootDir</code>, which explicitly specifies that this subproject should be compiled relative to the root project (<code class="calibre14">.</code>). Alternatively, you can specify an <code class="calibre14">outDir</code> that’s a subfolder of the root project’s <code class="calibre14">outDir</code>.</p>
</li>
</ul>
</li>
<li class="calibre32">
<p class="author1">Create a root <em class="calibre5">tsconfig.json</em> that references any subprojects that aren’t yet referenced by another subproject:</p>

<pre data-code-language="json" data-type="programlisting" class="calibre30"><code class="p">{</code>
  <code class="nt">"files"</code><code class="p">:</code> <code class="p">[],</code>
  <code class="nt">"references"</code><code class="p">:</code> <code class="p">[</code>
    <code class="p">{</code><code class="nt">"path"</code><code class="p">:</code> <code class="s">"./myProject"</code><code class="p">},</code>
    <code class="p">{</code><code class="nt">"path"</code><code class="p">:</code> <code class="s">"./mySecondProject"</code><code class="p">}</code>
  <code class="p">]</code>
<code class="p">}</code></pre>
</li>
<li class="calibre32">
<p class="author1">Now when you compile your project with TSC, use the <code class="calibre14">build</code> flag to tell TSC to take project <a data-primary="build flag (TSC)" data-type="indexterm" id="calibre_link-707" class="calibre4"></a>references into account:</p>

<pre data-code-language="sh" data-type="programlisting" class="calibre30">tsc --build <code class="c1"># Or, tsc -b for short</code></pre>
</li>

</ol>
<div data-type="warning" type="warning" class="calibre23"><h6 class="calibre24">Warning</h6>
<p class="author1">At the time of writing, project references are a new TypeScript feature with some rough edges. When using them, be careful to:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">Rebuild the entire project (with <code class="calibre14">tsc -b</code>) after cloning or refetching it, in order to regenerate any missing or outdated <em class="calibre5">.d.ts</em> files. Alternatively, check in your generated <em class="calibre5">d.ts</em> files.</p>
</li>
<li class="calibre11">
<p class="author1">Not use <code class="calibre14">noEmitOnError: false</code> with project references&mdash;TSC will always hardcode the option to <code class="calibre14">true</code>.</p>
</li>
<li class="calibre11">
<p class="author1">Manually make sure that a given subproject isn’t prepended by more than one other subproject. Otherwise, the doubly prepended subproject will show up twice in your compiled output. Note that if you’re just referencing and not prepending, you’re good to go.</p>
</li>
</ul>
</div>
<aside data-type="sidebar" type="sidebar" class="keyterm"><div class="sidebar" id="calibre_link-1933">
<h5 class="calibre29">Using extends to Reduce tsconfig.json Boilerplate</h5>
<p class="author1">Because you probably want all of your subprojects to share the same compiler options, it’s convenient to create a “base” <em class="calibre5">tsconfig.json</em> in your root directory that<a data-primary="extends option (TSC)" data-type="indexterm" id="calibre_link-1000" class="calibre4"></a> subprojects’ <em class="calibre5">tsconfig.json</em>s can extend:</p>

<pre data-code-language="json" data-type="programlisting" class="calibre30"><code class="p">{</code>
  <code class="nt">"compilerOptions"</code><code class="p">:</code> <code class="p">{</code>
    <code class="nt">"composite"</code><code class="p">:</code> <code class="kd">true</code><code class="p">,</code>
    <code class="nt">"declaration"</code><code class="p">:</code> <code class="kd">true</code><code class="p">,</code>
    <code class="nt">"declarationMap"</code><code class="p">:</code> <code class="kd">true</code><code class="p">,</code>
    <code class="nt">"lib"</code><code class="p">:</code> <code class="p">[</code><code class="s">"es2015"</code><code class="p">,</code> <code class="s">"es2016.array.include"</code><code class="p">],</code>
    <code class="nt">"rootDir"</code><code class="p">:</code> <code class="s">"."</code><code class="p">,</code>
    <code class="nt">"sourceMap"</code><code class="p">:</code> <code class="kd">true</code><code class="p">,</code>
    <code class="nt">"strict"</code><code class="p">:</code> <code class="kd">true</code><code class="p">,</code>
    <code class="nt">"target"</code><code class="p">:</code> <code class="s">"es5"</code><code class="p">,</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p class="author1">Then, update your subprojects to extend it using <em class="calibre5">tsconfig.json</em>’s <code class="calibre14">extends</code> option:</p>

<pre data-code-language="json" data-type="programlisting" class="calibre30"><code class="p">{</code>
  <code class="nt">"extends"</code><code class="p">:</code> <code class="s">"../tsconfig.base"</code><code class="p">,</code>
  <code class="nt">"include"</code><code class="p">:</code> <code class="p">[</code>
    <code class="s">"./**/*.ts"</code>
  <code class="p">],</code>
  <code class="nt">"references"</code><code class="p">:</code> <code class="p">[</code>
    <code class="p">{</code>
      <code class="nt">"path"</code><code class="p">:</code> <code class="s">"../myReferencedProject"</code><code class="p">,</code>
      <code class="nt">"prepend"</code><code class="p">:</code> <code class="kd">true</code>
    <code class="p">}</code>
  <code class="p">],</code>
<code class="p">}</code></pre>
</div></aside>
</div></section>













<section data-pdf-bookmark="Error Monitoring" data-type="sect2" class="preface"><div class="preface" id="calibre_link-507">
<h2 class="calibre17">Error Monitoring</h2>

<p class="author1">TypeScript warns you about errors at compile time,<a data-primary="project references" data-startref="ix_projref" data-type="indexterm" id="calibre_link-1374" class="calibre4"></a><a data-primary="TSC compiler" data-secondary="project references" data-startref="ix_TSCprojref" data-type="indexterm" id="calibre_link-1523" class="calibre4"></a><a data-primary="TypeScript" data-secondary="building a project" data-startref="ix_TSbldprref" data-tertiary="project references" data-type="indexterm" id="calibre_link-1685" class="calibre4"></a><a data-primary="TypeScript" data-secondary="building a project" data-tertiary="error monitoring" data-type="indexterm" id="calibre_link-1682" class="calibre4"></a><a data-primary="errors" data-secondary="monitoring in TypeScript projects" data-type="indexterm" id="calibre_link-890" class="calibre4"></a> but you also need a way to find out about exceptions that your users experience at runtime, so that you can try to prevent them at compile time (or at least fix the bug that caused the runtime error). Use an error monitoring tool like <a href="https://sentry.io" class="calibre4">Sentry</a> or <a href="https://bugsnag.com" class="calibre4">Bugsnag</a> to report and collate your runtime exceptions.<a data-primary="TypeScript" data-secondary="building a project" data-startref="ix_TSbld" data-type="indexterm" id="calibre_link-1677" class="calibre4"></a></p>
</div></section>





</div></section>













<section data-pdf-bookmark="Running TypeScript on the Server" data-type="sect1" class="preface"><div class="preface" id="calibre_link-472">
<h1 class="calibre13">Running TypeScript on the Server</h1>

<p class="author1">To run your TypeScript code in a NodeJS environment,<a data-primary="NodeJS" data-secondary="running TypeScript code in" data-type="indexterm" id="calibre_link-1271" class="calibre4"></a> just compile your code to ES2015 JavaScript (or ES5, if you’re targeting a legacy <a data-primary="TypeScript" data-secondary="running on the server" data-type="indexterm" id="calibre_link-1700" class="calibre4"></a>NodeJS version) with your <em class="calibre5">tsconfig.json</em>’s module flag set to <code class="calibre14">commonjs</code>:</p>

<pre data-code-language="json" data-type="programlisting" class="calibre30"><code class="p">{</code>
  <code class="nt">"compilerOptions"</code><code class="p">:</code> <code class="p">{</code>
    <code class="nt">"target"</code><code class="p">:</code> <code class="s">"es2015"</code><code class="p">,</code>
    <code class="nt">"module"</code><code class="p">:</code> <code class="s">"commonjs"</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p class="author1">That will compile your ES2015 <code class="calibre14">import</code> and <code class="calibre14">export</code> calls to <code class="calibre14">require</code> and <span class="calibre"><code class="calibre14">module.exports</code></span>, respectively, so your code will run on NodeJS with no further bundling needed.</p>

<p class="author1">If you’re using source maps (you should be!), you’ll need to feed your source maps into your NodeJS process. <a data-primary="source maps" data-secondary="feeding into NodeJS process" data-type="indexterm" id="calibre_link-1441" class="calibre4"></a>Just grab the <a href="https://www.npmjs.com/package/source-map-support" class="calibre4"><code class="calibre14">source-map-support</code></a> package from NPM, and follow the package’s setup instructions. Most process monitoring, logging, and error reporting tools like <a href="https://www.npmjs.com/package/pm2" class="calibre4">PM2</a>, <a href="https://www.npmjs.com/package/winston" class="calibre4">Winston</a>, and <a href="https://sentry.io" class="calibre4">Sentry</a> have built-in support for source maps.</p>
</div></section>













<section data-pdf-bookmark="Running TypeScript in the Browser" data-type="sect1" class="preface"><div class="preface" id="calibre_link-473">
<h1 class="calibre13">Running TypeScript in the Browser</h1>

<p class="author1">Compiling TypeScript to run in the browser involves a little more work than running TypeScript on the server.<a data-primary="TypeScript" data-secondary="running in the browser" data-type="indexterm" id="calibre_link-1699" class="calibre4"></a><a data-primary="browsers" data-secondary="running TypeScript code in" data-type="indexterm" id="calibre_link-703" class="calibre4"></a></p>

<p class="author1">First, pick a module system to compile to.<a data-primary="modules" data-secondary="picking module system to compile TypeScript to" data-type="indexterm" id="calibre_link-1231" class="calibre4"></a> A good rule of thumb is to stick to <code class="calibre14">umd</code> when publishing a library for others to use (e.g., on NPM) in order to maximize compatibility with various module bundlers that people might use in their projects.</p>

<p class="author1">If you just plan to use your code yourself without publishing it to NPM, which format you compile to depends on the module bundler you’re using. Check your bundler’s documentation&mdash;for example, Webpack and Rollup work best with ES2015 modules, while Browserify requires CommonJS modules. Here are a few guidelines:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">If you’re using the <a href="https://github.com/systemjs/systemjs" class="calibre4">SystemJS</a> module loader, set <code class="calibre14">module</code> to <code class="calibre14">systemjs</code>.</p>
</li>
<li class="calibre11">
<p class="author1">If you’re running your code through an ES2015-aware module bundler like <a href="https://webpack.js.org" class="calibre4">Webpack</a> or <a href="https://github.com/rollup/rollup" class="calibre4">Rollup</a>, set <code class="calibre14">module</code> to <code class="calibre14">es2015</code> or higher.</p>
</li>
<li class="calibre11">
<p class="author1">If you’re using an ES2015-aware module bundler and your code uses dynamic imports (see <a data-type="xref" href="#calibre_link-511" class="calibre4">“Dynamic Imports”</a>), set <code class="calibre14">module</code> to <code class="calibre14">esnext</code>.</p>
</li>
<li class="calibre11">
<p class="author1">If you’re building a library for other projects to use, and aren’t running your code through any additional build steps after <code class="calibre14">tsc</code>, maximize compatibility with different loaders that people use by setting <code class="calibre14">module</code> to <code class="calibre14">umd</code>.</p>
</li>
<li class="calibre11">
<p class="author1">If you’re bundling your module with a CommonJS bundler like <a href="https://github.com/browserify/browserify" class="calibre4">Browserify</a>, set <code class="calibre14">module</code> to <code class="calibre14">commonjs</code>.</p>
</li>
<li class="calibre11">
<p class="author1">If you’re planning to load your code with <a href="https://requirejs.org" class="calibre4">RequireJS</a> or another AMD module loader, set <code class="calibre14">module</code> to <code class="calibre14">amd</code>.</p>
</li>
<li class="calibre11">
<p class="author1">If you want your top-level exports to be globally available on the <code class="calibre14">window</code> object (as you might if you’re Mussolini’s great-nephew), set <code class="calibre14">module</code> to <code class="calibre14">none</code>. Note that TSC will try to curb your enthusiasm for inflicting pain on other software engineers by compiling to <code class="calibre14">commonjs</code> anyway if your code is in module mode (see <a data-type="xref" href="#calibre_link-330" class="calibre4">“Module Mode Versus Script Mode”</a>).</p>
</li>
</ul>

<p class="author1">Next, configure your build pipeline to compile all your TypeScript to a single JavaScript file (usually called a “bundle”) or a set of JavaScript files.<a data-primary="JavaScript" data-secondary="configuring build pipeline to compile TypeScript code to" data-type="indexterm" id="calibre_link-1147" class="calibre4"></a><a data-primary="outFile TSC flag" data-type="indexterm" id="calibre_link-1332" class="calibre4"></a> While TSC can do this for you for small projects with the <code class="calibre14">outFile</code> TSC flag, the flag is limited to generating SystemJS and AMD bundles.<a data-primary="TSC compiler" data-secondary="generating JavaScript bundles" data-type="indexterm" id="calibre_link-1512" class="calibre4"></a> And since TSC doesn’t support build plugins and intelligent code splitting the same way that a dedicated build tool like Webpack does, you’ll soon find yourself wanting a more powerful bundler.</p>

<p class="author1">That’s why for frontend projects, you should use a more powerful build tool from the beginning.<a data-primary="build tools" data-type="indexterm" id="calibre_link-708" class="calibre4"></a> There are TypeScript plugins for whatever build tool you might be using, such as:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1"><a href="http://bit.ly/2Gw3uH2" class="calibre4"><code class="calibre14">ts-loader</code></a> for <a href="https://webpack.js.org" class="calibre4">Webpack</a></p>
</li>
<li class="calibre11">
<p class="author1"><a href="http://bit.ly/2KOaZgw" class="calibre4"><code class="calibre14">tsify</code></a> for <a href="http://bit.ly/2IDpfGe" class="calibre4">Browserify</a></p>
</li>
<li class="calibre11">
<p class="author1"><a href="http://bit.ly/2vc2Sjy" class="calibre4"><code class="calibre14">@babel/preset-typescript</code></a> for <a href="https://babeljs.io" class="calibre4">Babel</a></p>
</li>
<li class="calibre11">
<p class="author1"><a href="http://bit.ly/2vanubN" class="calibre4"><code class="calibre14">gulp-typescript</code></a> for <a href="https://gulpjs.com" class="calibre4">Gulp</a></p>
</li>
<li class="calibre11">
<p class="author1"><a href="http://bit.ly/2PgUXuq" class="calibre4"><code class="calibre14">grunt-ts</code></a> for <a href="https://gruntjs.com" class="calibre4">Grunt</a></p>
</li>
</ul>

<p class="author1">While a full discussion of optimizing your JavaScript bundle for fast loading is outside the scope of this book,<a data-primary="JavaScript" data-secondary="optimizing bundles for fast loading" data-type="indexterm" id="calibre_link-1165" class="calibre4"></a> some brief advice&mdash;not specific to TypeScript&mdash;is:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">Keep your code modular, and avoid implicit dependencies in your code (these can happen when you assign things to the <code class="calibre14">window</code> global, or to other globals), so that your build tool can more accurately analyze your project’s dependency graph.</p>
</li>
<li class="calibre11">
<p class="author1">Use dynamic imports to lazy-load code that you don’t need for your initial page load, so you don’t unnecessarily block your page from rendering.</p>
</li>
<li class="calibre11">
<p class="author1">Take advantage of your build tool’s automatic code splitting functionality, so that you avoid loading too much JavaScript and slowing page load unnecessarily.</p>
</li>
<li class="calibre11">
<p class="author1">Have a strategy for measuring page load time, either synthetically or, ideally, with real user data. As your app grows the initial load time can get slower and slower; you can only optimize that load time if you have a way to measure it. Tools like <a href="https://newrelic.com" class="calibre4">New Relic</a> and <a href="https://www.datadoghq.com" class="calibre4">Datadog</a> are invaluable here.</p>
</li>
<li class="calibre11">
<p class="author1">Keep your production build as similar as possible to your development build. The more the two diverge, the more hard-to-fix bugs you’ll have that only show up in production.</p>
</li>
<li class="calibre11">
<p class="author1">Finally, when shipping TypeScript to run in the browser, have a strategy for polyfilling missing browser features. This might be a standard set of polyfills you ship as part of every bundle, or it might be a dynamic set of polyfills based on what features the user’s browser supports.</p>
</li>
</ul>
</div></section>













<section data-pdf-bookmark="Publishing Your TypeScript Code to NPM" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1934">
<h1 class="calibre13">Publishing Your TypeScript Code to NPM</h1>

<p class="author1">It’s easy to compile your TypeScript code so that other TypeScript and JavaScript projects can use it.<a data-primary="NPM package manager" data-secondary="publishing TypeScript code to" data-type="indexterm" id="calibre_link-1286" class="calibre4"></a><a data-primary="TypeScript" data-secondary="publishing code to NPM" data-type="indexterm" id="calibre_link-1697" class="calibre4"></a> There are a few best practices to keep in mind when compiling to JavaScript for external use:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">Generate source maps, so you can debug your own code.</p>
</li>
<li class="calibre11">
<p class="author1">Compile to ES5, so that others can easily build and run your code.</p>
</li>
<li class="calibre11">
<p class="author1">Be mindful about which module format you compile to (UMD, CommonJS, ES2015, etc.).</p>
</li>
<li class="calibre11">
<p class="author1">Generate type declarations, so that other TypeScript users have types for your code.</p>
</li>
</ul>

<p class="author1">Start by compiling your TypeScript to JavaScript with <code class="calibre14">tsc</code>, and generate corresponding type declarations. Be sure to configure your <em class="calibre5">tsconfig.json</em> to maximize compatibility with popular JavaScript environments and build systems (more on that in <a data-type="xref" href="#calibre_link-436" class="calibre4">“Building Your TypeScript Project”</a>):</p>

<pre data-code-language="json" data-type="programlisting" class="calibre30"><code class="p">{</code>
<code class="nt">"compilerOptions"</code><code class="p">:</code> <code class="p">{</code>
  <code class="nt">"declaration"</code><code class="p">:</code> <code class="kd">true</code><code class="p">,</code>
  <code class="nt">"module"</code><code class="p">:</code> <code class="s">"umd"</code><code class="p">,</code>
  <code class="nt">"sourceMaps"</code><code class="p">:</code> <code class="kd">true</code><code class="p">,</code>
  <code class="nt">"target"</code><code class="p">:</code> <code class="s">"es5"</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p class="author1">Next, blacklist your TypeScript source code from getting published to NPM in your <em class="calibre5">.npmignore</em>, to avoid bloating the size of your package. And in your <em class="calibre5">.gitignore</em>, exclude generated artifacts from your Git repository to avoid polluting it:</p>

<pre data-code-language="sh" data-type="programlisting" class="calibre30"><code class="c1"># .npmignore</code>

*.ts <code class="c1"># Ignore .ts files</code>
!*.d.ts <code class="c1"># Allow .d.ts files</code></pre>

<pre data-code-language="sh" data-type="programlisting" class="calibre30"><code class="c1"># .gitignore</code>

*.d.ts <code class="c1"># Ignore .d.ts files</code>
*.js <code class="c1"># Ignore .js files</code></pre>
<div data-type="note" type="note" class="calibre21"><h6 class="calibre22">Note</h6>
<p class="author1">If you stuck with the recommended project layout and kept your source files in <em class="calibre5">src/</em> and your generated files in <em class="calibre5">dist/</em>, your <em class="calibre5">.ignore</em> files will be even simpler:</p>

<pre data-code-language="sh" data-type="programlisting" class="calibre43"><code class="c1"># .npmignore</code>

src/ <code class="c1"># Ignore source files</code></pre>

<pre data-code-language="sh" data-type="programlisting" class="calibre43"><code class="c1"># .gitignore</code>

dist/ <code class="c1"># Ignore generated files</code></pre>
</div>

<p class="author1">Finally, add a <code class="calibre14">"types"</code> field to your project’s <em class="calibre5">package.json</em> to indicate that it comes with type declarations (note that this isn’t mandatory, but it is a helpful hint to TSC for any consumers that use TypeScript), and add a script to build your package before publishing it, to make sure that your package’s JavaScript, type declarations, and source maps are always up to date and in sync with the TypeScript you compiled them from:</p>

<pre data-code-language="json" data-type="programlisting" class="calibre30"><code class="p">{</code>
  <code class="nt">"name"</code><code class="p">:</code> <code class="s">"my-awesome-typescript-project"</code><code class="p">,</code>
  <code class="nt">"version"</code><code class="p">:</code> <code class="s">"1.0.0"</code><code class="p">,</code>
  <code class="nt">"main"</code><code class="p">:</code> <code class="s">"dist/index.js"</code><code class="p">,</code>
  <code class="nt">"types"</code><code class="p">:</code> <code class="s">"dist/index.d.ts"</code><code class="p">,</code>
  <code class="nt">"scripts"</code><code class="p">:</code> <code class="p">{</code>
    <code class="nt">"prepublishOnly"</code><code class="p">:</code> <code class="s">"tsc -d"</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p class="author1">That’s it! Now when you <code class="calibre14">npm publish</code> your package to NPM, NPM will automatically compile your TypeScript to a format usable by both people that use TypeScript (with full type safety) and people that use JavaScript (with some type safety, if their code editor supports it).<a data-primary="NPM package manager" data-secondary="publishing TypeScript code to" data-startref="ix_NPMpub" data-type="indexterm" id="calibre_link-1287" class="calibre4"></a><a data-primary="TypeScript" data-secondary="publishing code to NPM" data-startref="ix_TSpub" data-type="indexterm" id="calibre_link-1698" class="calibre4"></a></p>
</div></section>













<section data-pdf-bookmark="Triple-Slash Directives" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1935">
<h1 class="calibre13">Triple-Slash Directives</h1>

<p class="author1">TypeScript comes with a little-known, rarely used, and mostly outdated feature called <em class="calibre5">triple-slash directives</em>.<a data-primary="triple-slash directives" data-type="indexterm" id="calibre_link-1486" class="calibre4"></a><a data-primary="directives" data-secondary="triple-slash" data-type="indexterm" id="calibre_link-843" class="calibre4"></a><a data-primary="TypeScript" data-secondary="triple-slash directives" data-type="indexterm" id="calibre_link-1704" class="calibre4"></a> These directives are specially formatted TypeScript comments that serve as instructions to TSC.</p>

<p class="author1">They come in a few flavors, and in this section, we’ll cover just two of them: <code class="calibre14">types</code>, for eliding type-only full-module imports, and <code class="calibre14">amd-module</code>, for naming generated AMD modules. For a full reference, see <a data-type="xref" href="#calibre_link-512" class="calibre4">Appendix&nbsp;E</a>.</p>








<section data-pdf-bookmark="The types Directive" data-type="sect2" class="preface"><div class="preface" id="calibre_link-471">
<h2 class="calibre17">The types Directive</h2>

<p class="author1">When you import something from a module, depending on what you imported, TypeScript won’t always need to generate an <code class="calibre14">import</code> or <code class="calibre14">require</code> call when you compile your code to JavaScript.<a data-primary="directives" data-secondary="triple-slash" data-tertiary="types" data-type="indexterm" id="calibre_link-847" class="calibre4"></a><a data-primary="types directive" data-type="indexterm" id="calibre_link-1674" class="calibre4"></a><a data-primary="triple-slash directives" data-secondary="types" data-type="indexterm" id="calibre_link-1491" class="calibre4"></a> If you have an <code class="calibre14">import</code> statement whose export is only used in a type position in your module (i.e., you just imported a type from a module), TypeScript won’t generate any JavaScript code for that <code class="calibre14">import</code>&mdash;think of it as only existing at the type level. <a data-primary="imports" data-secondary="import elision" data-type="indexterm" id="calibre_link-1099" class="calibre4"></a>This feature is called <em class="calibre5">import elision</em>.</p>

<p class="author1">The exception to the rule is imports used for side effects: if you import an entire module (without importing a specific export or a wildcard from that module), that import will generate JavaScript code when you compile your TypeScript. You might do this, for instance, if you want to make sure that an ambient type defined in a script-mode module is available in your program (like we did in <a data-type="xref" href="#calibre_link-513" class="calibre4">“Safely Extending the Prototype”</a>). For example:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// global.ts</code>
<code class="nx">type</code> <code class="nx">MyGlobal</code> <code class="o">=</code> <code class="kt">number</code>

<code class="c">// app.ts</code>
<code class="kd">import</code> <code class="s">'./global'</code></pre>

<p class="author1">After compiling <em class="calibre5">app.ts</em> to JavaScript with <code class="calibre14">tsc app.ts</code>, you’ll notice that that the <span class="calibre"><code class="calibre14">./global</code></span> import wasn’t elided:</p>

<pre data-code-language="js" data-type="programlisting" class="calibre30"><code class="c">// app.js</code>
<code class="kd">import</code> <code class="s">'./global'</code></pre>

<p class="author1">If you find yourself writing imports like this, you may want to start by making sure that your import really needs to use side effects, and that there isn’t some other way to rewrite your code to make it more explicit which value or type you’re importing (e.g., <code class="calibre14">import {MyType} from './global'</code>&mdash;which TypeScript will elide for you&mdash;instead of <code class="calibre14">import './global'</code>). Or, see if you can include your ambient type in your <em class="calibre5">tsconfig.json</em>’s <code class="calibre14">types</code>, <code class="calibre14">files</code>, or <code class="calibre14">include</code> field and avoid the import altogether.</p>

<p class="author1">If neither of those works for your use case, and you want to continue to use a full-module import but avoid generating a JavaScript <code class="calibre14">import</code> or <code class="calibre14">require</code> call for that import, use the <code class="calibre14">types</code> triple-slash directive. A triple-slash directive is three slashes <code class="calibre14">///</code> followed by one of a few possible XML tags, each with its own set of required attributes. For the <code class="calibre14">types</code> directive, it looks like this:</p>

<ul class="printings">
<li class="calibre11">
<p class="author1">Declare a dependency on an ambient type declaration:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">/// &lt;reference types="./global" /&gt;</code></pre>
</li>
<li class="calibre11">
<p class="author1">Declare a dependency on <em class="calibre5">@types/jasmine/index.d.ts</em>:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">/// &lt;reference types="jasmine" /&gt;</code></pre>
</li>
</ul>

<p class="author1">You probably won’t find yourself using this directive often. And if you do, you may want to rethink how you’re using types in your project, and consider if there’s a way to rely less on ambient types.</p>
</div></section>













<section data-pdf-bookmark="The amd-module Directive" data-type="sect2" class="preface"><div class="preface" id="calibre_link-550">
<h2 class="calibre17">The amd-module Directive</h2>

<p class="author1">When compiling your TypeScript code to the AMD module format (indicated with <code class="calibre14">{"module": "amd"}</code> in your <em class="calibre5">tsconfig.json</em>), TypeScript will generate anonymous AMD modules by default.<a data-primary="modules" data-secondary="amd-module directive" data-type="indexterm" id="calibre_link-1220" class="calibre4"></a><a data-primary="amd-module directive" data-type="indexterm" id="calibre_link-617" class="calibre4"></a><a data-primary="directives" data-secondary="triple-slash" data-tertiary="amd-module" data-type="indexterm" id="calibre_link-846" class="calibre4"></a><a data-primary="triple-slash directives" data-secondary="amd-module" data-type="indexterm" id="calibre_link-1490" class="calibre4"></a> You can use the AMD triple-slash directive to give your emitted modules names.</p>

<p class="author1">Let’s say you have the following code:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">export</code> <code class="kd">let</code> <code class="nx">LogService</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">log() {</code>
    <code class="c">// ...</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p class="author1">Compiling to the <code class="calibre14">amd</code> module format, TSC generates the following JavaScript code:</p>

<pre data-code-language="js" data-type="programlisting" class="calibre30"><code class="nx">define</code><code class="p">([</code><code class="s">'require'</code><code class="p">,</code> <code class="s">'exports'</code><code class="p">],</code> <code class="kd">function</code><code class="p">(</code><code class="nx">require</code><code class="p">,</code> <code class="nx">exports</code><code class="p">)</code> <code class="p">{</code>
  <code class="nx">exports</code><code class="p">.</code><code class="nx">__esModule</code> <code class="o">=</code> <code class="kd">true</code>
  <code class="nx">exports</code><code class="p">.</code><code class="nx">LogService</code> <code class="o">=</code> <code class="p">{</code>
    <code class="nx">log</code><code class="p">()</code> <code class="p">{</code>
      <code class="c">// ...</code>
    <code class="p">}</code>
  <code class="p">}</code>
<code class="p">})</code></pre>

<p class="author1">If you’re familiar with the AMD module format, you might have noticed that this is an anonymous AMD module. To give your AMD module a name, use the <code class="calibre14">amd-module</code> triple-slash directive in your code:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">/// &lt;amd-module name="LogService" /&gt; </code><a class="calibre4" href="#calibre_link-514" id="calibre_link-516"><img alt="1" src="images/000000.png" class="calibre40" /></a><code class="c">
</code><code class="kd">export</code><code class="calibre14"> </code><code class="kd">let</code><code class="calibre14"> </code><code class="nx">LogService</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-515" id="calibre_link-517"><img alt="2" src="images/000001.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="nx">log() {</code><code class="calibre14">
    </code><code class="c">// ...
</code><code class="calibre14">  </code><code class="p">}</code><code class="calibre14">
</code><code class="p">}</code></pre>
<dl class="preface">
<dt class="calibre18"><a class="calibre4" href="#calibre_link-516" id="calibre_link-514"><img alt="1" src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We use the <code class="calibre14">amd-module</code> directive, and set a <code class="calibre14">name</code> attribute on it.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-517" id="calibre_link-515"><img alt="2" src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">The rest of our code is unchanged.</p></dd>
</dl>

<p class="author1">Recompiling to the AMD module format with TSC, we now get the following JavaScript:</p>
<pre data-code-language="js" data-type="programlisting" class="calibre30">
<em class="calibre41"><code class="c2">/// &lt;amd-module name='LogService' /&gt;</code></em><code class="c">
</code><code class="nx">define</code><code class="p">(</code><strong class="calibre49"><code class="s1">'LogService'</code><code class="p1">,</code><code class="calibre50"> </code></strong><code class="p">[</code><code class="s">'require'</code><code class="p">,</code><code class="calibre14"> </code><code class="s">'exports'</code><code class="p">]</code><code class="p">,</code><code class="calibre14"> </code><code class="kd">function</code><code class="p">(</code><code class="nx">require</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">exports</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="nx">exports</code><code class="p">.</code><code class="nx">__esModule</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="kd">true</code><code class="calibre14">
  </code><code class="nx">exports</code><code class="p">.</code><code class="nx">LogService</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
    </code><code class="nx">log</code><code class="p">(</code><code class="p">)</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
      </code><em class="calibre41"><code class="c2">// ...</code></em><code class="c">
</code><code class="calibre14">    </code><code class="p">}</code><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">
</code><code class="p">}</code><code class="p">)</code><code class="calibre14">
</code></pre>

<p class="author1">When compiling to AMD modules, use the <code class="calibre14">amd-module</code> directive to make your code easier to bundle and debug (or, switch to a more modern module format like ES2015 modules if you can).<a data-primary="triple-slash directives" data-startref="ix_triplesl" data-type="indexterm" id="calibre_link-1487" class="calibre4"></a><a data-primary="directives" data-secondary="triple-slash" data-startref="ix_dirtriplesl" data-type="indexterm" id="calibre_link-844" class="calibre4"></a><a data-primary="TypeScript" data-secondary="triple-slash directives" data-startref="ix_TStriplesl" data-type="indexterm" id="calibre_link-1705" class="calibre4"></a></p>
</div></section>





</div></section>













<section data-pdf-bookmark="Summary" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1936">
<h1 class="calibre13">Summary</h1>

<p class="author1">In this chapter we covered everything you need to know to build and run your TypeScript application in production, either in the browser or on the server. We discussed how to choose a JavaScript version to compile to, which libraries to mark as available in your environment (and how to polyfill libraries when they’re missing), and how to build and ship source maps with your application to make it easier to debug in production and develop locally. We then explored how to modularize your TypeScript project to keep compilation times fast. Finally, we finished up with how to run your TypeScript application on the server and in the browser, how to publish your TypeScript code to NPM for others to use, how import elision works, and&mdash;for AMD users&mdash;how to use triple-slash directives to name your modules.</p>
</div></section>







<div data-type="footnotes" class="calibre26"><p data-type="footnote" id="calibre_link-510" class="calibre27"><sup class="calibre28"><a href="#calibre_link-518" class="calibre16">1</a></sup> If you use a language feature that TSC doesn’t transpile and your target environment doesn’t support it either, you can usually find a Babel plugin to transpile it for you. To find the most up-to-date plugin, search for “babel plugin &lt;feature name&gt;” in your favorite search engine.</p></div></div></section></div>

<div data-type="book" class="calibre1" id="calibre_link-519"><section data-pdf-bookmark="Chapter 13. Conclusion" data-type="chapter" type="chapter" class="preface"><div class="preface" id="calibre_link-1937">
<h1 class="calibre12"><span class="calibre">Chapter 13. </span>Conclusion</h1>


<p class="author1">We’re nearing the end of our journey together.</p>

<p class="author1">We’ve covered what types are and why they’re useful; how TSC works; what types TypeScript supports; how <a data-primary="type systems" data-secondary="what TypeScript type system handles" data-type="indexterm" id="calibre_link-1585" class="calibre4"></a>TypeScript’s type system handles inference, assignability, refinement, widening, and totality; the rules of contextual typing; how variance works; and how to use type operators. We’ve covered functions and classes and interfaces, iterators and iterables and generators, overloads, polymorphic types, mixins, decorators, and the various escape hatches you can use once in a while to sacrifice safety to get your code out before your deadline. We explored the different ways to handle exceptions safely and their trade-offs, and how to use types to make concurrent, parallel, and asynchronous programs safe. We dove into using TypeScript with popular frameworks like Angular and React, and how namespaces and modules work. We looked at using, building, and deploying TypeScript on the frontend and on the backend, and talked about how to gradually migrate code to TypeScript, how to use type declarations, how to publish your code to NPM so others can use it, how to safely use third-party code, and how to build your TypeScript projects.</p>

<p class="author1">I hope that I’ve infected you with the gospel of static types.<a data-primary="types" data-secondary="sketching out programs in" data-type="indexterm" id="calibre_link-1647" class="calibre4"></a> I hope you now, at times, find yourself sketching out programs in types before implementing them, and I hope you’ve gained a deeply intuitive understanding of how you can use types to make your applications safer. I hope that I’ve changed your view of the world, at least a little bit, and that you now think in types when you write code.</p>

<p class="author1">You’re now equipped to teach others about TypeScript. Advocate for safety, and help make your company’s and your friends’ code better and more fun to write.</p>

<p class="author1">Finally, keep exploring. TypeScript probably isn’t your first language, and it probably won’t be your last. Keep learning about new ways to program, new ways to think about types, and new ways to think about the trade-offs between safety and ease of use. Maybe you’ll create the next big thing after TypeScript, and maybe I’ll be the one to write about it someday…</p>
</div></section></div>

<div data-type="book" class="calibre1" id="calibre_link-520"><section data-pdf-bookmark="Appendix A. Type Operators" data-type="appendix" type="appendix" class="preface"><div class="preface" id="calibre_link-1938">
<h1 class="calibre12"><span class="calibre">Appendix A. </span>Type Operators</h1>


<p class="author1">TypeScript supports a rich set of type operators for working with types. Use <a data-type="xref" href="#calibre_link-521" class="calibre4">Table&nbsp;A-1</a> as a handy <a data-primary="type operators" data-type="indexterm" id="calibre_link-1574" class="calibre4"></a>reference for when you want to learn more about an operator.</p>
<table id="calibre_link-521" class="stafflist_table">
<caption class="calibre35"><span class="calibre">Table A-1. </span>Type operators</caption>
<thead class="calibre36">
<tr class="calibre7">
<th class="calibre37">Type operator</th>
<th class="calibre37">Syntax</th>
<th class="calibre37">Use it on</th>
<th class="calibre37">Learn more</th>
</tr>
</thead>
<tbody class="calibre6">
<tr class="calibre7">
<td class="calibre8"><p class="author1">Type query</p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">typeof</code>, <span class="calibre"><code class="calibre14">instanceof</code></span></p></td>
<td class="calibre8"><p class="author1">Any type</p></td>
<td class="calibre8"><p class="author1"><a data-type="xref" href="#calibre_link-38" class="calibre4">“Refinement”</a>, <a data-type="xref" href="#calibre_link-522" class="calibre4">“Classes Declare Both Values and Types”</a></p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1">Keys</p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">keyof</code></p></td>
<td class="calibre8"><p class="author1">Object types</p></td>
<td class="calibre8"><p class="author1"><a data-type="xref" href="#calibre_link-523" class="calibre4">“The keyof operator”</a></p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1">Property lookup</p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">O[K]</code></p></td>
<td class="calibre8"><p class="author1">Object types</p></td>
<td class="calibre8"><p class="author1"><a data-type="xref" href="#calibre_link-524" class="calibre4">“The keying-in operator”</a></p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1">Mapped type</p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">[K in O]</code></p></td>
<td class="calibre8"><p class="author1">Object types</p></td>
<td class="calibre8"><p class="author1"><a data-type="xref" href="#calibre_link-257" class="calibre4">“Mapped Types”</a></p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1">Modifier addition</p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">+</code></p></td>
<td class="calibre8"><p class="author1">Object types</p></td>
<td class="calibre8"><p class="author1"><a data-type="xref" href="#calibre_link-257" class="calibre4">“Mapped Types”</a></p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1">Modifier subtraction</p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">-</code></p></td>
<td class="calibre8"><p class="author1">Object types</p></td>
<td class="calibre8"><p class="author1"><a data-type="xref" href="#calibre_link-257" class="calibre4">“Mapped Types”</a></p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1">Read-only modifier</p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">readonly</code></p></td>
<td class="calibre8"><p class="author1">Object types, array types, tuple types</p></td>
<td class="calibre8"><p class="author1"><a data-type="xref" href="#calibre_link-525" class="calibre4">“Objects”</a>, <a data-type="xref" href="#calibre_link-526" class="calibre4">“Classes and Inheritance”</a>, <a data-type="xref" href="#calibre_link-117" class="calibre4">“Read-only arrays and tuples”</a></p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1">Optional modifier</p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">?</code></p></td>
<td class="calibre8"><p class="author1">Object types, tuple types, function parameter types</p></td>
<td class="calibre8"><p class="author1"><a data-type="xref" href="#calibre_link-525" class="calibre4">“Objects”</a>, <a data-type="xref" href="#calibre_link-527" class="calibre4">“Tuples”</a>, <a data-type="xref" href="#calibre_link-528" class="calibre4">“Optional and Default Parameters”</a></p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1">Conditional type</p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">?</code></p></td>
<td class="calibre8"><p class="author1">Generic types, type aliases, function parameter types</p></td>
<td class="calibre8"><p class="author1"><a data-type="xref" href="#calibre_link-529" class="calibre4">“Conditional Types”</a></p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1">Non<code class="calibre14">null</code> assertion</p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">!</code></p></td>
<td class="calibre8"><p class="author1">Nullable types</p></td>
<td class="calibre8"><p class="author1"><a data-type="xref" href="#calibre_link-530" class="calibre4">“Nonnull Assertions”</a>, <a data-type="xref" href="#calibre_link-335" class="calibre4">“Definite Assignment Assertions”</a></p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1">Generic type parameter default</p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">=</code></p></td>
<td class="calibre8"><p class="author1">Generic types</p></td>
<td class="calibre8"><p class="author1"><a data-type="xref" href="#calibre_link-531" class="calibre4">“Generic Type Defaults”</a></p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1">Type assertion</p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">as</code>, <code class="calibre14">&lt;&gt;</code></p></td>
<td class="calibre8"><p class="author1">Any type</p></td>
<td class="calibre8"><p class="author1"><a data-type="xref" href="#calibre_link-233" class="calibre4">“Type Assertions”</a>, <a data-type="xref" href="#calibre_link-290" class="calibre4">“The const type”</a></p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1">Type guard</p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">is</code></p></td>
<td class="calibre8"><p class="author1">Function return types</p></td>
<td class="calibre8"><p class="author1"><a data-type="xref" href="#calibre_link-532" class="calibre4">“User-Defined Type Guards”</a></p></td>
</tr>
</tbody>
</table>
</div></section></div>

<div data-type="book" class="calibre1" id="calibre_link-533"><section data-pdf-bookmark="Appendix B. Type Utilities" data-type="appendix" type="appendix" class="preface"><div class="preface" id="calibre_link-1939">
<h1 class="calibre12"><span class="calibre">Appendix B. </span>Type Utilities</h1>


<p class="author1">TypeScript’s type utilities come bundled<a data-primary="type utilities" data-type="indexterm" id="calibre_link-1586" class="calibre4"></a> into its standard library. <a data-type="xref" href="#calibre_link-534" class="calibre4">Table&nbsp;B-1</a> enumerates all of the available utilities at the time of writing.</p>

<p class="author1">See <a href="http://bit.ly/2I0Ve2U" class="calibre4"><em class="calibre5">es5.d.ts</em></a> for an up-to-date reference.</p>
<table id="calibre_link-534" class="stafflist_table">
<caption class="calibre35"><span class="calibre">Table B-1. </span>Type utilities</caption>
<thead class="calibre36">
<tr class="calibre7">
<th class="calibre37">Type utility</th>
<th class="calibre37">Use it on</th>
<th class="calibre37">Description</th>
</tr>
</thead>
<tbody class="calibre6">
<tr class="calibre7">
<td class="calibre8"><p class="author1"><code class="calibre14">ConstructorParameters</code></p></td>
<td class="calibre8"><p class="author1">Class constructor types</p></td>
<td class="calibre8"><p class="author1">A tuple of a class constructor’s parameter types</p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1"><code class="calibre14">Exclude</code></p></td>
<td class="calibre8"><p class="author1">Union types</p></td>
<td class="calibre8"><p class="author1">Exclude a type from another type</p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1"><code class="calibre14">Extract</code></p></td>
<td class="calibre8"><p class="author1">Union types</p></td>
<td class="calibre8"><p class="author1">Select a subtype that’s assignable to another type</p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1"><code class="calibre14">InstanceType</code></p></td>
<td class="calibre8"><p class="author1">Class constructor types</p></td>
<td class="calibre8"><p class="author1">The instance type you get from <code class="calibre14">new</code>-ing a class constructor</p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1"><code class="calibre14">NonNullable</code></p></td>
<td class="calibre8"><p class="author1">Nullable types</p></td>
<td class="calibre8"><p class="author1">Exclude <code class="calibre14">null</code> and <code class="calibre14">undefined</code> from a type</p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1"><code class="calibre14">Parameters</code></p></td>
<td class="calibre8"><p class="author1">Function types</p></td>
<td class="calibre8"><p class="author1">A tuple of a function’s parameter types</p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1"><code class="calibre14">Partial</code></p></td>
<td class="calibre8"><p class="author1">Object types</p></td>
<td class="calibre8"><p class="author1">Make all properties in an object optional</p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1"><code class="calibre14">Pick</code></p></td>
<td class="calibre8"><p class="author1">Object types</p></td>
<td class="calibre8"><p class="author1">A subtype of an object type, with a subset of its keys</p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1"><code class="calibre14">Readonly</code></p></td>
<td class="calibre8"><p class="author1">Array, Object, and Tuple types</p></td>
<td class="calibre8"><p class="author1">Make all properties in an object read-only, or make an array or tuple read-only</p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1"><code class="calibre14">ReadonlyArray</code></p></td>
<td class="calibre8"><p class="author1">Any type</p></td>
<td class="calibre8"><p class="author1">Make an immutable array of the given type</p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1"><code class="calibre14">Record</code></p></td>
<td class="calibre8"><p class="author1">Object types</p></td>
<td class="calibre8"><p class="author1">A map from a key type to a value type</p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1"><code class="calibre14">Required</code></p></td>
<td class="calibre8"><p class="author1">Object types</p></td>
<td class="calibre8"><p class="author1">Make all properties in an object required</p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1"><code class="calibre14">ReturnType</code></p></td>
<td class="calibre8"><p class="author1">Function types</p></td>
<td class="calibre8"><p class="author1">A function’s return type</p></td>
</tr>
</tbody>
</table>
</div></section></div>

<div data-type="book" class="calibre1" id="calibre_link-535"><section data-pdf-bookmark="Appendix C. Scoped Declarations" data-type="appendix" type="appendix" class="preface"><div class="preface" id="calibre_link-148">
<h1 class="calibre12"><span class="calibre">Appendix C. </span>Scoped Declarations</h1>


<p class="author1">TypeScript declarations have a rich set of behaviors needed to model types and values, and as in JavaScript, they can be overloaded in a variety of ways.<a data-primary="scoped declarations" data-type="indexterm" id="calibre_link-1429" class="calibre4"></a> This appendix covers two of these behaviors, summarizing which declarations generate types (and which generate values), and which declarations can be merged.</p>






<section data-pdf-bookmark="Does It Generate a Type?" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1940">
<h1 class="calibre13">Does It Generate a Type?</h1>

<p class="author1">Some TypeScript declarations create a type, some <a data-primary="types" data-secondary="declarations generating" data-type="indexterm" id="calibre_link-1618" class="calibre4"></a>create a value, and some create both.<a data-primary="values" data-secondary="declarations generating" data-type="indexterm" id="calibre_link-1729" class="calibre4"></a> See to <a data-type="xref" href="#calibre_link-536" class="calibre4">Table&nbsp;C-1</a> for a quick reference.</p>
<table id="calibre_link-536" class="stafflist_table">
<caption class="calibre35"><span class="calibre">Table C-1. </span>Does the declaration generate a type?</caption>
<thead class="calibre36">
<tr class="calibre7">
<th class="calibre37">Keyword</th>
<th class="calibre37">Generates a type?</th>
<th class="calibre37">Generates a value?</th>
</tr>
</thead>
<tbody class="calibre6">
<tr class="calibre7">
<td class="calibre8"><p class="author1"><code class="calibre14">class</code></p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1"><code class="calibre14">const</code>, <code class="calibre14">let</code>, <code class="calibre14">var</code></p></td>
<td class="calibre8"><p class="author1">No</p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1"><code class="calibre14">enum</code></p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1"><code class="calibre14">function</code></p></td>
<td class="calibre8"><p class="author1">No</p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1"><code class="calibre14">interface</code></p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
<td class="calibre8"><p class="author1">No</p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1"><code class="calibre14">namespace</code></p></td>
<td class="calibre8"><p class="author1">No</p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1"><code class="calibre14">type</code></p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
<td class="calibre8"><p class="author1">No</p></td>
</tr>
</tbody>
</table>
</div></section>













<section data-pdf-bookmark="Does It Merge?" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1941">
<h1 class="calibre13">Does It Merge?</h1>

<p class="author1">Declaration merging is a core TypeScript behavior.<a data-primary="declaration merging" data-type="indexterm" id="calibre_link-822" class="calibre4"></a> Take advantage of it to create richer APIs, better modularize your code, and make your code safer.</p>

<p class="author1"><a data-type="xref" href="#calibre_link-537" class="calibre4">Table&nbsp;C-2</a> is reprinted from <a data-type="xref" href="#calibre_link-55" class="calibre4">“Declaration Merging”</a>; it’s a handy reference for which kinds of declarations TypeScript will merge for you.</p>
<table id="calibre_link-537" class="stafflist_table">
<caption class="calibre35"><span class="calibre">Table C-2. </span>Can the declaration be merged?</caption>
<tbody class="calibre6">
<tr class="calibre7">
<td class="calibre8"></td>
<td class="calibre8"></td>
<td class="calibre8"></td>
<td class="calibre8"></td>
<td class="calibre8"></td>
<th class="calibre53"></th>
<td class="calibre8">To</td>
<td class="calibre8"></td>
<td class="calibre8"></td>
<td class="calibre8"></td>
<td class="calibre8"></td>
</tr>
<tr class="calibre9">
<td class="calibre8"></td>
<td class="calibre8"></td>
<td class="calibre8"><p class="author1">Value</p></td>
<td class="calibre8"><p class="author1">Class</p></td>
<td class="calibre8"><p class="author1">Enum</p></td>
<td class="calibre8"><p class="author1">Function</p></td>
<td class="calibre8"><p class="author1">Types alias</p></td>
<td class="calibre8"><p class="author1">Interface</p></td>
<td class="calibre8"><p class="author1">Namespace</p></td>
<td class="calibre8"><p class="author1">Module</p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"></td>
<td class="calibre8"><p class="author1">Value</p></td>
<td class="calibre8"><p class="author1">No</p></td>
<td class="calibre8"><p class="author1">No</p></td>
<td class="calibre8"><p class="author1">No</p></td>
<td class="calibre8"><p class="author1">No</p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
<td class="calibre8"><p class="author1">No</p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"></td>
<td class="calibre8"><p class="author1">Class</p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1">No</p></td>
<td class="calibre8"><p class="author1">No</p></td>
<td class="calibre8"><p class="author1">No</p></td>
<td class="calibre8"><p class="author1">No</p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"></td>
<td class="calibre8"><p class="author1">Enum</p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
<td class="calibre8"><p class="author1">No</p></td>
<td class="calibre8"><p class="author1">No</p></td>
<td class="calibre8"><p class="author1">No</p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1">From</p></td>
<td class="calibre8"><p class="author1">Function</p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1">No</p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"></td>
<td class="calibre8"><p class="author1">Type alias</p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1">No</p></td>
<td class="calibre8"><p class="author1">No</p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
</tr>
<tr class="calibre9">

<td class="calibre8"></td>
<td class="calibre8"><p class="author1">Interface</p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"></td>
<td class="calibre8"><p class="author1">Namespace</p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"></td>
<td class="calibre8"><p class="author1">Module</p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1"> &mdash; </p></td>
<td class="calibre8"><p class="author1">Yes</p></td>
</tr>
</tbody>
</table>
</div></section>







</div></section></div>

<div data-type="book" class="calibre1" id="calibre_link-538"><section data-pdf-bookmark="Appendix D. Recipes for Writing Declaration Files for Third-Party JavaScript Modules" data-type="appendix" type="appendix" class="preface"><div class="preface" id="calibre_link-499">
<h1 class="calibre12"><span class="calibre">Appendix D. </span>Recipes for Writing Declaration Files for Third-Party JavaScript Modules</h1>


<p class="author1">This appendix covers a few key building blocks and patterns that come up over and over again when typing third-party modules<a data-primary="modules" data-secondary="writing declaration files for third-party JavaScript modules" data-type="indexterm" id="calibre_link-1235" class="calibre4"></a>. For a deeper discussion of typing third-party code, head over to <a data-type="xref" href="#calibre_link-494" class="calibre4">“JavaScript That Doesn’t Have Type Declarations on DefinitelyTyped”</a>.</p>

<p class="author1">Since module declaration files have to live in <em class="calibre5">.d.ts</em> files and so can’t contain values, when you declare module types you need to use the <code class="calibre14">declare</code> keyword to affirm that values of the given type really are exported by your module. <a data-type="xref" href="#calibre_link-539" class="calibre4">Table&nbsp;D-1</a> provides a short summary of regular declarations and their type declaration equivalents.</p>
<table id="calibre_link-539" class="stafflist_table">
<caption class="calibre35"><span class="calibre">Table D-1. </span>TypeScript and its type-only equivalents</caption>
<thead class="calibre36">
<tr class="calibre7">
<th class="calibre37"><em class="calibre5">.ts</em></th>
<th class="calibre37"><em class="calibre5">.d.ts</em></th>
</tr>
</thead>
<tbody class="calibre6">
<tr class="calibre7">
<td class="calibre8"><p class="author1"><code class="calibre14">var a = 1</code></p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">declare var a: number</code></p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1"><code class="calibre14">let a = 1</code></p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">declare let a: number</code></p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1"><code class="calibre14">const a = 1</code></p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">declare const a: 1</code></p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1"><code class="calibre14">function a(b) { return b.toFixed() }</code></p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">declare function a(b: number): string</code></p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1"><code class="calibre14">class A { b() { return 3 } }</code></p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">declare class A { b(): number }</code></p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1"><code class="calibre14">namespace A {}</code></p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">declare namespace A {}</code></p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1"><code class="calibre14">type A = number</code></p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">type A = number</code></p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1"><code class="calibre14">interface A { b?: string }</code></p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">interface A { b?: string }</code></p></td>
</tr>
</tbody>
</table>






<section data-pdf-bookmark="Types of Exports" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1942">
<h1 class="calibre13">Types of Exports</h1>

<p class="author1">Whether your module uses global, ES2015, or CommonJS exports will affect how you write your declaration files.</p>








<section data-pdf-bookmark="Globals" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1943">
<h2 class="calibre17">Globals</h2>

<p class="author1">If your module only assigns values to the global namespace and doesn’t actually export anything, you can just create a script-mode file (see <a data-type="xref" href="#calibre_link-330" class="calibre4">“Module Mode Versus Script Mode”</a>) and prefix your variable, function, and class declarations with <code class="calibre14">declare</code> (every other kind of declaration&mdash;<code class="calibre14">enum</code>, <code class="calibre14">type</code>, and so on&mdash;remains unchanged):</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// Global variable</code>
<code class="kd">declare</code> <code class="kd">let</code> <code class="nx">someGlobal</code>: <code class="kt">GlobalType</code>

<code class="c">// Global class</code>
<code class="kd">declare</code> <code class="kd">class</code> <code class="nx">GlobalClass</code> <code class="p">{}</code>

<code class="c">// Global function</code>
<code class="kd">declare</code> <code class="kd">function</code> <code class="nx">globalFunction</code><code class="p">()</code><code class="o">:</code> <code class="kt">string</code>

<code class="c">// Global enum</code>
<code class="kd">enum</code> <code class="nx">GlobalEnum</code> <code class="p">{</code><code class="nx">A</code><code class="p">,</code> <code class="nx">B</code><code class="p">,</code> <code class="nx">C</code><code class="p">}</code>

<code class="c">// Global namespace</code>
<code class="nx">namespace</code> <code class="nx">GlobalNamespace</code> <code class="p">{}</code>

<code class="c">// Global type alias</code>
<code class="nx">type</code> <code class="nx">GlobalType</code> <code class="o">=</code> <code class="kt">number</code>

<code class="c">// Global interface</code>
<code class="kd">interface</code> <code class="nx">GlobalInterface</code> <code class="p">{}</code></pre>

<p class="author1">Each of these declarations will be globally available to every file in your project without requiring an explicit import. Here, you could use <code class="calibre14">someGlobal</code> in any file in your project without importing it first, but at runtime, <code class="calibre14">someGlobal</code> would need to be assigned to the global namespace (<code class="calibre14">window</code> in browsers or <code class="calibre14">global</code> in NodeJS).</p>

<p class="author1">Be careful to avoid <code class="calibre14">import</code>s and <code class="calibre14">export</code>s in your declaration file in order to keep your file in script mode.</p>
</div></section>













<section data-pdf-bookmark="ES2015 Exports" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1944">
<h2 class="calibre17">ES2015 Exports</h2>

<p class="author1">If your module uses ES2015 exports&mdash;that is, the <code class="calibre14">export</code> keyword&mdash;simply replace <code class="calibre14">declare</code> (which affirms that a global variable is defined) with <code class="calibre14">export</code> (which affirms that an ES2015 binding is exported):</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// Default export</code>
<code class="kd">declare</code> <code class="kd">let</code> <code class="nx">defaultExport</code>: <code class="kt">SomeType</code>
<code class="kd">export</code> <code class="kd">default</code> <code class="nx">defaultExport</code>

<code class="c">// Named export</code>
<code class="kd">export</code> <code class="kd">class</code> <code class="nx">SomeExport</code> <code class="p">{</code>
  <code class="nx">a</code>: <code class="kt">SomeOtherType</code>
<code class="p">}</code>

<code class="c">// Class export</code>
<code class="kd">export</code> <code class="kd">class</code> <code class="nx">ExportedClass</code> <code class="p">{}</code>

<code class="c">// Function export</code>
<code class="kd">export</code> <code class="kd">function</code> <code class="nx">exportedFunction</code><code class="p">()</code><code class="o">:</code> <code class="kt">string</code>

<code class="c">// Enum export</code>
<code class="kd">enum</code> <code class="nx">ExportedEnum</code> <code class="p">{</code><code class="nx">A</code><code class="p">,</code> <code class="nx">B</code><code class="p">,</code> <code class="nx">C</code><code class="p">}</code>

<code class="c">// Namespace export</code>
<code class="kd">export</code> <code class="nx">namespace</code> <code class="nx">SomeNamespace</code> <code class="p">{</code>
  <code class="kd">let</code> <code class="nx">someNamespacedExport</code>: <code class="kt">number</code>
<code class="p">}</code>

<code class="c">// Type export</code>
<code class="kd">export</code> <code class="nx">type</code> <code class="nx">SomeType</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">a</code>: <code class="kt">number</code>
<code class="p">}</code>

<code class="c">// Interface export</code>
<code class="kd">export</code> <code class="kd">interface</code> <code class="nx">SomeOtherType</code> <code class="p">{</code>
  <code class="nx">b</code>: <code class="kt">string</code>
<code class="p">}</code></pre>
</div></section>













<section data-pdf-bookmark="CommonJS Exports" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1945">
<h2 class="calibre17">CommonJS Exports</h2>

<p class="author1">CommonJS was the de facto module standard before ES2015, and is still the standard for NodeJS at the time of writing. It also uses the <code class="calibre14">export</code> keyword, but the syntax is a bit different:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">declare</code> <code class="kd">let</code> <code class="nx">defaultExport</code>: <code class="kt">SomeType</code>
<code class="kd">export</code> <code class="o">=</code> <code class="nx">defaultExport</code></pre>

<p class="author1">Notice how we assigned our exports to <code class="calibre14">export</code>, rather than using <code class="calibre14">export</code> as a modifier (like we do for ES2015 exports).</p>

<p class="author1">A type declaration for a third-party CommonJS module can contain exactly one export. To export multiple things, we take advantage of declaration merging (see <a data-type="xref" href="#calibre_link-148" class="calibre4">Appendix&nbsp;C</a>).</p>

<p class="author1">For example, to type multiple exports and no default export, we export a single <span class="calibre"><code class="calibre14">namespace</code></span>:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">declare</code> <code class="nx">namespace</code> <code class="nx">MyNamedExports</code> <code class="p">{</code>
  <code class="kd">export</code> <code class="kd">let</code> <code class="nx">someExport</code>: <code class="kt">SomeType</code>
  <code class="kd">export</code> <code class="nx">type</code> <code class="nx">SomeType</code> <code class="o">=</code> <code class="kt">number</code>
  <code class="kd">export</code> <code class="kd">class</code> <code class="nx">OtherExport</code> <code class="p">{</code>
    <code class="nx">otherType</code>: <code class="kt">string</code>
  <code class="p">}</code>
<code class="p">}</code>
<code class="kd">export</code> <code class="o">=</code> <code class="nx">MyNamedExports</code></pre>

<p class="author1">What about a CommonJS module that has both a default export and named exports? We take advantage of declaration merging:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">declare</code> <code class="nx">namespace</code> <code class="nx">MyExports</code> <code class="p">{</code>
  <code class="kd">export</code> <code class="kd">let</code> <code class="nx">someExport</code>: <code class="kt">SomeType</code>
  <code class="kd">export</code> <code class="nx">type</code> <code class="nx">SomeType</code> <code class="o">=</code> <code class="kt">number</code>
<code class="p">}</code>
<code class="kd">declare</code> <code class="kd">function</code> <code class="nx">MyExports</code><code class="p">(</code><code class="nx">a</code>: <code class="kt">number</code><code class="p">)</code><code class="o">:</code> <code class="kt">string</code>
<code class="kd">export</code> <code class="o">=</code> <code class="nx">MyExports</code></pre>
</div></section>













<section data-pdf-bookmark="UMD Exports" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1946">
<h2 class="calibre17">UMD Exports</h2>

<p class="author1">Typing a UMD module is nearly identical to typing an ES2015 module. The only difference is that if you want to make your module globally available to script-mode files (see <a data-type="xref" href="#calibre_link-330" class="calibre4">“Module Mode Versus Script Mode”</a>), you use the special <code class="calibre14">export as namespace</code> syntax. For example:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">// Default export</code>
<code class="kd">declare</code> <code class="kd">let</code> <code class="nx">defaultExport</code>: <code class="kt">SomeType</code>
<code class="kd">export</code> <code class="kd">default</code> <code class="nx">defaultExport</code>

<code class="c">// Named export</code>
<code class="kd">export</code> <code class="kd">class</code> <code class="nx">SomeExport</code> <code class="p">{</code>
  <code class="nx">a</code>: <code class="kt">SomeType</code>
<code class="p">}</code>

<code class="c">// Type export</code>
<code class="kd">export</code> <code class="nx">type</code> <code class="nx">SomeType</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">a</code>: <code class="kt">number</code>
<code class="p">}</code>

<code class="kd">export</code> <code class="kd">as</code> <code class="nx">namespace</code> <code class="nx">MyModule</code></pre>

<p class="author1">Notice that last line&mdash;if you have a script-mode file in your project, you can now use that module directly (without importing it first) on the global <code class="calibre14">MyModule</code> namespace:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">let</code> <code class="nx">a</code> <code class="o">=</code> <code class="kd">new</code> <code class="nx">MyModule</code><code class="p">.</code><code class="nx">SomeExport</code></pre>
</div></section>





</div></section>













<section data-pdf-bookmark="Extending a Module" data-type="sect1" class="preface"><div class="preface" id="calibre_link-482">
<h1 class="calibre13">Extending a Module</h1>

<p class="author1">Extending a module’s type declaration is less common than typing a module, but it might come up if you write a JQuery plugin or a Lodash mixin. Try to avoid doing it when possible; instead, consider using a separate module. That is, instead of a Lodash mixin use a regular function, and instead of a JQuery plugin&mdash;wait, why are you still using JQuery?</p>








<section data-pdf-bookmark="Globals" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1947">
<h2 class="calibre17">Globals</h2>

<p class="author1">If you want to extend another module’s global namespace or interface, just create a script-mode file (see <a data-type="xref" href="#calibre_link-330" class="calibre4">“Module Mode Versus Script Mode”</a>), and augment it. Note that this only works for interfaces and namespaces because TypeScript will take care of merging them for you.</p>

<p class="author1">For example, let’s add an awesome new <code class="calibre14">marquee</code> method to JQuery. We’ll start by installing <code class="calibre14">jquery</code> itself:</p>

<pre data-code-language="sh" data-type="programlisting" class="calibre30">npm install jquery --save
npm install @types/jquery --save-dev</pre>

<p class="author1">We’ll then create a new file&mdash;say <em class="calibre5">jquery-extensions.d.ts</em>&mdash;in our project, and add <code class="calibre14">marquee</code> to JQuery’s global <code class="calibre14">JQuery</code> interface (I found that JQuery defines its methods on the <code class="calibre14">JQuery</code> interface by sleuthing through its type declarations):</p>

<pre data-code-language="js" data-type="programlisting" class="calibre30"><code class="kd">interface</code> <code class="nx">JQuery</code> <code class="p">{</code>
  <code class="nx">marquee</code><code class="p">(</code><code class="nx">speed</code><code class="o">:</code> <code class="nx">number</code><code class="p">)</code><code class="o">:</code> <code class="nx">JQuery</code><code class="o">&lt;</code><code class="nx">HTMLElement</code><code class="o">&gt;</code>
<code class="p">}</code></pre>

<p class="author1">Now, in any file where we use JQuery, we can use <code class="calibre14">marquee</code> (of course, we’ll want to add a runtime implementation for <code class="calibre14">marquee</code> too):</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">import</code> <code class="nx">$</code> <code class="nx">from</code> <code class="s">'jquery'</code>
<code class="nx">$</code><code class="p">(</code><code class="nx">myElement</code><code class="p">).</code><code class="nx">marquee</code><code class="p">(</code><code class="mi">3</code><code class="p">)</code></pre>

<p class="author1">Note that this is the same technique we used to extend built-in globals in <a data-type="xref" href="#calibre_link-513" class="calibre4">“Safely Extending the Prototype”</a>.</p>
</div></section>













<section data-pdf-bookmark="Modules" data-type="sect2" class="preface"><div class="preface" id="calibre_link-1948">
<h2 class="calibre17">Modules</h2>

<p class="author1">Extending module exports is a bit trickier, and has more pitfalls: you need to type your extension correctly, load your modules in the correct order at runtime, and make sure to update your extension’s types when the structure of the type declarations for the module you’re extending changes.</p>

<p class="author1">As an example, let’s type a new export for React. We’ll start by installing React and its type declarations:</p>

<pre data-code-language="sh" data-type="programlisting" class="calibre30">npm install react --save
npm install @types/react --save-dev</pre>

<p class="author1">Then we’ll take advantage of module merging (see <a data-type="xref" href="#calibre_link-55" class="calibre4">“Declaration Merging”</a>) and simply declare a module with the same name as our React module:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">import</code> <code class="p">{</code><code class="nx">ReactNode</code><code class="p">}</code> <code class="nx">from</code> <code class="s">'react'</code>

<code class="kd">declare</code> <code class="nx">module</code> <code class="s">'react'</code> <code class="p">{</code>
  <code class="kd">export</code> <code class="kd">function</code> <code class="nx">inspect</code><code class="p">(</code><code class="nx">element</code>: <code class="kt">ReactNode</code><code class="p">)</code><code class="o">:</code> <code class="kd">void</code>
<code class="p">}</code></pre>

<p class="author1">Note that unlike in our example for extending globals, it doesn’t matter whether our extension file is in module mode or script mode.</p>

<p class="author1">What about extending a specific export from a module? Inspired by <a href="https://reasonml.github.io/reason-react" class="calibre4">ReasonReact</a>, let’s say we want to add a built-in reducer for our React components (a reducer is a way to declare an explicit set of state transitions for a React component). At the time of writing, React’s type declarations declare the <code class="calibre14">React.Component</code> type as an interface and a class that get merged together into a single UMD export:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">export</code> <code class="o">=</code> <code class="nx">React</code>
<code class="kd">export</code> <code class="kd">as</code> <code class="nx">namespace</code> <code class="nx">React</code>

<code class="kd">declare</code> <code class="nx">namespace</code> <code class="nx">React</code> <code class="p">{</code>
  <code class="kd">interface</code> <code class="nx">Component</code><code class="o">&lt;</code><code class="nx">P</code> <code class="o">=</code> <code class="p">{},</code> <code class="nx">S</code> <code class="o">=</code> <code class="p">{},</code> <code class="nx">SS</code> <code class="o">=</code> <code class="nx">any</code><code class="o">&gt;</code>
    <code class="kd">extends</code> <code class="nx">ComponentLifecycle</code><code class="o">&lt;</code><code class="nx">P</code><code class="p">,</code> <code class="nx">S</code><code class="p">,</code> <code class="nx">SS</code><code class="o">&gt;</code> <code class="p">{}</code>
  <code class="kd">class</code> <code class="nx">Component</code><code class="o">&lt;</code><code class="nx">P</code><code class="p">,</code> <code class="nx">S</code><code class="o">&gt;</code> <code class="p">{</code>
    <code class="kd">constructor</code><code class="p">(</code><code class="nx">props</code>: <code class="kt">Readonly</code><code class="o">&lt;</code><code class="nx">P</code><code class="o">&gt;</code><code class="p">)</code>
    <code class="c">// ...</code>
  <code class="p">}</code>
  <code class="c">// ...</code>
<code class="p">}</code></pre>

<p class="author1">Let’s extend <code class="calibre14">Component</code> with our <code class="calibre14">reducer</code> method. We can do this by entering the following in a <em class="calibre5">react-extensions.d.ts</em> file in the project root:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">import</code><code class="calibre14"> </code><code class="s">'react'</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-540" id="calibre_link-544"><img alt="1" src="images/000000.png" class="calibre40" /></a><code class="calibre14">

</code><code class="kd">declare</code><code class="calibre14"> </code><code class="nx">module</code><code class="calibre14"> </code><code class="s">'react'</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-541" id="calibre_link-545"><img alt="2" src="images/000001.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="kd">interface</code><code class="calibre14"> </code><code class="nx">Component</code><code class="o">&lt;</code><code class="nx">P</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">S</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-542" id="calibre_link-546"><img alt="3" src="images/000002.png" class="calibre40" /></a><code class="calibre14">
    </code><code class="nx">reducer</code><code class="p">(</code><code class="nx">action</code><code class="calibre14">: </code><code class="kt">object</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">state</code><code class="calibre14">: </code><code class="kt">S</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">S</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-543" id="calibre_link-547"><img alt="4" src="images/000003.png" class="calibre40" /></a><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">
</code><code class="p">}</code></pre>
<dl class="preface">
<dt class="calibre18"><a class="calibre4" href="#calibre_link-544" id="calibre_link-540"><img alt="1" src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We import <code class="calibre14">'react'</code>, switching our extension file into script mode, which we need to be in to consume a React module. Note that there are other ways we could have switched to script mode, like importing something else, exporting something, or exporting an empty object (<code class="calibre14">export {}</code>)&mdash;we didn’t have to import <code class="calibre14">'react'</code> specifically.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-545" id="calibre_link-541"><img alt="2" src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We declare the <code class="calibre14">'react'</code> module, indicating to TypeScript that we want to declare types for that specific <code class="calibre14">import</code> path. Because we already installed <code class="calibre14">@types/react</code> (which defines an export for the same exact <code class="calibre14">'react'</code> path), TypeScript will merge this module declaration with the one provided by <code class="calibre14">@types/react</code>.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-546" id="calibre_link-542"><img alt="3" src="images/000002.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">We augment the <code class="calibre14">Component</code> interface provided by React by declaring our own <code class="calibre14">Component</code> interface. Following the rules of interface merging (<a data-type="xref" href="#calibre_link-329" class="calibre4">“Declaration Merging”</a>), we have to use the same exact signature in our declaration as the one in <code class="calibre14">@types/react</code>.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-547" id="calibre_link-543"><img alt="4" src="images/000003.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45">Finally, we declare our <code class="calibre14">reducer</code> method.</p></dd>
</dl>

<p class="author1">After declaring these types (and assuming we’ve implemented the runtime behavior to support this update somewhere), we can now declare React components with built-in <code class="calibre14">reducers</code> in a typesafe way:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">import</code> <code class="o">*</code> <code class="kd">as</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s">'react'</code>

<code class="nx">type</code> <code class="nx">Props</code> <code class="o">=</code> <code class="p">{</code>
  <code class="c">// ...</code>
<code class="p">}</code>

<code class="nx">type</code> <code class="nx">State</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">count</code>: <code class="kt">number</code>
  <code class="nx">item</code>: <code class="kt">string</code>
<code class="p">}</code>

<code class="nx">type</code> <code class="nx">Action</code> <code class="o">=</code>
  <code class="o">|</code> <code class="p">{</code><code class="nx">type</code><code class="o">:</code> <code class="s">'SET_ITEM'</code><code class="p">,</code> <code class="nx">value</code>: <code class="kt">string</code><code class="p">}</code>
  <code class="o">|</code> <code class="p">{</code><code class="nx">type</code><code class="o">:</code> <code class="s">'INCREMENT_COUNT'</code><code class="p">}</code>
  <code class="o">|</code> <code class="p">{</code><code class="nx">type</code><code class="o">:</code> <code class="s">'DECREMENT_COUNT'</code><code class="p">}</code>

<code class="kd">class</code> <code class="nx">ShoppingBasket</code> <code class="kd">extends</code> <code class="nx">React</code><code class="p">.</code><code class="nx">Component</code><code class="o">&lt;</code><code class="nx">Props</code><code class="p">,</code> <code class="nx">State</code><code class="o">&gt;</code> <code class="p">{</code>
  <code class="nx">reducer</code><code class="p">(</code><code class="nx">action</code>: <code class="kt">Action</code><code class="p">,</code> <code class="nx">state</code>: <code class="kt">State</code><code class="p">)</code><code class="o">:</code> <code class="nx">State</code> <code class="p">{</code>
    <code class="kd">switch</code> <code class="p">(</code><code class="nx">action</code><code class="p">.</code><code class="nx">type</code><code class="p">)</code> <code class="p">{</code>
      <code class="kd">case</code> <code class="s">'SET_ITEM'</code><code class="o">:</code>
        <code class="kd">return</code> <code class="p">{...</code><code class="nx">state</code><code class="p">,</code> <code class="nx">item</code>: <code class="kt">action.value</code><code class="p">}</code>
      <code class="kd">case</code> <code class="s">'INCREMENT_COUNT'</code><code class="o">:</code>
        <code class="kd">return</code> <code class="p">{...</code><code class="nx">state</code><code class="p">,</code> <code class="nx">count</code>: <code class="kt">state.count</code> <code class="o">+</code> <code class="mi">1</code><code class="p">}</code>
      <code class="kd">case</code> <code class="s">'DECREMENT_COUNT'</code><code class="o">:</code>
        <code class="kd">return</code> <code class="p">{...</code><code class="nx">state</code><code class="p">,</code> <code class="nx">count</code>: <code class="kt">state.count</code> <code class="o">-</code> <code class="mi">1</code><code class="p">}</code>
    <code class="p">}</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p class="author1">As noted at the start of this section, it’s good practice to avoid this pattern when possible (even though it’s cool) because it can make your modules brittle and dependent on load order. Instead, try to use composition so that your module extensions consume the module they’re extending, and export a wrapper rather than modifying that module.<a data-primary="modules" data-secondary="writing declaration files for third-party JavaScript modules" data-startref="ix_moddec" data-type="indexterm" id="calibre_link-1236" class="calibre4"></a></p>
</div></section>





</div></section>







</div></section></div>

<div data-type="book" class="calibre1" id="calibre_link-548"><section data-pdf-bookmark="Appendix E. Triple-Slash Directives" data-type="appendix" type="appendix" class="preface"><div class="preface" id="calibre_link-512">
<h1 class="calibre12"><span class="calibre">Appendix E. </span>Triple-Slash Directives</h1>


<p class="author1">Triple-slash directives are just regular JavaScript comments that TypeScript looks for to do things like adjust compiler settings for a specific file, or indicate that your file depends on another file.<a data-primary="directives" data-secondary="triple-slash" data-type="indexterm" id="calibre_link-845" class="calibre4"></a><a data-primary="triple-slash directives" data-type="indexterm" id="calibre_link-1488" class="calibre4"></a><a data-primary="/// (triple-slash directives)" data-type="indexterm" id="calibre_link-583" class="calibre4"></a><a data-primary="XML" data-secondary="tags in triple-slash directives" data-type="indexterm" id="calibre_link-1765" class="calibre4"></a> Put your directives at the top of your file, before any code. Triple-slash directives look like this (each directive is a triple-slash, <code class="calibre14">///</code>, followed by an XML tag):</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="c">/// &lt;directive attr="value" /&gt;</code></pre>

<p class="author1">TypeScript supports a handful of triple-slash directives. <a data-type="xref" href="#calibre_link-549" class="calibre4">Table&nbsp;E-1</a> lists the ones you are most likely to use:</p>
<dl class="preface">
<dt class="calibre18"><code class="calibre14">amd-module</code></dt>
<dd class="calibre19">
<p class="author1">Head over to <a data-type="xref" href="#calibre_link-550" class="calibre4">“The amd-module Directive”</a> to learn more.</p>
</dd>
<dt class="calibre18"><code class="calibre14">lib</code></dt>
<dd class="calibre19">
<p class="author1">The <code class="calibre14">lib</code> directive is a way to indicate to TypeScript<a data-primary="lib directive" data-type="indexterm" id="calibre_link-1190" class="calibre4"></a> which of TypeScript’s <code class="calibre14">lib</code>s your module depends on, which you may want to do if your project doesn’t have a <em class="calibre5">tsconfig.json</em>. Declaring the <code class="calibre14">lib</code>s you depend on in your <em class="calibre5">tsconfig.json</em> is almost always a better option.</p>
</dd>
<dt class="calibre18"><code class="calibre14">path</code></dt>
<dd class="calibre19">
<p class="author1">When using TSC’s <code class="calibre14">outFile</code> option, use the <code class="calibre14">path</code> directive to declare a dependency on another file, so that the other file appears<a data-primary="path directive" data-type="indexterm" id="calibre_link-1347" class="calibre4"></a> earlier in your compiled output than the dependent file does. If your project uses <code class="calibre14">import</code>s and <code class="calibre14">export</code>s, you likely won’t ever use this directive.</p>
</dd>
<dt class="calibre18"><code class="calibre14">type</code></dt>
<dd class="calibre19">
<p class="author1">Head over to <a data-type="xref" href="#calibre_link-471" class="calibre4">“The types Directive”</a> to learn more about the <code class="calibre14">type</code> directive.</p>
</dd>
</dl>
<table id="calibre_link-549" class="stafflist_table">
<caption class="calibre35"><span class="calibre">Table E-1. </span>Triple-slash directives</caption>
<thead class="calibre36">
<tr class="calibre7">
<th class="calibre37">Directive</th>
<th class="calibre37">Syntax</th>
<th class="calibre37">Use it to…</th>
</tr>
</thead>
<tbody class="calibre6">
<tr class="calibre7">
<td class="calibre8"><p class="author1"><code class="calibre14">amd-module</code></p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">&lt;amd-module name="MyComponent" /&gt;</code></p></td>
<td class="calibre8"><p class="author1">Declare export names when compiling to AMD modules</p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1"><code class="calibre14">lib</code></p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">&lt;reference lib="dom" /&gt;</code></p></td>
<td class="calibre8"><p class="author1">Declare which of TypeScript’s built-in <code class="calibre14">lib</code>s your type declarations depend on</p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1"><code class="calibre14">path</code></p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">&lt;reference path="./path.ts" /&gt;</code></p></td>
<td class="calibre8"><p class="author1">Declare which TypeScript files your module depends on</p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1"><code class="calibre14">type</code></p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">&lt;reference types="./path.d.ts" /&gt;</code></p></td>
<td class="calibre8"><p class="author1">Declare which type declaration files your module depends on</p></td>
</tr>
</tbody>
</table>






<section data-pdf-bookmark="Internal Directives" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1949">
<h1 class="calibre13">Internal Directives</h1>

<p class="author1">You will probably never use the <code class="calibre14">no-default-lib</code> directive (<a data-type="xref" href="#calibre_link-551" class="calibre4">Table&nbsp;E-2</a>) in your<a data-primary="internal triple-slash directives" data-type="indexterm" id="calibre_link-1126" class="calibre4"></a> own code.</p>
<table id="calibre_link-551" class="stafflist_table">
<caption class="calibre35"><span class="calibre">Table E-2. </span>Internal triple-slash directives</caption>
<thead class="calibre36">
<tr class="calibre7">
<th class="calibre37">Directive</th>
<th class="calibre37">Syntax</th>
<th class="calibre37">Use it to…</th>
</tr>
</thead>
<tbody class="calibre6">
<tr class="calibre7">
<td class="calibre8"><p class="author1"><code class="calibre14">no-default-lib</code></p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">&lt;reference no-default-lib="true" /&gt;</code></p></td>
<td class="calibre8"><p class="author1">Tell TypeScript to not use any <code class="calibre14">lib</code>s at all for this file</p></td>
</tr>
</tbody>
</table>
</div></section>













<section data-pdf-bookmark="Deprecated Directives" data-type="sect1" class="preface"><div class="preface" id="calibre_link-1950">
<h1 class="calibre13">Deprecated Directives</h1>

<p class="author1">You should never use the <code class="calibre14">amd-dependency</code> directive (<a data-type="xref" href="#calibre_link-552" class="calibre4">Table&nbsp;E-3</a>), and instead stick<a data-primary="triple-slash directives" data-startref="ix_tripleslref" data-type="indexterm" id="calibre_link-1489" class="calibre4"></a> to a regular <code class="calibre14">import</code>.</p>
<table id="calibre_link-552" class="stafflist_table">
<caption class="calibre35"><span class="calibre">Table E-3. </span>Deprecated triple-slash directives</caption>
<thead class="calibre36">
<tr class="calibre7">
<th class="calibre37">Directive</th>
<th class="calibre37">Syntax</th>
<th class="calibre37">Instead use…</th>
</tr>
</thead>
<tbody class="calibre6">
<tr class="calibre7">
<td class="calibre8"><p class="author1"><code class="calibre14">amd-dependency</code></p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">&lt;amd-dependency path="./a.ts" name="MyComponent" /&gt;</code></p></td>
<td class="calibre8"><p class="author1"><code class="calibre14">import</code></p></td>
</tr>
</tbody>
</table>
</div></section>







</div></section></div>

<div data-type="book" class="calibre1" id="calibre_link-553"><section data-pdf-bookmark="Appendix F. TSC Compiler Flags for Safety" data-type="appendix" type="appendix" class="preface"><div class="preface" id="calibre_link-497">
<h1 class="calibre12"><span class="calibre">Appendix F. </span>TSC Compiler Flags for Safety</h1>

<div data-type="tip" class="calibre21"><h6 class="calibre22">Tip</h6>
<p class="author1">For a complete list of available compiler flags, head over to the <a href="http://bit.ly/2JWfsgY" class="calibre4">TypeScript Handbook website</a>.</p>
</div>

<p class="author1">Each TypeScript release introduces new checks<a data-primary="safety flags (TSC)" data-type="indexterm" id="calibre_link-1428" class="calibre4"></a><a data-primary="TSC compiler" data-secondary="safety flags" data-type="indexterm" id="calibre_link-1524" class="calibre4"></a><a data-primary="strict flags in TSC" data-type="indexterm" id="calibre_link-1445" class="calibre4"></a> that you can enable to squeeze even more safety out of your code. Some of these flags&mdash;prefixed with <code class="calibre14">strict</code>&mdash;are included as part of the <code class="calibre14">strict</code> flag; or, you can opt into <code class="calibre14">strict</code> flags one at a time. <a data-type="xref" href="#calibre_link-554" class="calibre4">Table&nbsp;F-1</a> lists the compiler flags related to safety that are available at the time of <span class="calibre">writing</span>.</p>
<table id="calibre_link-554" class="stafflist_table">
<caption class="calibre35"><span class="calibre">Table F-1. </span>TSC safety flags</caption>
<thead class="calibre36">
<tr class="calibre7">
<th class="calibre37">Flag</th>
<th class="calibre37">Description</th>
</tr>
</thead>
<tbody class="calibre6">
<tr class="calibre7">
<td class="calibre8"><p class="author1"><code class="calibre14">alwaysStrict</code></p></td>
<td class="calibre8"><p class="author1">Emit <code class="calibre14">'use strict'</code>.</p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1"><code class="calibre14">noEmitOnError</code></p></td>
<td class="calibre8"><p class="author1">Don’t emit JavaScript when your code has type errors.</p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1"><code class="calibre14">noFallthroughCasesInSwitch</code></p></td>
<td class="calibre8"><p class="author1">Make sure that every <code class="calibre14">switch</code> case either returns a value or breaks.</p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1"><code class="calibre14">noImplicitAny</code></p></td>
<td class="calibre8"><p class="author1">Error when a variable’s type is inferred as <code class="calibre14">any</code>.</p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1"><code class="calibre14">noImplicitReturns</code></p></td>
<td class="calibre8"><p class="author1">Make sure that every code path in every function explicitly returns. See <a data-type="xref" href="#calibre_link-275" class="calibre4">“Totality”</a>.</p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1"><code class="calibre14">noImplicitThis</code></p></td>
<td class="calibre8"><p class="author1">Error when you use <code class="calibre14">this</code> in a function without explicitly annotating the <code class="calibre14">this</code> type. See <a data-type="xref" href="#calibre_link-81" class="calibre4">“Typing this”</a>.</p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1"><code class="calibre14">noUnusedLocals</code></p></td>
<td class="calibre8"><p class="author1">Warn about unused local variables.</p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1"><code class="calibre14">noUnusedParameters</code></p></td>
<td class="calibre8"><p class="author1">Warn about unused function parameters. Prefix your parameter name with <code class="calibre14">_</code> to ignore this error.</p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1"><code class="calibre14">strictBindCallApply</code></p></td>
<td class="calibre8"><p class="author1">Enforce type safety for <code class="calibre14">bind</code>, <code class="calibre14">call</code>, and <code class="calibre14">apply</code>. See <a data-type="xref" href="#calibre_link-555" class="calibre4">“call, apply, and bind”</a>.</p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1"><code class="calibre14">strictFunctionTypes</code></p></td>
<td class="calibre8"><p class="author1">Enforce that functions are contravariant in their parameter and <code class="calibre14">this</code> types. See <a data-type="xref" href="#calibre_link-556" class="calibre4">“Function variance”</a>.</p></td>
</tr>
<tr class="calibre7">
<td class="calibre8"><p class="author1"><code class="calibre14">strictNullChecks</code></p></td>
<td class="calibre8"><p class="author1">Promote <code class="calibre14">null</code> to a type. See <a data-type="xref" href="#calibre_link-557" class="calibre4">“null, undefined, void, and never”</a>.</p></td>
</tr>
<tr class="calibre9">
<td class="calibre8"><p class="author1"><code class="calibre14">strictPropertyInitialization</code></p></td>
<td class="calibre8"><p class="author1">Enforce that class properties are either nullable or initialized. See <a data-type="xref" href="#calibre_link-69" class="calibre4">Chapter&nbsp;5</a>.</p></td>
</tr>
</tbody>
</table>
</div></section></div>

<div data-type="book" class="calibre1" id="calibre_link-558"><section data-pdf-bookmark="Appendix G. TSX" data-type="appendix" type="appendix" class="preface"><div class="preface" id="calibre_link-437">
<h1 class="calibre12"><span class="calibre">Appendix G. </span>TSX</h1>


<p class="author1">Under the hood, TypeScript exposes a few hooks for typing TSX in a pluggable way. These are special types on the <code class="calibre14">global.JSX</code> namespace that TypeScript looks at as the source of truth for TSX types throughout your program.<a data-primary="TSX" data-secondary="reference" data-type="indexterm" id="calibre_link-1542" class="calibre4"></a></p>
<div data-type="note" type="note" class="calibre21"><h6 class="calibre22">Note</h6>
<p class="author1">If you’re just using React, you don’t need to know about these low-level hooks, but if you’re writing a TypeScript library that uses TSX without React, this appendix provides a helpful reference for the hooks you can use.</p>
</div>

<p class="author1">TSX supports<a data-primary="intrinsic elements (TSX)" data-type="indexterm" id="calibre_link-1131" class="calibre4"></a><a data-primary="value-based elements (TSX)" data-type="indexterm" id="calibre_link-1724" class="calibre4"></a> two kinds of elements: built-in ones (<em class="calibre5">intrinsic elements</em>) and user-defined ones (<em class="calibre5">value-based elements</em>). Intrinsic elements always have lowercased names, and refer to built-in elements like <code class="calibre14">&lt;li&gt;</code>, <code class="calibre14">&lt;h1&gt;</code>, and <code class="calibre14">&lt;div&gt;</code>. Value-based elements have PascalCased names, and refer to those elements that you create with React (or whatever frontend framework you’re using TSX with); they can be defined either as functions or as classes. See <a data-type="xref" href="#calibre_link-559" class="calibre4">Figure&nbsp;G-1</a>.</p>

<figure class="calibre33"><div class="figure" id="calibre_link-559">
<img alt="prts ag01" src="images/000025.png" class="calibre40" />
<h6 class="calibre34"><span class="calibre">Figure G-1. </span>The kinds of TSX elements</h6>
</div></figure>

<p class="author1">Using <a href="http://bit.ly/2CNzeW2" class="calibre4">React’s type declarations</a> as an example, we’ll walk through the hooks TypeScript uses to safely type TSX.<a data-primary="JSX (JavaScript XML)" data-secondary="React hooking into TSX to type JSX correctly" data-type="indexterm" id="calibre_link-1172" class="calibre4"></a><a data-primary="React" data-secondary="hooks into TSX to type JSX safely" data-type="indexterm" id="calibre_link-1401" class="calibre4"></a> Here’s how React hooks into TSX to type JSX safely:</p>

<pre data-code-language="ts" data-type="programlisting" class="calibre30"><code class="kd">declare</code><code class="calibre14"> </code><code class="nx">global</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
  </code><code class="nx">namespace</code><code class="calibre14"> </code><code class="nx">JSX</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14">
    </code><code class="kd">interface</code><code class="calibre14"> </code><code class="nx">Element</code><code class="calibre14"> </code><code class="kd">extends</code><code class="calibre14"> </code><code class="nx">React</code><code class="p">.</code><code class="nx">ReactElement</code><code class="o">&lt;</code><code class="nx">any</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="p">{</code><code class="p">}</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-560" id="calibre_link-568"><img alt="1" src="images/000000.png" class="calibre40" /></a><code class="calibre14">
    </code><code class="kd">interface</code><code class="calibre14"> </code><code class="nx">ElementClass</code><code class="calibre14"> </code><code class="kd">extends</code><code class="calibre14"> </code><code class="nx">React</code><code class="p">.</code><code class="nx">Component</code><code class="o">&lt;</code><code class="nx">any</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-561" id="calibre_link-569"><img alt="2" src="images/000001.png" class="calibre40" /></a><code class="calibre14">
      </code><code class="nx">render</code><code class="p">(</code><code class="p">)</code><code class="o">:</code><code class="calibre14"> </code><code class="nx">React</code><code class="p">.</code><code class="nx">ReactNode</code><code class="calibre14">
    </code><code class="p">}</code><code class="calibre14">
    </code><code class="kd">interface</code><code class="calibre14"> </code><code class="nx">ElementAttributesProperty</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-562" id="calibre_link-570"><img alt="3" src="images/000002.png" class="calibre40" /></a><code class="calibre14">
      </code><code class="nx">props</code><code class="o">:</code><code class="calibre14"> </code><code class="p">{</code><code class="p">}</code><code class="calibre14">
    </code><code class="p">}</code><code class="calibre14">
    </code><code class="kd">interface</code><code class="calibre14"> </code><code class="nx">ElementChildrenAttribute</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-563" id="calibre_link-571"><img alt="4" src="images/000003.png" class="calibre40" /></a><code class="calibre14">
      </code><code class="nx">children</code><code class="o">:</code><code class="calibre14"> </code><code class="p">{</code><code class="p">}</code><code class="calibre14">
    </code><code class="p">}</code><code class="calibre14">

    </code><code class="nx">type</code><code class="calibre14"> </code><code class="nx">LibraryManagedAttributes</code><code class="o">&lt;</code><code class="nx">C</code><code class="p">,</code><code class="calibre14"> </code><code class="nx">P</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="o">=</code><code class="calibre14"> </code><code class="c">// ... </code><a class="calibre4" href="#calibre_link-564" id="calibre_link-572"><img alt="5" src="images/000004.png" class="calibre40" /></a><code class="c">
</code><code class="calibre14">
    </code><code class="kd">interface</code><code class="calibre14"> </code><code class="nx">IntrinsicAttributes</code><code class="calibre14"> </code><code class="kd">extends</code><code class="calibre14"> </code><code class="nx">React</code><code class="p">.</code><code class="nx">Attributes</code><code class="calibre14"> </code><code class="p">{</code><code class="p">}</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-565" id="calibre_link-573"><img alt="6" src="images/000005.png" class="calibre40" /></a><code class="calibre14">
    </code><code class="kd">interface</code><code class="calibre14"> </code><code class="nx">IntrinsicClassAttributes</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="kd">extends</code><code class="calibre14"> </code><code class="nx">React</code><code class="p">.</code><code class="nx">ClassAttributes</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="calibre14"> </code><code class="p">{</code><code class="p">}</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-566" id="calibre_link-574"><img alt="7" src="images/000006.png" class="calibre40" /></a><code class="calibre14">

    </code><code class="kd">interface</code><code class="calibre14"> </code><code class="nx">IntrinsicElements</code><code class="calibre14"> </code><code class="p">{</code><code class="calibre14"> </code><a class="calibre4" href="#calibre_link-567" id="calibre_link-575"><img alt="8" src="images/000007.png" class="calibre40" /></a><code class="calibre14">
      </code><code class="nx">a</code><code class="calibre14">: </code><code class="kt">React.DetailedHTMLProps</code><code class="o">&lt;</code><code class="calibre14">
        </code><code class="nx">React</code><code class="p">.</code><code class="nx">AnchorHTMLAttributes</code><code class="o">&lt;</code><code class="nx">HTMLAnchorElement</code><code class="o">&gt;</code><code class="p">,</code><code class="calibre14">
        </code><code class="nx">HTMLAnchorElement</code><code class="calibre14">
      </code><code class="o">&gt;</code><code class="calibre14">
      </code><code class="nx">abbr</code><code class="calibre14">: </code><code class="kt">React.DetailedHTMLProps</code><code class="o">&lt;</code><code class="calibre14">
        </code><code class="nx">React</code><code class="p">.</code><code class="nx">HTMLAttributes</code><code class="o">&lt;</code><code class="nx">HTMLElement</code><code class="o">&gt;</code><code class="p">,</code><code class="calibre14">
        </code><code class="nx">HTMLElement</code><code class="calibre14">
      </code><code class="o">&gt;</code><code class="calibre14">
      </code><code class="nx">address</code><code class="calibre14">: </code><code class="kt">React.DetailedHTMLProps</code><code class="o">&lt;</code><code class="calibre14">
        </code><code class="nx">React</code><code class="p">.</code><code class="nx">HTMLAttributes</code><code class="o">&lt;</code><code class="nx">HTMLElement</code><code class="o">&gt;</code><code class="p">,</code><code class="calibre14">
        </code><code class="nx">HTMLElement</code><code class="calibre14">
      </code><code class="o">&gt;</code><code class="calibre14">
      </code><code class="c">// ...
</code><code class="calibre14">    </code><code class="p">}</code><code class="calibre14">
  </code><code class="p">}</code><code class="calibre14">
</code><code class="p">}</code></pre>
<dl class="preface">
<dt class="calibre18"><a class="calibre4" href="#calibre_link-568" id="calibre_link-560"><img alt="1" src="images/000000.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45"><code class="calibre14">JSX.Element</code> is the type of a value-based TSX element.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-569" id="calibre_link-561"><img alt="2" src="images/000001.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45"><code class="calibre14">JSX.ElementClass</code> is the type of an instance of a value-based class component. Whenever you declare a class component that you plan to instantiate with TSX’s <code class="calibre14">&lt;MyComponent /&gt;</code> syntax, its class must satisfy this interface.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-570" id="calibre_link-562"><img alt="3" src="images/000002.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45"><code class="calibre14">JSX.ElementAttributesProperty</code> is the name of the property TypeScript looks at to figure out what attributes a component supports. For React, that means the <code class="calibre14">props</code> property. TypeScript looks for this value on a class instance.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-571" id="calibre_link-563"><img alt="4" src="images/000003.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45"><code class="calibre14">JSX.ElementChildrenAttribute</code> is the name of the property that TypeScript looks at to figure out what types of children a component supports. For React, that means the <code class="calibre14">children</code> property.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-572" id="calibre_link-564"><img alt="5" src="images/000004.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45"><code class="calibre14">JSX.IntrinsicAttributes</code> is the set of attributes that all intrinsic elements support. For React, that means the <code class="calibre14">key</code> attribute.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-573" id="calibre_link-565"><img alt="6" src="images/000005.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45"><code class="calibre14">JSX.IntrinsicClassAttributes</code> is the set of attributes that all class components (both intrinsic and value-based) support. For React, that means <code class="calibre14">ref</code>.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-574" id="calibre_link-566"><img alt="7" src="images/000006.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45"><code class="calibre14">JSX.LibraryManagedAttributes</code> specifies other places where JSX elements can declare and initialize property types. For React, that means <code class="calibre14">propTypes</code> as another place to declare property types, and <code class="calibre14">defaultProps</code> as the place to declare default values for properties.</p></dd>
<dt class="calibre18"><a class="calibre4" href="#calibre_link-575" id="calibre_link-567"><img alt="8" src="images/000007.png" class="calibre40" /></a></dt>
<dd class="calibre44"><p class="calibre45"><code class="calibre14">JSX.IntrinsicElements</code> enumerates every type of HTML element that you can use in TSX, mapping each element’s tag name to its attribute and children types. Because JSX isn’t HTML, React’s type declarations have to tell TypeScript exactly what elements someone might use in a TSX expression, and because you can use any standard HTML element from TSX, the declarations have to manually enumerate each element along with its attribute types (for an <code class="calibre14">&lt;a&gt;</code> tag, for example, valid attributes include <code class="calibre14">href: string</code> and <code class="calibre14">rel: string</code>, but not <code class="calibre14">value</code>) and what types of children it might have.</p></dd>
</dl>

<p class="author1">By declaring any of these types in the global JSX namespace, you can hook into TypeScript’s typechecking behavior for TSX and customize it however you want. Unless you’re writing a library that uses TSX (and doesn’t use React), you’ll probably never touch these hooks.<a data-primary="TSX" data-secondary="reference" data-startref="ix_TSXref" data-type="indexterm" id="calibre_link-1543" class="calibre4"></a></p>
</div></section></div>

<div data-type="book" class="calibre1" id="calibre_link-576"><section data-type="index" type="index" class="preface"><div class="index" id="calibre_link-1951"><h1 class="calibre12">Index</h1><div data-type="index" class="preface"><div data-type="indexdiv" class="preface"><h3 class="calibre54"><span data-gentext="indexsymbols" class="calibre">Symbols</span></h3><ul class="printings"><li class="calibre55"><span data-type="index-term" class="calibre">! (exclamation mark), nonnull assertion operator</span>, <a data-type="index:locator" href="#calibre_link-577" class="calibre4">Nonnull Assertions</a></li><li class="calibre55"><span data-type="index-term" class="calibre">&amp; (ampersand), for intersection types</span>, <a data-type="index:locator" href="#calibre_link-578" class="calibre4">Union and intersection types</a>, <a data-type="index:locator" href="#calibre_link-579" class="calibre4">Type Operators for Object Types</a></li><li class="calibre55"><span data-type="index-term" class="calibre">() (parentheses), invoking functions with</span>, <a data-type="index:locator" href="#calibre_link-580" class="calibre4">call, apply, and bind</a></li><li class="calibre55"><span data-type="index-term" class="calibre">* (asterisk), before function names</span>, <a data-type="index:locator" href="#calibre_link-581" class="calibre4">Generator Functions</a></li><li class="calibre55"><span data-type="index-term" class="calibre">+ (plus) type operator</span>, <a data-type="index:locator" href="#calibre_link-582" class="calibre4">Mapped Types</a></li><li class="calibre55"><span data-type="index-term" class="calibre">/// (triple-slash directives)</span>, <a data-type="index:locator" href="#calibre_link-583" class="calibre4">Triple-Slash Directives</a></li><li class="calibre55"><span data-type="index-term" class="calibre">&lt; &gt; (angle brackets)</span><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">enclosing generic type parameters</span>, <a data-type="index:locator" href="#calibre_link-584" class="calibre4">Polymorphism</a></li><li class="calibre55"><span data-type="index-term" class="calibre">in type assertions</span>, <a data-type="index:locator" href="#calibre_link-585" class="calibre4">Type Assertions</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">? (question mark)</span><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">for optional elements in tuples</span>, <a data-type="index:locator" href="#calibre_link-586" class="calibre4">Tuples</a></li><li class="calibre55"><span data-type="index-term" class="calibre">for optional function parameters</span>, <a data-type="index:locator" href="#calibre_link-587" class="calibre4">Optional and Default Parameters</a></li><li class="calibre55"><span data-type="index-term" class="calibre">for optional properties in objects</span>, <a data-type="index:locator" href="#calibre_link-588" class="calibre4">Objects</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">@ts-check comment</span>, <a data-type="index:locator" href="#calibre_link-589" class="calibre4">Step 2a: Enable Typechecking for JavaScript (Optional)</a></li><li class="calibre55"><span data-type="index-term" class="calibre">@ts-ignore comment</span>, <a data-type="index:locator" href="#calibre_link-590" class="calibre4">JavaScript That Doesn’t Have Type Declarations on DefinitelyTyped</a></li><li class="calibre55"><span data-type="index-term" class="calibre">@ts-nocheck comment</span>, <a data-type="index:locator" href="#calibre_link-591" class="calibre4">Step 2a: Enable Typechecking for JavaScript (Optional)</a></li><li class="calibre55"><span data-type="index-term" class="calibre">[] (square brackets)</span><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">index signature syntax</span>, <a data-type="index:locator" href="#calibre_link-592" class="calibre4">Objects</a></li><li class="calibre55"><span data-type="index-term" class="calibre">keying-in operator</span>, <a data-type="index:locator" href="#calibre_link-593" class="calibre4">The infer Keyword</a></li><li class="calibre55"><span data-type="index-term" class="calibre">retrieving enum values</span>, <a data-type="index:locator" href="#calibre_link-594" class="calibre4">Enums</a></li><li class="calibre55"><span data-type="index-term" class="calibre">in tuple declarations</span>, <a data-type="index:locator" href="#calibre_link-595" class="calibre4">Tuples</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">{} (curly braces), defining object literal types with</span>, <a data-type="index:locator" href="#calibre_link-596" class="calibre4">Objects</a></li><li class="calibre55"><span data-type="index-term" class="calibre">| (pipe symbol), for union types</span>, <a data-type="index:locator" href="#calibre_link-597" class="calibre4">Union and intersection types</a>, <a data-type="index:locator" href="#calibre_link-598" class="calibre4">Type Operators for Object Types</a>, <a data-type="index:locator" href="#calibre_link-599" class="calibre4">In the Browser: With Web Workers</a></li><li class="calibre55"><span data-type="index-term" class="calibre">&ndash; (minus) type operator</span>, <a data-type="index:locator" href="#calibre_link-600" class="calibre4">Mapped Types</a></li><li class="calibre55"><span data-type="index-term" class="calibre">… (ellipsis) in variadic function parameters list</span>, <a data-type="index:locator" href="#calibre_link-601" class="calibre4">Rest Parameters</a></li></ul></div><div data-type="indexdiv" class="preface"><h3 class="calibre54">A</h3><ul class="printings"><li class="calibre55"><span data-type="index-term" class="calibre">abstract classes</span>, <a data-type="index:locator" href="#calibre_link-602" class="calibre4">Classes and Inheritance</a>, <a data-type="index:locator" href="#calibre_link-603" class="calibre4">Classes and Inheritance</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">extending versus implementing interfaces</span>, <a data-type="index:locator" href="#calibre_link-604" class="calibre4">Implementing Interfaces Versus Extending Abstract Classes</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">abstract syntax tree (AST)</span>, <a data-type="index:locator" href="#calibre_link-605" class="calibre4">The Compiler</a></li><li class="calibre55"><span data-type="index-term" class="calibre">actual parameters</span> (<span data-gentext="see" class="calibre">see</span> arguments)</li><li class="calibre55"><span data-type="index-term" class="calibre">Ahead-of-Time (AoT) compiler (Angular)</span>, <a data-type="index:locator" href="#calibre_link-606" class="calibre4">Angular 6/7</a>, <a data-type="index:locator" href="#calibre_link-607" class="calibre4">Services</a></li><li class="calibre55"><span data-type="index-term" class="calibre">aliases (type)</span> (<span data-gentext="see" class="calibre">see</span> type aliases)</li><li class="calibre55"><span data-type="index-term" class="calibre">allowJs TSC flag</span>, <a data-type="index:locator" href="#calibre_link-608" class="calibre4">Step 1: Add TSC</a></li><li class="calibre55"><span data-type="index-term" class="calibre">ambient module declarations</span>, <a data-type="index:locator" href="#calibre_link-609" class="calibre4">Ambient Module Declarations</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">creating for third-party JavaScript</span>, <a data-type="index:locator" href="#calibre_link-610" class="calibre4">JavaScript That Doesn’t Have Type Declarations on DefinitelyTyped</a></li><li class="calibre55"><span data-type="index-term" class="calibre">wildcard</span>, <a data-type="index:locator" href="#calibre_link-611" class="calibre4">Ambient Module Declarations</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">ambient type declarations</span>, <a data-type="index:locator" href="#calibre_link-612" class="calibre4">Ambient Type Declarations</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">defining TODO as type alias for any</span>, <a data-type="index:locator" href="#calibre_link-613" class="calibre4">Step 3: Rename Your Files to .ts</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">ambient variable declarations</span>, <a data-type="index:locator" href="#calibre_link-614" class="calibre4">Ambient Variable Declarations</a></li><li class="calibre55"><span data-type="index-term" class="calibre">AMD module standard</span>, <a data-type="index:locator" href="#calibre_link-615" class="calibre4">A Brief History of JavaScript Modules</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">consuming JavaScript module that uses</span>, <a data-type="index:locator" href="#calibre_link-616" class="calibre4">Using CommonJS and AMD Code</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">amd-module directive</span>, <a data-type="index:locator" href="#calibre_link-617" class="calibre4">The amd-module Directive</a></li><li class="calibre55"><span data-type="index-term" class="calibre">Angular 6/7</span>, <a data-type="index:locator" href="#calibre_link-618" class="calibre4">Angular 6/7</a>-<a data-type="index:locator" href="#calibre_link-619" class="calibre4">Services</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">components</span>, <a data-type="index:locator" href="#calibre_link-620" class="calibre4">Components</a></li><li class="calibre55"><span data-type="index-term" class="calibre">initializing a project</span>, <a data-type="index:locator" href="#calibre_link-621" class="calibre4">Scaffolding</a></li><li class="calibre55"><span data-type="index-term" class="calibre">installing CLI</span>, <a data-type="index:locator" href="#calibre_link-622" class="calibre4">Scaffolding</a></li><li class="calibre55"><span data-type="index-term" class="calibre">services</span>, <a data-type="index:locator" href="#calibre_link-623" class="calibre4">Services</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">angularCompilerOptions</span>, <a data-type="index:locator" href="#calibre_link-624" class="calibre4">Components</a></li><li class="calibre55"><span data-type="index-term" class="calibre">any type</span>, <a data-type="index:locator" href="#calibre_link-625" class="calibre4">any</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">as overloaded function parameter type</span>, <a data-type="index:locator" href="#calibre_link-626" class="calibre4">Overloaded Function Types</a></li><li class="calibre55"><span data-type="index-term" class="calibre">inferred for empty array elements</span>, <a data-type="index:locator" href="#calibre_link-627" class="calibre4">Arrays</a></li><li class="calibre55"><span data-type="index-term" class="calibre">JavaScript types inferred as</span>, <a data-type="index:locator" href="#calibre_link-628" class="calibre4">Step 2a: Enable Typechecking for JavaScript (Optional)</a></li><li class="calibre55"><span data-type="index-term" class="calibre">object versus</span>, <a data-type="index:locator" href="#calibre_link-629" class="calibre4">Objects</a></li><li class="calibre55"><span data-type="index-term" class="calibre">TODO ambient type declaration as type alias for</span>, <a data-type="index:locator" href="#calibre_link-630" class="calibre4">Step 3: Rename Your Files to .ts</a></li><li class="calibre55"><span data-type="index-term" class="calibre">type assertions as</span>, <a data-type="index:locator" href="#calibre_link-631" class="calibre4">Type Assertions</a></li><li class="calibre55"><span data-type="index-term" class="calibre">widening of variables initialized as null or undefined to</span>, <a data-type="index:locator" href="#calibre_link-632" class="calibre4">Type Widening</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">APIs</span><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">application interacting with databases</span>, <a data-type="index:locator" href="#calibre_link-633" class="calibre4">Backend Frameworks</a></li><li class="calibre55"><span data-type="index-term" class="calibre">typesafe, for use with frameworks and TypeScript</span>, <a data-type="index:locator" href="#calibre_link-634" class="calibre4">Typesafe APIs</a>-<a data-type="index:locator" href="#calibre_link-635" class="calibre4">Typesafe APIs</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">apply function</span>, <a data-type="index:locator" href="#calibre_link-636" class="calibre4">call, apply, and bind</a></li><li class="calibre55"><span data-type="index-term" class="calibre">arguments</span><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">defined</span>, <a data-type="index:locator" href="#calibre_link-637" class="calibre4">Declaring and Invoking Functions</a></li><li class="calibre55"><span data-type="index-term" class="calibre">passing in function calls</span>, <a data-type="index:locator" href="#calibre_link-638" class="calibre4">Declaring and Invoking Functions</a></li><li class="calibre55"><span data-type="index-term" class="calibre">variable or fixed number of</span>, <a data-type="index:locator" href="#calibre_link-639" class="calibre4">Rest Parameters</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">arity</span><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">modeling using bounded polymorphism</span>, <a data-type="index:locator" href="#calibre_link-640" class="calibre4">Using bounded polymorphism to model arity</a></li><li class="calibre55"><span data-type="index-term" class="calibre">variadic versus fixed-arity functons</span>, <a data-type="index:locator" href="#calibre_link-641" class="calibre4">Rest Parameters</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">arrays</span>, <a data-type="index:locator" href="#calibre_link-642" class="calibre4">Arrays</a>-<a data-type="index:locator" href="#calibre_link-643" class="calibre4">Read-only arrays and tuples</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">Array type, extending safely</span>, <a data-type="index:locator" href="#calibre_link-644" class="calibre4">Safely Extending the Prototype</a></li><li class="calibre55"><span data-type="index-term" class="calibre">Array.prototype.includes (ES2016)</span>, <a data-type="index:locator" href="#calibre_link-645" class="calibre4">lib</a></li><li class="calibre55"><span data-type="index-term" class="calibre">covariance in array members</span>, <a data-type="index:locator" href="#calibre_link-646" class="calibre4">Shape and array variance</a></li><li class="calibre55"><span data-type="index-term" class="calibre">filtering</span>, <a data-type="index:locator" href="#calibre_link-647" class="calibre4">Polymorphism</a></li><li class="calibre55"><span data-type="index-term" class="calibre">generic functions on Array type</span>, <a data-type="index:locator" href="#calibre_link-648" class="calibre4">Where Can You Declare Generics?</a></li><li class="calibre55"><span data-type="index-term" class="calibre">homogeneous</span>, <a data-type="index:locator" href="#calibre_link-649" class="calibre4">Arrays</a></li><li class="calibre55"><span data-type="index-term" class="calibre">lists of function parameters passed in as</span>, <a data-type="index:locator" href="#calibre_link-650" class="calibre4">Rest Parameters</a></li><li class="calibre55"><span data-type="index-term" class="calibre">read-only</span>, <a data-type="index:locator" href="#calibre_link-651" class="calibre4">Read-only arrays and tuples</a></li><li class="calibre55"><span data-type="index-term" class="calibre">syntaxes for, T[] and Array&lt;T&gt;</span>, <a data-type="index:locator" href="#calibre_link-652" class="calibre4">Arrays</a></li><li class="calibre55"><span data-type="index-term" class="calibre">tuples</span>, <a data-type="index:locator" href="#calibre_link-653" class="calibre4">Tuples</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">as (type assertion)</span>, <a data-type="index:locator" href="#calibre_link-654" class="calibre4">Type Assertions</a></li><li class="calibre55"><span data-type="index-term" class="calibre">as const</span>, <a data-type="index:locator" href="#calibre_link-655" class="calibre4">The const type</a></li><li class="calibre55"><span data-type="index-term" class="calibre">assertions</span><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">definite assignment</span>, <a data-type="index:locator" href="#calibre_link-656" class="calibre4">Definite Assignment Assertions</a></li><li class="calibre55"><span data-type="index-term" class="calibre">nonnull</span>, <a data-type="index:locator" href="#calibre_link-657" class="calibre4">Nonnull Assertions</a></li><li class="calibre55"><span data-type="index-term" class="calibre">type</span>, <a data-type="index:locator" href="#calibre_link-658" class="calibre4">Type Assertions</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">assignability</span>, <a data-type="index:locator" href="#calibre_link-659" class="calibre4">Talking About Types</a>, <a data-type="index:locator" href="#calibre_link-660" class="calibre4">Assignability</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">for enums</span>, <a data-type="index:locator" href="#calibre_link-661" class="calibre4">Enums</a></li><li class="calibre55"><span data-type="index-term" class="calibre">inferred generic types to explicitly bound generic</span>, <a data-type="index:locator" href="#calibre_link-662" class="calibre4">Generic Type Inference</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">assignment, this variable</span>, <a data-type="index:locator" href="#calibre_link-663" class="calibre4">Typing this</a></li><li class="calibre55"><span data-type="index-term" class="calibre">AST (abstract syntax tree)</span>, <a data-type="index:locator" href="#calibre_link-664" class="calibre4">The Compiler</a></li><li class="calibre55"><span data-type="index-term" class="calibre">async and await syntax</span>, <a data-type="index:locator" href="#calibre_link-665" class="calibre4">Asynchronous Programming, Concurrency, and Parallelism</a>, <a data-type="index:locator" href="#calibre_link-666" class="calibre4">async and await</a></li><li class="calibre55"><span data-type="index-term" class="calibre">asynchronous programming</span>, <a data-type="index:locator" href="#calibre_link-667" class="calibre4">Asynchronous Programming, Concurrency, and Parallelism</a>-<a data-type="index:locator" href="#calibre_link-668" class="calibre4">Typesafe Multithreading</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">async and await</span>, <a data-type="index:locator" href="#calibre_link-669" class="calibre4">async and await</a></li><li class="calibre55"><span data-type="index-term" class="calibre">async streams</span>, <a data-type="index:locator" href="#calibre_link-670" class="calibre4">Async Streams</a>-<a data-type="index:locator" href="#calibre_link-671" class="calibre4">Typesafe Multithreading</a><ul class="calibre57"><li class="calibre55"><span data-type="index-term" class="calibre">event emitters</span>, <a data-type="index:locator" href="#calibre_link-672" class="calibre4">Event Emitters</a>-<a data-type="index:locator" href="#calibre_link-673" class="calibre4">Typesafe Multithreading</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">callbacks</span>, <a data-type="index:locator" href="#calibre_link-674" class="calibre4">Working with Callbacks</a>-<a data-type="index:locator" href="#calibre_link-675" class="calibre4">Working with Callbacks</a></li><li class="calibre55"><span data-type="index-term" class="calibre">JavaScript's event loop</span>, <a data-type="index:locator" href="#calibre_link-676" class="calibre4">JavaScript’s Event Loop</a>-<a data-type="index:locator" href="#calibre_link-677" class="calibre4">JavaScript’s Event Loop</a></li><li class="calibre55"><span data-type="index-term" class="calibre">promises</span>, <a data-type="index:locator" href="#calibre_link-678" class="calibre4">Regaining Sanity with Promises</a>-<a data-type="index:locator" href="#calibre_link-679" class="calibre4">Regaining Sanity with Promises</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">asynchronously loading modules</span>, <a data-type="index:locator" href="#calibre_link-680" class="calibre4">A Brief History of JavaScript Modules</a></li></ul></div><div data-type="indexdiv" class="preface"><h3 class="calibre54">B</h3><ul class="printings"><li class="calibre55"><span data-type="index-term" class="calibre">Babel, running typechecked TypeScript code through</span>, <a data-type="index:locator" href="#calibre_link-681" class="calibre4">lib</a></li><li class="calibre55"><span data-type="index-term" class="calibre">backend frameworks</span>, <a data-type="index:locator" href="#calibre_link-682" class="calibre4">Backend Frameworks</a></li><li class="calibre55"><span data-type="index-term" class="calibre">bigint type</span>, <a data-type="index:locator" href="#calibre_link-683" class="calibre4">bigint</a></li><li class="calibre55"><span data-type="index-term" class="calibre">binary trees</span>, <a data-type="index:locator" href="#calibre_link-684" class="calibre4">Bounded Polymorphism</a></li><li class="calibre55"><span data-type="index-term" class="calibre">bind function</span>, <a data-type="index:locator" href="#calibre_link-685" class="calibre4">call, apply, and bind</a></li><li class="calibre55"><span data-type="index-term" class="calibre">binding</span><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">for generic type parameters</span>, <a data-type="index:locator" href="#calibre_link-686" class="calibre4">Polymorphism</a></li><li class="calibre55"><span data-type="index-term" class="calibre">of generics, when it happens</span>, <a data-type="index:locator" href="#calibre_link-687" class="calibre4">When Are Generics Bound?</a>-<a data-type="index:locator" href="#calibre_link-688" class="calibre4">Where Can You Declare Generics?</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">boolean type</span>, <a data-type="index:locator" href="#calibre_link-689" class="calibre4">All About Types</a>, <a data-type="index:locator" href="#calibre_link-690" class="calibre4">boolean</a></li><li class="calibre55"><span data-type="index-term" class="calibre">bottom type</span>, <a data-type="index:locator" href="#calibre_link-691" class="calibre4">null, undefined, void, and never</a></li><li class="calibre55"><span data-type="index-term" class="calibre">bounded polymorphism</span>, <a data-type="index:locator" href="#calibre_link-692" class="calibre4">Bounded Polymorphism</a>-<a data-type="index:locator" href="#calibre_link-693" class="calibre4">Using bounded polymorphism to model arity</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">using to model arity</span>, <a data-type="index:locator" href="#calibre_link-694" class="calibre4">Using bounded polymorphism to model arity</a></li><li class="calibre55"><span data-type="index-term" class="calibre">with multiple constraints</span>, <a data-type="index:locator" href="#calibre_link-695" class="calibre4">Bounded polymorphism with multiple constraints</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">bounds</span>, <a data-type="index:locator" href="#calibre_link-696" class="calibre4">Talking About Types</a></li><li class="calibre55"><span data-type="index-term" class="calibre">Browserify</span>, <a data-type="index:locator" href="#calibre_link-697" class="calibre4">A Brief History of JavaScript Modules</a></li><li class="calibre55"><span data-type="index-term" class="calibre">browsers</span><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">loading and running JavaScript</span>, <a data-type="index:locator" href="#calibre_link-698" class="calibre4">A Brief History of JavaScript Modules</a></li><li class="calibre55"><span data-type="index-term" class="calibre">module-loadable format for</span>, <a data-type="index:locator" href="#calibre_link-699" class="calibre4">A Brief History of JavaScript Modules</a></li><li class="calibre55"><span data-type="index-term" class="calibre">overloads in browser DOM APIs</span>, <a data-type="index:locator" href="#calibre_link-700" class="calibre4">Overloaded Function Types</a></li><li class="calibre55"><span data-type="index-term" class="calibre">preferring modules over namespaces</span>, <a data-type="index:locator" href="#calibre_link-701" class="calibre4">Compiled Output</a></li><li class="calibre55"><span data-type="index-term" class="calibre">running JavaScript in, polyfills and</span>, <a data-type="index:locator" href="#calibre_link-702" class="calibre4">lib</a></li><li class="calibre55"><span data-type="index-term" class="calibre">running TypeScript code in</span>, <a data-type="index:locator" href="#calibre_link-703" class="calibre4">Running TypeScript in the Browser</a></li><li class="calibre55"><span data-type="index-term" class="calibre">typesafe multithreading with Web Workers</span>, <a data-type="index:locator" href="#calibre_link-704" class="calibre4">In the Browser: With Web Workers</a>-<a data-type="index:locator" href="#calibre_link-705" class="calibre4">Typesafe protocols</a><ul class="calibre57"><li class="calibre55"><span data-type="index-term" class="calibre">typesafe protocols</span>, <a data-type="index:locator" href="#calibre_link-706" class="calibre4">Typesafe protocols</a></li></ul></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">build flag (TSC)</span>, <a data-type="index:locator" href="#calibre_link-707" class="calibre4">Project References</a></li><li class="calibre55"><span data-type="index-term" class="calibre">build tools</span>, <a data-type="index:locator" href="#calibre_link-708" class="calibre4">Running TypeScript in the Browser</a></li><li class="calibre55"><span data-type="index-term" class="calibre">builder pattern</span>, <a data-type="index:locator" href="#calibre_link-709" class="calibre4">Builder Pattern</a></li><li class="calibre55"><span data-type="index-term" class="calibre">bytecode</span>, <a data-type="index:locator" href="#calibre_link-710" class="calibre4">The Compiler</a></li></ul></div><div data-type="indexdiv" class="preface"><h3 class="calibre54">C</h3><ul class="printings"><li class="calibre55"><span data-type="index-term" class="calibre">call function</span>, <a data-type="index:locator" href="#calibre_link-711" class="calibre4">call, apply, and bind</a></li><li class="calibre55"><span data-type="index-term" class="calibre">call signatures</span>, <a data-type="index:locator" href="#calibre_link-712" class="calibre4">Call Signatures</a>-<a data-type="index:locator" href="#calibre_link-713" class="calibre4">Call Signatures</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">declaring generics as part of</span>, <a data-type="index:locator" href="#calibre_link-714" class="calibre4">When Are Generics Bound?</a></li><li class="calibre55"><span data-type="index-term" class="calibre">implementing, example</span>, <a data-type="index:locator" href="#calibre_link-715" class="calibre4">Call Signatures</a></li><li class="calibre55"><span data-type="index-term" class="calibre">in type-driven development</span>, <a data-type="index:locator" href="#calibre_link-716" class="calibre4">Type-Driven Development</a></li><li class="calibre55"><span data-type="index-term" class="calibre">overloaded</span>, <a data-type="index:locator" href="#calibre_link-717" class="calibre4">Overloaded Function Types</a>-<a data-type="index:locator" href="#calibre_link-718" class="calibre4">Overloaded Function Types</a></li><li class="calibre55"><span data-type="index-term" class="calibre">shorthand  versus written out fully</span>, <a data-type="index:locator" href="#calibre_link-719" class="calibre4">Overloaded Function Types</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">callbacks</span>, <a data-type="index:locator" href="#calibre_link-720" class="calibre4">Working with Callbacks</a>-<a data-type="index:locator" href="#calibre_link-721" class="calibre4">Working with Callbacks</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">appendAndRead function example</span>, <a data-type="index:locator" href="#calibre_link-722" class="calibre4">Regaining Sanity with Promises</a></li><li class="calibre55"><span data-type="index-term" class="calibre">callback pyramids</span>, <a data-type="index:locator" href="#calibre_link-723" class="calibre4">Working with Callbacks</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">catch clause</span>, <a data-type="index:locator" href="#calibre_link-724" class="calibre4">Regaining Sanity with Promises</a>, <a data-type="index:locator" href="#calibre_link-725" class="calibre4">async and await</a></li><li class="calibre55"><span data-type="index-term" class="calibre">channels, emitting events on</span>, <a data-type="index:locator" href="#calibre_link-726" class="calibre4">Event Emitters</a></li><li class="calibre55"><span data-type="index-term" class="calibre">checkJs TSC flag</span>, <a data-type="index:locator" href="#calibre_link-727" class="calibre4">Step 2a: Enable Typechecking for JavaScript (Optional)</a></li><li class="calibre55"><span data-type="index-term" class="calibre">class keyword</span>, <a data-type="index:locator" href="#calibre_link-728" class="calibre4">Classes and Inheritance</a></li><li class="calibre55"><span data-type="index-term" class="calibre">classes</span>, <a data-type="index:locator" href="#calibre_link-729" class="calibre4">Classes and Interfaces</a>-<a data-type="index:locator" href="#calibre_link-730" class="calibre4">Using this as a Return Type</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">and inheritance</span>, <a data-type="index:locator" href="#calibre_link-731" class="calibre4">Classes and Inheritance</a><ul class="calibre57"><li class="calibre55"><span data-type="index-term" class="calibre">abstract classes</span>, <a data-type="index:locator" href="#calibre_link-732" class="calibre4">Classes and Inheritance</a></li><li class="calibre55"><span data-type="index-term" class="calibre">access modifiers for properties and methods</span>, <a data-type="index:locator" href="#calibre_link-733" class="calibre4">Classes and Inheritance</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">binding of generics</span>, <a data-type="index:locator" href="#calibre_link-734" class="calibre4">When Are Generics Bound?</a></li><li class="calibre55"><span data-type="index-term" class="calibre">covariance in class members</span>, <a data-type="index:locator" href="#calibre_link-735" class="calibre4">Shape and array variance</a></li><li class="calibre55"><span data-type="index-term" class="calibre">declaring both values and types</span>, <a data-type="index:locator" href="#calibre_link-736" class="calibre4">Classes Declare Both Values and Types</a></li><li class="calibre55"><span data-type="index-term" class="calibre">declaring, type declarations and</span>, <a data-type="index:locator" href="#calibre_link-737" class="calibre4">Type Declarations</a></li><li class="calibre55"><span data-type="index-term" class="calibre">decorators</span>, <a data-type="index:locator" href="#calibre_link-738" class="calibre4">Decorators</a>-<a data-type="index:locator" href="#calibre_link-739" class="calibre4">Decorators</a></li><li class="calibre55"><span data-type="index-term" class="calibre">design patterns</span>, <a data-type="index:locator" href="#calibre_link-740" class="calibre4">Design Patterns</a>-<a data-type="index:locator" href="#calibre_link-741" class="calibre4">Builder Pattern</a><ul class="calibre57"><li class="calibre55"><span data-type="index-term" class="calibre">builder pattern</span>, <a data-type="index:locator" href="#calibre_link-742" class="calibre4">Builder Pattern</a></li><li class="calibre55"><span data-type="index-term" class="calibre">factory pattern</span>, <a data-type="index:locator" href="#calibre_link-743" class="calibre4">Factory Pattern</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">implementing interfaces</span>, <a data-type="index:locator" href="#calibre_link-744" class="calibre4">Implementations</a><ul class="calibre57"><li class="calibre55"><span data-type="index-term" class="calibre">versus extending abstract classes</span>, <a data-type="index:locator" href="#calibre_link-745" class="calibre4">Implementing Interfaces Versus Extending Abstract Classes</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">mixins</span>, <a data-type="index:locator" href="#calibre_link-746" class="calibre4">Mixins</a>-<a data-type="index:locator" href="#calibre_link-747" class="calibre4">Decorators</a></li><li class="calibre55"><span data-type="index-term" class="calibre">polymorphism</span>, <a data-type="index:locator" href="#calibre_link-748" class="calibre4">Polymorphism</a></li><li class="calibre55"><span data-type="index-term" class="calibre">simulating final classes</span>, <a data-type="index:locator" href="#calibre_link-749" class="calibre4">Simulating final Classes</a></li><li class="calibre55"><span data-type="index-term" class="calibre">structural typing</span>, <a data-type="index:locator" href="#calibre_link-750" class="calibre4">Classes Are Structurally Typed</a></li><li class="calibre55"><span data-type="index-term" class="calibre">super calls</span>, <a data-type="index:locator" href="#calibre_link-751" class="calibre4">super</a></li><li class="calibre55"><span data-type="index-term" class="calibre">using this as return type</span>, <a data-type="index:locator" href="#calibre_link-752" class="calibre4">Using this as a Return Type</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">classic mode (moduleResolution flag)</span>, <a data-type="index:locator" href="#calibre_link-753" class="calibre4">Declaration Merging</a></li><li class="calibre55"><span data-type="index-term" class="calibre">CLI (command-line interface) in Angular</span>, <a data-type="index:locator" href="#calibre_link-754" class="calibre4">Angular 6/7</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">installing</span>, <a data-type="index:locator" href="#calibre_link-755" class="calibre4">Scaffolding</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">client/server communications</span>, <a data-type="index:locator" href="#calibre_link-756" class="calibre4">Typesafe APIs</a>-<a data-type="index:locator" href="#calibre_link-757" class="calibre4">Typesafe APIs</a></li><li class="calibre55"><span data-type="index-term" class="calibre">code editors</span>, <a data-type="index:locator" href="#calibre_link-758" class="calibre4">When are types checked?</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">setting up for TypeScript</span>, <a data-type="index:locator" href="#calibre_link-759" class="calibre4">Code Editor Setup</a>-<a data-type="index:locator" href="#calibre_link-760" class="calibre4">tslint.json</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">code examples from this book</span>, <a data-type="index:locator" href="#calibre_link-761" class="calibre4">Using Code Examples</a></li><li class="calibre55"><span data-type="index-term" class="calibre">code splitting</span>, <a data-type="index:locator" href="#calibre_link-762" class="calibre4">Dynamic Imports</a></li><li class="calibre55"><span data-type="index-term" class="calibre">code style</span><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">configuring for TSLint</span>, <a data-type="index:locator" href="#calibre_link-763" class="calibre4">tslint.json</a></li><li class="calibre55"><span data-type="index-term" class="calibre">in this book</span>, <a data-type="index:locator" href="#calibre_link-764" class="calibre4">Style</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">CommonJS module setting (TSC)</span>, <a data-type="index:locator" href="#calibre_link-765" class="calibre4">Dialing In Your Compile Target</a></li><li class="calibre55"><span data-type="index-term" class="calibre">CommonJS module standard</span>, <a data-type="index:locator" href="#calibre_link-766" class="calibre4">A Brief History of JavaScript Modules</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">consuming JavaScript module that uses</span>, <a data-type="index:locator" href="#calibre_link-767" class="calibre4">Using CommonJS and AMD Code</a></li><li class="calibre55"><span data-type="index-term" class="calibre">problems with</span>, <a data-type="index:locator" href="#calibre_link-768" class="calibre4">A Brief History of JavaScript Modules</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">companion object pattern</span>, <a data-type="index:locator" href="#calibre_link-769" class="calibre4">Companion Object Pattern</a>, <a data-type="index:locator" href="#calibre_link-770" class="calibre4">Declaration Merging</a></li><li class="calibre55"><span data-type="index-term" class="calibre">compile target for TypeScript projects</span>, <a data-type="index:locator" href="#calibre_link-771" class="calibre4">Dialing In Your Compile Target</a>-<a data-type="index:locator" href="#calibre_link-772" class="calibre4">lib</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">target setting</span>, <a data-type="index:locator" href="#calibre_link-773" class="calibre4">target</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">compilers</span><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">angularCompilerOptions</span>, <a data-type="index:locator" href="#calibre_link-774" class="calibre4">Components</a></li><li class="calibre55"><span data-type="index-term" class="calibre">AoT Angular compiler</span>, <a data-type="index:locator" href="#calibre_link-775" class="calibre4">Services</a></li><li class="calibre55"><span data-type="index-term" class="calibre">TypeScript compiler</span>, <a data-type="index:locator" href="#calibre_link-776" class="calibre4">The Compiler</a>-<a data-type="index:locator" href="#calibre_link-777" class="calibre4">The Compiler</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">components</span><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">Angular</span>, <a data-type="index:locator" href="#calibre_link-778" class="calibre4">Components</a></li><li class="calibre55"><span data-type="index-term" class="calibre">React</span>, <a data-type="index:locator" href="#calibre_link-779" class="calibre4">React</a><ul class="calibre57"><li class="calibre55"><span data-type="index-term" class="calibre">function and class components</span>, <a data-type="index:locator" href="#calibre_link-780" class="calibre4">Using TSX with React</a></li></ul></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">composite (compiler option)</span>, <a data-type="index:locator" href="#calibre_link-781" class="calibre4">Project References</a></li><li class="calibre55"><span data-type="index-term" class="calibre">concrete types</span>, <a data-type="index:locator" href="#calibre_link-782" class="calibre4">Polymorphism</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">binding to generic type parameters</span>, <a data-type="index:locator" href="#calibre_link-783" class="calibre4">Polymorphism</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">conditional types</span>, <a data-type="index:locator" href="#calibre_link-784" class="calibre4">Conditional Types</a>-<a data-type="index:locator" href="#calibre_link-785" class="calibre4">Escape Hatches</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">built-in</span>, <a data-type="index:locator" href="#calibre_link-786" class="calibre4">Built-in Conditional Types</a></li><li class="calibre55"><span data-type="index-term" class="calibre">distributive</span>, <a data-type="index:locator" href="#calibre_link-787" class="calibre4">Distributive Conditionals</a></li><li class="calibre55"><span data-type="index-term" class="calibre">infer keyword, declaring generics inline</span>, <a data-type="index:locator" href="#calibre_link-788" class="calibre4">The infer Keyword</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">const</span><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">array declarations with</span>, <a data-type="index:locator" href="#calibre_link-789" class="calibre4">Arrays</a></li><li class="calibre55"><span data-type="index-term" class="calibre">declaring objects with</span>, <a data-type="index:locator" href="#calibre_link-790" class="calibre4">Objects</a></li><li class="calibre55"><span data-type="index-term" class="calibre">declaring symbols with</span>, <a data-type="index:locator" href="#calibre_link-791" class="calibre4">symbol</a></li><li class="calibre55"><span data-type="index-term" class="calibre">enum declarations with</span>, <a data-type="index:locator" href="#calibre_link-792" class="calibre4">Enums</a><ul class="calibre57"><li class="calibre55"><span data-type="index-term" class="calibre">problems with</span>, <a data-type="index:locator" href="#calibre_link-793" class="calibre4">Enums</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">type declarations with</span>, <a data-type="index:locator" href="#calibre_link-794" class="calibre4">Summary</a></li><li class="calibre55"><span data-type="index-term" class="calibre">using to opt out of type widening at declaration time</span>, <a data-type="index:locator" href="#calibre_link-795" class="calibre4">The const type</a></li><li class="calibre55"><span data-type="index-term" class="calibre">variable declarations with</span>, <a data-type="index:locator" href="#calibre_link-796" class="calibre4">Type aliases</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">const values</span>, <a data-type="index:locator" href="#calibre_link-797" class="calibre4">boolean</a></li><li class="calibre55"><span data-type="index-term" class="calibre">constraints</span>, <a data-type="index:locator" href="#calibre_link-798" class="calibre4">Talking About Types</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">generics as</span>, <a data-type="index:locator" href="#calibre_link-799" class="calibre4">Polymorphism</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">constructor signatures</span>, <a data-type="index:locator" href="#calibre_link-800" class="calibre4">Classes Declare Both Values and Types</a></li><li class="calibre55"><span data-type="index-term" class="calibre">constructors</span><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">class, mixins and</span>, <a data-type="index:locator" href="#calibre_link-801" class="calibre4">Mixins</a></li><li class="calibre55"><span data-type="index-term" class="calibre">extended class constructors</span>, <a data-type="index:locator" href="#calibre_link-802" class="calibre4">Decorators</a></li><li class="calibre55"><span data-type="index-term" class="calibre">private class constructors</span>, <a data-type="index:locator" href="#calibre_link-803" class="calibre4">Simulating final Classes</a></li><li class="calibre55"><span data-type="index-term" class="calibre">safety issues with function constructors</span>, <a data-type="index:locator" href="#calibre_link-804" class="calibre4">Declaring and Invoking Functions</a></li><li class="calibre55"><span data-type="index-term" class="calibre">super calls</span>, <a data-type="index:locator" href="#calibre_link-805" class="calibre4">super</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">contextual typing</span>, <a data-type="index:locator" href="#calibre_link-806" class="calibre4">Contextual Typing</a></li><li class="calibre55"><span data-type="index-term" class="calibre">contravariance</span>, <a data-type="index:locator" href="#calibre_link-807" class="calibre4">Shape and array variance</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">in function parameters and this types</span>, <a data-type="index:locator" href="#calibre_link-808" class="calibre4">Function variance</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">conversions (type)</span>, <a data-type="index:locator" href="#calibre_link-809" class="calibre4">Are types automatically converted?</a></li><li class="calibre55"><span data-type="index-term" class="calibre">core-js library</span>, <a data-type="index:locator" href="#calibre_link-810" class="calibre4">lib</a></li><li class="calibre55"><span data-type="index-term" class="calibre">covariance</span>, <a data-type="index:locator" href="#calibre_link-811" class="calibre4">Shape and array variance</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">in function return types</span>, <a data-type="index:locator" href="#calibre_link-812" class="calibre4">Function variance</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">createElement DOM API</span>, <a data-type="index:locator" href="#calibre_link-813" class="calibre4">Overloaded Function Types</a></li><li class="calibre55"><span data-type="index-term" class="calibre">CSS files, loading</span>, <a data-type="index:locator" href="#calibre_link-814" class="calibre4">Ambient Module Declarations</a></li></ul></div><div data-type="indexdiv" class="preface"><h3 class="calibre54">D</h3><ul class="printings"><li class="calibre55"><span data-type="index-term" class="calibre">.d.ts file extension (type declarations)</span>, <a data-type="index:locator" href="#calibre_link-815" class="calibre4">Type Declarations</a></li><li class="calibre55"><span data-type="index-term" class="calibre">databases, application interacting with</span>, <a data-type="index:locator" href="#calibre_link-816" class="calibre4">Backend Frameworks</a></li><li class="calibre55"><span data-type="index-term" class="calibre">declaration (compiler option)</span>, <a data-type="index:locator" href="#calibre_link-817" class="calibre4">Project References</a></li><li class="calibre55"><span data-type="index-term" class="calibre">declaration maps</span>, <a data-type="index:locator" href="#calibre_link-818" class="calibre4">Artifacts</a></li><li class="calibre55"><span data-type="index-term" class="calibre">declaration merging</span>, <a data-type="index:locator" href="#calibre_link-819" class="calibre4">Declaration Merging</a>, <a data-type="index:locator" href="#calibre_link-820" class="calibre4">Declaration Merging</a>-<a data-type="index:locator" href="#calibre_link-821" class="calibre4">Declaration Merging</a>, <a data-type="index:locator" href="#calibre_link-822" class="calibre4">Does It Merge?</a></li><li class="calibre55"><span data-type="index-term" class="calibre">declarationMap (compiler option)</span>, <a data-type="index:locator" href="#calibre_link-823" class="calibre4">Project References</a></li><li class="calibre55"><span data-type="index-term" class="calibre">declare keyword</span>, <a data-type="index:locator" href="#calibre_link-824" class="calibre4">Type Declarations</a>, <a data-type="index:locator" href="#calibre_link-825" class="calibre4">Type Declarations</a></li><li class="calibre55"><span data-type="index-term" class="calibre">declare module syntax</span>, <a data-type="index:locator" href="#calibre_link-826" class="calibre4">Ambient Module Declarations</a></li><li class="calibre55"><span data-type="index-term" class="calibre">decorators</span>, <a data-type="index:locator" href="#calibre_link-827" class="calibre4">Decorators</a>-<a data-type="index:locator" href="#calibre_link-828" class="calibre4">Decorators</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">example, @serializable decorator</span>, <a data-type="index:locator" href="#calibre_link-829" class="calibre4">Decorators</a></li><li class="calibre55"><span data-type="index-term" class="calibre">expected type signatures for decorator functions</span>, <a data-type="index:locator" href="#calibre_link-830" class="calibre4">Decorators</a></li><li class="calibre55"><span data-type="index-term" class="calibre">use by Angular</span>, <a data-type="index:locator" href="#calibre_link-831" class="calibre4">Components</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">defaults</span><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">for function parameters</span>, <a data-type="index:locator" href="#calibre_link-832" class="calibre4">Optional and Default Parameters</a></li><li class="calibre55"><span data-type="index-term" class="calibre">generic type</span>, <a data-type="index:locator" href="#calibre_link-833" class="calibre4">Generic Type Defaults</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">definite assignment assertions</span>, <a data-type="index:locator" href="#calibre_link-834" class="calibre4">Definite Assignment Assertions</a></li><li class="calibre55"><span data-type="index-term" class="calibre">DefinitelyTyped</span><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">JavaScript with type declarations on</span>, <a data-type="index:locator" href="#calibre_link-835" class="calibre4">JavaScript That Has Type Declarations on DefinitelyTyped</a></li><li class="calibre55"><span data-type="index-term" class="calibre">JavaScript without type declarations on</span>, <a data-type="index:locator" href="#calibre_link-836" class="calibre4">JavaScript That Doesn’t Have Type Declarations on DefinitelyTyped</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">dependency injector (Angular)</span>, <a data-type="index:locator" href="#calibre_link-837" class="calibre4">Services</a></li><li class="calibre55"><span data-type="index-term" class="calibre">design patterns</span>, <a data-type="index:locator" href="#calibre_link-838" class="calibre4">Design Patterns</a>-<a data-type="index:locator" href="#calibre_link-839" class="calibre4">Builder Pattern</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">builder pattern</span>, <a data-type="index:locator" href="#calibre_link-840" class="calibre4">Builder Pattern</a></li><li class="calibre55"><span data-type="index-term" class="calibre">factory pattern</span>, <a data-type="index:locator" href="#calibre_link-841" class="calibre4">Factory Pattern</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">dialog, closing with nonnull assertions</span>, <a data-type="index:locator" href="#calibre_link-842" class="calibre4">Nonnull Assertions</a></li><li class="calibre55"><span data-type="index-term" class="calibre">directives</span><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">triple-slash</span>, <a data-type="index:locator" href="#calibre_link-843" class="calibre4">Triple-Slash Directives</a>-<a data-type="index:locator" href="#calibre_link-844" class="calibre4">The amd-module Directive</a>, <a data-type="index:locator" href="#calibre_link-845" class="calibre4">Triple-Slash Directives</a><ul class="calibre57"><li class="calibre55"><span data-type="index-term" class="calibre">amd-module</span>, <a data-type="index:locator" href="#calibre_link-846" class="calibre4">The amd-module Directive</a></li><li class="calibre55"><span data-type="index-term" class="calibre">types</span>, <a data-type="index:locator" href="#calibre_link-847" class="calibre4">The types Directive</a></li></ul></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">distributive property of conditional types following</span>, <a data-type="index:locator" href="#calibre_link-848" class="calibre4">Distributive Conditionals</a></li><li class="calibre55"><span data-type="index-term" class="calibre">DOM (Document Object Model)</span>, <a data-type="index:locator" href="#calibre_link-849" class="calibre4">Preface</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">DOM type declarations, enabling</span>, <a data-type="index:locator" href="#calibre_link-850" class="calibre4">lib</a></li><li class="calibre55"><span data-type="index-term" class="calibre">enabling DOM APIs in TSC compiler</span>, <a data-type="index:locator" href="#calibre_link-851" class="calibre4">Frontend Frameworks</a></li><li class="calibre55"><span data-type="index-term" class="calibre">events, typed in TypeScript standard library</span>, <a data-type="index:locator" href="#calibre_link-852" class="calibre4">Event Emitters</a></li><li class="calibre55"><span data-type="index-term" class="calibre">overloads in browser DOM APIs</span>, <a data-type="index:locator" href="#calibre_link-853" class="calibre4">Overloaded Function Types</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">dom library for TSC</span>, <a data-type="index:locator" href="#calibre_link-854" class="calibre4">In the Browser: With Web Workers</a></li><li class="calibre55"><span data-type="index-term" class="calibre">Don't Repeat Yourself (DRY)</span>, <a data-type="index:locator" href="#calibre_link-855" class="calibre4">Type aliases</a></li><li class="calibre55"><span data-type="index-term" class="calibre">downlevelIteration TSC flag</span>, <a data-type="index:locator" href="#calibre_link-856" class="calibre4">Iterators</a></li><li class="calibre55"><span data-type="index-term" class="calibre">DRY (Don't Repeat Yourself)</span>, <a data-type="index:locator" href="#calibre_link-857" class="calibre4">Type aliases</a></li><li class="calibre55"><span data-type="index-term" class="calibre">duck typing</span>, <a data-type="index:locator" href="#calibre_link-858" class="calibre4">Objects</a><ul class="calibre56"><li class="calibre55">(<span data-gentext="see" class="calibre">see also</span> structural typing)</li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">dynamic imports</span>, <a data-type="index:locator" href="#calibre_link-859" class="calibre4">Dynamic Imports</a></li></ul></div><div data-type="indexdiv" class="preface"><h3 class="calibre54">E</h3><ul class="printings"><li class="calibre55"><span data-type="index-term" class="calibre">editors</span>, <a data-type="index:locator" href="#calibre_link-860" class="calibre4">When are types checked?</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">autocompletion in</span>, <a data-type="index:locator" href="#calibre_link-861" class="calibre4">Frontend Frameworks</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">Either type</span>, <a data-type="index:locator" href="#calibre_link-862" class="calibre4">The Option Type</a></li><li class="calibre55"><span data-type="index-term" class="calibre">engines (JavaScript)</span>, <a data-type="index:locator" href="#calibre_link-863" class="calibre4">The Compiler</a></li><li class="calibre55"><span data-type="index-term" class="calibre">enums</span>, <a data-type="index:locator" href="#calibre_link-864" class="calibre4">Enums</a>-<a data-type="index:locator" href="#calibre_link-865" class="calibre4">Summary</a>, <a data-type="index:locator" href="#calibre_link-866" class="calibre4">Simulating Nominal Types</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">assignability</span>, <a data-type="index:locator" href="#calibre_link-867" class="calibre4">Assignability</a></li><li class="calibre55"><span data-type="index-term" class="calibre">avoiding use of</span>, <a data-type="index:locator" href="#calibre_link-868" class="calibre4">Enums</a></li><li class="calibre55"><span data-type="index-term" class="calibre">const</span>, <a data-type="index:locator" href="#calibre_link-869" class="calibre4">Enums</a></li><li class="calibre55"><span data-type="index-term" class="calibre">naming conventions</span>, <a data-type="index:locator" href="#calibre_link-870" class="calibre4">Enums</a></li><li class="calibre55"><span data-type="index-term" class="calibre">preserveConstEnums TSC flag</span>, <a data-type="index:locator" href="#calibre_link-871" class="calibre4">Enums</a></li><li class="calibre55"><span data-type="index-term" class="calibre">splitting across multiple declarations</span>, <a data-type="index:locator" href="#calibre_link-872" class="calibre4">Enums</a></li><li class="calibre55"><span data-type="index-term" class="calibre">with explicit numeric values, example of</span>, <a data-type="index:locator" href="#calibre_link-873" class="calibre4">Enums</a></li><li class="calibre55"><span data-type="index-term" class="calibre">with inferred numeric values, example of</span>, <a data-type="index:locator" href="#calibre_link-874" class="calibre4">Enums</a></li><li class="calibre55"><span data-type="index-term" class="calibre">with partially inferred values, example of</span>, <a data-type="index:locator" href="#calibre_link-875" class="calibre4">Enums</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">errors</span><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">error messages in TypeScript</span>, <a data-type="index:locator" href="#calibre_link-876" class="calibre4">Introduction</a></li><li class="calibre55"><span data-type="index-term" class="calibre">handling</span>, <a data-type="index:locator" href="#calibre_link-877" class="calibre4">Handling Errors</a>-<a data-type="index:locator" href="#calibre_link-878" class="calibre4">Exercises</a><ul class="calibre57"><li class="calibre55"><span data-type="index-term" class="calibre">in Promises</span>, <a data-type="index:locator" href="#calibre_link-879" class="calibre4">Regaining Sanity with Promises</a></li><li class="calibre55"><span data-type="index-term" class="calibre">returning exceptions</span>, <a data-type="index:locator" href="#calibre_link-880" class="calibre4">Returning Exceptions</a>-<a data-type="index:locator" href="#calibre_link-881" class="calibre4">Returning Exceptions</a></li><li class="calibre55"><span data-type="index-term" class="calibre">returning null</span>, <a data-type="index:locator" href="#calibre_link-882" class="calibre4">Returning null</a></li><li class="calibre55"><span data-type="index-term" class="calibre">throwing exceptions</span>, <a data-type="index:locator" href="#calibre_link-883" class="calibre4">Throwing Exceptions</a>-<a data-type="index:locator" href="#calibre_link-884" class="calibre4">Throwing Exceptions</a></li><li class="calibre55"><span data-type="index-term" class="calibre">using Option type</span>, <a data-type="index:locator" href="#calibre_link-885" class="calibre4">The Option Type</a>-<a data-type="index:locator" href="#calibre_link-886" class="calibre4">The Option Type</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">in callbacks</span>, <a data-type="index:locator" href="#calibre_link-887" class="calibre4">Working with Callbacks</a></li><li class="calibre55"><span data-type="index-term" class="calibre">in JavaScript</span>, <a data-type="index:locator" href="#calibre_link-888" class="calibre4">Introduction</a></li><li class="calibre55"><span data-type="index-term" class="calibre">in Promise implementation</span>, <a data-type="index:locator" href="#calibre_link-889" class="calibre4">Regaining Sanity with Promises</a></li><li class="calibre55"><span data-type="index-term" class="calibre">monitoring in TypeScript projects</span>, <a data-type="index:locator" href="#calibre_link-890" class="calibre4">Error Monitoring</a></li><li class="calibre55"><span data-type="index-term" class="calibre">surfacing, in JavaScript versus TypeScript</span>, <a data-type="index:locator" href="#calibre_link-891" class="calibre4">When are errors surfaced?</a></li><li class="calibre55"><span data-type="index-term" class="calibre">TypeScript errors</span><ul class="calibre57"><li class="calibre55"><span data-type="index-term" class="calibre">TS1332</span>, <a data-type="index:locator" href="#calibre_link-892" class="calibre4">symbol</a></li><li class="calibre55"><span data-type="index-term" class="calibre">TS1353</span>, <a data-type="index:locator" href="#calibre_link-893" class="calibre4">bigint</a></li><li class="calibre55"><span data-type="index-term" class="calibre">TS2300</span>, <a data-type="index:locator" href="#calibre_link-894" class="calibre4">Type aliases</a>, <a data-type="index:locator" href="#calibre_link-895" class="calibre4">Declaration Merging</a></li><li class="calibre55"><span data-type="index-term" class="calibre">TS2304</span>, <a data-type="index:locator" href="#calibre_link-896" class="calibre4">A JSX primer</a>, <a data-type="index:locator" href="#calibre_link-897" class="calibre4">Ambient Variable Declarations</a></li><li class="calibre55"><span data-type="index-term" class="calibre">TS2314</span>, <a data-type="index:locator" href="#calibre_link-898" class="calibre4">When Are Generics Bound?</a>, <a data-type="index:locator" href="#calibre_link-899" class="calibre4">The infer Keyword</a></li><li class="calibre55"><span data-type="index-term" class="calibre">TS2322</span>, <a data-type="index:locator" href="#calibre_link-900" class="calibre4">boolean</a>, <a data-type="index:locator" href="#calibre_link-901" class="calibre4">bigint</a>, <a data-type="index:locator" href="#calibre_link-902" class="calibre4">string</a>, <a data-type="index:locator" href="#calibre_link-903" class="calibre4">Objects</a>, <a data-type="index:locator" href="#calibre_link-904" class="calibre4">Objects</a>, <a data-type="index:locator" href="#calibre_link-905" class="calibre4">Tuples</a>, <a data-type="index:locator" href="#calibre_link-906" class="calibre4">Generic Type Inference</a>, <a data-type="index:locator" href="#calibre_link-907" class="calibre4">Excess property checking</a></li><li class="calibre55"><span data-type="index-term" class="calibre">TS2339</span>, <a data-type="index:locator" href="#calibre_link-908" class="calibre4">Introduction</a>, <a data-type="index:locator" href="#calibre_link-909" class="calibre4">Objects</a>, <a data-type="index:locator" href="#calibre_link-910" class="calibre4">Read-only arrays and tuples</a>, <a data-type="index:locator" href="#calibre_link-911" class="calibre4">Enums</a>, <a data-type="index:locator" href="#calibre_link-912" class="calibre4">Enums</a>, <a data-type="index:locator" href="#calibre_link-913" class="calibre4">Polymorphism</a>, <a data-type="index:locator" href="#calibre_link-914" class="calibre4">User-Defined Type Guards</a>, <a data-type="index:locator" href="#calibre_link-915" class="calibre4">Frontend Frameworks</a></li><li class="calibre55"><span data-type="index-term" class="calibre">TS2345</span>, <a data-type="index:locator" href="#calibre_link-916" class="calibre4">Introduction</a>, <a data-type="index:locator" href="#calibre_link-917" class="calibre4">Talking About Types</a>, <a data-type="index:locator" href="#calibre_link-918" class="calibre4">Arrays</a>, <a data-type="index:locator" href="#calibre_link-919" class="calibre4">Arrays</a>, <a data-type="index:locator" href="#calibre_link-920" class="calibre4">Enums</a>, <a data-type="index:locator" href="#calibre_link-921" class="calibre4">Declaring and Invoking Functions</a>, <a data-type="index:locator" href="#calibre_link-922" class="calibre4">Classes Are Structurally Typed</a>, <a data-type="index:locator" href="#calibre_link-923" class="calibre4">Shape and array variance</a>, <a data-type="index:locator" href="#calibre_link-924" class="calibre4">Function variance</a>, <a data-type="index:locator" href="#calibre_link-925" class="calibre4">Function variance</a>, <a data-type="index:locator" href="#calibre_link-926" class="calibre4">Excess property checking</a>, <a data-type="index:locator" href="#calibre_link-927" class="calibre4">Excess property checking</a>, <a data-type="index:locator" href="#calibre_link-928" class="calibre4">The keyof operator</a>, <a data-type="index:locator" href="#calibre_link-929" class="calibre4">Nonnull Assertions</a>, <a data-type="index:locator" href="#calibre_link-930" class="calibre4">Simulating Nominal Types</a></li><li class="calibre55"><span data-type="index-term" class="calibre">TS2362</span>, <a data-type="index:locator" href="#calibre_link-931" class="calibre4">Generic Type Inference</a></li><li class="calibre55"><span data-type="index-term" class="calibre">TS2365</span>, <a data-type="index:locator" href="#calibre_link-932" class="calibre4">Introduction</a>, <a data-type="index:locator" href="#calibre_link-933" class="calibre4">Are types automatically converted?</a></li><li class="calibre55"><span data-type="index-term" class="calibre">TS2366</span>, <a data-type="index:locator" href="#calibre_link-934" class="calibre4">Totality</a></li><li class="calibre55"><span data-type="index-term" class="calibre">TS2367</span>, <a data-type="index:locator" href="#calibre_link-935" class="calibre4">symbol</a></li><li class="calibre55"><span data-type="index-term" class="calibre">TS2393</span>, <a data-type="index:locator" href="#calibre_link-936" class="calibre4">Collisions</a></li><li class="calibre55"><span data-type="index-term" class="calibre">TS2428</span>, <a data-type="index:locator" href="#calibre_link-937" class="calibre4">Declaration Merging</a></li><li class="calibre55"><span data-type="index-term" class="calibre">TS2430</span>, <a data-type="index:locator" href="#calibre_link-938" class="calibre4">Interfaces</a></li><li class="calibre55"><span data-type="index-term" class="calibre">TS2454</span>, <a data-type="index:locator" href="#calibre_link-939" class="calibre4">Definite Assignment Assertions</a></li><li class="calibre55"><span data-type="index-term" class="calibre">TS2469</span>, <a data-type="index:locator" href="#calibre_link-940" class="calibre4">symbol</a></li><li class="calibre55"><span data-type="index-term" class="calibre">TS2476</span>, <a data-type="index:locator" href="#calibre_link-941" class="calibre4">Enums</a></li><li class="calibre55"><span data-type="index-term" class="calibre">TS2511</span>, <a data-type="index:locator" href="#calibre_link-942" class="calibre4">Classes and Inheritance</a></li><li class="calibre55"><span data-type="index-term" class="calibre">TS2531</span>, <a data-type="index:locator" href="#calibre_link-943" class="calibre4">Nonnull Assertions</a></li><li class="calibre55"><span data-type="index-term" class="calibre">TS2532</span>, <a data-type="index:locator" href="#calibre_link-944" class="calibre4">Objects</a></li><li class="calibre55"><span data-type="index-term" class="calibre">TS2540</span>, <a data-type="index:locator" href="#calibre_link-945" class="calibre4">Objects</a></li><li class="calibre55"><span data-type="index-term" class="calibre">TS2542</span>, <a data-type="index:locator" href="#calibre_link-946" class="calibre4">Read-only arrays and tuples</a></li><li class="calibre55"><span data-type="index-term" class="calibre">TS2554</span>, <a data-type="index:locator" href="#calibre_link-947" class="calibre4">Declaring and Invoking Functions</a>, <a data-type="index:locator" href="#calibre_link-948" class="calibre4">Rest Parameters</a>, <a data-type="index:locator" href="#calibre_link-949" class="calibre4">Using bounded polymorphism to model arity</a></li><li class="calibre55"><span data-type="index-term" class="calibre">TS2558</span>, <a data-type="index:locator" href="#calibre_link-950" class="calibre4">Generic Type Inference</a></li><li class="calibre55"><span data-type="index-term" class="calibre">TS2571</span>, <a data-type="index:locator" href="#calibre_link-951" class="calibre4">unknown</a></li><li class="calibre55"><span data-type="index-term" class="calibre">TS2684</span>, <a data-type="index:locator" href="#calibre_link-952" class="calibre4">Typing this</a></li><li class="calibre55"><span data-type="index-term" class="calibre">TS2706</span>, <a data-type="index:locator" href="#calibre_link-953" class="calibre4">Generic Type Defaults</a></li><li class="calibre55"><span data-type="index-term" class="calibre">TS2717</span>, <a data-type="index:locator" href="#calibre_link-954" class="calibre4">Declaration Merging</a></li><li class="calibre55"><span data-type="index-term" class="calibre">TS2739</span>, <a data-type="index:locator" href="#calibre_link-955" class="calibre4">The Record Type</a></li><li class="calibre55"><span data-type="index-term" class="calibre">TS2741</span>, <a data-type="index:locator" href="#calibre_link-956" class="calibre4">Objects</a>, <a data-type="index:locator" href="#calibre_link-957" class="calibre4">Objects</a></li><li class="calibre55"><span data-type="index-term" class="calibre">TS7006</span>, <a data-type="index:locator" href="#calibre_link-958" class="calibre4">Contextual Typing</a></li><li class="calibre55"><span data-type="index-term" class="calibre">TS7030</span>, <a data-type="index:locator" href="#calibre_link-959" class="calibre4">Totality</a></li></ul></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">ES2015</span>, <a data-type="index:locator" href="#calibre_link-960" class="calibre4">A Brief History of JavaScript Modules</a></li><li class="calibre55"><span data-type="index-term" class="calibre">escape hatches</span>, <a data-type="index:locator" href="#calibre_link-961" class="calibre4">Escape Hatches</a>-<a data-type="index:locator" href="#calibre_link-962" class="calibre4">Definite Assignment Assertions</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">definite assignment assertions</span>, <a data-type="index:locator" href="#calibre_link-963" class="calibre4">Definite Assignment Assertions</a></li><li class="calibre55"><span data-type="index-term" class="calibre">nonnull assertions</span>, <a data-type="index:locator" href="#calibre_link-964" class="calibre4">Nonnull Assertions</a></li><li class="calibre55"><span data-type="index-term" class="calibre">simulating nominal types</span>, <a data-type="index:locator" href="#calibre_link-965" class="calibre4">Simulating Nominal Types</a>-<a data-type="index:locator" href="#calibre_link-966" class="calibre4">Simulating Nominal Types</a></li><li class="calibre55"><span data-type="index-term" class="calibre">type assertions</span>, <a data-type="index:locator" href="#calibre_link-967" class="calibre4">Type Assertions</a>-<a data-type="index:locator" href="#calibre_link-968" class="calibre4">Type Assertions</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">esModuleInterop TSC flag</span>, <a data-type="index:locator" href="#calibre_link-969" class="calibre4">A JSX primer</a>, <a data-type="index:locator" href="#calibre_link-970" class="calibre4">Using CommonJS and AMD Code</a></li><li class="calibre55"><span data-type="index-term" class="calibre">ESNext features</span>, <a data-type="index:locator" href="#calibre_link-971" class="calibre4">target</a></li><li class="calibre55"><span data-type="index-term" class="calibre">esnext module mode</span>, <a data-type="index:locator" href="#calibre_link-972" class="calibre4">Dynamic Imports</a></li><li class="calibre55"><span data-type="index-term" class="calibre">event emitters</span>, <a data-type="index:locator" href="#calibre_link-973" class="calibre4">Async Streams</a>, <a data-type="index:locator" href="#calibre_link-974" class="calibre4">Typesafe Multithreading</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">using in multithreading with Web Workers</span>, <a data-type="index:locator" href="#calibre_link-975" class="calibre4">In the Browser: With Web Workers</a>-<a data-type="index:locator" href="#calibre_link-976" class="calibre4">In the Browser: With Web Workers</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">event loop</span>, <a data-type="index:locator" href="#calibre_link-977" class="calibre4">JavaScript’s Event Loop</a>-<a data-type="index:locator" href="#calibre_link-978" class="calibre4">JavaScript’s Event Loop</a></li><li class="calibre55"><span data-type="index-term" class="calibre">event queue</span>, <a data-type="index:locator" href="#calibre_link-979" class="calibre4">JavaScript’s Event Loop</a></li><li class="calibre55"><span data-type="index-term" class="calibre">exceptions</span>, <a data-type="index:locator" href="#calibre_link-980" class="calibre4">Handling Errors</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">handling</span>, <a data-type="index:locator" href="#calibre_link-981" class="calibre4">Handling Errors</a><ul class="calibre57"><li class="calibre55">(<span data-gentext="see" class="calibre">see also</span> errors, handling)</li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">JavaScript and</span>, <a data-type="index:locator" href="#calibre_link-982" class="calibre4">Introduction</a></li><li class="calibre55"><span data-type="index-term" class="calibre">returning</span>, <a data-type="index:locator" href="#calibre_link-983" class="calibre4">Returning Exceptions</a>-<a data-type="index:locator" href="#calibre_link-984" class="calibre4">Returning Exceptions</a></li><li class="calibre55"><span data-type="index-term" class="calibre">throwing</span>, <a data-type="index:locator" href="#calibre_link-985" class="calibre4">Throwing Exceptions</a>-<a data-type="index:locator" href="#calibre_link-986" class="calibre4">Throwing Exceptions</a><ul class="calibre57"><li class="calibre55"><span data-type="index-term" class="calibre">in Promises</span>, <a data-type="index:locator" href="#calibre_link-987" class="calibre4">Regaining Sanity with Promises</a></li></ul></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">excess property checking</span>, <a data-type="index:locator" href="#calibre_link-988" class="calibre4">Excess property checking</a></li><li class="calibre55"><span data-type="index-term" class="calibre">executors</span>, <a data-type="index:locator" href="#calibre_link-989" class="calibre4">Regaining Sanity with Promises</a></li><li class="calibre55"><span data-type="index-term" class="calibre">exhaustiveness checking</span>, <a data-type="index:locator" href="#calibre_link-990" class="calibre4">Totality</a><ul class="calibre56"><li class="calibre55">(<span data-gentext="see" class="calibre">see also</span> totality)</li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">experimentalDecorators TSC flag</span>, <a data-type="index:locator" href="#calibre_link-991" class="calibre4">Decorators</a></li><li class="calibre55"><span data-type="index-term" class="calibre">exports</span><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">CommonJS</span>, <a data-type="index:locator" href="#calibre_link-992" class="calibre4">A Brief History of JavaScript Modules</a></li><li class="calibre55"><span data-type="index-term" class="calibre">ES2015 standard for</span>, <a data-type="index:locator" href="#calibre_link-993" class="calibre4">A Brief History of JavaScript Modules</a>-<a data-type="index:locator" href="#calibre_link-994" class="calibre4">import, export</a></li><li class="calibre55"><span data-type="index-term" class="calibre">module mode versus script mode</span>, <a data-type="index:locator" href="#calibre_link-995" class="calibre4">Module Mode Versus Script Mode</a></li><li class="calibre55"><span data-type="index-term" class="calibre">module.exports</span>, <a data-type="index:locator" href="#calibre_link-996" class="calibre4">A Brief History of JavaScript Modules</a></li><li class="calibre55"><span data-type="index-term" class="calibre">namespace</span>, <a data-type="index:locator" href="#calibre_link-997" class="calibre4">Namespaces</a></li><li class="calibre55"><span data-type="index-term" class="calibre">using CommonJS and AMD code</span>, <a data-type="index:locator" href="#calibre_link-998" class="calibre4">Using CommonJS and AMD Code</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">extends keyword</span>, <a data-type="index:locator" href="#calibre_link-999" class="calibre4">Classes and Inheritance</a></li><li class="calibre55"><span data-type="index-term" class="calibre">extends option (TSC)</span>, <a data-type="index:locator" href="#calibre_link-1000" class="calibre4">Project References</a></li></ul></div><div data-type="indexdiv" class="preface"><h3 class="calibre54">F</h3><ul class="printings"><li class="calibre55"><span data-type="index-term" class="calibre">factory pattern</span>, <a data-type="index:locator" href="#calibre_link-1001" class="calibre4">Factory Pattern</a></li><li class="calibre55"><span data-type="index-term" class="calibre">filesystem, module paths as filenames on</span>, <a data-type="index:locator" href="#calibre_link-1002" class="calibre4">import, export</a></li><li class="calibre55"><span data-type="index-term" class="calibre">final classes, simulating</span>, <a data-type="index:locator" href="#calibre_link-1003" class="calibre4">Simulating final Classes</a></li><li class="calibre55"><span data-type="index-term" class="calibre">finally clause</span>, <a data-type="index:locator" href="#calibre_link-1004" class="calibre4">async and await</a></li><li class="calibre55"><span data-type="index-term" class="calibre">fixed-arity functions</span>, <a data-type="index:locator" href="#calibre_link-1005" class="calibre4">Rest Parameters</a></li><li class="calibre55"><span data-type="index-term" class="calibre">flow-based type inference</span>, <a data-type="index:locator" href="#calibre_link-1006" class="calibre4">Refinement</a></li><li class="calibre55"><span data-type="index-term" class="calibre">folder structure for TypeScript projects</span>, <a data-type="index:locator" href="#calibre_link-1007" class="calibre4">index.ts</a>, <a data-type="index:locator" href="#calibre_link-1008" class="calibre4">Project Layout</a></li><li class="calibre55"><span data-type="index-term" class="calibre">formal parameters</span> (<span data-gentext="see" class="calibre">see</span> parameters)</li><li class="calibre55"><span data-type="index-term" class="calibre">frameworks</span>, <a data-type="index:locator" href="#calibre_link-1009" class="calibre4">Frontend and Backend Frameworks</a>-<a data-type="index:locator" href="#calibre_link-1010" class="calibre4">Summary</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">backend</span>, <a data-type="index:locator" href="#calibre_link-1011" class="calibre4">Backend Frameworks</a></li><li class="calibre55"><span data-type="index-term" class="calibre">frontend</span>, <a data-type="index:locator" href="#calibre_link-1012" class="calibre4">Frontend and Backend Frameworks</a>-<a data-type="index:locator" href="#calibre_link-1013" class="calibre4">Services</a><ul class="calibre57"><li class="calibre55"><span data-type="index-term" class="calibre">Angular 6/7</span>, <a data-type="index:locator" href="#calibre_link-1014" class="calibre4">Angular 6/7</a>-<a data-type="index:locator" href="#calibre_link-1015" class="calibre4">Services</a></li><li class="calibre55"><span data-type="index-term" class="calibre">enabling DOM APIs in tsconfig.json</span>, <a data-type="index:locator" href="#calibre_link-1016" class="calibre4">Frontend Frameworks</a></li><li class="calibre55"><span data-type="index-term" class="calibre">React</span>, <a data-type="index:locator" href="#calibre_link-1017" class="calibre4">React</a>-<a data-type="index:locator" href="#calibre_link-1018" class="calibre4">Using TSX with React</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">typesafe APIs for</span>, <a data-type="index:locator" href="#calibre_link-1019" class="calibre4">Typesafe APIs</a>-<a data-type="index:locator" href="#calibre_link-1020" class="calibre4">Typesafe APIs</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">fresh object literal type</span>, <a data-type="index:locator" href="#calibre_link-1021" class="calibre4">Excess property checking</a></li><li class="calibre55"><span data-type="index-term" class="calibre">fullTemplateTypeCheck TSC flag</span>, <a data-type="index:locator" href="#calibre_link-1022" class="calibre4">Components</a></li><li class="calibre55"><span data-type="index-term" class="calibre">Function type</span>, <a data-type="index:locator" href="#calibre_link-1023" class="calibre4">Call Signatures</a></li><li class="calibre55"><span data-type="index-term" class="calibre">functions</span>, <a data-type="index:locator" href="#calibre_link-1024" class="calibre4">Functions</a>-<a data-type="index:locator" href="#calibre_link-1025" class="calibre4">Exercises</a>, <a data-type="index:locator" href="#calibre_link-1026" class="calibre4">Advanced Function Types</a>-<a data-type="index:locator" href="#calibre_link-1027" class="calibre4">User-Defined Type Guards</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">binding generics</span>, <a data-type="index:locator" href="#calibre_link-1028" class="calibre4">When Are Generics Bound?</a></li><li class="calibre55"><span data-type="index-term" class="calibre">declaring and invoking</span>, <a data-type="index:locator" href="#calibre_link-1029" class="calibre4">Declaring and Invoking Functions</a>-<a data-type="index:locator" href="#calibre_link-1030" class="calibre4">Overloaded Function Types</a><ul class="calibre57"><li class="calibre55"><span data-type="index-term" class="calibre">call signatures</span>, <a data-type="index:locator" href="#calibre_link-1031" class="calibre4">Call Signatures</a>-<a data-type="index:locator" href="#calibre_link-1032" class="calibre4">Call Signatures</a></li><li class="calibre55"><span data-type="index-term" class="calibre">contextual typing</span>, <a data-type="index:locator" href="#calibre_link-1033" class="calibre4">Contextual Typing</a></li><li class="calibre55"><span data-type="index-term" class="calibre">declaring with named function syntax</span>, <a data-type="index:locator" href="#calibre_link-1034" class="calibre4">Declaring and Invoking Functions</a></li><li class="calibre55"><span data-type="index-term" class="calibre">generator functions</span>, <a data-type="index:locator" href="#calibre_link-1035" class="calibre4">Generator Functions</a></li><li class="calibre55"><span data-type="index-term" class="calibre">invoking functions</span>, <a data-type="index:locator" href="#calibre_link-1036" class="calibre4">Declaring and Invoking Functions</a></li><li class="calibre55"><span data-type="index-term" class="calibre">invoking with call, apply, and bind</span>, <a data-type="index:locator" href="#calibre_link-1037" class="calibre4">call, apply, and bind</a></li><li class="calibre55"><span data-type="index-term" class="calibre">iterators</span>, <a data-type="index:locator" href="#calibre_link-1038" class="calibre4">Iterators</a>-<a data-type="index:locator" href="#calibre_link-1039" class="calibre4">Iterators</a></li><li class="calibre55"><span data-type="index-term" class="calibre">optional and default parameters</span>, <a data-type="index:locator" href="#calibre_link-1040" class="calibre4">Optional and Default Parameters</a></li><li class="calibre55"><span data-type="index-term" class="calibre">overloaded function types</span>, <a data-type="index:locator" href="#calibre_link-1041" class="calibre4">Overloaded Function Types</a>-<a data-type="index:locator" href="#calibre_link-1042" class="calibre4">Overloaded Function Types</a></li><li class="calibre55"><span data-type="index-term" class="calibre">rest parameters</span>, <a data-type="index:locator" href="#calibre_link-1043" class="calibre4">Rest Parameters</a></li><li class="calibre55"><span data-type="index-term" class="calibre">typing this variable</span>, <a data-type="index:locator" href="#calibre_link-1044" class="calibre4">Typing this</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">decorator</span>, <a data-type="index:locator" href="#calibre_link-1045" class="calibre4">Decorators</a></li><li class="calibre55"><span data-type="index-term" class="calibre">improving type inference for tuples</span>, <a data-type="index:locator" href="#calibre_link-1046" class="calibre4">Improving Type Inference for Tuples</a></li><li class="calibre55"><span data-type="index-term" class="calibre">null, undefined, void and never return types</span>, <a data-type="index:locator" href="#calibre_link-1047" class="calibre4">null, undefined, void, and never</a></li><li class="calibre55"><span data-type="index-term" class="calibre">overloaded ambient function declarations</span>, <a data-type="index:locator" href="#calibre_link-1048" class="calibre4">Collisions</a></li><li class="calibre55"><span data-type="index-term" class="calibre">parameter types</span>, <a data-type="index:locator" href="#calibre_link-1049" class="calibre4">Talking About Types</a></li><li class="calibre55"><span data-type="index-term" class="calibre">polymorphism</span>, <a data-type="index:locator" href="#calibre_link-1050" class="calibre4">Polymorphism</a>-<a data-type="index:locator" href="#calibre_link-1051" class="calibre4">Type-Driven Development</a><ul class="calibre57"><li class="calibre55"><span data-type="index-term" class="calibre">bounded</span>, <a data-type="index:locator" href="#calibre_link-1052" class="calibre4">Bounded Polymorphism</a>-<a data-type="index:locator" href="#calibre_link-1053" class="calibre4">Using bounded polymorphism to model arity</a></li><li class="calibre55"><span data-type="index-term" class="calibre">generic type defaults</span>, <a data-type="index:locator" href="#calibre_link-1054" class="calibre4">Generic Type Defaults</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">type-driven development</span>, <a data-type="index:locator" href="#calibre_link-1055" class="calibre4">Type-Driven Development</a></li><li class="calibre55"><span data-type="index-term" class="calibre">user-defined type guards</span>, <a data-type="index:locator" href="#calibre_link-1056" class="calibre4">User-Defined Type Guards</a></li><li class="calibre55"><span data-type="index-term" class="calibre">variance</span>, <a data-type="index:locator" href="#calibre_link-1057" class="calibre4">Function variance</a><ul class="calibre57"><li class="calibre55"><span data-type="index-term" class="calibre">covariant return types</span>, <a data-type="index:locator" href="#calibre_link-1058" class="calibre4">Function variance</a></li></ul></li></ul></li></ul></div><div data-type="indexdiv" class="preface"><h3 class="calibre54">G</h3><ul class="printings"><li class="calibre55"><span data-type="index-term" class="calibre">generator functions</span>, <a data-type="index:locator" href="#calibre_link-1059" class="calibre4">Generator Functions</a></li><li class="calibre55"><span data-type="index-term" class="calibre">generic type parameters</span>, <a data-type="index:locator" href="#calibre_link-1060" class="calibre4">Polymorphism</a><ul class="calibre56"><li class="calibre55">(<span data-gentext="see" class="calibre">see also</span> generic types; generics)</li><li class="calibre55"><span data-type="index-term" class="calibre">as constraints</span>, <a data-type="index:locator" href="#calibre_link-1061" class="calibre4">Polymorphism</a></li><li class="calibre55"><span data-type="index-term" class="calibre">comma-separated list within angle brackets</span>, <a data-type="index:locator" href="#calibre_link-1062" class="calibre4">Polymorphism</a></li><li class="calibre55"><span data-type="index-term" class="calibre">naming conventions</span>, <a data-type="index:locator" href="#calibre_link-1063" class="calibre4">Polymorphism</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">generic types</span>, <a data-type="index:locator" href="#calibre_link-1064" class="calibre4">Polymorphism</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">Promise</span>, <a data-type="index:locator" href="#calibre_link-1065" class="calibre4">Regaining Sanity with Promises</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">generics</span>, <a data-type="index:locator" href="#calibre_link-1066" class="calibre4">Polymorphism</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">binding, when it happens</span>, <a data-type="index:locator" href="#calibre_link-1067" class="calibre4">When Are Generics Bound?</a>-<a data-type="index:locator" href="#calibre_link-1068" class="calibre4">Where Can You Declare Generics?</a></li><li class="calibre55"><span data-type="index-term" class="calibre">bounded polymorphism</span>, <a data-type="index:locator" href="#calibre_link-1069" class="calibre4">Bounded Polymorphism</a>-<a data-type="index:locator" href="#calibre_link-1070" class="calibre4">Using bounded polymorphism to model arity</a></li><li class="calibre55"><span data-type="index-term" class="calibre">classes and interfaces support for</span>, <a data-type="index:locator" href="#calibre_link-1071" class="calibre4">Polymorphism</a>-<a data-type="index:locator" href="#calibre_link-1072" class="calibre4">Mixins</a></li><li class="calibre55"><span data-type="index-term" class="calibre">declaring as part of a condition</span>, <a data-type="index:locator" href="#calibre_link-1073" class="calibre4">Conditional Types</a>, <a data-type="index:locator" href="#calibre_link-1074" class="calibre4">The infer Keyword</a></li><li class="calibre55"><span data-type="index-term" class="calibre">interface declaring</span>, <a data-type="index:locator" href="#calibre_link-1075" class="calibre4">Declaration Merging</a></li><li class="calibre55"><span data-type="index-term" class="calibre">subtyping</span>, <a data-type="index:locator" href="#calibre_link-1076" class="calibre4">Variance</a></li><li class="calibre55"><span data-type="index-term" class="calibre">type aliases</span>, <a data-type="index:locator" href="#calibre_link-1077" class="calibre4">Generic Type Aliases</a></li><li class="calibre55"><span data-type="index-term" class="calibre">type defaults</span>, <a data-type="index:locator" href="#calibre_link-1078" class="calibre4">Generic Type Defaults</a></li><li class="calibre55"><span data-type="index-term" class="calibre">type inference</span>, <a data-type="index:locator" href="#calibre_link-1079" class="calibre4">Generic Type Inference</a>-<a data-type="index:locator" href="#calibre_link-1080" class="calibre4">Generic Type Aliases</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">global namespace</span>, <a data-type="index:locator" href="#calibre_link-1081" class="calibre4">Safely Extending the Prototype</a>, <a data-type="index:locator" href="#calibre_link-1082" class="calibre4">Compiled Output</a></li><li class="calibre55"><span data-type="index-term" class="calibre">global.JSX namespace</span>, <a data-type="index:locator" href="#calibre_link-1083" class="calibre4">TSX = JSX + TypeScript</a></li><li class="calibre55"><span data-type="index-term" class="calibre">globals (browser)</span>, <a data-type="index:locator" href="#calibre_link-1084" class="calibre4">A Brief History of JavaScript Modules</a>, <a data-type="index:locator" href="#calibre_link-1085" class="calibre4">Using CommonJS and AMD Code</a></li><li class="calibre55"><span data-type="index-term" class="calibre">gradually typed languages</span>, <a data-type="index:locator" href="#calibre_link-1086" class="calibre4">How are types bound?</a></li></ul></div><div data-type="indexdiv" class="preface"><h3 class="calibre54">H</h3><ul class="printings"><li class="calibre55"><span data-type="index-term" class="calibre">homogeneous arrays</span>, <a data-type="index:locator" href="#calibre_link-1087" class="calibre4">Arrays</a></li><li class="calibre55"><span data-type="index-term" class="calibre">HTML templates (Angular)</span>, <a data-type="index:locator" href="#calibre_link-1088" class="calibre4">Components</a></li></ul></div><div data-type="indexdiv" class="preface"><h3 class="calibre54">I</h3><ul class="printings"><li class="calibre55"><span data-type="index-term" class="calibre">immediately invoked function expressions (IIFEs)</span>, <a data-type="index:locator" href="#calibre_link-1089" class="calibre4">A Brief History of JavaScript Modules</a></li><li class="calibre55"><span data-type="index-term" class="calibre">immutable arrays</span>, <a data-type="index:locator" href="#calibre_link-1090" class="calibre4">Read-only arrays and tuples</a></li><li class="calibre55"><span data-type="index-term" class="calibre">implements keyword</span>, <a data-type="index:locator" href="#calibre_link-1091" class="calibre4">Implementations</a></li><li class="calibre55"><span data-type="index-term" class="calibre">import function</span>, <a data-type="index:locator" href="#calibre_link-1092" class="calibre4">Dynamic Imports</a></li><li class="calibre55"><span data-type="index-term" class="calibre">import statements</span>, <a data-type="index:locator" href="#calibre_link-1093" class="calibre4">Safely Extending the Prototype</a>, <a data-type="index:locator" href="#calibre_link-1094" class="calibre4">Dynamic Imports</a></li><li class="calibre55"><span data-type="index-term" class="calibre">imports</span><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">CommonJS</span>, <a data-type="index:locator" href="#calibre_link-1095" class="calibre4">A Brief History of JavaScript Modules</a></li><li class="calibre55"><span data-type="index-term" class="calibre">dynamic</span>, <a data-type="index:locator" href="#calibre_link-1096" class="calibre4">Dynamic Imports</a></li><li class="calibre55"><span data-type="index-term" class="calibre">ES2015 standard for</span>, <a data-type="index:locator" href="#calibre_link-1097" class="calibre4">A Brief History of JavaScript Modules</a>-<a data-type="index:locator" href="#calibre_link-1098" class="calibre4">import, export</a></li><li class="calibre55"><span data-type="index-term" class="calibre">import elision</span>, <a data-type="index:locator" href="#calibre_link-1099" class="calibre4">The types Directive</a></li><li class="calibre55"><span data-type="index-term" class="calibre">module mode versus script mode</span>, <a data-type="index:locator" href="#calibre_link-1100" class="calibre4">Module Mode Versus Script Mode</a></li><li class="calibre55"><span data-type="index-term" class="calibre">module name for exact import path</span>, <a data-type="index:locator" href="#calibre_link-1101" class="calibre4">Ambient Module Declarations</a></li><li class="calibre55"><span data-type="index-term" class="calibre">using CommonJS and AMD code</span>, <a data-type="index:locator" href="#calibre_link-1102" class="calibre4">Using CommonJS and AMD Code</a></li><li class="calibre55"><span data-type="index-term" class="calibre">whitelisting an untyped import</span>, <a data-type="index:locator" href="#calibre_link-1103" class="calibre4">JavaScript That Doesn’t Have Type Declarations on DefinitelyTyped</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">index signatures</span>, <a data-type="index:locator" href="#calibre_link-1104" class="calibre4">Objects</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">Record object</span>, <a data-type="index:locator" href="#calibre_link-1105" class="calibre4">The Record Type</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">index.ts</span>, <a data-type="index:locator" href="#calibre_link-1106" class="calibre4">index.ts</a></li><li class="calibre55"><span data-type="index-term" class="calibre">infer keyword</span>, <a data-type="index:locator" href="#calibre_link-1107" class="calibre4">The infer Keyword</a></li><li class="calibre55"><span data-type="index-term" class="calibre">inferring types</span>, <a data-type="index:locator" href="#calibre_link-1108" class="calibre4">The Type System</a></li><li class="calibre55"><span data-type="index-term" class="calibre">inheritance</span>, <a data-type="index:locator" href="#calibre_link-1109" class="calibre4">Classes and Inheritance</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">simulating multiple inheritance</span>, <a data-type="index:locator" href="#calibre_link-1110" class="calibre4">Mixins</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">inner nodes</span>, <a data-type="index:locator" href="#calibre_link-1111" class="calibre4">Bounded Polymorphism</a></li><li class="calibre55"><span data-type="index-term" class="calibre">instance methods</span>, <a data-type="index:locator" href="#calibre_link-1112" class="calibre4">Classes and Inheritance</a></li><li class="calibre55"><span data-type="index-term" class="calibre">instanceof operator</span>, <a data-type="index:locator" href="#calibre_link-1113" class="calibre4">Classes Declare Both Values and Types</a></li><li class="calibre55"><span data-type="index-term" class="calibre">interfaces</span>, <a data-type="index:locator" href="#calibre_link-1114" class="calibre4">Interfaces</a>-<a data-type="index:locator" href="#calibre_link-1115" class="calibre4">Implementing Interfaces Versus Extending Abstract Classes</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">Angular lifecycle hooks</span>, <a data-type="index:locator" href="#calibre_link-1116" class="calibre4">Components</a></li><li class="calibre55"><span data-type="index-term" class="calibre">binding of generics</span>, <a data-type="index:locator" href="#calibre_link-1117" class="calibre4">When Are Generics Bound?</a></li><li class="calibre55"><span data-type="index-term" class="calibre">comparison with type aliases</span>, <a data-type="index:locator" href="#calibre_link-1118" class="calibre4">Interfaces</a></li><li class="calibre55"><span data-type="index-term" class="calibre">declaration merging</span>, <a data-type="index:locator" href="#calibre_link-1119" class="calibre4">Declaration Merging</a></li><li class="calibre55"><span data-type="index-term" class="calibre">extending objects, classes, or other interfaces</span>, <a data-type="index:locator" href="#calibre_link-1120" class="calibre4">Interfaces</a></li><li class="calibre55"><span data-type="index-term" class="calibre">implementation</span>, <a data-type="index:locator" href="#calibre_link-1121" class="calibre4">Implementations</a></li><li class="calibre55"><span data-type="index-term" class="calibre">implementing versus extending abstract classes</span>, <a data-type="index:locator" href="#calibre_link-1122" class="calibre4">Implementing Interfaces Versus Extending Abstract Classes</a></li><li class="calibre55"><span data-type="index-term" class="calibre">merging</span>, <a data-type="index:locator" href="#calibre_link-1123" class="calibre4">Declaration Merging</a></li><li class="calibre55"><span data-type="index-term" class="calibre">polymorphism</span>, <a data-type="index:locator" href="#calibre_link-1124" class="calibre4">Polymorphism</a></li><li class="calibre55"><span data-type="index-term" class="calibre">top-level, in type declaration files</span>, <a data-type="index:locator" href="#calibre_link-1125" class="calibre4">Type Declarations</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">internal triple-slash directives</span>, <a data-type="index:locator" href="#calibre_link-1126" class="calibre4">Internal Directives</a></li><li class="calibre55"><span data-type="index-term" class="calibre">interpreted languages</span>, <a data-type="index:locator" href="#calibre_link-1127" class="calibre4">The Compiler</a></li><li class="calibre55"><span data-type="index-term" class="calibre">intersection types</span>, <a data-type="index:locator" href="#calibre_link-1128" class="calibre4">Union and intersection types</a>, <a data-type="index:locator" href="#calibre_link-1129" class="calibre4">Interfaces</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">array</span>, <a data-type="index:locator" href="#calibre_link-1130" class="calibre4">Arrays</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">intrinsic elements (TSX)</span>, <a data-type="index:locator" href="#calibre_link-1131" class="calibre4">TSX</a></li><li class="calibre55"><span data-type="index-term" class="calibre">invalid actions</span>, <a data-type="index:locator" href="#calibre_link-1132" class="calibre4">Introduction</a></li><li class="calibre55"><span data-type="index-term" class="calibre">invariance</span>, <a data-type="index:locator" href="#calibre_link-1133" class="calibre4">Shape and array variance</a></li><li class="calibre55"><span data-type="index-term" class="calibre">isomorphic programs</span>, <a data-type="index:locator" href="#calibre_link-1134" class="calibre4">Dialing In Your Compile Target</a></li><li class="calibre55"><span data-type="index-term" class="calibre">iterable iterators</span>, <a data-type="index:locator" href="#calibre_link-1135" class="calibre4">Iterators</a></li><li class="calibre55"><span data-type="index-term" class="calibre">IterableIterator type</span>, <a data-type="index:locator" href="#calibre_link-1136" class="calibre4">Generator Functions</a></li><li class="calibre55"><span data-type="index-term" class="calibre">iterables</span>, <a data-type="index:locator" href="#calibre_link-1137" class="calibre4">Iterators</a></li><li class="calibre55"><span data-type="index-term" class="calibre">iterators</span>, <a data-type="index:locator" href="#calibre_link-1138" class="calibre4">Iterators</a>-<a data-type="index:locator" href="#calibre_link-1139" class="calibre4">Iterators</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">built-in, for common collection types</span>, <a data-type="index:locator" href="#calibre_link-1140" class="calibre4">Iterators</a></li><li class="calibre55"><span data-type="index-term" class="calibre">defined</span>, <a data-type="index:locator" href="#calibre_link-1141" class="calibre4">Iterators</a></li></ul></li></ul></div><div data-type="indexdiv" class="preface"><h3 class="calibre54">J</h3><ul class="printings"><li class="calibre55"><span data-type="index-term" class="calibre">JavaScript</span>, <a data-type="index:locator" href="#calibre_link-1142" class="calibre4">Preface</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">built-in iterators for collection types</span>, <a data-type="index:locator" href="#calibre_link-1143" class="calibre4">Iterators</a></li><li class="calibre55"><span data-type="index-term" class="calibre">compile target for TypeScript projects</span>, <a data-type="index:locator" href="#calibre_link-1144" class="calibre4">Dialing In Your Compile Target</a>-<a data-type="index:locator" href="#calibre_link-1145" class="calibre4">lib</a><ul class="calibre57"><li class="calibre55"><span data-type="index-term" class="calibre">language versions and releases</span>, <a data-type="index:locator" href="#calibre_link-1146" class="calibre4">target</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">configuring build pipeline to compile TypeScript code to</span>, <a data-type="index:locator" href="#calibre_link-1147" class="calibre4">Running TypeScript in the Browser</a></li><li class="calibre55"><span data-type="index-term" class="calibre">engine</span>, <a data-type="index:locator" href="#calibre_link-1148" class="calibre4">The Compiler</a></li><li class="calibre55"><span data-type="index-term" class="calibre">event loop</span>, <a data-type="index:locator" href="#calibre_link-1149" class="calibre4">JavaScript’s Event Loop</a>-<a data-type="index:locator" href="#calibre_link-1150" class="calibre4">JavaScript’s Event Loop</a></li><li class="calibre55"><span data-type="index-term" class="calibre">interoperating with</span>, <a data-type="index:locator" href="#calibre_link-1151" class="calibre4">Interoperating with JavaScript</a>-<a data-type="index:locator" href="#calibre_link-1152" class="calibre4">Summary</a><ul class="calibre57"><li class="calibre55"><span data-type="index-term" class="calibre">gradually migrating code to TypeScript</span>, <a data-type="index:locator" href="#calibre_link-1153" class="calibre4">Gradually Migrating from JavaScript to TypeScript</a>-<a data-type="index:locator" href="#calibre_link-1154" class="calibre4">Step 4: Make It strict</a></li><li class="calibre55"><span data-type="index-term" class="calibre">type lookup for JavaScript</span>, <a data-type="index:locator" href="#calibre_link-1155" class="calibre4">Type Lookup for JavaScript</a>-<a data-type="index:locator" href="#calibre_link-1156" class="calibre4">Using Third-Party JavaScript</a></li><li class="calibre55"><span data-type="index-term" class="calibre">using third-party JavaScript</span>, <a data-type="index:locator" href="#calibre_link-1157" class="calibre4">Using Third-Party JavaScript</a>-<a data-type="index:locator" href="#calibre_link-1158" class="calibre4">JavaScript That Doesn’t Have Type Declarations on DefinitelyTyped</a></li><li class="calibre55"><span data-type="index-term" class="calibre">using type declarations</span>, <a data-type="index:locator" href="#calibre_link-1159" class="calibre4">Type Declarations</a>-<a data-type="index:locator" href="#calibre_link-1160" class="calibre4">Ambient Module Declarations</a></li><li class="calibre55"><span data-type="index-term" class="calibre">ways to use JavaScript from TypeScript</span>, <a data-type="index:locator" href="#calibre_link-1161" class="calibre4">Summary</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">latest syntax and features</span>, <a data-type="index:locator" href="#calibre_link-1162" class="calibre4">Style</a></li><li class="calibre55"><span data-type="index-term" class="calibre">modules, brief history of</span>, <a data-type="index:locator" href="#calibre_link-1163" class="calibre4">A Brief History of JavaScript Modules</a>-<a data-type="index:locator" href="#calibre_link-1164" class="calibre4">A Brief History of JavaScript Modules</a></li><li class="calibre55"><span data-type="index-term" class="calibre">optimizing bundles for fast loading</span>, <a data-type="index:locator" href="#calibre_link-1165" class="calibre4">Running TypeScript in the Browser</a></li><li class="calibre55"><span data-type="index-term" class="calibre">type system, comparison to TypeScript</span>, <a data-type="index:locator" href="#calibre_link-1166" class="calibre4">TypeScript Versus JavaScript</a>-<a data-type="index:locator" href="#calibre_link-1167" class="calibre4">When are errors surfaced?</a></li><li class="calibre55"><span data-type="index-term" class="calibre">TypeScript program compiled to</span>, <a data-type="index:locator" href="#calibre_link-1168" class="calibre4">Artifacts</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">JSDoc annotations</span>, <a data-type="index:locator" href="#calibre_link-1169" class="calibre4">Step 2b: Add JSDoc Annotations (Optional)</a></li><li class="calibre55"><span data-type="index-term" class="calibre">JSON (JavaScript Object Notation)</span><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">loading .json files</span>, <a data-type="index:locator" href="#calibre_link-1170" class="calibre4">Ambient Module Declarations</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">JSX (JavaScript XML)</span>, <a data-type="index:locator" href="#calibre_link-1171" class="calibre4">A JSX primer</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">React hooking into TSX to type JSX correctly</span>, <a data-type="index:locator" href="#calibre_link-1172" class="calibre4">TSX</a></li><li class="calibre55"><span data-type="index-term" class="calibre">TSX and</span>, <a data-type="index:locator" href="#calibre_link-1173" class="calibre4">TSX = JSX + TypeScript</a></li><li class="calibre55"><span data-type="index-term" class="calibre">using TSX with React</span>, <a data-type="index:locator" href="#calibre_link-1174" class="calibre4">Using TSX with React</a>-<a data-type="index:locator" href="#calibre_link-1175" class="calibre4">Using TSX with React</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">jsx directive</span>, <a data-type="index:locator" href="#calibre_link-1176" class="calibre4">TSX = JSX + TypeScript</a></li></ul></div><div data-type="indexdiv" class="preface"><h3 class="calibre54">K</h3><ul class="printings"><li class="calibre55"><span data-type="index-term" class="calibre">keying-in operator</span>, <a data-type="index:locator" href="#calibre_link-1177" class="calibre4">The keying-in operator</a>, <a data-type="index:locator" href="#calibre_link-1178" class="calibre4">The infer Keyword</a></li><li class="calibre55"><span data-type="index-term" class="calibre">keyof operator</span>, <a data-type="index:locator" href="#calibre_link-1179" class="calibre4">The keyof operator</a></li><li class="calibre55"><span data-type="index-term" class="calibre">keyofStringsOnly TSC flag</span>, <a data-type="index:locator" href="#calibre_link-1180" class="calibre4">The keyof operator</a></li></ul></div><div data-type="indexdiv" class="preface"><h3 class="calibre54">L</h3><ul class="printings"><li class="calibre55"><span data-type="index-term" class="calibre">LABjs, loading module with</span>, <a data-type="index:locator" href="#calibre_link-1181" class="calibre4">A Brief History of JavaScript Modules</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">lazy-loading code</span>, <a data-type="index:locator" href="#calibre_link-1182" class="calibre4">Dynamic Imports</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">lazy and asynchronous loading modules</span>, <a data-type="index:locator" href="#calibre_link-1183" class="calibre4">A Brief History of JavaScript Modules</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">lazy loading chunks of code</span>, <a data-type="index:locator" href="#calibre_link-1184" class="calibre4">Dynamic Imports</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">leading with the types</span>, <a data-type="index:locator" href="#calibre_link-1185" class="calibre4">Type-Driven Development</a></li><li class="calibre55"><span data-type="index-term" class="calibre">leaf nodes</span>, <a data-type="index:locator" href="#calibre_link-1186" class="calibre4">Bounded Polymorphism</a></li><li class="calibre55"><span data-type="index-term" class="calibre">let</span><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">type declarations with</span>, <a data-type="index:locator" href="#calibre_link-1187" class="calibre4">Summary</a></li><li class="calibre55"><span data-type="index-term" class="calibre">using const instead of</span>, <a data-type="index:locator" href="#calibre_link-1188" class="calibre4">boolean</a></li><li class="calibre55"><span data-type="index-term" class="calibre">variable declarations with</span>, <a data-type="index:locator" href="#calibre_link-1189" class="calibre4">Type aliases</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">lib directive</span>, <a data-type="index:locator" href="#calibre_link-1190" class="calibre4">Triple-Slash Directives</a></li><li class="calibre55"><span data-type="index-term" class="calibre">lib setting (TSC)</span>, <a data-type="index:locator" href="#calibre_link-1191" class="calibre4">Ambient Variable Declarations</a>, <a data-type="index:locator" href="#calibre_link-1192" class="calibre4">Dialing In Your Compile Target</a>, <a data-type="index:locator" href="#calibre_link-1193" class="calibre4">lib</a></li><li class="calibre55"><span data-type="index-term" class="calibre">lib tsconfig.json option</span>, <a data-type="index:locator" href="#calibre_link-1194" class="calibre4">Frontend Frameworks</a></li><li class="calibre55"><span data-type="index-term" class="calibre">lifecycle hooks (Angular)</span>, <a data-type="index:locator" href="#calibre_link-1195" class="calibre4">Components</a></li><li class="calibre55"><span data-type="index-term" class="calibre">listeners, creating</span>, <a data-type="index:locator" href="#calibre_link-1196" class="calibre4">Event Emitters</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">onmessage API in Web Workers</span>, <a data-type="index:locator" href="#calibre_link-1197" class="calibre4">In the Browser: With Web Workers</a></li></ul></li></ul></div><div data-type="indexdiv" class="preface"><h3 class="calibre54">M</h3><ul class="printings"><li class="calibre55"><span data-type="index-term" class="calibre">mapped types</span>, <a data-type="index:locator" href="#calibre_link-1198" class="calibre4">Mapped Types</a>-<a data-type="index:locator" href="#calibre_link-1199" class="calibre4">Companion Object Pattern</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">built-in</span>, <a data-type="index:locator" href="#calibre_link-1200" class="calibre4">Built-in mapped types</a></li><li class="calibre55"><span data-type="index-term" class="calibre">using to build typesafe event emitters</span>, <a data-type="index:locator" href="#calibre_link-1201" class="calibre4">Event Emitters</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">MatrixProtocol</span>, <a data-type="index:locator" href="#calibre_link-1202" class="calibre4">Typesafe protocols</a></li><li class="calibre55"><span data-type="index-term" class="calibre">memory safety</span>, <a data-type="index:locator" href="#calibre_link-1203" class="calibre4">In the Browser: With Web Workers</a></li><li class="calibre55"><span data-type="index-term" class="calibre">message passing (Web Workers)</span>, <a data-type="index:locator" href="#calibre_link-1204" class="calibre4">In the Browser: With Web Workers</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">message passing API</span>, <a data-type="index:locator" href="#calibre_link-1205" class="calibre4">In the Browser: With Web Workers</a></li><li class="calibre55"><span data-type="index-term" class="calibre">onmessage API</span>, <a data-type="index:locator" href="#calibre_link-1206" class="calibre4">In the Browser: With Web Workers</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">methods</span>, <a data-type="index:locator" href="#calibre_link-1207" class="calibre4">Classes and Inheritance</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">abstract</span>, <a data-type="index:locator" href="#calibre_link-1208" class="calibre4">Classes and Inheritance</a></li><li class="calibre55"><span data-type="index-term" class="calibre">access modifiers for</span>, <a data-type="index:locator" href="#calibre_link-1209" class="calibre4">Classes and Inheritance</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">mixins</span>, <a data-type="index:locator" href="#calibre_link-1210" class="calibre4">Mixins</a>-<a data-type="index:locator" href="#calibre_link-1211" class="calibre4">Decorators</a></li><li class="calibre55"><span data-type="index-term" class="calibre">module mode versus script mode</span>, <a data-type="index:locator" href="#calibre_link-1212" class="calibre4">Module Mode Versus Script Mode</a></li><li class="calibre55"><span data-type="index-term" class="calibre">module setting (TSC)</span>, <a data-type="index:locator" href="#calibre_link-1213" class="calibre4">Dialing In Your Compile Target</a></li><li class="calibre55"><span data-type="index-term" class="calibre">module setting (tsconfig.json)</span>, <a data-type="index:locator" href="#calibre_link-1214" class="calibre4">Compiled Output</a></li><li class="calibre55"><span data-type="index-term" class="calibre">module.exports</span>, <a data-type="index:locator" href="#calibre_link-1215" class="calibre4">A Brief History of JavaScript Modules</a></li><li class="calibre55"><span data-type="index-term" class="calibre">moduleResolution TSC flag</span>, <a data-type="index:locator" href="#calibre_link-1216" class="calibre4">Declaration Merging</a></li><li class="calibre55"><span data-type="index-term" class="calibre">modules</span>, <a data-type="index:locator" href="#calibre_link-1217" class="calibre4">Namespaces.Modules</a>-<a data-type="index:locator" href="#calibre_link-1218" class="calibre4">Module Mode Versus Script Mode</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">ambient module declarations</span>, <a data-type="index:locator" href="#calibre_link-1219" class="calibre4">Ambient Module Declarations</a></li><li class="calibre55"><span data-type="index-term" class="calibre">amd-module directive</span>, <a data-type="index:locator" href="#calibre_link-1220" class="calibre4">The amd-module Directive</a></li><li class="calibre55"><span data-type="index-term" class="calibre">brief history of JavaScript modules</span>, <a data-type="index:locator" href="#calibre_link-1221" class="calibre4">A Brief History of JavaScript Modules</a>-<a data-type="index:locator" href="#calibre_link-1222" class="calibre4">A Brief History of JavaScript Modules</a></li><li class="calibre55"><span data-type="index-term" class="calibre">import, export</span>, <a data-type="index:locator" href="#calibre_link-1223" class="calibre4">import, export</a>-<a data-type="index:locator" href="#calibre_link-1224" class="calibre4">import, export</a><ul class="calibre57"><li class="calibre55"><span data-type="index-term" class="calibre">dynamic imports</span>, <a data-type="index:locator" href="#calibre_link-1225" class="calibre4">Dynamic Imports</a></li><li class="calibre55"><span data-type="index-term" class="calibre">module mode or script mode</span>, <a data-type="index:locator" href="#calibre_link-1226" class="calibre4">Module Mode Versus Script Mode</a></li><li class="calibre55"><span data-type="index-term" class="calibre">using CommonJS and AMD code</span>, <a data-type="index:locator" href="#calibre_link-1227" class="calibre4">Using CommonJS and AMD Code</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">imported from JavaScript, type lookup for</span>, <a data-type="index:locator" href="#calibre_link-1228" class="calibre4">Type Lookup for JavaScript</a>-<a data-type="index:locator" href="#calibre_link-1229" class="calibre4">Using Third-Party JavaScript</a></li><li class="calibre55"><span data-type="index-term" class="calibre">module field in tsconfig.json</span>, <a data-type="index:locator" href="#calibre_link-1230" class="calibre4">Step 1: Add TSC</a></li><li class="calibre55"><span data-type="index-term" class="calibre">picking module system to compile TypeScript to</span>, <a data-type="index:locator" href="#calibre_link-1231" class="calibre4">Running TypeScript in the Browser</a></li><li class="calibre55"><span data-type="index-term" class="calibre">preferring over namespaces</span>, <a data-type="index:locator" href="#calibre_link-1232" class="calibre4">Compiled Output</a></li><li class="calibre55"><span data-type="index-term" class="calibre">telling TypeScript about a third-party module installed with NPM</span>, <a data-type="index:locator" href="#calibre_link-1233" class="calibre4">Type Declarations</a></li><li class="calibre55"><span data-type="index-term" class="calibre">untyped, importing from third-party JavaScript</span>, <a data-type="index:locator" href="#calibre_link-1234" class="calibre4">JavaScript That Doesn’t Have Type Declarations on DefinitelyTyped</a></li><li class="calibre55"><span data-type="index-term" class="calibre">writing declaration files for third-party JavaScript modules</span>, <a data-type="index:locator" href="#calibre_link-1235" class="calibre4">Recipes for Writing Declaration Files for Third-Party JavaScript Modules</a>-<a data-type="index:locator" href="#calibre_link-1236" class="calibre4">Modules</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">Moment.js date manipulation library</span>, <a data-type="index:locator" href="#calibre_link-1237" class="calibre4">Dynamic Imports</a></li><li class="calibre55"><span data-type="index-term" class="calibre">multithreading</span>, <a data-type="index:locator" href="#calibre_link-1238" class="calibre4">Typesafe Multithreading</a>-<a data-type="index:locator" href="#calibre_link-1239" class="calibre4">In NodeJS: With Child Processes</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">in the browser with Web Workers</span>, <a data-type="index:locator" href="#calibre_link-1240" class="calibre4">In the Browser: With Web Workers</a>-<a data-type="index:locator" href="#calibre_link-1241" class="calibre4">Typesafe protocols</a></li><li class="calibre55"><span data-type="index-term" class="calibre">typesafe multithreading in NodeJS with child processes</span>, <a data-type="index:locator" href="#calibre_link-1242" class="calibre4">In NodeJS: With Child Processes</a>-<a data-type="index:locator" href="#calibre_link-1243" class="calibre4">In NodeJS: With Child Processes</a></li></ul></li></ul></div><div data-type="indexdiv" class="preface"><h3 class="calibre54">N</h3><ul class="printings"><li class="calibre55"><span data-type="index-term" class="calibre">named function syntax</span>, <a data-type="index:locator" href="#calibre_link-1244" class="calibre4">Declaring and Invoking Functions</a></li><li class="calibre55"><span data-type="index-term" class="calibre">namespace keyword</span>, <a data-type="index:locator" href="#calibre_link-1245" class="calibre4">Namespaces</a></li><li class="calibre55"><span data-type="index-term" class="calibre">namespaces</span>, <a data-type="index:locator" href="#calibre_link-1246" class="calibre4">Namespaces</a>-<a data-type="index:locator" href="#calibre_link-1247" class="calibre4">Compiled Output</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">collisions</span>, <a data-type="index:locator" href="#calibre_link-1248" class="calibre4">Collisions</a></li><li class="calibre55"><span data-type="index-term" class="calibre">compiled output</span>, <a data-type="index:locator" href="#calibre_link-1249" class="calibre4">Compiled Output</a></li><li class="calibre55"><span data-type="index-term" class="calibre">exports</span>, <a data-type="index:locator" href="#calibre_link-1250" class="calibre4">Namespaces</a></li><li class="calibre55"><span data-type="index-term" class="calibre">long, using aliases to shorten</span>, <a data-type="index:locator" href="#calibre_link-1251" class="calibre4">Namespaces</a></li><li class="calibre55"><span data-type="index-term" class="calibre">merging</span>, <a data-type="index:locator" href="#calibre_link-1252" class="calibre4">Declaration Merging</a></li><li class="calibre55"><span data-type="index-term" class="calibre">preferring modules over</span>, <a data-type="index:locator" href="#calibre_link-1253" class="calibre4">Compiled Output</a></li><li class="calibre55"><span data-type="index-term" class="calibre">subnamespaces</span>, <a data-type="index:locator" href="#calibre_link-1254" class="calibre4">Namespaces</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">never type</span>, <a data-type="index:locator" href="#calibre_link-1255" class="calibre4">null, undefined, void, and never</a>, <a data-type="index:locator" href="#calibre_link-1256" class="calibre4">Distributive Conditionals</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">summary of usage</span>, <a data-type="index:locator" href="#calibre_link-1257" class="calibre4">null, undefined, void, and never</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">new operator</span>, <a data-type="index:locator" href="#calibre_link-1258" class="calibre4">Classes Declare Both Values and Types</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">new(…any[]) syntax for extended class constructors)</span>, <a data-type="index:locator" href="#calibre_link-1259" class="calibre4">Decorators</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">next method</span>, <a data-type="index:locator" href="#calibre_link-1260" class="calibre4">Iterators</a></li><li class="calibre55"><span data-type="index-term" class="calibre">no-invalid-this TSLint rule</span>, <a data-type="index:locator" href="#calibre_link-1261" class="calibre4">Typing this</a></li><li class="calibre55"><span data-type="index-term" class="calibre">Node API for Redis</span>, <a data-type="index:locator" href="#calibre_link-1262" class="calibre4">Event Emitters</a></li><li class="calibre55"><span data-type="index-term" class="calibre">node mode (moduleResolution flag)</span>, <a data-type="index:locator" href="#calibre_link-1263" class="calibre4">Declaration Merging</a></li><li class="calibre55"><span data-type="index-term" class="calibre">NodeJS</span><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">callback-based fs.readFile API</span>, <a data-type="index:locator" href="#calibre_link-1264" class="calibre4">Working with Callbacks</a>-<a data-type="index:locator" href="#calibre_link-1265" class="calibre4">Working with Callbacks</a></li><li class="calibre55"><span data-type="index-term" class="calibre">EventEmitter</span>, <a data-type="index:locator" href="#calibre_link-1266" class="calibre4">Async Streams</a>, <a data-type="index:locator" href="#calibre_link-1267" class="calibre4">In the Browser: With Web Workers</a></li><li class="calibre55"><span data-type="index-term" class="calibre">installing and running</span>, <a data-type="index:locator" href="#calibre_link-1268" class="calibre4">Code Editor Setup</a></li><li class="calibre55"><span data-type="index-term" class="calibre">modules</span>, <a data-type="index:locator" href="#calibre_link-1269" class="calibre4">A Brief History of JavaScript Modules</a></li><li class="calibre55"><span data-type="index-term" class="calibre">preferring modules over namespaces</span>, <a data-type="index:locator" href="#calibre_link-1270" class="calibre4">Compiled Output</a></li><li class="calibre55"><span data-type="index-term" class="calibre">running TypeScript code in</span>, <a data-type="index:locator" href="#calibre_link-1271" class="calibre4">Running TypeScript on the Server</a></li><li class="calibre55"><span data-type="index-term" class="calibre">typesafe multihreading with child processes</span>, <a data-type="index:locator" href="#calibre_link-1272" class="calibre4">In NodeJS: With Child Processes</a>-<a data-type="index:locator" href="#calibre_link-1273" class="calibre4">In NodeJS: With Child Processes</a></li><li class="calibre55"><span data-type="index-term" class="calibre">wrapping callback-based fs.readFileAPI  in Promise-based API</span>, <a data-type="index:locator" href="#calibre_link-1274" class="calibre4">Regaining Sanity with Promises</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">nodes (binary tree)</span>, <a data-type="index:locator" href="#calibre_link-1275" class="calibre4">Bounded Polymorphism</a></li><li class="calibre55"><span data-type="index-term" class="calibre">noImplicitAny flag in tsconfig.json</span>, <a data-type="index:locator" href="#calibre_link-1276" class="calibre4">any</a></li><li class="calibre55"><span data-type="index-term" class="calibre">noImplicitAny flag in tsconfig.sh</span>, <a data-type="index:locator" href="#calibre_link-1277" class="calibre4">Step 2a: Enable Typechecking for JavaScript (Optional)</a></li><li class="calibre55"><span data-type="index-term" class="calibre">noImplicitReturns TSC flag</span>, <a data-type="index:locator" href="#calibre_link-1278" class="calibre4">Totality</a></li><li class="calibre55"><span data-type="index-term" class="calibre">noImplicitThis TSC option</span>, <a data-type="index:locator" href="#calibre_link-1279" class="calibre4">Typing this</a></li><li class="calibre55"><span data-type="index-term" class="calibre">nominal types, simulating</span>, <a data-type="index:locator" href="#calibre_link-1280" class="calibre4">Simulating Nominal Types</a>-<a data-type="index:locator" href="#calibre_link-1281" class="calibre4">Simulating Nominal Types</a></li><li class="calibre55"><span data-type="index-term" class="calibre">nominal typing</span>, <a data-type="index:locator" href="#calibre_link-1282" class="calibre4">Objects</a></li><li class="calibre55"><span data-type="index-term" class="calibre">nonnull assertions</span>, <a data-type="index:locator" href="#calibre_link-1283" class="calibre4">Nonnull Assertions</a></li><li class="calibre55"><span data-type="index-term" class="calibre">NPM package manager</span>, <a data-type="index:locator" href="#calibre_link-1284" class="calibre4">Code Editor Setup</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">installing third-party JavaScript</span>, <a data-type="index:locator" href="#calibre_link-1285" class="calibre4">Using Third-Party JavaScript</a></li><li class="calibre55"><span data-type="index-term" class="calibre">publishing TypeScript code to</span>, <a data-type="index:locator" href="#calibre_link-1286" class="calibre4">Publishing Your TypeScript Code to NPM</a>-<a data-type="index:locator" href="#calibre_link-1287" class="calibre4">Publishing Your TypeScript Code to NPM</a></li><li class="calibre55"><span data-type="index-term" class="calibre">sending type declaration to</span>, <a data-type="index:locator" href="#calibre_link-1288" class="calibre4">JavaScript That Doesn’t Have Type Declarations on DefinitelyTyped</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">null type</span>, <a data-type="index:locator" href="#calibre_link-1289" class="calibre4">null, undefined, void, and never</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">example of usage</span>, <a data-type="index:locator" href="#calibre_link-1290" class="calibre4">null, undefined, void, and never</a></li><li class="calibre55"><span data-type="index-term" class="calibre">function returning null</span>, <a data-type="index:locator" href="#calibre_link-1291" class="calibre4">Returning null</a></li><li class="calibre55"><span data-type="index-term" class="calibre">nonnull assertions</span>, <a data-type="index:locator" href="#calibre_link-1292" class="calibre4">Nonnull Assertions</a></li><li class="calibre55"><span data-type="index-term" class="calibre">problems with in programming languages</span>, <a data-type="index:locator" href="#calibre_link-1293" class="calibre4">null, undefined, void, and never</a></li><li class="calibre55"><span data-type="index-term" class="calibre">strict null checking</span>, <a data-type="index:locator" href="#calibre_link-1294" class="calibre4">null, undefined, void, and never</a></li><li class="calibre55"><span data-type="index-term" class="calibre">summary of usage</span>, <a data-type="index:locator" href="#calibre_link-1295" class="calibre4">null, undefined, void, and never</a></li><li class="calibre55"><span data-type="index-term" class="calibre">variables initialized to, type widening</span>, <a data-type="index:locator" href="#calibre_link-1296" class="calibre4">Type Widening</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">number type</span>, <a data-type="index:locator" href="#calibre_link-1297" class="calibre4">All About Types</a>, <a data-type="index:locator" href="#calibre_link-1298" class="calibre4">number</a></li><li class="calibre55"><span data-type="index-term" class="calibre">numbers, numeric separators in</span>, <a data-type="index:locator" href="#calibre_link-1299" class="calibre4">number</a></li></ul></div><div data-type="indexdiv" class="preface"><h3 class="calibre54">O</h3><ul class="printings"><li class="calibre55"><span data-type="index-term" class="calibre">object literals</span>, <a data-type="index:locator" href="#calibre_link-1300" class="calibre4">Objects</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">fresh object literal type</span>, <a data-type="index:locator" href="#calibre_link-1301" class="calibre4">Excess property checking</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">object-relational mappers (ORMs)</span>, <a data-type="index:locator" href="#calibre_link-1302" class="calibre4">Backend Frameworks</a></li><li class="calibre55"><span data-type="index-term" class="calibre">objects</span>, <a data-type="index:locator" href="#calibre_link-1303" class="calibre4">Objects</a>-<a data-type="index:locator" href="#calibre_link-1304" class="calibre4">Intermission: Type Aliases, Unions, and Intersections</a>, <a data-type="index:locator" href="#calibre_link-1305" class="calibre4">Advanced Object Types</a>-<a data-type="index:locator" href="#calibre_link-1306" class="calibre4">Companion Object Pattern</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">companion object pattern</span>, <a data-type="index:locator" href="#calibre_link-1307" class="calibre4">Companion Object Pattern</a></li><li class="calibre55"><span data-type="index-term" class="calibre">covariant members</span>, <a data-type="index:locator" href="#calibre_link-1308" class="calibre4">Shape and array variance</a></li><li class="calibre55"><span data-type="index-term" class="calibre">declaring in TypeScript</span>, <a data-type="index:locator" href="#calibre_link-1309" class="calibre4">Objects</a></li><li class="calibre55"><span data-type="index-term" class="calibre">empty</span>, <a data-type="index:locator" href="#calibre_link-1310" class="calibre4">Objects</a></li><li class="calibre55"><span data-type="index-term" class="calibre">filtering arrays of</span>, <a data-type="index:locator" href="#calibre_link-1311" class="calibre4">Polymorphism</a></li><li class="calibre55"><span data-type="index-term" class="calibre">index signature</span>, <a data-type="index:locator" href="#calibre_link-1312" class="calibre4">Objects</a></li><li class="calibre55"><span data-type="index-term" class="calibre">invariant property types in some languages</span>, <a data-type="index:locator" href="#calibre_link-1313" class="calibre4">Shape and array variance</a></li><li class="calibre55"><span data-type="index-term" class="calibre">mapped types</span>, <a data-type="index:locator" href="#calibre_link-1314" class="calibre4">Mapped Types</a>-<a data-type="index:locator" href="#calibre_link-1315" class="calibre4">Companion Object Pattern</a></li><li class="calibre55"><span data-type="index-term" class="calibre">properties of</span>, <a data-type="index:locator" href="#calibre_link-1316" class="calibre4">Objects</a></li><li class="calibre55"><span data-type="index-term" class="calibre">Record type</span>, <a data-type="index:locator" href="#calibre_link-1317" class="calibre4">The Record Type</a></li><li class="calibre55"><span data-type="index-term" class="calibre">shape of</span>, <a data-type="index:locator" href="#calibre_link-1318" class="calibre4">Objects</a></li><li class="calibre55"><span data-type="index-term" class="calibre">type operators for</span>, <a data-type="index:locator" href="#calibre_link-1319" class="calibre4">Type Operators for Object Types</a>-<a data-type="index:locator" href="#calibre_link-1320" class="calibre4">The keyof operator</a><ul class="calibre57"><li class="calibre55"><span data-type="index-term" class="calibre">keying-in operator</span>, <a data-type="index:locator" href="#calibre_link-1321" class="calibre4">The keying-in operator</a></li><li class="calibre55"><span data-type="index-term" class="calibre">keyof operator</span>, <a data-type="index:locator" href="#calibre_link-1322" class="calibre4">The keyof operator</a></li></ul></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">Observables</span>, <a data-type="index:locator" href="#calibre_link-1323" class="calibre4">Async Streams</a></li><li class="calibre55"><span data-type="index-term" class="calibre">Option type</span>, <a data-type="index:locator" href="#calibre_link-1324" class="calibre4">The Option Type</a>-<a data-type="index:locator" href="#calibre_link-1325" class="calibre4">The Option Type</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">flatMap and getOrElse methods</span>, <a data-type="index:locator" href="#calibre_link-1326" class="calibre4">The Option Type</a></li><li class="calibre55"><span data-type="index-term" class="calibre">implementation in Some&lt;T&gt; and None classes</span>, <a data-type="index:locator" href="#calibre_link-1327" class="calibre4">The Option Type</a></li><li class="calibre55"><span data-type="index-term" class="calibre">implementing flatMap and getOrElse on Some&lt;T&gt; and None</span>, <a data-type="index:locator" href="#calibre_link-1328" class="calibre4">The Option Type</a></li><li class="calibre55"><span data-type="index-term" class="calibre">implementing Option function</span>, <a data-type="index:locator" href="#calibre_link-1329" class="calibre4">The Option Type</a></li><li class="calibre55"><span data-type="index-term" class="calibre">using overloaded signatures to give flatMap more specific types</span>, <a data-type="index:locator" href="#calibre_link-1330" class="calibre4">The Option Type</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">ORMs (object-relational mappers)</span>, <a data-type="index:locator" href="#calibre_link-1331" class="calibre4">Backend Frameworks</a></li><li class="calibre55"><span data-type="index-term" class="calibre">outFile TSC flag</span>, <a data-type="index:locator" href="#calibre_link-1332" class="calibre4">Running TypeScript in the Browser</a></li><li class="calibre55"><span data-type="index-term" class="calibre">overloaded ambient function declarations</span>, <a data-type="index:locator" href="#calibre_link-1333" class="calibre4">Collisions</a></li><li class="calibre55"><span data-type="index-term" class="calibre">overloaded function types</span>, <a data-type="index:locator" href="#calibre_link-1334" class="calibre4">Overloaded Function Types</a>-<a data-type="index:locator" href="#calibre_link-1335" class="calibre4">Overloaded Function Types</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">filter function</span>, <a data-type="index:locator" href="#calibre_link-1336" class="calibre4">Polymorphism</a></li><li class="calibre55"><span data-type="index-term" class="calibre">keeping overload signatures specific</span>, <a data-type="index:locator" href="#calibre_link-1337" class="calibre4">Overloaded Function Types</a></li></ul></li></ul></div><div data-type="indexdiv" class="preface"><h3 class="calibre54">P</h3><ul class="printings"><li class="calibre55"><span data-type="index-term" class="calibre">parallelism</span>, <a data-type="index:locator" href="#calibre_link-1338" class="calibre4">Typesafe Multithreading</a><ul class="calibre56"><li class="calibre55">(<span data-gentext="see" class="calibre">see also</span> multithreading)</li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">parameters</span><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">compatibility of arguments with</span>, <a data-type="index:locator" href="#calibre_link-1339" class="calibre4">Declaring and Invoking Functions</a></li><li class="calibre55"><span data-type="index-term" class="calibre">contravariance in function parameters</span>, <a data-type="index:locator" href="#calibre_link-1340" class="calibre4">Function variance</a></li><li class="calibre55"><span data-type="index-term" class="calibre">defined</span>, <a data-type="index:locator" href="#calibre_link-1341" class="calibre4">Declaring and Invoking Functions</a></li><li class="calibre55"><span data-type="index-term" class="calibre">generic type</span>, <a data-type="index:locator" href="#calibre_link-1342" class="calibre4">Polymorphism</a></li><li class="calibre55"><span data-type="index-term" class="calibre">optional and default</span>, <a data-type="index:locator" href="#calibre_link-1343" class="calibre4">Optional and Default Parameters</a></li><li class="calibre55"><span data-type="index-term" class="calibre">optional function parameters in type inference on JavaScript</span>, <a data-type="index:locator" href="#calibre_link-1344" class="calibre4">Step 2a: Enable Typechecking for JavaScript (Optional)</a></li><li class="calibre55"><span data-type="index-term" class="calibre">rest</span>, <a data-type="index:locator" href="#calibre_link-1345" class="calibre4">Rest Parameters</a></li><li class="calibre55"><span data-type="index-term" class="calibre">type</span>, <a data-type="index:locator" href="#calibre_link-1346" class="calibre4">Talking About Types</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">path directive</span>, <a data-type="index:locator" href="#calibre_link-1347" class="calibre4">Triple-Slash Directives</a></li><li class="calibre55"><span data-type="index-term" class="calibre">paths (module)</span>, <a data-type="index:locator" href="#calibre_link-1348" class="calibre4">import, export</a>, <a data-type="index:locator" href="#calibre_link-1349" class="calibre4">Dynamic Imports</a>, <a data-type="index:locator" href="#calibre_link-1350" class="calibre4">Declaration Merging</a></li><li class="calibre55"><span data-type="index-term" class="calibre">polyfills</span>, <a data-type="index:locator" href="#calibre_link-1351" class="calibre4">Dialing In Your Compile Target</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">for process.env.NODE_ENV</span>, <a data-type="index:locator" href="#calibre_link-1352" class="calibre4">Ambient Variable Declarations</a></li><li class="calibre55"><span data-type="index-term" class="calibre">for target environment not supporting newer library feature</span>, <a data-type="index:locator" href="#calibre_link-1353" class="calibre4">lib</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">polymorphism</span>, <a data-type="index:locator" href="#calibre_link-1354" class="calibre4">Polymorphism</a>-<a data-type="index:locator" href="#calibre_link-1355" class="calibre4">Type-Driven Development</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">binding of generics</span>, <a data-type="index:locator" href="#calibre_link-1356" class="calibre4">When Are Generics Bound?</a>-<a data-type="index:locator" href="#calibre_link-1357" class="calibre4">Where Can You Declare Generics?</a></li><li class="calibre55"><span data-type="index-term" class="calibre">bounded</span>, <a data-type="index:locator" href="#calibre_link-1358" class="calibre4">Bounded Polymorphism</a>-<a data-type="index:locator" href="#calibre_link-1359" class="calibre4">Using bounded polymorphism to model arity</a><ul class="calibre57"><li class="calibre55"><span data-type="index-term" class="calibre">using to model arity</span>, <a data-type="index:locator" href="#calibre_link-1360" class="calibre4">Using bounded polymorphism to model arity</a></li><li class="calibre55"><span data-type="index-term" class="calibre">with multiple constraints</span>, <a data-type="index:locator" href="#calibre_link-1361" class="calibre4">Bounded polymorphism with multiple constraints</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">classes and interfaces</span>, <a data-type="index:locator" href="#calibre_link-1362" class="calibre4">Polymorphism</a>-<a data-type="index:locator" href="#calibre_link-1363" class="calibre4">Mixins</a></li><li class="calibre55"><span data-type="index-term" class="calibre">generic type aliases</span>, <a data-type="index:locator" href="#calibre_link-1364" class="calibre4">Generic Type Aliases</a></li><li class="calibre55"><span data-type="index-term" class="calibre">generic type defaults</span>, <a data-type="index:locator" href="#calibre_link-1365" class="calibre4">Generic Type Defaults</a></li><li class="calibre55"><span data-type="index-term" class="calibre">generic type inference</span>, <a data-type="index:locator" href="#calibre_link-1366" class="calibre4">Generic Type Inference</a>-<a data-type="index:locator" href="#calibre_link-1367" class="calibre4">Generic Type Aliases</a></li><li class="calibre55"><span data-type="index-term" class="calibre">generic type parameters</span>, <a data-type="index:locator" href="#calibre_link-1368" class="calibre4">Polymorphism</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">preserveConstEnums TSC flag</span>, <a data-type="index:locator" href="#calibre_link-1369" class="calibre4">Enums</a></li><li class="calibre55"><span data-type="index-term" class="calibre">private (access modifier)</span>, <a data-type="index:locator" href="#calibre_link-1370" class="calibre4">Classes and Inheritance</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">class constructors</span>, <a data-type="index:locator" href="#calibre_link-1371" class="calibre4">Simulating final Classes</a></li><li class="calibre55"><span data-type="index-term" class="calibre">classes with private fields</span>, <a data-type="index:locator" href="#calibre_link-1372" class="calibre4">Classes Are Structurally Typed</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">project references</span>, <a data-type="index:locator" href="#calibre_link-1373" class="calibre4">Project References</a>-<a data-type="index:locator" href="#calibre_link-1374" class="calibre4">Error Monitoring</a></li><li class="calibre55"><span data-type="index-term" class="calibre">projects, setting up for TypeScript</span>, <a data-type="index:locator" href="#calibre_link-1375" class="calibre4">index.ts</a></li><li class="calibre55"><span data-type="index-term" class="calibre">promises</span>, <a data-type="index:locator" href="#calibre_link-1376" class="calibre4">Regaining Sanity with Promises</a>-<a data-type="index:locator" href="#calibre_link-1377" class="calibre4">Regaining Sanity with Promises</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">Promise implementation</span>, <a data-type="index:locator" href="#calibre_link-1378" class="calibre4">Regaining Sanity with Promises</a><ul class="calibre57"><li class="calibre55"><span data-type="index-term" class="calibre">generic type</span>, <a data-type="index:locator" href="#calibre_link-1379" class="calibre4">Regaining Sanity with Promises</a></li><li class="calibre55"><span data-type="index-term" class="calibre">rejecting Promises with an error</span>, <a data-type="index:locator" href="#calibre_link-1380" class="calibre4">Regaining Sanity with Promises</a></li><li class="calibre55"><span data-type="index-term" class="calibre">sequencing Promises with then and catch</span>, <a data-type="index:locator" href="#calibre_link-1381" class="calibre4">Regaining Sanity with Promises</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">returned by import function</span>, <a data-type="index:locator" href="#calibre_link-1382" class="calibre4">Dynamic Imports</a></li><li class="calibre55"><span data-type="index-term" class="calibre">using async and await with</span>, <a data-type="index:locator" href="#calibre_link-1383" class="calibre4">async and await</a></li><li class="calibre55"><span data-type="index-term" class="calibre">wrapping callback-based NodeJS API fs.readFile  in Promise-based API</span>, <a data-type="index:locator" href="#calibre_link-1384" class="calibre4">Regaining Sanity with Promises</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">properties</span><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">access modifiers for</span>, <a data-type="index:locator" href="#calibre_link-1385" class="calibre4">Classes and Inheritance</a></li><li class="calibre55"><span data-type="index-term" class="calibre">excess property checking</span>, <a data-type="index:locator" href="#calibre_link-1386" class="calibre4">Excess property checking</a></li><li class="calibre55"><span data-type="index-term" class="calibre">function, modeling with full call signatures</span>, <a data-type="index:locator" href="#calibre_link-1387" class="calibre4">Overloaded Function Types</a></li><li class="calibre55"><span data-type="index-term" class="calibre">object and class, covariance in</span>, <a data-type="index:locator" href="#calibre_link-1388" class="calibre4">Shape and array variance</a></li><li class="calibre55"><span data-type="index-term" class="calibre">type inference on JavaScript code</span>, <a data-type="index:locator" href="#calibre_link-1389" class="calibre4">Step 2a: Enable Typechecking for JavaScript (Optional)</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">protected (access modifier)</span>, <a data-type="index:locator" href="#calibre_link-1390" class="calibre4">Classes and Inheritance</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">classes with protected fields</span>, <a data-type="index:locator" href="#calibre_link-1391" class="calibre4">Classes Are Structurally Typed</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">protocols</span><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">client/server communications over</span>, <a data-type="index:locator" href="#calibre_link-1392" class="calibre4">Typesafe APIs</a></li><li class="calibre55"><span data-type="index-term" class="calibre">typesafe</span>, <a data-type="index:locator" href="#calibre_link-1393" class="calibre4">Typesafe protocols</a>, <a data-type="index:locator" href="#calibre_link-1394" class="calibre4">Typesafe APIs</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">prototypes, extending safely</span>, <a data-type="index:locator" href="#calibre_link-1395" class="calibre4">Safely Extending the Prototype</a>-<a data-type="index:locator" href="#calibre_link-1396" class="calibre4">Summary</a></li><li class="calibre55"><span data-type="index-term" class="calibre">public (access modifier)</span>, <a data-type="index:locator" href="#calibre_link-1397" class="calibre4">Classes and Inheritance</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">methods</span>, <a data-type="index:locator" href="#calibre_link-1398" class="calibre4">Classes and Inheritance</a></li></ul></li></ul></div><div data-type="indexdiv" class="preface"><h3 class="calibre54">R</h3><ul class="printings"><li class="calibre55"><span data-type="index-term" class="calibre">React</span>, <a data-type="index:locator" href="#calibre_link-1399" class="calibre4">React</a>-<a data-type="index:locator" href="#calibre_link-1400" class="calibre4">Using TSX with React</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">hooks into TSX to type JSX safely</span>, <a data-type="index:locator" href="#calibre_link-1401" class="calibre4">TSX</a></li><li class="calibre55"><span data-type="index-term" class="calibre">JSX primer</span>, <a data-type="index:locator" href="#calibre_link-1402" class="calibre4">A JSX primer</a></li><li class="calibre55"><span data-type="index-term" class="calibre">TSX or JSX support in TypeScript</span>, <a data-type="index:locator" href="#calibre_link-1403" class="calibre4">TSX = JSX + TypeScript</a></li><li class="calibre55"><span data-type="index-term" class="calibre">using TSX with</span>, <a data-type="index:locator" href="#calibre_link-1404" class="calibre4">Using TSX with React</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">reactive programming libraries</span>, <a data-type="index:locator" href="#calibre_link-1405" class="calibre4">Async Streams</a></li><li class="calibre55"><span data-type="index-term" class="calibre">readonly modifier</span>, <a data-type="index:locator" href="#calibre_link-1406" class="calibre4">Objects</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">using with arrays and tuples</span>, <a data-type="index:locator" href="#calibre_link-1407" class="calibre4">Read-only arrays and tuples</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">ReadonlyArray type</span>, <a data-type="index:locator" href="#calibre_link-1408" class="calibre4">Read-only arrays and tuples</a></li><li class="calibre55"><span data-type="index-term" class="calibre">Record type</span>, <a data-type="index:locator" href="#calibre_link-1409" class="calibre4">The Record Type</a></li><li class="calibre55"><span data-type="index-term" class="calibre">Redis library, using</span>, <a data-type="index:locator" href="#calibre_link-1410" class="calibre4">Event Emitters</a></li><li class="calibre55"><span data-type="index-term" class="calibre">reference types</span>, <a data-type="index:locator" href="#calibre_link-1411" class="calibre4">Style</a></li><li class="calibre55"><span data-type="index-term" class="calibre">references (compiler option)</span>, <a data-type="index:locator" href="#calibre_link-1412" class="calibre4">Project References</a></li><li class="calibre55"><span data-type="index-term" class="calibre">refinement (types)</span>, <a data-type="index:locator" href="#calibre_link-1413" class="calibre4">Refinement</a>-<a data-type="index:locator" href="#calibre_link-1414" class="calibre4">Discriminated union types</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">discriminated union types</span>, <a data-type="index:locator" href="#calibre_link-1415" class="calibre4">Discriminated union types</a></li><li class="calibre55"><span data-type="index-term" class="calibre">typeof operator and changing scopes</span>, <a data-type="index:locator" href="#calibre_link-1416" class="calibre4">User-Defined Type Guards</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">require calls</span>, <a data-type="index:locator" href="#calibre_link-1417" class="calibre4">A Brief History of JavaScript Modules</a></li><li class="calibre55"><span data-type="index-term" class="calibre">rest parameters</span>, <a data-type="index:locator" href="#calibre_link-1418" class="calibre4">Rest Parameters</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">type inference for</span>, <a data-type="index:locator" href="#calibre_link-1419" class="calibre4">Improving Type Inference for Tuples</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">return statements, totality checking</span>, <a data-type="index:locator" href="#calibre_link-1420" class="calibre4">Totality</a></li><li class="calibre55"><span data-type="index-term" class="calibre">return types</span><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">annotations of</span>, <a data-type="index:locator" href="#calibre_link-1421" class="calibre4">Declaring and Invoking Functions</a></li><li class="calibre55"><span data-type="index-term" class="calibre">covariance in</span>, <a data-type="index:locator" href="#calibre_link-1422" class="calibre4">Function variance</a></li><li class="calibre55"><span data-type="index-term" class="calibre">this variable</span>, <a data-type="index:locator" href="#calibre_link-1423" class="calibre4">Using this as a Return Type</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">role-oriented programming</span>, <a data-type="index:locator" href="#calibre_link-1424" class="calibre4">Mixins</a></li><li class="calibre55"><span data-type="index-term" class="calibre">runtime</span>, <a data-type="index:locator" href="#calibre_link-1425" class="calibre4">The Compiler</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">exceptions</span>, <a data-type="index:locator" href="#calibre_link-1426" class="calibre4">Handling Errors</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">RxJS library</span>, <a data-type="index:locator" href="#calibre_link-1427" class="calibre4">Async Streams</a></li></ul></div><div data-type="indexdiv" class="preface"><h3 class="calibre54">S</h3><ul class="printings"><li class="calibre55"><span data-type="index-term" class="calibre">safety flags (TSC)</span>, <a data-type="index:locator" href="#calibre_link-1428" class="calibre4">TSC Compiler Flags for Safety</a></li><li class="calibre55"><span data-type="index-term" class="calibre">scoped declarations</span>, <a data-type="index:locator" href="#calibre_link-1429" class="calibre4">Scoped Declarations</a></li><li class="calibre55"><span data-type="index-term" class="calibre">script mode versus module mode</span>, <a data-type="index:locator" href="#calibre_link-1430" class="calibre4">Module Mode Versus Script Mode</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">script mode for type declarations</span>, <a data-type="index:locator" href="#calibre_link-1431" class="calibre4">Type Declarations</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">self-hosting compilers</span>, <a data-type="index:locator" href="#calibre_link-1432" class="calibre4">Code Editor Setup</a></li><li class="calibre55"><span data-type="index-term" class="calibre">sequencing operations</span><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">in callbacks</span>, <a data-type="index:locator" href="#calibre_link-1433" class="calibre4">Working with Callbacks</a></li><li class="calibre55"><span data-type="index-term" class="calibre">in Promises</span>, <a data-type="index:locator" href="#calibre_link-1434" class="calibre4">Regaining Sanity with Promises</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">services (Angular)</span>, <a data-type="index:locator" href="#calibre_link-1435" class="calibre4">Services</a></li><li class="calibre55"><span data-type="index-term" class="calibre">shapes</span><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">subtype and supertype rules</span>, <a data-type="index:locator" href="#calibre_link-1436" class="calibre4">Shape and array variance</a></li><li class="calibre55"><span data-type="index-term" class="calibre">subtyping</span>, <a data-type="index:locator" href="#calibre_link-1437" class="calibre4">Shape and array variance</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">shorthand call signatures</span>, <a data-type="index:locator" href="#calibre_link-1438" class="calibre4">Overloaded Function Types</a></li><li class="calibre55"><span data-type="index-term" class="calibre">source maps</span>, <a data-type="index:locator" href="#calibre_link-1439" class="calibre4">Artifacts</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">enabling</span>, <a data-type="index:locator" href="#calibre_link-1440" class="calibre4">Enabling Source Maps</a></li><li class="calibre55"><span data-type="index-term" class="calibre">feeding into NodeJS process</span>, <a data-type="index:locator" href="#calibre_link-1441" class="calibre4">Running TypeScript on the Server</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">SQL calls</span>, <a data-type="index:locator" href="#calibre_link-1442" class="calibre4">Backend Frameworks</a></li><li class="calibre55"><span data-type="index-term" class="calibre">src/index.ts</span>, <a data-type="index:locator" href="#calibre_link-1443" class="calibre4">index.ts</a></li><li class="calibre55"><span data-type="index-term" class="calibre">strict flags in TSC</span>, <a data-type="index:locator" href="#calibre_link-1444" class="calibre4">any</a>, <a data-type="index:locator" href="#calibre_link-1445" class="calibre4">TSC Compiler Flags for Safety</a></li><li class="calibre55"><span data-type="index-term" class="calibre">strict mode (TSC)</span>, <a data-type="index:locator" href="#calibre_link-1446" class="calibre4">Step 2a: Enable Typechecking for JavaScript (Optional)</a></li><li class="calibre55"><span data-type="index-term" class="calibre">strictBindCallApply option</span>, <a data-type="index:locator" href="#calibre_link-1447" class="calibre4">call, apply, and bind</a></li><li class="calibre55"><span data-type="index-term" class="calibre">strictFunctionTypes TSC flag</span>, <a data-type="index:locator" href="#calibre_link-1448" class="calibre4">Function variance</a></li><li class="calibre55"><span data-type="index-term" class="calibre">strictNullChecks and strictPropertyInitialization TSC flags</span>, <a data-type="index:locator" href="#calibre_link-1449" class="calibre4">Classes and Inheritance</a></li><li class="calibre55"><span data-type="index-term" class="calibre">strictNullChecks option</span>, <a data-type="index:locator" href="#calibre_link-1450" class="calibre4">null, undefined, void, and never</a></li><li class="calibre55"><span data-type="index-term" class="calibre">string type</span>, <a data-type="index:locator" href="#calibre_link-1451" class="calibre4">All About Types</a>, <a data-type="index:locator" href="#calibre_link-1452" class="calibre4">string</a></li><li class="calibre55"><span data-type="index-term" class="calibre">strings</span><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">automatic type conversions in JavaScript</span>, <a data-type="index:locator" href="#calibre_link-1453" class="calibre4">Are types automatically converted?</a></li><li class="calibre55"><span data-type="index-term" class="calibre">filtering arrays of</span>, <a data-type="index:locator" href="#calibre_link-1454" class="calibre4">Polymorphism</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">structural typing</span>, <a data-type="index:locator" href="#calibre_link-1455" class="calibre4">Objects</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">classes in TypeScript</span>, <a data-type="index:locator" href="#calibre_link-1456" class="calibre4">Classes Are Structurally Typed</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">subtypes</span>, <a data-type="index:locator" href="#calibre_link-1457" class="calibre4">Subtypes and Supertypes</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">assignability and</span>, <a data-type="index:locator" href="#calibre_link-1458" class="calibre4">Assignability</a></li><li class="calibre55"><span data-type="index-term" class="calibre">subtyping rules for more complex types</span>, <a data-type="index:locator" href="#calibre_link-1459" class="calibre4">Variance</a><ul class="calibre57"><li class="calibre55"><span data-type="index-term" class="calibre">shapes and arrays</span>, <a data-type="index:locator" href="#calibre_link-1460" class="calibre4">Shape and array variance</a></li></ul></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">super calls</span>, <a data-type="index:locator" href="#calibre_link-1461" class="calibre4">super</a></li><li class="calibre55"><span data-type="index-term" class="calibre">supertypes</span>, <a data-type="index:locator" href="#calibre_link-1462" class="calibre4">Subtypes and Supertypes</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">assignability and</span>, <a data-type="index:locator" href="#calibre_link-1463" class="calibre4">Assignability</a></li><li class="calibre55"><span data-type="index-term" class="calibre">using object type in place of expected supertype</span>, <a data-type="index:locator" href="#calibre_link-1464" class="calibre4">Shape and array variance</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">symbol type</span>, <a data-type="index:locator" href="#calibre_link-1465" class="calibre4">symbol</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">example usages for unique symbol</span>, <a data-type="index:locator" href="#calibre_link-1466" class="calibre4">symbol</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">Symbol.iterator</span>, <a data-type="index:locator" href="#calibre_link-1467" class="calibre4">Iterators</a></li></ul></div><div data-type="indexdiv" class="preface"><h3 class="calibre54">T</h3><ul class="printings"><li class="calibre55"><span data-type="index-term" class="calibre">tags for union types</span>, <a data-type="index:locator" href="#calibre_link-1468" class="calibre4">Discriminated union types</a></li><li class="calibre55"><span data-type="index-term" class="calibre">target setting (TSC)</span>, <a data-type="index:locator" href="#calibre_link-1469" class="calibre4">Dialing In Your Compile Target</a></li><li class="calibre55"><span data-type="index-term" class="calibre">tasks</span>, <a data-type="index:locator" href="#calibre_link-1470" class="calibre4">JavaScript’s Event Loop</a></li><li class="calibre55"><span data-type="index-term" class="calibre">tests, relying on to find errors</span>, <a data-type="index:locator" href="#calibre_link-1471" class="calibre4">Introduction</a></li><li class="calibre55"><span data-type="index-term" class="calibre">then clause</span>, <a data-type="index:locator" href="#calibre_link-1472" class="calibre4">Regaining Sanity with Promises</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">using async and await instead of</span>, <a data-type="index:locator" href="#calibre_link-1473" class="calibre4">async and await</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">third-party JavaScript, using</span>, <a data-type="index:locator" href="#calibre_link-1474" class="calibre4">Using Third-Party JavaScript</a>-<a data-type="index:locator" href="#calibre_link-1475" class="calibre4">JavaScript That Doesn’t Have Type Declarations on DefinitelyTyped</a></li><li class="calibre55"><span data-type="index-term" class="calibre">this variable</span>, <a data-type="index:locator" href="#calibre_link-1476" class="calibre4">call, apply, and bind</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">contravariance in function this types</span>, <a data-type="index:locator" href="#calibre_link-1477" class="calibre4">Function variance</a></li><li class="calibre55"><span data-type="index-term" class="calibre">typing</span>, <a data-type="index:locator" href="#calibre_link-1478" class="calibre4">Typing this</a></li><li class="calibre55"><span data-type="index-term" class="calibre">using as method return type</span>, <a data-type="index:locator" href="#calibre_link-1479" class="calibre4">Using this as a Return Type</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">totality</span>, <a data-type="index:locator" href="#calibre_link-1480" class="calibre4">Totality</a>-<a data-type="index:locator" href="#calibre_link-1481" class="calibre4">Totality</a></li><li class="calibre55"><span data-type="index-term" class="calibre">traits</span>, <a data-type="index:locator" href="#calibre_link-1482" class="calibre4">Mixins</a><ul class="calibre56"><li class="calibre55">(<span data-gentext="see" class="calibre">see also</span> mixins)</li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">transpiling</span>, <a data-type="index:locator" href="#calibre_link-1483" class="calibre4">Dialing In Your Compile Target</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">JavaScript features TSC does/does not transpile for</span>, <a data-type="index:locator" href="#calibre_link-1484" class="calibre4">target</a></li><li class="calibre55"><span data-type="index-term" class="calibre">TSC support for transpiling code to older JavaScript versions</span>, <a data-type="index:locator" href="#calibre_link-1485" class="calibre4">Dialing In Your Compile Target</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">triple-slash directives</span>, <a data-type="index:locator" href="#calibre_link-1486" class="calibre4">Triple-Slash Directives</a>-<a data-type="index:locator" href="#calibre_link-1487" class="calibre4">The amd-module Directive</a>, <a data-type="index:locator" href="#calibre_link-1488" class="calibre4">Triple-Slash Directives</a>-<a data-type="index:locator" href="#calibre_link-1489" class="calibre4">Deprecated Directives</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">amd-module</span>, <a data-type="index:locator" href="#calibre_link-1490" class="calibre4">The amd-module Directive</a></li><li class="calibre55"><span data-type="index-term" class="calibre">types</span>, <a data-type="index:locator" href="#calibre_link-1491" class="calibre4">The types Directive</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">true and false values (boolean type)</span>, <a data-type="index:locator" href="#calibre_link-1492" class="calibre4">boolean</a></li><li class="calibre55"><span data-type="index-term" class="calibre">Try type</span>, <a data-type="index:locator" href="#calibre_link-1493" class="calibre4">The Option Type</a></li><li class="calibre55"><span data-type="index-term" class="calibre">try/catch statements</span>, <a data-type="index:locator" href="#calibre_link-1494" class="calibre4">Throwing Exceptions</a>, <a data-type="index:locator" href="#calibre_link-1495" class="calibre4">Regaining Sanity with Promises</a></li><li class="calibre55"><span data-type="index-term" class="calibre">TSC compiler</span>, <a data-type="index:locator" href="#calibre_link-1496" class="calibre4">The Compiler</a>, <a data-type="index:locator" href="#calibre_link-1497" class="calibre4">Code Editor Setup</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">artifacts generated by</span>, <a data-type="index:locator" href="#calibre_link-1498" class="calibre4">Artifacts</a></li><li class="calibre55"><span data-type="index-term" class="calibre">checkJs flag</span>, <a data-type="index:locator" href="#calibre_link-1499" class="calibre4">Step 2a: Enable Typechecking for JavaScript (Optional)</a></li><li class="calibre55"><span data-type="index-term" class="calibre">compiling JavaScript code</span>, <a data-type="index:locator" href="#calibre_link-1500" class="calibre4">Step 1: Add TSC</a></li><li class="calibre55"><span data-type="index-term" class="calibre">configuring with tsconfig.json</span>, <a data-type="index:locator" href="#calibre_link-1501" class="calibre4">tsconfig.json</a></li><li class="calibre55"><span data-type="index-term" class="calibre">declarations flag</span>, <a data-type="index:locator" href="#calibre_link-1502" class="calibre4">Type Declarations</a></li><li class="calibre55"><span data-type="index-term" class="calibre">downlevelIteration flag</span>, <a data-type="index:locator" href="#calibre_link-1503" class="calibre4">Iterators</a></li><li class="calibre55"><span data-type="index-term" class="calibre">enabling DOM APIs</span>, <a data-type="index:locator" href="#calibre_link-1504" class="calibre4">Frontend Frameworks</a></li><li class="calibre55"><span data-type="index-term" class="calibre">enabling dom lib for</span>, <a data-type="index:locator" href="#calibre_link-1505" class="calibre4">In the Browser: With Web Workers</a></li><li class="calibre55"><span data-type="index-term" class="calibre">enabling noImplicitAny flag</span>, <a data-type="index:locator" href="#calibre_link-1506" class="calibre4">Step 2a: Enable Typechecking for JavaScript (Optional)</a></li><li class="calibre55"><span data-type="index-term" class="calibre">enabling webworker lib for</span>, <a data-type="index:locator" href="#calibre_link-1507" class="calibre4">In the Browser: With Web Workers</a></li><li class="calibre55"><span data-type="index-term" class="calibre">esModuleInterop flag</span>, <a data-type="index:locator" href="#calibre_link-1508" class="calibre4">A JSX primer</a>, <a data-type="index:locator" href="#calibre_link-1509" class="calibre4">Using CommonJS and AMD Code</a></li><li class="calibre55"><span data-type="index-term" class="calibre">experimentalDecorators flag</span>, <a data-type="index:locator" href="#calibre_link-1510" class="calibre4">Decorators</a></li><li class="calibre55"><span data-type="index-term" class="calibre">fullTemplateTypeCheck flag</span>, <a data-type="index:locator" href="#calibre_link-1511" class="calibre4">Components</a></li><li class="calibre55"><span data-type="index-term" class="calibre">generating JavaScript bundles</span>, <a data-type="index:locator" href="#calibre_link-1512" class="calibre4">Running TypeScript in the Browser</a></li><li class="calibre55"><span data-type="index-term" class="calibre">installing with npm</span>, <a data-type="index:locator" href="#calibre_link-1513" class="calibre4">Code Editor Setup</a></li><li class="calibre55"><span data-type="index-term" class="calibre">jsx flag</span>, <a data-type="index:locator" href="#calibre_link-1514" class="calibre4">TSX = JSX + TypeScript</a></li><li class="calibre55"><span data-type="index-term" class="calibre">keyofStringsOnly flag</span>, <a data-type="index:locator" href="#calibre_link-1515" class="calibre4">The keyof operator</a></li><li class="calibre55"><span data-type="index-term" class="calibre">lib setting</span>, <a data-type="index:locator" href="#calibre_link-1516" class="calibre4">Ambient Variable Declarations</a></li><li class="calibre55"><span data-type="index-term" class="calibre">moduleResolution flag</span>, <a data-type="index:locator" href="#calibre_link-1517" class="calibre4">Declaration Merging</a></li><li class="calibre55"><span data-type="index-term" class="calibre">namespace output</span>, <a data-type="index:locator" href="#calibre_link-1518" class="calibre4">Compiled Output</a></li><li class="calibre55"><span data-type="index-term" class="calibre">noImplicitReturns flag</span>, <a data-type="index:locator" href="#calibre_link-1519" class="calibre4">Totality</a></li><li class="calibre55"><span data-type="index-term" class="calibre">noImplicitThis option</span>, <a data-type="index:locator" href="#calibre_link-1520" class="calibre4">Typing this</a></li><li class="calibre55"><span data-type="index-term" class="calibre">preserveConstEnums option</span>, <a data-type="index:locator" href="#calibre_link-1521" class="calibre4">Enums</a></li><li class="calibre55"><span data-type="index-term" class="calibre">project references</span>, <a data-type="index:locator" href="#calibre_link-1522" class="calibre4">Project References</a>-<a data-type="index:locator" href="#calibre_link-1523" class="calibre4">Error Monitoring</a></li><li class="calibre55"><span data-type="index-term" class="calibre">safety flags</span>, <a data-type="index:locator" href="#calibre_link-1524" class="calibre4">TSC Compiler Flags for Safety</a></li><li class="calibre55"><span data-type="index-term" class="calibre">setting to dial in environments to target</span>, <a data-type="index:locator" href="#calibre_link-1525" class="calibre4">Dialing In Your Compile Target</a></li><li class="calibre55"><span data-type="index-term" class="calibre">strictBindCallApply option</span>, <a data-type="index:locator" href="#calibre_link-1526" class="calibre4">call, apply, and bind</a></li><li class="calibre55"><span data-type="index-term" class="calibre">strictFunctionTypes flag</span>, <a data-type="index:locator" href="#calibre_link-1527" class="calibre4">Function variance</a></li><li class="calibre55"><span data-type="index-term" class="calibre">strictNullChecks and strictPropertyInitialization flags</span>, <a data-type="index:locator" href="#calibre_link-1528" class="calibre4">Classes and Inheritance</a></li><li class="calibre55"><span data-type="index-term" class="calibre">strictNullChecks option</span>, <a data-type="index:locator" href="#calibre_link-1529" class="calibre4">null, undefined, void, and never</a></li><li class="calibre55"><span data-type="index-term" class="calibre">types and typeRoots settings</span>, <a data-type="index:locator" href="#calibre_link-1530" class="calibre4">Type Lookup for JavaScript</a></li><li class="calibre55"><span data-type="index-term" class="calibre">using more stringent flags on migrated JavaScript code</span>, <a data-type="index:locator" href="#calibre_link-1531" class="calibre4">Step 4: Make It strict</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">tsconfig.json</span>, <a data-type="index:locator" href="#calibre_link-1532" class="calibre4">tsconfig.json</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">enabling noImplicitAny flag</span>, <a data-type="index:locator" href="#calibre_link-1533" class="calibre4">any</a></li><li class="calibre55"><span data-type="index-term" class="calibre">lib option</span>, <a data-type="index:locator" href="#calibre_link-1534" class="calibre4">Frontend Frameworks</a></li><li class="calibre55"><span data-type="index-term" class="calibre">module:esnext</span>, <a data-type="index:locator" href="#calibre_link-1535" class="calibre4">Dynamic Imports</a></li><li class="calibre55"><span data-type="index-term" class="calibre">options</span>, <a data-type="index:locator" href="#calibre_link-1536" class="calibre4">tsconfig.json</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">TSLint</span><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">configuring with tslint.json</span>, <a data-type="index:locator" href="#calibre_link-1537" class="calibre4">tslint.json</a></li><li class="calibre55"><span data-type="index-term" class="calibre">installing</span>, <a data-type="index:locator" href="#calibre_link-1538" class="calibre4">Code Editor Setup</a></li><li class="calibre55"><span data-type="index-term" class="calibre">no-angle-bracket-type-assertion rule</span>, <a data-type="index:locator" href="#calibre_link-1539" class="calibre4">Type Assertions</a></li><li class="calibre55"><span data-type="index-term" class="calibre">no-invalid-this rule</span>, <a data-type="index:locator" href="#calibre_link-1540" class="calibre4">Typing this</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">tslint.json</span>, <a data-type="index:locator" href="#calibre_link-1541" class="calibre4">tslint.json</a></li><li class="calibre55"><span data-type="index-term" class="calibre">TSX</span><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">reference</span>, <a data-type="index:locator" href="#calibre_link-1542" class="calibre4">TSX</a>-<a data-type="index:locator" href="#calibre_link-1543" class="calibre4">TSX</a></li><li class="calibre55"><span data-type="index-term" class="calibre">using with React</span>, <a data-type="index:locator" href="#calibre_link-1544" class="calibre4">Using TSX with React</a>-<a data-type="index:locator" href="#calibre_link-1545" class="calibre4">Using TSX with React</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">tuples</span>, <a data-type="index:locator" href="#calibre_link-1546" class="calibre4">Tuples</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">improving type inference for</span>, <a data-type="index:locator" href="#calibre_link-1547" class="calibre4">Improving Type Inference for Tuples</a></li><li class="calibre55"><span data-type="index-term" class="calibre">optional elements</span>, <a data-type="index:locator" href="#calibre_link-1548" class="calibre4">Tuples</a></li><li class="calibre55"><span data-type="index-term" class="calibre">read-only</span>, <a data-type="index:locator" href="#calibre_link-1549" class="calibre4">Read-only arrays and tuples</a></li><li class="calibre55"><span data-type="index-term" class="calibre">rest elements</span>, <a data-type="index:locator" href="#calibre_link-1550" class="calibre4">Tuples</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">type aliases</span>, <a data-type="index:locator" href="#calibre_link-1551" class="calibre4">Type aliases</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">binding of generics</span>, <a data-type="index:locator" href="#calibre_link-1552" class="calibre4">When Are Generics Bound?</a></li><li class="calibre55"><span data-type="index-term" class="calibre">comparison with interfaces</span>, <a data-type="index:locator" href="#calibre_link-1553" class="calibre4">Interfaces</a></li><li class="calibre55"><span data-type="index-term" class="calibre">for namespaces</span>, <a data-type="index:locator" href="#calibre_link-1554" class="calibre4">Namespaces</a></li><li class="calibre55"><span data-type="index-term" class="calibre">generic</span>, <a data-type="index:locator" href="#calibre_link-1555" class="calibre4">Generic Type Aliases</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">type branding</span>, <a data-type="index:locator" href="#calibre_link-1556" class="calibre4">Simulating Nominal Types</a></li><li class="calibre55"><span data-type="index-term" class="calibre">type declarations</span>, <a data-type="index:locator" href="#calibre_link-1557" class="calibre4">Type Declarations</a>-<a data-type="index:locator" href="#calibre_link-1558" class="calibre4">Ambient Module Declarations</a>, <a data-type="index:locator" href="#calibre_link-1559" class="calibre4">Artifacts</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">ambient module declarations</span>, <a data-type="index:locator" href="#calibre_link-1560" class="calibre4">Ambient Module Declarations</a></li><li class="calibre55"><span data-type="index-term" class="calibre">ambient type declarations</span>, <a data-type="index:locator" href="#calibre_link-1561" class="calibre4">Ambient Type Declarations</a></li><li class="calibre55"><span data-type="index-term" class="calibre">ambient variable declarations</span>, <a data-type="index:locator" href="#calibre_link-1562" class="calibre4">Ambient Variable Declarations</a></li><li class="calibre55"><span data-type="index-term" class="calibre">creating for third-party JavaScript and sending to NPM</span>, <a data-type="index:locator" href="#calibre_link-1563" class="calibre4">JavaScript That Doesn’t Have Type Declarations on DefinitelyTyped</a></li><li class="calibre55"><span data-type="index-term" class="calibre">differences from regular TypeScript syntax</span>, <a data-type="index:locator" href="#calibre_link-1564" class="calibre4">Type Declarations</a></li><li class="calibre55"><span data-type="index-term" class="calibre">DOM type declarations, enabling</span>, <a data-type="index:locator" href="#calibre_link-1565" class="calibre4">lib</a></li><li class="calibre55"><span data-type="index-term" class="calibre">example with equivalent TypeScript code</span>, <a data-type="index:locator" href="#calibre_link-1566" class="calibre4">Type Declarations</a></li><li class="calibre55"><span data-type="index-term" class="calibre">in JavaScript on DefinitelyTyped</span>, <a data-type="index:locator" href="#calibre_link-1567" class="calibre4">JavaScript That Has Type Declarations on DefinitelyTyped</a></li><li class="calibre55"><span data-type="index-term" class="calibre">JavaScript code without on DefinitelyTyped</span>, <a data-type="index:locator" href="#calibre_link-1568" class="calibre4">JavaScript That Doesn’t Have Type Declarations on DefinitelyTyped</a></li><li class="calibre55"><span data-type="index-term" class="calibre">uses of type declaration files</span>, <a data-type="index:locator" href="#calibre_link-1569" class="calibre4">Type Declarations</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">type guards</span>, <a data-type="index:locator" href="#calibre_link-1570" class="calibre4">User-Defined Type Guards</a></li><li class="calibre55"><span data-type="index-term" class="calibre">type inference</span><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">improving for tuples</span>, <a data-type="index:locator" href="#calibre_link-1571" class="calibre4">Improving Type Inference for Tuples</a></li><li class="calibre55"><span data-type="index-term" class="calibre">types in JavaScript code</span>, <a data-type="index:locator" href="#calibre_link-1572" class="calibre4">Step 2a: Enable Typechecking for JavaScript (Optional)</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">type literals</span>, <a data-type="index:locator" href="#calibre_link-1573" class="calibre4">boolean</a></li><li class="calibre55"><span data-type="index-term" class="calibre">type operators</span>, <a data-type="index:locator" href="#calibre_link-1574" class="calibre4">Type Operators</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">for object types</span>, <a data-type="index:locator" href="#calibre_link-1575" class="calibre4">Type Operators for Object Types</a>-<a data-type="index:locator" href="#calibre_link-1576" class="calibre4">The keyof operator</a><ul class="calibre57"><li class="calibre55"><span data-type="index-term" class="calibre">keying-in operator</span>, <a data-type="index:locator" href="#calibre_link-1577" class="calibre4">The keying-in operator</a></li><li class="calibre55"><span data-type="index-term" class="calibre">keyof</span>, <a data-type="index:locator" href="#calibre_link-1578" class="calibre4">The keyof operator</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">&ndash; (minus) and + (plus)</span>, <a data-type="index:locator" href="#calibre_link-1579" class="calibre4">Mapped Types</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">type refinement</span> (<span data-gentext="see" class="calibre">see</span> refinement)</li><li class="calibre55"><span data-type="index-term" class="calibre">type safety</span>, <a data-type="index:locator" href="#calibre_link-1580" class="calibre4">Introduction</a></li><li class="calibre55"><span data-type="index-term" class="calibre">type signatures</span> (<span data-gentext="see" class="calibre">see</span> call signatures)</li><li class="calibre55"><span data-type="index-term" class="calibre">type systems</span>, <a data-type="index:locator" href="#calibre_link-1581" class="calibre4">The Type System</a>-<a data-type="index:locator" href="#calibre_link-1582" class="calibre4">When are errors surfaced?</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">comparison for JavaScript and TypeScript</span>, <a data-type="index:locator" href="#calibre_link-1583" class="calibre4">TypeScript Versus JavaScript</a>-<a data-type="index:locator" href="#calibre_link-1584" class="calibre4">When are errors surfaced?</a></li><li class="calibre55"><span data-type="index-term" class="calibre">what TypeScript type system handles</span>, <a data-type="index:locator" href="#calibre_link-1585" class="calibre4">Conclusion</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">type utilities</span>, <a data-type="index:locator" href="#calibre_link-1586" class="calibre4">Type Utilities</a></li><li class="calibre55"><span data-type="index-term" class="calibre">type widening</span>, <a data-type="index:locator" href="#calibre_link-1587" class="calibre4">Type Widening</a>-<a data-type="index:locator" href="#calibre_link-1588" class="calibre4">The const type</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">excess property checking</span>, <a data-type="index:locator" href="#calibre_link-1589" class="calibre4">Excess property checking</a></li><li class="calibre55"><span data-type="index-term" class="calibre">preventing with const type</span>, <a data-type="index:locator" href="#calibre_link-1590" class="calibre4">The const type</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">type-driven development</span>, <a data-type="index:locator" href="#calibre_link-1591" class="calibre4">Type-Driven Development</a></li><li class="calibre55"><span data-type="index-term" class="calibre">type-level code</span>, <a data-type="index:locator" href="#calibre_link-1592" class="calibre4">Call Signatures</a></li><li class="calibre55"><span data-type="index-term" class="calibre">typechecker</span>, <a data-type="index:locator" href="#calibre_link-1593" class="calibre4">The Compiler</a>, <a data-type="index:locator" href="#calibre_link-1594" class="calibre4">All About Types</a></li><li class="calibre55"><span data-type="index-term" class="calibre">typechecking</span>, <a data-type="index:locator" href="#calibre_link-1595" class="calibre4">The Compiler</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">for Angular templates</span>, <a data-type="index:locator" href="#calibre_link-1596" class="calibre4">Components</a></li><li class="calibre55"><span data-type="index-term" class="calibre">JavaScript code</span>, <a data-type="index:locator" href="#calibre_link-1597" class="calibre4">Step 2a: Enable Typechecking for JavaScript (Optional)</a></li><li class="calibre55"><span data-type="index-term" class="calibre">JavaScript versus TypeScript</span>, <a data-type="index:locator" href="#calibre_link-1598" class="calibre4">When are types checked?</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">typeof operator</span>, <a data-type="index:locator" href="#calibre_link-1599" class="calibre4">Classes Declare Both Values and Types</a>, <a data-type="index:locator" href="#calibre_link-1600" class="calibre4">User-Defined Type Guards</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">using with array items</span>, <a data-type="index:locator" href="#calibre_link-1601" class="calibre4">Arrays</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">types</span><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">advanced object types</span>, <a data-type="index:locator" href="#calibre_link-1602" class="calibre4">Advanced Object Types</a>-<a data-type="index:locator" href="#calibre_link-1603" class="calibre4">Companion Object Pattern</a><ul class="calibre57"><li class="calibre55"><span data-type="index-term" class="calibre">companion object pattern</span>, <a data-type="index:locator" href="#calibre_link-1604" class="calibre4">Companion Object Pattern</a></li><li class="calibre55"><span data-type="index-term" class="calibre">mapped types</span>, <a data-type="index:locator" href="#calibre_link-1605" class="calibre4">Mapped Types</a>-<a data-type="index:locator" href="#calibre_link-1606" class="calibre4">Companion Object Pattern</a></li><li class="calibre55"><span data-type="index-term" class="calibre">Record</span>, <a data-type="index:locator" href="#calibre_link-1607" class="calibre4">The Record Type</a></li><li class="calibre55"><span data-type="index-term" class="calibre">type operators</span>, <a data-type="index:locator" href="#calibre_link-1608" class="calibre4">Type Operators for Object Types</a>-<a data-type="index:locator" href="#calibre_link-1609" class="calibre4">The keyof operator</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">binding, JavaScript versus TypeScript</span>, <a data-type="index:locator" href="#calibre_link-1610" class="calibre4">How are types bound?</a></li><li class="calibre55"><span data-type="index-term" class="calibre">classes declaring both values and types</span>, <a data-type="index:locator" href="#calibre_link-1611" class="calibre4">Classes Declare Both Values and Types</a></li><li class="calibre55"><span data-type="index-term" class="calibre">conditional</span>, <a data-type="index:locator" href="#calibre_link-1612" class="calibre4">Conditional Types</a>-<a data-type="index:locator" href="#calibre_link-1613" class="calibre4">Escape Hatches</a><ul class="calibre57"><li class="calibre55"><span data-type="index-term" class="calibre">built-in</span>, <a data-type="index:locator" href="#calibre_link-1614" class="calibre4">Built-in Conditional Types</a></li><li class="calibre55"><span data-type="index-term" class="calibre">declaring generics inline with infer keyword</span>, <a data-type="index:locator" href="#calibre_link-1615" class="calibre4">The infer Keyword</a></li><li class="calibre55"><span data-type="index-term" class="calibre">distributive conditionals</span>, <a data-type="index:locator" href="#calibre_link-1616" class="calibre4">Distributive Conditionals</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">conversions, JavaScript versus Typescript</span>, <a data-type="index:locator" href="#calibre_link-1617" class="calibre4">Are types automatically converted?</a></li><li class="calibre55"><span data-type="index-term" class="calibre">declarations generating</span>, <a data-type="index:locator" href="#calibre_link-1618" class="calibre4">Does It Generate a Type?</a></li><li class="calibre55"><span data-type="index-term" class="calibre">declaring type this variable</span>, <a data-type="index:locator" href="#calibre_link-1619" class="calibre4">Typing this</a></li><li class="calibre55"><span data-type="index-term" class="calibre">defined</span>, <a data-type="index:locator" href="#calibre_link-1620" class="calibre4">All About Types</a></li><li class="calibre55"><span data-type="index-term" class="calibre">DOM type declarations, enabling</span>, <a data-type="index:locator" href="#calibre_link-1621" class="calibre4">Frontend Frameworks</a></li><li class="calibre55"><span data-type="index-term" class="calibre">escape hatches</span>, <a data-type="index:locator" href="#calibre_link-1622" class="calibre4">Escape Hatches</a>-<a data-type="index:locator" href="#calibre_link-1623" class="calibre4">Definite Assignment Assertions</a><ul class="calibre57"><li class="calibre55"><span data-type="index-term" class="calibre">definite assignment assertions</span>, <a data-type="index:locator" href="#calibre_link-1624" class="calibre4">Definite Assignment Assertions</a></li><li class="calibre55"><span data-type="index-term" class="calibre">nonnull assertions</span>, <a data-type="index:locator" href="#calibre_link-1625" class="calibre4">Nonnull Assertions</a></li><li class="calibre55"><span data-type="index-term" class="calibre">simulating nominal types</span>, <a data-type="index:locator" href="#calibre_link-1626" class="calibre4">Simulating Nominal Types</a>-<a data-type="index:locator" href="#calibre_link-1627" class="calibre4">Simulating Nominal Types</a></li><li class="calibre55"><span data-type="index-term" class="calibre">type assertions</span>, <a data-type="index:locator" href="#calibre_link-1628" class="calibre4">Type Assertions</a>-<a data-type="index:locator" href="#calibre_link-1629" class="calibre4">Type Assertions</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">extending the prototype safely</span>, <a data-type="index:locator" href="#calibre_link-1630" class="calibre4">Safely Extending the Prototype</a>-<a data-type="index:locator" href="#calibre_link-1631" class="calibre4">Summary</a></li><li class="calibre55"><span data-type="index-term" class="calibre">function</span>, <a data-type="index:locator" href="#calibre_link-1632" class="calibre4">Advanced Function Types</a>-<a data-type="index:locator" href="#calibre_link-1633" class="calibre4">User-Defined Type Guards</a><ul class="calibre57"><li class="calibre55"><span data-type="index-term" class="calibre">improving type inference for tuples</span>, <a data-type="index:locator" href="#calibre_link-1634" class="calibre4">Improving Type Inference for Tuples</a></li><li class="calibre55"><span data-type="index-term" class="calibre">user-defined type guards</span>, <a data-type="index:locator" href="#calibre_link-1635" class="calibre4">User-Defined Type Guards</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">merging types and values</span>, <a data-type="index:locator" href="#calibre_link-1636" class="calibre4">Declaration Merging</a></li><li class="calibre55"><span data-type="index-term" class="calibre">relationships between</span>, <a data-type="index:locator" href="#calibre_link-1637" class="calibre4">Relationships Between Types</a>-<a data-type="index:locator" href="#calibre_link-1638" class="calibre4">Discriminated union types</a><ul class="calibre57"><li class="calibre55"><span data-type="index-term" class="calibre">assignability</span>, <a data-type="index:locator" href="#calibre_link-1639" class="calibre4">Assignability</a></li><li class="calibre55"><span data-type="index-term" class="calibre">refinement</span>, <a data-type="index:locator" href="#calibre_link-1640" class="calibre4">Refinement</a>-<a data-type="index:locator" href="#calibre_link-1641" class="calibre4">Discriminated union types</a></li><li class="calibre55"><span data-type="index-term" class="calibre">subtypes and supertypes</span>, <a data-type="index:locator" href="#calibre_link-1642" class="calibre4">Subtypes and Supertypes</a></li><li class="calibre55"><span data-type="index-term" class="calibre">type widening</span>, <a data-type="index:locator" href="#calibre_link-1643" class="calibre4">Type Widening</a>-<a data-type="index:locator" href="#calibre_link-1644" class="calibre4">The const type</a></li><li class="calibre55"><span data-type="index-term" class="calibre">variance</span>, <a data-type="index:locator" href="#calibre_link-1645" class="calibre4">Variance</a>-<a data-type="index:locator" href="#calibre_link-1646" class="calibre4">Function variance</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">sketching out programs in</span>, <a data-type="index:locator" href="#calibre_link-1647" class="calibre4">Conclusion</a></li><li class="calibre55"><span data-type="index-term" class="calibre">supported by TypeScript</span>, <a data-type="index:locator" href="#calibre_link-1648" class="calibre4">The ABCs of Types</a>-<a data-type="index:locator" href="#calibre_link-1649" class="calibre4">Summary</a><ul class="calibre57"><li class="calibre55"><span data-type="index-term" class="calibre">any</span>, <a data-type="index:locator" href="#calibre_link-1650" class="calibre4">any</a></li><li class="calibre55"><span data-type="index-term" class="calibre">arrays</span>, <a data-type="index:locator" href="#calibre_link-1651" class="calibre4">Arrays</a>-<a data-type="index:locator" href="#calibre_link-1652" class="calibre4">Read-only arrays and tuples</a></li><li class="calibre55"><span data-type="index-term" class="calibre">bigint</span>, <a data-type="index:locator" href="#calibre_link-1653" class="calibre4">bigint</a></li><li class="calibre55"><span data-type="index-term" class="calibre">boolean</span>, <a data-type="index:locator" href="#calibre_link-1654" class="calibre4">boolean</a></li><li class="calibre55"><span data-type="index-term" class="calibre">null, undefined, void, and never</span>, <a data-type="index:locator" href="#calibre_link-1655" class="calibre4">null, undefined, void, and never</a>-<a data-type="index:locator" href="#calibre_link-1656" class="calibre4">null, undefined, void, and never</a></li><li class="calibre55"><span data-type="index-term" class="calibre">number</span>, <a data-type="index:locator" href="#calibre_link-1657" class="calibre4">number</a></li><li class="calibre55"><span data-type="index-term" class="calibre">objects</span>, <a data-type="index:locator" href="#calibre_link-1658" class="calibre4">Objects</a>-<a data-type="index:locator" href="#calibre_link-1659" class="calibre4">Intermission: Type Aliases, Unions, and Intersections</a></li><li class="calibre55"><span data-type="index-term" class="calibre">string</span>, <a data-type="index:locator" href="#calibre_link-1660" class="calibre4">string</a></li><li class="calibre55"><span data-type="index-term" class="calibre">symbol</span>, <a data-type="index:locator" href="#calibre_link-1661" class="calibre4">symbol</a></li><li class="calibre55"><span data-type="index-term" class="calibre">tuples</span>, <a data-type="index:locator" href="#calibre_link-1662" class="calibre4">Tuples</a></li><li class="calibre55"><span data-type="index-term" class="calibre">type aliases</span>, <a data-type="index:locator" href="#calibre_link-1663" class="calibre4">Type aliases</a></li><li class="calibre55"><span data-type="index-term" class="calibre">types and their subtypes</span>, <a data-type="index:locator" href="#calibre_link-1664" class="calibre4">Summary</a></li><li class="calibre55"><span data-type="index-term" class="calibre">union and intersection types</span>, <a data-type="index:locator" href="#calibre_link-1665" class="calibre4">Union and intersection types</a></li><li class="calibre55"><span data-type="index-term" class="calibre">unknown</span>, <a data-type="index:locator" href="#calibre_link-1666" class="calibre4">unknown</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">terminology and vocabulary of</span>, <a data-type="index:locator" href="#calibre_link-1667" class="calibre4">Talking About Types</a></li><li class="calibre55"><span data-type="index-term" class="calibre">top-level, in type declaration files</span>, <a data-type="index:locator" href="#calibre_link-1668" class="calibre4">Type Declarations</a></li><li class="calibre55"><span data-type="index-term" class="calibre">totality</span>, <a data-type="index:locator" href="#calibre_link-1669" class="calibre4">Totality</a>-<a data-type="index:locator" href="#calibre_link-1670" class="calibre4">Totality</a></li><li class="calibre55"><span data-type="index-term" class="calibre">type lookup for JavaScript</span>, <a data-type="index:locator" href="#calibre_link-1671" class="calibre4">Type Lookup for JavaScript</a>-<a data-type="index:locator" href="#calibre_link-1672" class="calibre4">Using Third-Party JavaScript</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">types and typeRoots settings (TSC)</span>, <a data-type="index:locator" href="#calibre_link-1673" class="calibre4">Type Lookup for JavaScript</a></li><li class="calibre55"><span data-type="index-term" class="calibre">types directive</span>, <a data-type="index:locator" href="#calibre_link-1674" class="calibre4">The types Directive</a></li><li class="calibre55"><span data-type="index-term" class="calibre">TypeScript</span><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">benefits of</span>, <a data-type="index:locator" href="#calibre_link-1675" class="calibre4">Introduction</a></li><li class="calibre55"><span data-type="index-term" class="calibre">building a project</span>, <a data-type="index:locator" href="#calibre_link-1676" class="calibre4">Building Your TypeScript Project</a>-<a data-type="index:locator" href="#calibre_link-1677" class="calibre4">Error Monitoring</a><ul class="calibre57"><li class="calibre55"><span data-type="index-term" class="calibre">artifacts generated by TSC</span>, <a data-type="index:locator" href="#calibre_link-1678" class="calibre4">Artifacts</a></li><li class="calibre55"><span data-type="index-term" class="calibre">dialing in your compile target</span>, <a data-type="index:locator" href="#calibre_link-1679" class="calibre4">Dialing In Your Compile Target</a>-<a data-type="index:locator" href="#calibre_link-1680" class="calibre4">lib</a></li><li class="calibre55"><span data-type="index-term" class="calibre">enabling source maps</span>, <a data-type="index:locator" href="#calibre_link-1681" class="calibre4">Enabling Source Maps</a></li><li class="calibre55"><span data-type="index-term" class="calibre">error monitoring</span>, <a data-type="index:locator" href="#calibre_link-1682" class="calibre4">Error Monitoring</a></li><li class="calibre55"><span data-type="index-term" class="calibre">project layout</span>, <a data-type="index:locator" href="#calibre_link-1683" class="calibre4">Project Layout</a></li><li class="calibre55"><span data-type="index-term" class="calibre">project references</span>, <a data-type="index:locator" href="#calibre_link-1684" class="calibre4">Project References</a>-<a data-type="index:locator" href="#calibre_link-1685" class="calibre4">Error Monitoring</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">compiler</span>, <a data-type="index:locator" href="#calibre_link-1686" class="calibre4">TypeScript: A 10_000 Foot View</a>-<a data-type="index:locator" href="#calibre_link-1687" class="calibre4">The Compiler</a></li><li class="calibre55"><span data-type="index-term" class="calibre">errors, handling of</span>, <a data-type="index:locator" href="#calibre_link-1688" class="calibre4">Introduction</a></li><li class="calibre55"><span data-type="index-term" class="calibre">gradually migrating JavaScript code to</span>, <a data-type="index:locator" href="#calibre_link-1689" class="calibre4">Gradually Migrating from JavaScript to TypeScript</a>-<a data-type="index:locator" href="#calibre_link-1690" class="calibre4">Step 4: Make It strict</a><ul class="calibre57"><li class="calibre55"><span data-type="index-term" class="calibre">adding JSDoc annotations</span>, <a data-type="index:locator" href="#calibre_link-1691" class="calibre4">Step 2b: Add JSDoc Annotations (Optional)</a></li><li class="calibre55"><span data-type="index-term" class="calibre">adding TSC to JavaScript projects</span>, <a data-type="index:locator" href="#calibre_link-1692" class="calibre4">Step 1: Add TSC</a></li><li class="calibre55"><span data-type="index-term" class="calibre">enabling typechecking for JavaScript</span>, <a data-type="index:locator" href="#calibre_link-1693" class="calibre4">Step 2a: Enable Typechecking for JavaScript (Optional)</a></li><li class="calibre55"><span data-type="index-term" class="calibre">renaming files to .ts</span>, <a data-type="index:locator" href="#calibre_link-1694" class="calibre4">Step 3: Rename Your Files to .ts</a></li><li class="calibre55"><span data-type="index-term" class="calibre">using strict TSC flags</span>, <a data-type="index:locator" href="#calibre_link-1695" class="calibre4">Step 4: Make It strict</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">modules, consuming and exporting</span>, <a data-type="index:locator" href="#calibre_link-1696" class="calibre4">A Brief History of JavaScript Modules</a></li><li class="calibre55"><span data-type="index-term" class="calibre">publishing code to NPM</span>, <a data-type="index:locator" href="#calibre_link-1697" class="calibre4">Publishing Your TypeScript Code to NPM</a>-<a data-type="index:locator" href="#calibre_link-1698" class="calibre4">Publishing Your TypeScript Code to NPM</a></li><li class="calibre55"><span data-type="index-term" class="calibre">running in the browser</span>, <a data-type="index:locator" href="#calibre_link-1699" class="calibre4">Running TypeScript in the Browser</a></li><li class="calibre55"><span data-type="index-term" class="calibre">running on the server</span>, <a data-type="index:locator" href="#calibre_link-1700" class="calibre4">Running TypeScript on the Server</a></li><li class="calibre55"><span data-type="index-term" class="calibre">setting up code editors</span>, <a data-type="index:locator" href="#calibre_link-1701" class="calibre4">Code Editor Setup</a>-<a data-type="index:locator" href="#calibre_link-1702" class="calibre4">tslint.json</a></li><li class="calibre55"><span data-type="index-term" class="calibre">setting up projects, index.ts file</span>, <a data-type="index:locator" href="#calibre_link-1703" class="calibre4">index.ts</a></li><li class="calibre55"><span data-type="index-term" class="calibre">triple-slash directives</span>, <a data-type="index:locator" href="#calibre_link-1704" class="calibre4">Triple-Slash Directives</a>-<a data-type="index:locator" href="#calibre_link-1705" class="calibre4">The amd-module Directive</a></li><li class="calibre55"><span data-type="index-term" class="calibre">type system</span>, <a data-type="index:locator" href="#calibre_link-1706" class="calibre4">The Type System</a>-<a data-type="index:locator" href="#calibre_link-1707" class="calibre4">When are errors surfaced?</a><ul class="calibre57"><li class="calibre55"><span data-type="index-term" class="calibre">comparison to JavaScript</span>, <a data-type="index:locator" href="#calibre_link-1708" class="calibre4">TypeScript Versus JavaScript</a>-<a data-type="index:locator" href="#calibre_link-1709" class="calibre4">When are errors surfaced?</a></li></ul></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">TypeSearch</span>, <a data-type="index:locator" href="#calibre_link-1710" class="calibre4">JavaScript That Has Type Declarations on DefinitelyTyped</a></li></ul></div><div data-type="indexdiv" class="preface"><h3 class="calibre54">U</h3><ul class="printings"><li class="calibre55"><span data-type="index-term" class="calibre">undefined type</span>, <a data-type="index:locator" href="#calibre_link-1711" class="calibre4">null, undefined, void, and never</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">example of usage</span>, <a data-type="index:locator" href="#calibre_link-1712" class="calibre4">null, undefined, void, and never</a></li><li class="calibre55"><span data-type="index-term" class="calibre">nonnull assertions</span>, <a data-type="index:locator" href="#calibre_link-1713" class="calibre4">Nonnull Assertions</a></li><li class="calibre55"><span data-type="index-term" class="calibre">summary of usage</span>, <a data-type="index:locator" href="#calibre_link-1714" class="calibre4">null, undefined, void, and never</a></li><li class="calibre55"><span data-type="index-term" class="calibre">variables initialized to, type widening</span>, <a data-type="index:locator" href="#calibre_link-1715" class="calibre4">Type Widening</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">union types</span>, <a data-type="index:locator" href="#calibre_link-1716" class="calibre4">Union and intersection types</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">adding conditional type</span>, <a data-type="index:locator" href="#calibre_link-1717" class="calibre4">Distributive Conditionals</a></li><li class="calibre55"><span data-type="index-term" class="calibre">defining for communication among threads</span>, <a data-type="index:locator" href="#calibre_link-1718" class="calibre4">In the Browser: With Web Workers</a></li><li class="calibre55"><span data-type="index-term" class="calibre">discriminated</span>, <a data-type="index:locator" href="#calibre_link-1719" class="calibre4">Discriminated union types</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">unique symbols</span>, <a data-type="index:locator" href="#calibre_link-1720" class="calibre4">symbol</a>, <a data-type="index:locator" href="#calibre_link-1721" class="calibre4">Simulating Nominal Types</a></li><li class="calibre55"><span data-type="index-term" class="calibre">unknown type</span>, <a data-type="index:locator" href="#calibre_link-1722" class="calibre4">unknown</a></li><li class="calibre55"><span data-type="index-term" class="calibre">user-defined type guards</span>, <a data-type="index:locator" href="#calibre_link-1723" class="calibre4">User-Defined Type Guards</a></li></ul></div><div data-type="indexdiv" class="preface"><h3 class="calibre54">V</h3><ul class="printings"><li class="calibre55"><span data-type="index-term" class="calibre">value-based elements (TSX)</span>, <a data-type="index:locator" href="#calibre_link-1724" class="calibre4">TSX</a></li><li class="calibre55"><span data-type="index-term" class="calibre">value-level code</span>, <a data-type="index:locator" href="#calibre_link-1725" class="calibre4">Call Signatures</a></li><li class="calibre55"><span data-type="index-term" class="calibre">value: type annotations</span>, <a data-type="index:locator" href="#calibre_link-1726" class="calibre4">The Type System</a></li><li class="calibre55"><span data-type="index-term" class="calibre">values</span>, <a data-type="index:locator" href="#calibre_link-1727" class="calibre4">Style</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">classes declaring both values and types</span>, <a data-type="index:locator" href="#calibre_link-1728" class="calibre4">Classes Declare Both Values and Types</a></li><li class="calibre55"><span data-type="index-term" class="calibre">declarations generating</span>, <a data-type="index:locator" href="#calibre_link-1729" class="calibre4">Does It Generate a Type?</a></li><li class="calibre55"><span data-type="index-term" class="calibre">merging values and types</span>, <a data-type="index:locator" href="#calibre_link-1730" class="calibre4">Declaration Merging</a></li><li class="calibre55"><span data-type="index-term" class="calibre">null and undefined</span>, <a data-type="index:locator" href="#calibre_link-1731" class="calibre4">null, undefined, void, and never</a></li><li class="calibre55"><span data-type="index-term" class="calibre">top-level, in type declaration files</span>, <a data-type="index:locator" href="#calibre_link-1732" class="calibre4">Type Declarations</a></li><li class="calibre55"><span data-type="index-term" class="calibre">type declarations and</span>, <a data-type="index:locator" href="#calibre_link-1733" class="calibre4">Type Declarations</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">var</span><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">type declarations with</span>, <a data-type="index:locator" href="#calibre_link-1734" class="calibre4">Summary</a></li><li class="calibre55"><span data-type="index-term" class="calibre">using const instead of</span>, <a data-type="index:locator" href="#calibre_link-1735" class="calibre4">boolean</a></li><li class="calibre55"><span data-type="index-term" class="calibre">variable declarations with</span>, <a data-type="index:locator" href="#calibre_link-1736" class="calibre4">Type aliases</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">variables</span><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">ambient variable declarations</span>, <a data-type="index:locator" href="#calibre_link-1737" class="calibre4">Ambient Variable Declarations</a></li><li class="calibre55"><span data-type="index-term" class="calibre">ambient versus regular declarations</span>, <a data-type="index:locator" href="#calibre_link-1738" class="calibre4">Type Declarations</a></li><li class="calibre55"><span data-type="index-term" class="calibre">declaring, then initializing with values</span>, <a data-type="index:locator" href="#calibre_link-1739" class="calibre4">Objects</a></li><li class="calibre55"><span data-type="index-term" class="calibre">immutable, no type widening</span>, <a data-type="index:locator" href="#calibre_link-1740" class="calibre4">Type Widening</a></li><li class="calibre55"><span data-type="index-term" class="calibre">mutable, type widening</span>, <a data-type="index:locator" href="#calibre_link-1741" class="calibre4">Type Widening</a></li><li class="calibre55"><span data-type="index-term" class="calibre">with explicitly annotated types</span>, <a data-type="index:locator" href="#calibre_link-1742" class="calibre4">The Type System</a></li><li class="calibre55"><span data-type="index-term" class="calibre">with implicitly inferred types</span>, <a data-type="index:locator" href="#calibre_link-1743" class="calibre4">The Type System</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">variadic functions</span>, <a data-type="index:locator" href="#calibre_link-1744" class="calibre4">Rest Parameters</a></li><li class="calibre55"><span data-type="index-term" class="calibre">variance</span>, <a data-type="index:locator" href="#calibre_link-1745" class="calibre4">Variance</a>-<a data-type="index:locator" href="#calibre_link-1746" class="calibre4">Function variance</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">function</span>, <a data-type="index:locator" href="#calibre_link-1747" class="calibre4">Function variance</a></li><li class="calibre55"><span data-type="index-term" class="calibre">kinds of</span>, <a data-type="index:locator" href="#calibre_link-1748" class="calibre4">Shape and array variance</a></li><li class="calibre55"><span data-type="index-term" class="calibre">shape and array</span>, <a data-type="index:locator" href="#calibre_link-1749" class="calibre4">Shape and array variance</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">view layer of frontend applications (React)</span>, <a data-type="index:locator" href="#calibre_link-1750" class="calibre4">React</a></li><li class="calibre55"><span data-type="index-term" class="calibre">void type</span>, <a data-type="index:locator" href="#calibre_link-1751" class="calibre4">null, undefined, void, and never</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">summary of usage</span>, <a data-type="index:locator" href="#calibre_link-1752" class="calibre4">null, undefined, void, and never</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">VSCode</span>, <a data-type="index:locator" href="#calibre_link-1753" class="calibre4">Code Editor Setup</a></li></ul></div><div data-type="indexdiv" class="preface"><h3 class="calibre54">W</h3><ul class="printings"><li class="calibre55"><span data-type="index-term" class="calibre">weakly typed languages</span>, <a data-type="index:locator" href="#calibre_link-1754" class="calibre4">Are types automatically converted?</a></li><li class="calibre55"><span data-type="index-term" class="calibre">web page for this book</span>, <a data-type="index:locator" href="#calibre_link-1755" class="calibre4">How to Contact Us</a></li><li class="calibre55"><span data-type="index-term" class="calibre">Web Workers, typesafe multithreading with</span>, <a data-type="index:locator" href="#calibre_link-1756" class="calibre4">In the Browser: With Web Workers</a>-<a data-type="index:locator" href="#calibre_link-1757" class="calibre4">Typesafe protocols</a><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">abstracting snowflake API behind EvenEmitter-based API</span>, <a data-type="index:locator" href="#calibre_link-1758" class="calibre4">In the Browser: With Web Workers</a></li><li class="calibre55"><span data-type="index-term" class="calibre">message passing API</span>, <a data-type="index:locator" href="#calibre_link-1759" class="calibre4">In the Browser: With Web Workers</a></li><li class="calibre55"><span data-type="index-term" class="calibre">onmessage API</span>, <a data-type="index:locator" href="#calibre_link-1760" class="calibre4">In the Browser: With Web Workers</a></li><li class="calibre55"><span data-type="index-term" class="calibre">typesafe protocols</span>, <a data-type="index:locator" href="#calibre_link-1761" class="calibre4">Typesafe protocols</a></li></ul></li><li class="calibre55"><span data-type="index-term" class="calibre">widening types</span> (<span data-gentext="see" class="calibre">see</span> type widening)</li><li class="calibre55"><span data-type="index-term" class="calibre">WindowEventMap interface</span>, <a data-type="index:locator" href="#calibre_link-1762" class="calibre4">Event Emitters</a></li><li class="calibre55"><span data-type="index-term" class="calibre">Without type</span>, <a data-type="index:locator" href="#calibre_link-1763" class="calibre4">Distributive Conditionals</a></li></ul></div><div data-type="indexdiv" class="preface"><h3 class="calibre54">X</h3><ul class="printings"><li class="calibre55"><span data-type="index-term" class="calibre">XML</span><ul class="calibre56"><li class="calibre55"><span data-type="index-term" class="calibre">JSX (JavaScript XML)</span>, <a data-type="index:locator" href="#calibre_link-1764" class="calibre4">A JSX primer</a></li><li class="calibre55"><span data-type="index-term" class="calibre">tags in triple-slash directives</span>, <a data-type="index:locator" href="#calibre_link-1765" class="calibre4">Triple-Slash Directives</a></li><li class="calibre55"><span data-type="index-term" class="calibre">TSX (JSX and TypeScript)</span>, <a data-type="index:locator" href="#calibre_link-1766" class="calibre4">TSX = JSX + TypeScript</a></li><li class="calibre55"><span data-type="index-term" class="calibre">using TSX with React</span>, <a data-type="index:locator" href="#calibre_link-1767" class="calibre4">Using TSX with React</a>-<a data-type="index:locator" href="#calibre_link-1768" class="calibre4">Using TSX with React</a></li></ul></li></ul></div><div data-type="indexdiv" class="preface"><h3 class="calibre54">Y</h3><ul class="printings"><li class="calibre55"><span data-type="index-term" class="calibre">yield keyword</span>, <a data-type="index:locator" href="#calibre_link-1769" class="calibre4">Generator Functions</a></li></ul></div></div></div></section></div>

<div data-type="book" class="calibre1" id="calibre_link-1770"><section class="preface" data-pdf-bookmark="About the Author" data-type="colophon" type="colophon"><div class="preface" id="calibre_link-1952">
  <h1 class="calibre3">About the Author</h1>
  <p class="author1"><strong class="calibre38">Boris Cherny</strong> is an engineering and product leader at Facebook. Previously, he worked in VC, ad tech, and at a bunch of startups, most of which aren’t around anymore. He is interested in programming languages, code synthesis and static analysis, and building user experiences that people love. In his free time, he runs the San Francisco TypeScript Meetup and writes on his personal blog, <a class="calibre4" href="https://performancejs.com/"><em class="calibre5">performancejs.com</em></a>. Find him on GitHub at <a href="https://github.com/bcherny" class="calibre4"><em class="calibre5">https://github.com/bcherny</em></a>.</p>
</div></section></div>

<div data-type="book" class="calibre1" id="calibre_link-1771"><section data-pdf-bookmark="Colophon" data-type="colophon" type="colophon" class="preface"><div class="preface" id="calibre_link-1953">
  <h1 class="calibre3">Colophon</h1>

 <p class="author1">The animal on the cover of <em class="calibre5">Programming TypeScript</em> is a guanaco (<em class="calibre5">Lama guanicoe</em>). Guanacos are the wild ancestors of llamas and are also related to camels. Before sheep were introduced to the continent, guanacos could be found throughout much of South America. They live in the dry, steep, mountainous regions, ranging as high as 13,000 feet above sea level. Most of the 600,000 guanaco live in Argentina today, specifically favoring the Patagonia region.</p>

<p class="author1">To survive the rocky and sloped terrain, a guanaco has two padded toes on each foot and a low center of gravity. The average height of a guanaco is under four feet at the shoulder. Their thick wool coats are light to medium, reddish brown with near white coloring underneath. Long eyelashes protect their eyes from strong winds, and big, pointed ears help them sense threats.</p>

<p class="author1">Guanacos travel in herds made up of several females, young under one year of age, and a single breeding male. When they feel threatened, guanacos alert their herd to flee with a high-pitched bleat that some say sounds like a barking laugh. Pumas and foxes prey on guanacos, so they take turns standing on hills and shrieking to alert the rest of the herd when it’s time to run to safety. A guanaco can typically run up to 35 miles per hour. If a predator chases the herd, the male will run to the back in defense.</p>

<p class="author1">It takes nearly a full year for a guanaco to gestate. Once born, a <em class="calibre5">chulengo</em>, as they’re called, needs only five minutes before it can begin to walk. After a year living with their parents, chulengos must find their own herds. This abrupt dismissal may contribute to the low survival rate among guanaco young&mdash;just 30% reach adulthood. An adult can live for 15 to 20 years.</p>

 <p class="author1">On the rugged slopes and scrub of the guanaco habitat, grasses and vegetation are tough, thick, and a crucial source of hydration. Guanacos have three-chamber stomachs that help them digest the plants and retain the liquid for longer periods of time. Their upper lips are split in two&mdash;an adaptation that makes grabbing their food <span class="calibre">easier</span>.</p>

 <p class="author1">Many of the animals on O’Reilly covers are endangered; all of them are important to the world.</p>

 <p class="author1">The cover illustration is by Karen Montgomery, based on a black and white engraving from the <em class="calibre5">Pictorial Museum of Animated Nature</em>. The cover fonts are Gilroy Semibold and Guardian Sans. The text font is Adobe Minion Pro; the heading font is Adobe Myriad Condensed; and the code font is Dalton Maag’s Ubuntu Mono.</p>

</div></section></div>

</body></html>